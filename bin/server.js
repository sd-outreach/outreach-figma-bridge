#!/usr/bin/env node
// Outreach Figma MCP Bridge â€” bundled server
"use strict";var Kv=Object.create;var ma=Object.defineProperty;var Xv=Object.getOwnPropertyDescriptor;var Yv=Object.getOwnPropertyNames;var Qv=Object.getPrototypeOf,eb=Object.prototype.hasOwnProperty;var k=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ha=(t,e)=>{for(var r in e)ma(t,r,{get:e[r],enumerable:!0})},tb=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Yv(e))!eb.call(t,o)&&o!==r&&ma(t,o,{get:()=>e[o],enumerable:!(n=Xv(e,o))||n.enumerable});return t};var Xt=(t,e,r)=>(r=t!=null?Kv(Qv(t)):{},tb(e||!t||!t.__esModule?ma(r,"default",{value:t,enumerable:!0}):r,t));var xo=k(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.regexpCode=ee.getEsmExportName=ee.getProperty=ee.safeStringify=ee.stringify=ee.strConcat=ee.addCodeArg=ee.str=ee._=ee.nil=ee._Code=ee.Name=ee.IDENTIFIER=ee._CodeOrName=void 0;var vo=class{};ee._CodeOrName=vo;ee.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var Vr=class extends vo{constructor(e){if(super(),!ee.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}};ee.Name=Vr;var it=class extends vo{constructor(e){super(),this._items=typeof e=="string"?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let e=this._items[0];return e===""||e==='""'}get str(){var e;return(e=this._str)!==null&&e!==void 0?e:this._str=this._items.reduce((r,n)=>`${r}${n}`,"")}get names(){var e;return(e=this._names)!==null&&e!==void 0?e:this._names=this._items.reduce((r,n)=>(n instanceof Vr&&(r[n.str]=(r[n.str]||0)+1),r),{})}};ee._Code=it;ee.nil=new it("");function _h(t,...e){let r=[t[0]],n=0;for(;n<e.length;)Ql(r,e[n]),r.push(t[++n]);return new it(r)}ee._=_h;var Yl=new it("+");function vh(t,...e){let r=[bo(t[0])],n=0;for(;n<e.length;)r.push(Yl),Ql(r,e[n]),r.push(Yl,bo(t[++n]));return t$(r),new it(r)}ee.str=vh;function Ql(t,e){e instanceof it?t.push(...e._items):e instanceof Vr?t.push(e):t.push(o$(e))}ee.addCodeArg=Ql;function t$(t){let e=1;for(;e<t.length-1;){if(t[e]===Yl){let r=r$(t[e-1],t[e+1]);if(r!==void 0){t.splice(e-1,3,r);continue}t[e++]="+"}e++}}function r$(t,e){if(e==='""')return t;if(t==='""')return e;if(typeof t=="string")return e instanceof Vr||t[t.length-1]!=='"'?void 0:typeof e!="string"?`${t.slice(0,-1)}${e}"`:e[0]==='"'?t.slice(0,-1)+e.slice(1):void 0;if(typeof e=="string"&&e[0]==='"'&&!(t instanceof Vr))return`"${t}${e.slice(1)}`}function n$(t,e){return e.emptyStr()?t:t.emptyStr()?e:vh`${t}${e}`}ee.strConcat=n$;function o$(t){return typeof t=="number"||typeof t=="boolean"||t===null?t:bo(Array.isArray(t)?t.join(","):t)}function s$(t){return new it(bo(t))}ee.stringify=s$;function bo(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}ee.safeStringify=bo;function i$(t){return typeof t=="string"&&ee.IDENTIFIER.test(t)?new it(`.${t}`):_h`[${t}]`}ee.getProperty=i$;function a$(t){if(typeof t=="string"&&ee.IDENTIFIER.test(t))return new it(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)}ee.getEsmExportName=a$;function c$(t){return new it(t.toString())}ee.regexpCode=c$});var ru=k(We=>{"use strict";Object.defineProperty(We,"__esModule",{value:!0});We.ValueScope=We.ValueScopeName=We.Scope=We.varKinds=We.UsedValueState=void 0;var Ge=xo(),eu=class extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}},ii;(function(t){t[t.Started=0]="Started",t[t.Completed=1]="Completed"})(ii||(We.UsedValueState=ii={}));We.varKinds={const:new Ge.Name("const"),let:new Ge.Name("let"),var:new Ge.Name("var")};var ai=class{constructor({prefixes:e,parent:r}={}){this._names={},this._prefixes=e,this._parent=r}toName(e){return e instanceof Ge.Name?e:this.name(e)}name(e){return new Ge.Name(this._newName(e))}_newName(e){let r=this._names[e]||this._nameGroup(e);return`${e}${r.index++}`}_nameGroup(e){var r,n;if(!((n=(r=this._parent)===null||r===void 0?void 0:r._prefixes)===null||n===void 0)&&n.has(e)||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}};We.Scope=ai;var ci=class extends Ge.Name{constructor(e,r){super(r),this.prefix=e}setValue(e,{property:r,itemIndex:n}){this.value=e,this.scopePath=(0,Ge._)`.${new Ge.Name(r)}[${n}]`}};We.ValueScopeName=ci;var l$=(0,Ge._)`\n`,tu=class extends ai{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?l$:Ge.nil}}get(){return this._scope}name(e){return new ci(e,this._newName(e))}value(e,r){var n;if(r.ref===void 0)throw new Error("CodeGen: ref must be passed in value");let o=this.toName(e),{prefix:s}=o,i=(n=r.key)!==null&&n!==void 0?n:r.ref,a=this._values[s];if(a){let u=a.get(i);if(u)return u}else a=this._values[s]=new Map;a.set(i,o);let c=this._scope[s]||(this._scope[s]=[]),l=c.length;return c[l]=r.ref,o.setValue(r,{property:s,itemIndex:l}),o}getValue(e,r){let n=this._values[e];if(n)return n.get(r)}scopeRefs(e,r=this._values){return this._reduceValues(r,n=>{if(n.scopePath===void 0)throw new Error(`CodeGen: name "${n}" has no value`);return(0,Ge._)`${e}${n.scopePath}`})}scopeCode(e=this._values,r,n){return this._reduceValues(e,o=>{if(o.value===void 0)throw new Error(`CodeGen: name "${o}" has no value`);return o.value.code},r,n)}_reduceValues(e,r,n={},o){let s=Ge.nil;for(let i in e){let a=e[i];if(!a)continue;let c=n[i]=n[i]||new Map;a.forEach(l=>{if(c.has(l))return;c.set(l,ii.Started);let u=r(l);if(u){let d=this.opts.es5?We.varKinds.var:We.varKinds.const;s=(0,Ge._)`${s}${d} ${l} = ${u};${this.opts._n}`}else if(u=o?.(l))s=(0,Ge._)`${s}${u}${this.opts._n}`;else throw new eu(l);c.set(l,ii.Completed)})}return s}};We.ValueScope=tu});var B=k(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.or=H.and=H.not=H.CodeGen=H.operators=H.varKinds=H.ValueScopeName=H.ValueScope=H.Scope=H.Name=H.regexpCode=H.stringify=H.getProperty=H.nil=H.strConcat=H.str=H._=void 0;var Y=xo(),yt=ru(),cr=xo();Object.defineProperty(H,"_",{enumerable:!0,get:function(){return cr._}});Object.defineProperty(H,"str",{enumerable:!0,get:function(){return cr.str}});Object.defineProperty(H,"strConcat",{enumerable:!0,get:function(){return cr.strConcat}});Object.defineProperty(H,"nil",{enumerable:!0,get:function(){return cr.nil}});Object.defineProperty(H,"getProperty",{enumerable:!0,get:function(){return cr.getProperty}});Object.defineProperty(H,"stringify",{enumerable:!0,get:function(){return cr.stringify}});Object.defineProperty(H,"regexpCode",{enumerable:!0,get:function(){return cr.regexpCode}});Object.defineProperty(H,"Name",{enumerable:!0,get:function(){return cr.Name}});var fi=ru();Object.defineProperty(H,"Scope",{enumerable:!0,get:function(){return fi.Scope}});Object.defineProperty(H,"ValueScope",{enumerable:!0,get:function(){return fi.ValueScope}});Object.defineProperty(H,"ValueScopeName",{enumerable:!0,get:function(){return fi.ValueScopeName}});Object.defineProperty(H,"varKinds",{enumerable:!0,get:function(){return fi.varKinds}});H.operators={GT:new Y._Code(">"),GTE:new Y._Code(">="),LT:new Y._Code("<"),LTE:new Y._Code("<="),EQ:new Y._Code("==="),NEQ:new Y._Code("!=="),NOT:new Y._Code("!"),OR:new Y._Code("||"),AND:new Y._Code("&&"),ADD:new Y._Code("+")};var Ft=class{optimizeNodes(){return this}optimizeNames(e,r){return this}},nu=class extends Ft{constructor(e,r,n){super(),this.varKind=e,this.name=r,this.rhs=n}render({es5:e,_n:r}){let n=e?yt.varKinds.var:this.varKind,o=this.rhs===void 0?"":` = ${this.rhs}`;return`${n} ${this.name}${o};`+r}optimizeNames(e,r){if(e[this.name.str])return this.rhs&&(this.rhs=Sn(this.rhs,e,r)),this}get names(){return this.rhs instanceof Y._CodeOrName?this.rhs.names:{}}},li=class extends Ft{constructor(e,r,n){super(),this.lhs=e,this.rhs=r,this.sideEffects=n}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof Y.Name&&!e[this.lhs.str]&&!this.sideEffects))return this.rhs=Sn(this.rhs,e,r),this}get names(){let e=this.lhs instanceof Y.Name?{}:{...this.lhs.names};return di(e,this.rhs)}},ou=class extends li{constructor(e,r,n,o){super(e,n,o),this.op=r}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}},su=class extends Ft{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}},iu=class extends Ft{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}},au=class extends Ft{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}},cu=class extends Ft{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,r){return this.code=Sn(this.code,e,r),this}get names(){return this.code instanceof Y._CodeOrName?this.code.names:{}}},wo=class extends Ft{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((r,n)=>r+n.render(e),"")}optimizeNodes(){let{nodes:e}=this,r=e.length;for(;r--;){let n=e[r].optimizeNodes();Array.isArray(n)?e.splice(r,1,...n):n?e[r]=n:e.splice(r,1)}return e.length>0?this:void 0}optimizeNames(e,r){let{nodes:n}=this,o=n.length;for(;o--;){let s=n[o];s.optimizeNames(e,r)||(u$(e,s.names),n.splice(o,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((e,r)=>Gr(e,r.names),{})}},Ut=class extends wo{render(e){return"{"+e._n+super.render(e)+"}"+e._n}},lu=class extends wo{},wn=class extends Ut{};wn.kind="else";var Br=class t extends Ut{constructor(e,r){super(r),this.condition=e}render(e){let r=`if(${this.condition})`+super.render(e);return this.else&&(r+="else "+this.else.render(e)),r}optimizeNodes(){super.optimizeNodes();let e=this.condition;if(e===!0)return this.nodes;let r=this.else;if(r){let n=r.optimizeNodes();r=this.else=Array.isArray(n)?new wn(n):n}if(r)return e===!1?r instanceof t?r:r.nodes:this.nodes.length?this:new t(bh(e),r instanceof t?[r]:r.nodes);if(!(e===!1||!this.nodes.length))return this}optimizeNames(e,r){var n;if(this.else=(n=this.else)===null||n===void 0?void 0:n.optimizeNames(e,r),!!(super.optimizeNames(e,r)||this.else))return this.condition=Sn(this.condition,e,r),this}get names(){let e=super.names;return di(e,this.condition),this.else&&Gr(e,this.else.names),e}};Br.kind="if";var Hr=class extends Ut{};Hr.kind="for";var uu=class extends Hr{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iteration=Sn(this.iteration,e,r),this}get names(){return Gr(super.names,this.iteration.names)}},du=class extends Hr{constructor(e,r,n,o){super(),this.varKind=e,this.name=r,this.from=n,this.to=o}render(e){let r=e.es5?yt.varKinds.var:this.varKind,{name:n,from:o,to:s}=this;return`for(${r} ${n}=${o}; ${n}<${s}; ${n}++)`+super.render(e)}get names(){let e=di(super.names,this.from);return di(e,this.to)}},ui=class extends Hr{constructor(e,r,n,o){super(),this.loop=e,this.varKind=r,this.name=n,this.iterable=o}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iterable=Sn(this.iterable,e,r),this}get names(){return Gr(super.names,this.iterable.names)}},So=class extends Ut{constructor(e,r,n){super(),this.name=e,this.args=r,this.async=n}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}};So.kind="func";var $o=class extends wo{render(e){return"return "+super.render(e)}};$o.kind="return";var fu=class extends Ut{render(e){let r="try"+super.render(e);return this.catch&&(r+=this.catch.render(e)),this.finally&&(r+=this.finally.render(e)),r}optimizeNodes(){var e,r;return super.optimizeNodes(),(e=this.catch)===null||e===void 0||e.optimizeNodes(),(r=this.finally)===null||r===void 0||r.optimizeNodes(),this}optimizeNames(e,r){var n,o;return super.optimizeNames(e,r),(n=this.catch)===null||n===void 0||n.optimizeNames(e,r),(o=this.finally)===null||o===void 0||o.optimizeNames(e,r),this}get names(){let e=super.names;return this.catch&&Gr(e,this.catch.names),this.finally&&Gr(e,this.finally.names),e}},ko=class extends Ut{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}};ko.kind="catch";var To=class extends Ut{render(e){return"finally"+super.render(e)}};To.kind="finally";var pu=class{constructor(e,r={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...r,_n:r.lines?`
`:""},this._extScope=e,this._scope=new yt.Scope({parent:e}),this._nodes=[new lu]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,r){let n=this._extScope.value(e,r);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(e,r){return this._extScope.getValue(e,r)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,r,n,o){let s=this._scope.toName(r);return n!==void 0&&o&&(this._constants[s.str]=n),this._leafNode(new nu(e,s,n)),s}const(e,r,n){return this._def(yt.varKinds.const,e,r,n)}let(e,r,n){return this._def(yt.varKinds.let,e,r,n)}var(e,r,n){return this._def(yt.varKinds.var,e,r,n)}assign(e,r,n){return this._leafNode(new li(e,r,n))}add(e,r){return this._leafNode(new ou(e,H.operators.ADD,r))}code(e){return typeof e=="function"?e():e!==Y.nil&&this._leafNode(new cu(e)),this}object(...e){let r=["{"];for(let[n,o]of e)r.length>1&&r.push(","),r.push(n),(n!==o||this.opts.es5)&&(r.push(":"),(0,Y.addCodeArg)(r,o));return r.push("}"),new Y._Code(r)}if(e,r,n){if(this._blockNode(new Br(e)),r&&n)this.code(r).else().code(n).endIf();else if(r)this.code(r).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new Br(e))}else(){return this._elseNode(new wn)}endIf(){return this._endBlockNode(Br,wn)}_for(e,r){return this._blockNode(e),r&&this.code(r).endFor(),this}for(e,r){return this._for(new uu(e),r)}forRange(e,r,n,o,s=this.opts.es5?yt.varKinds.var:yt.varKinds.let){let i=this._scope.toName(e);return this._for(new du(s,i,r,n),()=>o(i))}forOf(e,r,n,o=yt.varKinds.const){let s=this._scope.toName(e);if(this.opts.es5){let i=r instanceof Y.Name?r:this.var("_arr",r);return this.forRange("_i",0,(0,Y._)`${i}.length`,a=>{this.var(s,(0,Y._)`${i}[${a}]`),n(s)})}return this._for(new ui("of",o,s,r),()=>n(s))}forIn(e,r,n,o=this.opts.es5?yt.varKinds.var:yt.varKinds.const){if(this.opts.ownProperties)return this.forOf(e,(0,Y._)`Object.keys(${r})`,n);let s=this._scope.toName(e);return this._for(new ui("in",o,s,r),()=>n(s))}endFor(){return this._endBlockNode(Hr)}label(e){return this._leafNode(new su(e))}break(e){return this._leafNode(new iu(e))}return(e){let r=new $o;if(this._blockNode(r),this.code(e),r.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode($o)}try(e,r,n){if(!r&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');let o=new fu;if(this._blockNode(o),this.code(e),r){let s=this.name("e");this._currNode=o.catch=new ko(s),r(s)}return n&&(this._currNode=o.finally=new To,this.code(n)),this._endBlockNode(ko,To)}throw(e){return this._leafNode(new au(e))}block(e,r){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(r),this}endBlock(e){let r=this._blockStarts.pop();if(r===void 0)throw new Error("CodeGen: not in self-balancing block");let n=this._nodes.length-r;if(n<0||e!==void 0&&n!==e)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${e} expected`);return this._nodes.length=r,this}func(e,r=Y.nil,n,o){return this._blockNode(new So(e,r,n)),o&&this.code(o).endFunc(),this}endFunc(){return this._endBlockNode(So)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,r){let n=this._currNode;if(n instanceof e||r&&n instanceof r)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${r?`${e.kind}/${r.kind}`:e.kind}"`)}_elseNode(e){let r=this._currNode;if(!(r instanceof Br))throw new Error('CodeGen: "else" without "if"');return this._currNode=r.else=e,this}get _root(){return this._nodes[0]}get _currNode(){let e=this._nodes;return e[e.length-1]}set _currNode(e){let r=this._nodes;r[r.length-1]=e}};H.CodeGen=pu;function Gr(t,e){for(let r in e)t[r]=(t[r]||0)+(e[r]||0);return t}function di(t,e){return e instanceof Y._CodeOrName?Gr(t,e.names):t}function Sn(t,e,r){if(t instanceof Y.Name)return n(t);if(!o(t))return t;return new Y._Code(t._items.reduce((s,i)=>(i instanceof Y.Name&&(i=n(i)),i instanceof Y._Code?s.push(...i._items):s.push(i),s),[]));function n(s){let i=r[s.str];return i===void 0||e[s.str]!==1?s:(delete e[s.str],i)}function o(s){return s instanceof Y._Code&&s._items.some(i=>i instanceof Y.Name&&e[i.str]===1&&r[i.str]!==void 0)}}function u$(t,e){for(let r in e)t[r]=(t[r]||0)-(e[r]||0)}function bh(t){return typeof t=="boolean"||typeof t=="number"||t===null?!t:(0,Y._)`!${mu(t)}`}H.not=bh;var d$=xh(H.operators.AND);function f$(...t){return t.reduce(d$)}H.and=f$;var p$=xh(H.operators.OR);function m$(...t){return t.reduce(p$)}H.or=m$;function xh(t){return(e,r)=>e===Y.nil?r:r===Y.nil?e:(0,Y._)`${mu(e)} ${t} ${mu(r)}`}function mu(t){return t instanceof Y.Name?t:(0,Y._)`(${t})`}});var te=k(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.checkStrictMode=G.getErrorPath=G.Type=G.useFunc=G.setEvaluated=G.evaluatedPropsToName=G.mergeEvaluated=G.eachItem=G.unescapeJsonPointer=G.escapeJsonPointer=G.escapeFragment=G.unescapeFragment=G.schemaRefOrVal=G.schemaHasRulesButRef=G.schemaHasRules=G.checkUnknownRules=G.alwaysValidSchema=G.toHash=void 0;var se=B(),h$=xo();function g$(t){let e={};for(let r of t)e[r]=!0;return e}G.toHash=g$;function y$(t,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:($h(t,e),!kh(e,t.self.RULES.all))}G.alwaysValidSchema=y$;function $h(t,e=t.schema){let{opts:r,self:n}=t;if(!r.strictSchema||typeof e=="boolean")return;let o=n.RULES.keywords;for(let s in e)o[s]||Ih(t,`unknown keyword: "${s}"`)}G.checkUnknownRules=$h;function kh(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(e[r])return!0;return!1}G.schemaHasRules=kh;function _$(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(r!=="$ref"&&e.all[r])return!0;return!1}G.schemaHasRulesButRef=_$;function v$({topSchemaRef:t,schemaPath:e},r,n,o){if(!o){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,se._)`${r}`}return(0,se._)`${t}${e}${(0,se.getProperty)(n)}`}G.schemaRefOrVal=v$;function b$(t){return Th(decodeURIComponent(t))}G.unescapeFragment=b$;function x$(t){return encodeURIComponent(gu(t))}G.escapeFragment=x$;function gu(t){return typeof t=="number"?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}G.escapeJsonPointer=gu;function Th(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}G.unescapeJsonPointer=Th;function w$(t,e){if(Array.isArray(t))for(let r of t)e(r);else e(t)}G.eachItem=w$;function wh({mergeNames:t,mergeToName:e,mergeValues:r,resultToName:n}){return(o,s,i,a)=>{let c=i===void 0?s:i instanceof se.Name?(s instanceof se.Name?t(o,s,i):e(o,s,i),i):s instanceof se.Name?(e(o,i,s),s):r(s,i);return a===se.Name&&!(c instanceof se.Name)?n(o,c):c}}G.mergeEvaluated={props:wh({mergeNames:(t,e,r)=>t.if((0,se._)`${r} !== true && ${e} !== undefined`,()=>{t.if((0,se._)`${e} === true`,()=>t.assign(r,!0),()=>t.assign(r,(0,se._)`${r} || {}`).code((0,se._)`Object.assign(${r}, ${e})`))}),mergeToName:(t,e,r)=>t.if((0,se._)`${r} !== true`,()=>{e===!0?t.assign(r,!0):(t.assign(r,(0,se._)`${r} || {}`),yu(t,r,e))}),mergeValues:(t,e)=>t===!0?!0:{...t,...e},resultToName:Eh}),items:wh({mergeNames:(t,e,r)=>t.if((0,se._)`${r} !== true && ${e} !== undefined`,()=>t.assign(r,(0,se._)`${e} === true ? true : ${r} > ${e} ? ${r} : ${e}`)),mergeToName:(t,e,r)=>t.if((0,se._)`${r} !== true`,()=>t.assign(r,e===!0?!0:(0,se._)`${r} > ${e} ? ${r} : ${e}`)),mergeValues:(t,e)=>t===!0?!0:Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})};function Eh(t,e){if(e===!0)return t.var("props",!0);let r=t.var("props",(0,se._)`{}`);return e!==void 0&&yu(t,r,e),r}G.evaluatedPropsToName=Eh;function yu(t,e,r){Object.keys(r).forEach(n=>t.assign((0,se._)`${e}${(0,se.getProperty)(n)}`,!0))}G.setEvaluated=yu;var Sh={};function S$(t,e){return t.scopeValue("func",{ref:e,code:Sh[e.code]||(Sh[e.code]=new h$._Code(e.code))})}G.useFunc=S$;var hu;(function(t){t[t.Num=0]="Num",t[t.Str=1]="Str"})(hu||(G.Type=hu={}));function $$(t,e,r){if(t instanceof se.Name){let n=e===hu.Num;return r?n?(0,se._)`"[" + ${t} + "]"`:(0,se._)`"['" + ${t} + "']"`:n?(0,se._)`"/" + ${t}`:(0,se._)`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,se.getProperty)(t).toString():"/"+gu(t)}G.getErrorPath=$$;function Ih(t,e,r=t.opts.strictSchema){if(r){if(e=`strict mode: ${e}`,r===!0)throw new Error(e);t.self.logger.warn(e)}}G.checkStrictMode=Ih});var qt=k(_u=>{"use strict";Object.defineProperty(_u,"__esModule",{value:!0});var Ce=B(),k$={data:new Ce.Name("data"),valCxt:new Ce.Name("valCxt"),instancePath:new Ce.Name("instancePath"),parentData:new Ce.Name("parentData"),parentDataProperty:new Ce.Name("parentDataProperty"),rootData:new Ce.Name("rootData"),dynamicAnchors:new Ce.Name("dynamicAnchors"),vErrors:new Ce.Name("vErrors"),errors:new Ce.Name("errors"),this:new Ce.Name("this"),self:new Ce.Name("self"),scope:new Ce.Name("scope"),json:new Ce.Name("json"),jsonPos:new Ce.Name("jsonPos"),jsonLen:new Ce.Name("jsonLen"),jsonPart:new Ce.Name("jsonPart")};_u.default=k$});var Eo=k(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.extendErrors=Ae.resetErrorsCount=Ae.reportExtraError=Ae.reportError=Ae.keyword$DataError=Ae.keywordError=void 0;var Q=B(),pi=te(),Ze=qt();Ae.keywordError={message:({keyword:t})=>(0,Q.str)`must pass "${t}" keyword validation`};Ae.keyword$DataError={message:({keyword:t,schemaType:e})=>e?(0,Q.str)`"${t}" keyword must be ${e} ($data)`:(0,Q.str)`"${t}" keyword is invalid ($data)`};function T$(t,e=Ae.keywordError,r,n){let{it:o}=t,{gen:s,compositeRule:i,allErrors:a}=o,c=Nh(t,e,r);n??(i||a)?zh(s,c):Ph(o,(0,Q._)`[${c}]`)}Ae.reportError=T$;function E$(t,e=Ae.keywordError,r){let{it:n}=t,{gen:o,compositeRule:s,allErrors:i}=n,a=Nh(t,e,r);zh(o,a),s||i||Ph(n,Ze.default.vErrors)}Ae.reportExtraError=E$;function I$(t,e){t.assign(Ze.default.errors,e),t.if((0,Q._)`${Ze.default.vErrors} !== null`,()=>t.if(e,()=>t.assign((0,Q._)`${Ze.default.vErrors}.length`,e),()=>t.assign(Ze.default.vErrors,null)))}Ae.resetErrorsCount=I$;function z$({gen:t,keyword:e,schemaValue:r,data:n,errsCount:o,it:s}){if(o===void 0)throw new Error("ajv implementation error");let i=t.name("err");t.forRange("i",o,Ze.default.errors,a=>{t.const(i,(0,Q._)`${Ze.default.vErrors}[${a}]`),t.if((0,Q._)`${i}.instancePath === undefined`,()=>t.assign((0,Q._)`${i}.instancePath`,(0,Q.strConcat)(Ze.default.instancePath,s.errorPath))),t.assign((0,Q._)`${i}.schemaPath`,(0,Q.str)`${s.errSchemaPath}/${e}`),s.opts.verbose&&(t.assign((0,Q._)`${i}.schema`,r),t.assign((0,Q._)`${i}.data`,n))})}Ae.extendErrors=z$;function zh(t,e){let r=t.const("err",e);t.if((0,Q._)`${Ze.default.vErrors} === null`,()=>t.assign(Ze.default.vErrors,(0,Q._)`[${r}]`),(0,Q._)`${Ze.default.vErrors}.push(${r})`),t.code((0,Q._)`${Ze.default.errors}++`)}function Ph(t,e){let{gen:r,validateName:n,schemaEnv:o}=t;o.$async?r.throw((0,Q._)`new ${t.ValidationError}(${e})`):(r.assign((0,Q._)`${n}.errors`,e),r.return(!1))}var Wr={keyword:new Q.Name("keyword"),schemaPath:new Q.Name("schemaPath"),params:new Q.Name("params"),propertyName:new Q.Name("propertyName"),message:new Q.Name("message"),schema:new Q.Name("schema"),parentSchema:new Q.Name("parentSchema")};function Nh(t,e,r){let{createErrors:n}=t.it;return n===!1?(0,Q._)`{}`:P$(t,e,r)}function P$(t,e,r={}){let{gen:n,it:o}=t,s=[N$(o,r),O$(t,r)];return R$(t,e,s),n.object(...s)}function N$({errorPath:t},{instancePath:e}){let r=e?(0,Q.str)`${t}${(0,pi.getErrorPath)(e,pi.Type.Str)}`:t;return[Ze.default.instancePath,(0,Q.strConcat)(Ze.default.instancePath,r)]}function O$({keyword:t,it:{errSchemaPath:e}},{schemaPath:r,parentSchema:n}){let o=n?e:(0,Q.str)`${e}/${t}`;return r&&(o=(0,Q.str)`${o}${(0,pi.getErrorPath)(r,pi.Type.Str)}`),[Wr.schemaPath,o]}function R$(t,{params:e,message:r},n){let{keyword:o,data:s,schemaValue:i,it:a}=t,{opts:c,propertyName:l,topSchemaRef:u,schemaPath:d}=a;n.push([Wr.keyword,o],[Wr.params,typeof e=="function"?e(t):e||(0,Q._)`{}`]),c.messages&&n.push([Wr.message,typeof r=="function"?r(t):r]),c.verbose&&n.push([Wr.schema,i],[Wr.parentSchema,(0,Q._)`${u}${d}`],[Ze.default.data,s]),l&&n.push([Wr.propertyName,l])}});var Rh=k($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.boolOrEmptySchema=$n.topBoolOrEmptySchema=void 0;var C$=Eo(),A$=B(),M$=qt(),D$={message:"boolean schema is false"};function j$(t){let{gen:e,schema:r,validateName:n}=t;r===!1?Oh(t,!1):typeof r=="object"&&r.$async===!0?e.return(M$.default.data):(e.assign((0,A$._)`${n}.errors`,null),e.return(!0))}$n.topBoolOrEmptySchema=j$;function L$(t,e){let{gen:r,schema:n}=t;n===!1?(r.var(e,!1),Oh(t)):r.var(e,!0)}$n.boolOrEmptySchema=L$;function Oh(t,e){let{gen:r,data:n}=t,o={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,C$.reportError)(o,D$,void 0,e)}});var vu=k(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.getRules=kn.isJSONType=void 0;var Z$=["string","number","integer","boolean","null","object","array"],F$=new Set(Z$);function U$(t){return typeof t=="string"&&F$.has(t)}kn.isJSONType=U$;function q$(){let t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}kn.getRules=q$});var bu=k(lr=>{"use strict";Object.defineProperty(lr,"__esModule",{value:!0});lr.shouldUseRule=lr.shouldUseGroup=lr.schemaHasRulesForType=void 0;function V$({schema:t,self:e},r){let n=e.RULES.types[r];return n&&n!==!0&&Ch(t,n)}lr.schemaHasRulesForType=V$;function Ch(t,e){return e.rules.some(r=>Ah(t,r))}lr.shouldUseGroup=Ch;function Ah(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(n=>t[n]!==void 0))}lr.shouldUseRule=Ah});var Io=k(Me=>{"use strict";Object.defineProperty(Me,"__esModule",{value:!0});Me.reportTypeError=Me.checkDataTypes=Me.checkDataType=Me.coerceAndCheckDataType=Me.getJSONTypes=Me.getSchemaTypes=Me.DataType=void 0;var B$=vu(),H$=bu(),G$=Eo(),q=B(),Mh=te(),Tn;(function(t){t[t.Correct=0]="Correct",t[t.Wrong=1]="Wrong"})(Tn||(Me.DataType=Tn={}));function W$(t){let e=Dh(t.type);if(e.includes("null")){if(t.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&t.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');t.nullable===!0&&e.push("null")}return e}Me.getSchemaTypes=W$;function Dh(t){let e=Array.isArray(t)?t:t?[t]:[];if(e.every(B$.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}Me.getJSONTypes=Dh;function J$(t,e){let{gen:r,data:n,opts:o}=t,s=K$(e,o.coerceTypes),i=e.length>0&&!(s.length===0&&e.length===1&&(0,H$.schemaHasRulesForType)(t,e[0]));if(i){let a=wu(e,n,o.strictNumbers,Tn.Wrong);r.if(a,()=>{s.length?X$(t,e,s):Su(t)})}return i}Me.coerceAndCheckDataType=J$;var jh=new Set(["string","number","integer","boolean","null"]);function K$(t,e){return e?t.filter(r=>jh.has(r)||e==="array"&&r==="array"):[]}function X$(t,e,r){let{gen:n,data:o,opts:s}=t,i=n.let("dataType",(0,q._)`typeof ${o}`),a=n.let("coerced",(0,q._)`undefined`);s.coerceTypes==="array"&&n.if((0,q._)`${i} == 'object' && Array.isArray(${o}) && ${o}.length == 1`,()=>n.assign(o,(0,q._)`${o}[0]`).assign(i,(0,q._)`typeof ${o}`).if(wu(e,o,s.strictNumbers),()=>n.assign(a,o))),n.if((0,q._)`${a} !== undefined`);for(let l of r)(jh.has(l)||l==="array"&&s.coerceTypes==="array")&&c(l);n.else(),Su(t),n.endIf(),n.if((0,q._)`${a} !== undefined`,()=>{n.assign(o,a),Y$(t,a)});function c(l){switch(l){case"string":n.elseIf((0,q._)`${i} == "number" || ${i} == "boolean"`).assign(a,(0,q._)`"" + ${o}`).elseIf((0,q._)`${o} === null`).assign(a,(0,q._)`""`);return;case"number":n.elseIf((0,q._)`${i} == "boolean" || ${o} === null
              || (${i} == "string" && ${o} && ${o} == +${o})`).assign(a,(0,q._)`+${o}`);return;case"integer":n.elseIf((0,q._)`${i} === "boolean" || ${o} === null
              || (${i} === "string" && ${o} && ${o} == +${o} && !(${o} % 1))`).assign(a,(0,q._)`+${o}`);return;case"boolean":n.elseIf((0,q._)`${o} === "false" || ${o} === 0 || ${o} === null`).assign(a,!1).elseIf((0,q._)`${o} === "true" || ${o} === 1`).assign(a,!0);return;case"null":n.elseIf((0,q._)`${o} === "" || ${o} === 0 || ${o} === false`),n.assign(a,null);return;case"array":n.elseIf((0,q._)`${i} === "string" || ${i} === "number"
              || ${i} === "boolean" || ${o} === null`).assign(a,(0,q._)`[${o}]`)}}}function Y$({gen:t,parentData:e,parentDataProperty:r},n){t.if((0,q._)`${e} !== undefined`,()=>t.assign((0,q._)`${e}[${r}]`,n))}function xu(t,e,r,n=Tn.Correct){let o=n===Tn.Correct?q.operators.EQ:q.operators.NEQ,s;switch(t){case"null":return(0,q._)`${e} ${o} null`;case"array":s=(0,q._)`Array.isArray(${e})`;break;case"object":s=(0,q._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":s=i((0,q._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":s=i();break;default:return(0,q._)`typeof ${e} ${o} ${t}`}return n===Tn.Correct?s:(0,q.not)(s);function i(a=q.nil){return(0,q.and)((0,q._)`typeof ${e} == "number"`,a,r?(0,q._)`isFinite(${e})`:q.nil)}}Me.checkDataType=xu;function wu(t,e,r,n){if(t.length===1)return xu(t[0],e,r,n);let o,s=(0,Mh.toHash)(t);if(s.array&&s.object){let i=(0,q._)`typeof ${e} != "object"`;o=s.null?i:(0,q._)`!${e} || ${i}`,delete s.null,delete s.array,delete s.object}else o=q.nil;s.number&&delete s.integer;for(let i in s)o=(0,q.and)(o,xu(i,e,r,n));return o}Me.checkDataTypes=wu;var Q$={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>typeof t=="string"?(0,q._)`{type: ${t}}`:(0,q._)`{type: ${e}}`};function Su(t){let e=ek(t);(0,G$.reportError)(e,Q$)}Me.reportTypeError=Su;function ek(t){let{gen:e,data:r,schema:n}=t,o=(0,Mh.schemaRefOrVal)(t,n,"type");return{gen:e,keyword:"type",data:r,schema:n.type,schemaCode:o,schemaValue:o,parentSchema:n,params:{},it:t}}});var Zh=k(mi=>{"use strict";Object.defineProperty(mi,"__esModule",{value:!0});mi.assignDefaults=void 0;var En=B(),tk=te();function rk(t,e){let{properties:r,items:n}=t.schema;if(e==="object"&&r)for(let o in r)Lh(t,o,r[o].default);else e==="array"&&Array.isArray(n)&&n.forEach((o,s)=>Lh(t,s,o.default))}mi.assignDefaults=rk;function Lh(t,e,r){let{gen:n,compositeRule:o,data:s,opts:i}=t;if(r===void 0)return;let a=(0,En._)`${s}${(0,En.getProperty)(e)}`;if(o){(0,tk.checkStrictMode)(t,`default is ignored for: ${a}`);return}let c=(0,En._)`${a} === undefined`;i.useDefaults==="empty"&&(c=(0,En._)`${c} || ${a} === null || ${a} === ""`),n.if(c,(0,En._)`${a} = ${(0,En.stringify)(r)}`)}});var at=k(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.validateUnion=oe.validateArray=oe.usePattern=oe.callValidateCode=oe.schemaProperties=oe.allSchemaProperties=oe.noPropertyInData=oe.propertyInData=oe.isOwnProperty=oe.hasPropFunc=oe.reportMissingProp=oe.checkMissingProp=oe.checkReportMissingProp=void 0;var le=B(),$u=te(),ur=qt(),nk=te();function ok(t,e){let{gen:r,data:n,it:o}=t;r.if(Tu(r,n,e,o.opts.ownProperties),()=>{t.setParams({missingProperty:(0,le._)`${e}`},!0),t.error()})}oe.checkReportMissingProp=ok;function sk({gen:t,data:e,it:{opts:r}},n,o){return(0,le.or)(...n.map(s=>(0,le.and)(Tu(t,e,s,r.ownProperties),(0,le._)`${o} = ${s}`)))}oe.checkMissingProp=sk;function ik(t,e){t.setParams({missingProperty:e},!0),t.error()}oe.reportMissingProp=ik;function Fh(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,le._)`Object.prototype.hasOwnProperty`})}oe.hasPropFunc=Fh;function ku(t,e,r){return(0,le._)`${Fh(t)}.call(${e}, ${r})`}oe.isOwnProperty=ku;function ak(t,e,r,n){let o=(0,le._)`${e}${(0,le.getProperty)(r)} !== undefined`;return n?(0,le._)`${o} && ${ku(t,e,r)}`:o}oe.propertyInData=ak;function Tu(t,e,r,n){let o=(0,le._)`${e}${(0,le.getProperty)(r)} === undefined`;return n?(0,le.or)(o,(0,le.not)(ku(t,e,r))):o}oe.noPropertyInData=Tu;function Uh(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}oe.allSchemaProperties=Uh;function ck(t,e){return Uh(e).filter(r=>!(0,$u.alwaysValidSchema)(t,e[r]))}oe.schemaProperties=ck;function lk({schemaCode:t,data:e,it:{gen:r,topSchemaRef:n,schemaPath:o,errorPath:s},it:i},a,c,l){let u=l?(0,le._)`${t}, ${e}, ${n}${o}`:e,d=[[ur.default.instancePath,(0,le.strConcat)(ur.default.instancePath,s)],[ur.default.parentData,i.parentData],[ur.default.parentDataProperty,i.parentDataProperty],[ur.default.rootData,ur.default.rootData]];i.opts.dynamicRef&&d.push([ur.default.dynamicAnchors,ur.default.dynamicAnchors]);let g=(0,le._)`${u}, ${r.object(...d)}`;return c!==le.nil?(0,le._)`${a}.call(${c}, ${g})`:(0,le._)`${a}(${g})`}oe.callValidateCode=lk;var uk=(0,le._)`new RegExp`;function dk({gen:t,it:{opts:e}},r){let n=e.unicodeRegExp?"u":"",{regExp:o}=e.code,s=o(r,n);return t.scopeValue("pattern",{key:s.toString(),ref:s,code:(0,le._)`${o.code==="new RegExp"?uk:(0,nk.useFunc)(t,o)}(${r}, ${n})`})}oe.usePattern=dk;function fk(t){let{gen:e,data:r,keyword:n,it:o}=t,s=e.name("valid");if(o.allErrors){let a=e.let("valid",!0);return i(()=>e.assign(a,!1)),a}return e.var(s,!0),i(()=>e.break()),s;function i(a){let c=e.const("len",(0,le._)`${r}.length`);e.forRange("i",0,c,l=>{t.subschema({keyword:n,dataProp:l,dataPropType:$u.Type.Num},s),e.if((0,le.not)(s),a)})}}oe.validateArray=fk;function pk(t){let{gen:e,schema:r,keyword:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(c=>(0,$u.alwaysValidSchema)(o,c))&&!o.opts.unevaluated)return;let i=e.let("valid",!1),a=e.name("_valid");e.block(()=>r.forEach((c,l)=>{let u=t.subschema({keyword:n,schemaProp:l,compositeRule:!0},a);e.assign(i,(0,le._)`${i} || ${a}`),t.mergeValidEvaluated(u,a)||e.if((0,le.not)(i))})),t.result(i,()=>t.reset(),()=>t.error(!0))}oe.validateUnion=pk});var Bh=k(Et=>{"use strict";Object.defineProperty(Et,"__esModule",{value:!0});Et.validateKeywordUsage=Et.validSchemaType=Et.funcKeywordCode=Et.macroKeywordCode=void 0;var Fe=B(),Jr=qt(),mk=at(),hk=Eo();function gk(t,e){let{gen:r,keyword:n,schema:o,parentSchema:s,it:i}=t,a=e.macro.call(i.self,o,s,i),c=Vh(r,n,a);i.opts.validateSchema!==!1&&i.self.validateSchema(a,!0);let l=r.name("valid");t.subschema({schema:a,schemaPath:Fe.nil,errSchemaPath:`${i.errSchemaPath}/${n}`,topSchemaRef:c,compositeRule:!0},l),t.pass(l,()=>t.error(!0))}Et.macroKeywordCode=gk;function yk(t,e){var r;let{gen:n,keyword:o,schema:s,parentSchema:i,$data:a,it:c}=t;vk(c,e);let l=!a&&e.compile?e.compile.call(c.self,s,i,c):e.validate,u=Vh(n,o,l),d=n.let("valid");t.block$data(d,g),t.ok((r=e.valid)!==null&&r!==void 0?r:d);function g(){if(e.errors===!1)m(),e.modifying&&qh(t),y(()=>t.error());else{let b=e.async?h():f();e.modifying&&qh(t),y(()=>_k(t,b))}}function h(){let b=n.let("ruleErrs",null);return n.try(()=>m((0,Fe._)`await `),x=>n.assign(d,!1).if((0,Fe._)`${x} instanceof ${c.ValidationError}`,()=>n.assign(b,(0,Fe._)`${x}.errors`),()=>n.throw(x))),b}function f(){let b=(0,Fe._)`${u}.errors`;return n.assign(b,null),m(Fe.nil),b}function m(b=e.async?(0,Fe._)`await `:Fe.nil){let x=c.opts.passContext?Jr.default.this:Jr.default.self,w=!("compile"in e&&!a||e.schema===!1);n.assign(d,(0,Fe._)`${b}${(0,mk.callValidateCode)(t,u,x,w)}`,e.modifying)}function y(b){var x;n.if((0,Fe.not)((x=e.valid)!==null&&x!==void 0?x:d),b)}}Et.funcKeywordCode=yk;function qh(t){let{gen:e,data:r,it:n}=t;e.if(n.parentData,()=>e.assign(r,(0,Fe._)`${n.parentData}[${n.parentDataProperty}]`))}function _k(t,e){let{gen:r}=t;r.if((0,Fe._)`Array.isArray(${e})`,()=>{r.assign(Jr.default.vErrors,(0,Fe._)`${Jr.default.vErrors} === null ? ${e} : ${Jr.default.vErrors}.concat(${e})`).assign(Jr.default.errors,(0,Fe._)`${Jr.default.vErrors}.length`),(0,hk.extendErrors)(t)},()=>t.error())}function vk({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function Vh(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,Fe.stringify)(r)})}function bk(t,e,r=!1){return!e.length||e.some(n=>n==="array"?Array.isArray(t):n==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==n||r&&typeof t>"u")}Et.validSchemaType=bk;function xk({schema:t,opts:e,self:r,errSchemaPath:n},o,s){if(Array.isArray(o.keyword)?!o.keyword.includes(s):o.keyword!==s)throw new Error("ajv implementation error");let i=o.dependencies;if(i?.some(a=>!Object.prototype.hasOwnProperty.call(t,a)))throw new Error(`parent schema must have dependencies of ${s}: ${i.join(",")}`);if(o.validateSchema&&!o.validateSchema(t[s])){let c=`keyword "${s}" value is invalid at path "${n}": `+r.errorsText(o.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(c);else throw new Error(c)}}Et.validateKeywordUsage=xk});var Gh=k(dr=>{"use strict";Object.defineProperty(dr,"__esModule",{value:!0});dr.extendSubschemaMode=dr.extendSubschemaData=dr.getSubschema=void 0;var It=B(),Hh=te();function wk(t,{keyword:e,schemaProp:r,schema:n,schemaPath:o,errSchemaPath:s,topSchemaRef:i}){if(e!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){let a=t.schema[e];return r===void 0?{schema:a,schemaPath:(0,It._)`${t.schemaPath}${(0,It.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:a[r],schemaPath:(0,It._)`${t.schemaPath}${(0,It.getProperty)(e)}${(0,It.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,Hh.escapeFragment)(r)}`}}if(n!==void 0){if(o===void 0||s===void 0||i===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:o,topSchemaRef:i,errSchemaPath:s}}throw new Error('either "keyword" or "schema" must be passed')}dr.getSubschema=wk;function Sk(t,e,{dataProp:r,dataPropType:n,data:o,dataTypes:s,propertyName:i}){if(o!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');let{gen:a}=e;if(r!==void 0){let{errorPath:l,dataPathArr:u,opts:d}=e,g=a.let("data",(0,It._)`${e.data}${(0,It.getProperty)(r)}`,!0);c(g),t.errorPath=(0,It.str)`${l}${(0,Hh.getErrorPath)(r,n,d.jsPropertySyntax)}`,t.parentDataProperty=(0,It._)`${r}`,t.dataPathArr=[...u,t.parentDataProperty]}if(o!==void 0){let l=o instanceof It.Name?o:a.let("data",o,!0);c(l),i!==void 0&&(t.propertyName=i)}s&&(t.dataTypes=s);function c(l){t.data=l,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,l]}}dr.extendSubschemaData=Sk;function $k(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:n,createErrors:o,allErrors:s}){n!==void 0&&(t.compositeRule=n),o!==void 0&&(t.createErrors=o),s!==void 0&&(t.allErrors=s),t.jtdDiscriminator=e,t.jtdMetadata=r}dr.extendSubschemaMode=$k});var Eu=k((tM,Wh)=>{"use strict";Wh.exports=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,o,s;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(o=n;o--!==0;)if(!t(e[o],r[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(r).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(r,s[o]))return!1;for(o=n;o--!==0;){var i=s[o];if(!t(e[i],r[i]))return!1}return!0}return e!==e&&r!==r}});var Kh=k((rM,Jh)=>{"use strict";var fr=Jh.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var n=typeof r=="function"?r:r.pre||function(){},o=r.post||function(){};hi(e,n,o,t,"",t)};fr.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};fr.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};fr.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};fr.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function hi(t,e,r,n,o,s,i,a,c,l){if(n&&typeof n=="object"&&!Array.isArray(n)){e(n,o,s,i,a,c,l);for(var u in n){var d=n[u];if(Array.isArray(d)){if(u in fr.arrayKeywords)for(var g=0;g<d.length;g++)hi(t,e,r,d[g],o+"/"+u+"/"+g,s,o,u,n,g)}else if(u in fr.propsKeywords){if(d&&typeof d=="object")for(var h in d)hi(t,e,r,d[h],o+"/"+u+"/"+kk(h),s,o,u,n,h)}else(u in fr.keywords||t.allKeys&&!(u in fr.skipKeywords))&&hi(t,e,r,d,o+"/"+u,s,o,u,n)}r(n,o,s,i,a,c,l)}}function kk(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}});var zo=k(Je=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});Je.getSchemaRefs=Je.resolveUrl=Je.normalizeId=Je._getFullPath=Je.getFullPath=Je.inlineRef=void 0;var Tk=te(),Ek=Eu(),Ik=Kh(),zk=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function Pk(t,e=!0){return typeof t=="boolean"?!0:e===!0?!Iu(t):e?Xh(t)<=e:!1}Je.inlineRef=Pk;var Nk=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function Iu(t){for(let e in t){if(Nk.has(e))return!0;let r=t[e];if(Array.isArray(r)&&r.some(Iu)||typeof r=="object"&&Iu(r))return!0}return!1}function Xh(t){let e=0;for(let r in t){if(r==="$ref")return 1/0;if(e++,!zk.has(r)&&(typeof t[r]=="object"&&(0,Tk.eachItem)(t[r],n=>e+=Xh(n)),e===1/0))return 1/0}return e}function Yh(t,e="",r){r!==!1&&(e=In(e));let n=t.parse(e);return Qh(t,n)}Je.getFullPath=Yh;function Qh(t,e){return t.serialize(e).split("#")[0]+"#"}Je._getFullPath=Qh;var Ok=/#\/?$/;function In(t){return t?t.replace(Ok,""):""}Je.normalizeId=In;function Rk(t,e,r){return r=In(r),t.resolve(e,r)}Je.resolveUrl=Rk;var Ck=/^[a-z_][-a-z0-9._]*$/i;function Ak(t,e){if(typeof t=="boolean")return{};let{schemaId:r,uriResolver:n}=this.opts,o=In(t[r]||e),s={"":o},i=Yh(n,o,!1),a={},c=new Set;return Ik(t,{allKeys:!0},(d,g,h,f)=>{if(f===void 0)return;let m=i+g,y=s[f];typeof d[r]=="string"&&(y=b.call(this,d[r])),x.call(this,d.$anchor),x.call(this,d.$dynamicAnchor),s[g]=y;function b(w){let I=this.opts.uriResolver.resolve;if(w=In(y?I(y,w):w),c.has(w))throw u(w);c.add(w);let C=this.refs[w];return typeof C=="string"&&(C=this.refs[C]),typeof C=="object"?l(d,C.schema,w):w!==In(m)&&(w[0]==="#"?(l(d,a[w],w),a[w]=d):this.refs[w]=m),w}function x(w){if(typeof w=="string"){if(!Ck.test(w))throw new Error(`invalid anchor "${w}"`);b.call(this,`#${w}`)}}}),a;function l(d,g,h){if(g!==void 0&&!Ek(d,g))throw u(h)}function u(d){return new Error(`reference "${d}" resolves to more than one schema`)}}Je.getSchemaRefs=Ak});var Oo=k(pr=>{"use strict";Object.defineProperty(pr,"__esModule",{value:!0});pr.getData=pr.KeywordCxt=pr.validateFunctionCode=void 0;var og=Rh(),eg=Io(),Pu=bu(),gi=Io(),Mk=Zh(),No=Bh(),zu=Gh(),M=B(),F=qt(),Dk=zo(),Vt=te(),Po=Eo();function jk(t){if(ag(t)&&(cg(t),ig(t))){Fk(t);return}sg(t,()=>(0,og.topBoolOrEmptySchema)(t))}pr.validateFunctionCode=jk;function sg({gen:t,validateName:e,schema:r,schemaEnv:n,opts:o},s){o.code.es5?t.func(e,(0,M._)`${F.default.data}, ${F.default.valCxt}`,n.$async,()=>{t.code((0,M._)`"use strict"; ${tg(r,o)}`),Zk(t,o),t.code(s)}):t.func(e,(0,M._)`${F.default.data}, ${Lk(o)}`,n.$async,()=>t.code(tg(r,o)).code(s))}function Lk(t){return(0,M._)`{${F.default.instancePath}="", ${F.default.parentData}, ${F.default.parentDataProperty}, ${F.default.rootData}=${F.default.data}${t.dynamicRef?(0,M._)`, ${F.default.dynamicAnchors}={}`:M.nil}}={}`}function Zk(t,e){t.if(F.default.valCxt,()=>{t.var(F.default.instancePath,(0,M._)`${F.default.valCxt}.${F.default.instancePath}`),t.var(F.default.parentData,(0,M._)`${F.default.valCxt}.${F.default.parentData}`),t.var(F.default.parentDataProperty,(0,M._)`${F.default.valCxt}.${F.default.parentDataProperty}`),t.var(F.default.rootData,(0,M._)`${F.default.valCxt}.${F.default.rootData}`),e.dynamicRef&&t.var(F.default.dynamicAnchors,(0,M._)`${F.default.valCxt}.${F.default.dynamicAnchors}`)},()=>{t.var(F.default.instancePath,(0,M._)`""`),t.var(F.default.parentData,(0,M._)`undefined`),t.var(F.default.parentDataProperty,(0,M._)`undefined`),t.var(F.default.rootData,F.default.data),e.dynamicRef&&t.var(F.default.dynamicAnchors,(0,M._)`{}`)})}function Fk(t){let{schema:e,opts:r,gen:n}=t;sg(t,()=>{r.$comment&&e.$comment&&ug(t),Hk(t),n.let(F.default.vErrors,null),n.let(F.default.errors,0),r.unevaluated&&Uk(t),lg(t),Jk(t)})}function Uk(t){let{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,M._)`${r}.evaluated`),e.if((0,M._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,M._)`${t.evaluated}.props`,(0,M._)`undefined`)),e.if((0,M._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,M._)`${t.evaluated}.items`,(0,M._)`undefined`))}function tg(t,e){let r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,M._)`/*# sourceURL=${r} */`:M.nil}function qk(t,e){if(ag(t)&&(cg(t),ig(t))){Vk(t,e);return}(0,og.boolOrEmptySchema)(t,e)}function ig({schema:t,self:e}){if(typeof t=="boolean")return!t;for(let r in t)if(e.RULES.all[r])return!0;return!1}function ag(t){return typeof t.schema!="boolean"}function Vk(t,e){let{schema:r,gen:n,opts:o}=t;o.$comment&&r.$comment&&ug(t),Gk(t),Wk(t);let s=n.const("_errs",F.default.errors);lg(t,s),n.var(e,(0,M._)`${s} === ${F.default.errors}`)}function cg(t){(0,Vt.checkUnknownRules)(t),Bk(t)}function lg(t,e){if(t.opts.jtd)return rg(t,[],!1,e);let r=(0,eg.getSchemaTypes)(t.schema),n=(0,eg.coerceAndCheckDataType)(t,r);rg(t,r,!n,e)}function Bk(t){let{schema:e,errSchemaPath:r,opts:n,self:o}=t;e.$ref&&n.ignoreKeywordsWithRef&&(0,Vt.schemaHasRulesButRef)(e,o.RULES)&&o.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function Hk(t){let{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,Vt.checkStrictMode)(t,"default is ignored in the schema root")}function Gk(t){let e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,Dk.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function Wk(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function ug({gen:t,schemaEnv:e,schema:r,errSchemaPath:n,opts:o}){let s=r.$comment;if(o.$comment===!0)t.code((0,M._)`${F.default.self}.logger.log(${s})`);else if(typeof o.$comment=="function"){let i=(0,M.str)`${n}/$comment`,a=t.scopeValue("root",{ref:e.root});t.code((0,M._)`${F.default.self}.opts.$comment(${s}, ${i}, ${a}.schema)`)}}function Jk(t){let{gen:e,schemaEnv:r,validateName:n,ValidationError:o,opts:s}=t;r.$async?e.if((0,M._)`${F.default.errors} === 0`,()=>e.return(F.default.data),()=>e.throw((0,M._)`new ${o}(${F.default.vErrors})`)):(e.assign((0,M._)`${n}.errors`,F.default.vErrors),s.unevaluated&&Kk(t),e.return((0,M._)`${F.default.errors} === 0`))}function Kk({gen:t,evaluated:e,props:r,items:n}){r instanceof M.Name&&t.assign((0,M._)`${e}.props`,r),n instanceof M.Name&&t.assign((0,M._)`${e}.items`,n)}function rg(t,e,r,n){let{gen:o,schema:s,data:i,allErrors:a,opts:c,self:l}=t,{RULES:u}=l;if(s.$ref&&(c.ignoreKeywordsWithRef||!(0,Vt.schemaHasRulesButRef)(s,u))){o.block(()=>fg(t,"$ref",u.all.$ref.definition));return}c.jtd||Xk(t,e),o.block(()=>{for(let g of u.rules)d(g);d(u.post)});function d(g){(0,Pu.shouldUseGroup)(s,g)&&(g.type?(o.if((0,gi.checkDataType)(g.type,i,c.strictNumbers)),ng(t,g),e.length===1&&e[0]===g.type&&r&&(o.else(),(0,gi.reportTypeError)(t)),o.endIf()):ng(t,g),a||o.if((0,M._)`${F.default.errors} === ${n||0}`))}}function ng(t,e){let{gen:r,schema:n,opts:{useDefaults:o}}=t;o&&(0,Mk.assignDefaults)(t,e.type),r.block(()=>{for(let s of e.rules)(0,Pu.shouldUseRule)(n,s)&&fg(t,s.keyword,s.definition,e.type)})}function Xk(t,e){t.schemaEnv.meta||!t.opts.strictTypes||(Yk(t,e),t.opts.allowUnionTypes||Qk(t,e),eT(t,t.dataTypes))}function Yk(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{dg(t.dataTypes,r)||Nu(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),rT(t,e)}}function Qk(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&Nu(t,"use allowUnionTypes to allow union type keyword")}function eT(t,e){let r=t.self.RULES.all;for(let n in r){let o=r[n];if(typeof o=="object"&&(0,Pu.shouldUseRule)(t.schema,o)){let{type:s}=o.definition;s.length&&!s.some(i=>tT(e,i))&&Nu(t,`missing type "${s.join(",")}" for keyword "${n}"`)}}}function tT(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function dg(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function rT(t,e){let r=[];for(let n of t.dataTypes)dg(e,n)?r.push(n):e.includes("integer")&&n==="number"&&r.push("integer");t.dataTypes=r}function Nu(t,e){let r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,Vt.checkStrictMode)(t,e,t.opts.strictTypes)}var yi=class{constructor(e,r,n){if((0,No.validateKeywordUsage)(e,r,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Vt.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",pg(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,No.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",F.default.errors))}result(e,r,n){this.failResult((0,M.not)(e),r,n)}failResult(e,r,n){this.gen.if(e),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,M.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);let{schemaCode:r}=this;this.fail((0,M._)`${r} !== undefined && (${(0,M.or)(this.invalid$data(),e)})`)}error(e,r,n){if(r){this.setParams(r),this._error(e,n),this.setParams({});return}this._error(e,n)}_error(e,r){(e?Po.reportExtraError:Po.reportError)(this,this.def.error,r)}$dataError(){(0,Po.reportError)(this,this.def.$dataError||Po.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,Po.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,n=M.nil){this.gen.block(()=>{this.check$data(e,n),r()})}check$data(e=M.nil,r=M.nil){if(!this.$data)return;let{gen:n,schemaCode:o,schemaType:s,def:i}=this;n.if((0,M.or)((0,M._)`${o} === undefined`,r)),e!==M.nil&&n.assign(e,!0),(s.length||i.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==M.nil&&n.assign(e,!1)),n.else()}invalid$data(){let{gen:e,schemaCode:r,schemaType:n,def:o,it:s}=this;return(0,M.or)(i(),a());function i(){if(n.length){if(!(r instanceof M.Name))throw new Error("ajv implementation error");let c=Array.isArray(n)?n:[n];return(0,M._)`${(0,gi.checkDataTypes)(c,r,s.opts.strictNumbers,gi.DataType.Wrong)}`}return M.nil}function a(){if(o.validateSchema){let c=e.scopeValue("validate$data",{ref:o.validateSchema});return(0,M._)`!${c}(${r})`}return M.nil}}subschema(e,r){let n=(0,zu.getSubschema)(this.it,e);(0,zu.extendSubschemaData)(n,this.it,e),(0,zu.extendSubschemaMode)(n,e);let o={...this.it,...n,items:void 0,props:void 0};return qk(o,r),o}mergeEvaluated(e,r){let{it:n,gen:o}=this;n.opts.unevaluated&&(n.props!==!0&&e.props!==void 0&&(n.props=Vt.mergeEvaluated.props(o,e.props,n.props,r)),n.items!==!0&&e.items!==void 0&&(n.items=Vt.mergeEvaluated.items(o,e.items,n.items,r)))}mergeValidEvaluated(e,r){let{it:n,gen:o}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return o.if(r,()=>this.mergeEvaluated(e,M.Name)),!0}};pr.KeywordCxt=yi;function fg(t,e,r,n){let o=new yi(t,r,e);"code"in r?r.code(o,n):o.$data&&r.validate?(0,No.funcKeywordCode)(o,r):"macro"in r?(0,No.macroKeywordCode)(o,r):(r.compile||r.validate)&&(0,No.funcKeywordCode)(o,r)}var nT=/^\/(?:[^~]|~0|~1)*$/,oT=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function pg(t,{dataLevel:e,dataNames:r,dataPathArr:n}){let o,s;if(t==="")return F.default.rootData;if(t[0]==="/"){if(!nT.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);o=t,s=F.default.rootData}else{let l=oT.exec(t);if(!l)throw new Error(`Invalid JSON-pointer: ${t}`);let u=+l[1];if(o=l[2],o==="#"){if(u>=e)throw new Error(c("property/index",u));return n[e-u]}if(u>e)throw new Error(c("data",u));if(s=r[e-u],!o)return s}let i=s,a=o.split("/");for(let l of a)l&&(s=(0,M._)`${s}${(0,M.getProperty)((0,Vt.unescapeJsonPointer)(l))}`,i=(0,M._)`${i} && ${s}`);return i;function c(l,u){return`Cannot access ${l} ${u} levels up, current level is ${e}`}}pr.getData=pg});var _i=k(Ru=>{"use strict";Object.defineProperty(Ru,"__esModule",{value:!0});var Ou=class extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}};Ru.default=Ou});var Ro=k(Mu=>{"use strict";Object.defineProperty(Mu,"__esModule",{value:!0});var Cu=zo(),Au=class extends Error{constructor(e,r,n,o){super(o||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,Cu.resolveUrl)(e,r,n),this.missingSchema=(0,Cu.normalizeId)((0,Cu.getFullPath)(e,this.missingRef))}};Mu.default=Au});var bi=k(ct=>{"use strict";Object.defineProperty(ct,"__esModule",{value:!0});ct.resolveSchema=ct.getCompilingSchema=ct.resolveRef=ct.compileSchema=ct.SchemaEnv=void 0;var _t=B(),sT=_i(),Kr=qt(),vt=zo(),mg=te(),iT=Oo(),zn=class{constructor(e){var r;this.refs={},this.dynamicAnchors={};let n;typeof e.schema=="object"&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,vt.normalizeId)(n?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=n?.$async,this.refs={}}};ct.SchemaEnv=zn;function ju(t){let e=hg.call(this,t);if(e)return e;let r=(0,vt.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:n,lines:o}=this.opts.code,{ownProperties:s}=this.opts,i=new _t.CodeGen(this.scope,{es5:n,lines:o,ownProperties:s}),a;t.$async&&(a=i.scopeValue("Error",{ref:sT.default,code:(0,_t._)`require("ajv/dist/runtime/validation_error").default`}));let c=i.scopeName("validate");t.validateName=c;let l={gen:i,allErrors:this.opts.allErrors,data:Kr.default.data,parentData:Kr.default.parentData,parentDataProperty:Kr.default.parentDataProperty,dataNames:[Kr.default.data],dataPathArr:[_t.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:i.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,_t.stringify)(t.schema)}:{ref:t.schema}),validateName:c,ValidationError:a,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:_t.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,_t._)`""`,opts:this.opts,self:this},u;try{this._compilations.add(t),(0,iT.validateFunctionCode)(l),i.optimize(this.opts.code.optimize);let d=i.toString();u=`${i.scopeRefs(Kr.default.scope)}return ${d}`,this.opts.code.process&&(u=this.opts.code.process(u,t));let h=new Function(`${Kr.default.self}`,`${Kr.default.scope}`,u)(this,this.scope.get());if(this.scope.value(c,{ref:h}),h.errors=null,h.schema=t.schema,h.schemaEnv=t,t.$async&&(h.$async=!0),this.opts.code.source===!0&&(h.source={validateName:c,validateCode:d,scopeValues:i._values}),this.opts.unevaluated){let{props:f,items:m}=l;h.evaluated={props:f instanceof _t.Name?void 0:f,items:m instanceof _t.Name?void 0:m,dynamicProps:f instanceof _t.Name,dynamicItems:m instanceof _t.Name},h.source&&(h.source.evaluated=(0,_t.stringify)(h.evaluated))}return t.validate=h,t}catch(d){throw delete t.validate,delete t.validateName,u&&this.logger.error("Error compiling schema, function code:",u),d}finally{this._compilations.delete(t)}}ct.compileSchema=ju;function aT(t,e,r){var n;r=(0,vt.resolveUrl)(this.opts.uriResolver,e,r);let o=t.refs[r];if(o)return o;let s=uT.call(this,t,r);if(s===void 0){let i=(n=t.localRefs)===null||n===void 0?void 0:n[r],{schemaId:a}=this.opts;i&&(s=new zn({schema:i,schemaId:a,root:t,baseId:e}))}if(s!==void 0)return t.refs[r]=cT.call(this,s)}ct.resolveRef=aT;function cT(t){return(0,vt.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:ju.call(this,t)}function hg(t){for(let e of this._compilations)if(lT(e,t))return e}ct.getCompilingSchema=hg;function lT(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function uT(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||vi.call(this,t,e)}function vi(t,e){let r=this.opts.uriResolver.parse(e),n=(0,vt._getFullPath)(this.opts.uriResolver,r),o=(0,vt.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&n===o)return Du.call(this,r,t);let s=(0,vt.normalizeId)(n),i=this.refs[s]||this.schemas[s];if(typeof i=="string"){let a=vi.call(this,t,i);return typeof a?.schema!="object"?void 0:Du.call(this,r,a)}if(typeof i?.schema=="object"){if(i.validate||ju.call(this,i),s===(0,vt.normalizeId)(e)){let{schema:a}=i,{schemaId:c}=this.opts,l=a[c];return l&&(o=(0,vt.resolveUrl)(this.opts.uriResolver,o,l)),new zn({schema:a,schemaId:c,root:t,baseId:o})}return Du.call(this,r,i)}}ct.resolveSchema=vi;var dT=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function Du(t,{baseId:e,schema:r,root:n}){var o;if(((o=t.fragment)===null||o===void 0?void 0:o[0])!=="/")return;for(let a of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;let c=r[(0,mg.unescapeFragment)(a)];if(c===void 0)return;r=c;let l=typeof r=="object"&&r[this.opts.schemaId];!dT.has(a)&&l&&(e=(0,vt.resolveUrl)(this.opts.uriResolver,e,l))}let s;if(typeof r!="boolean"&&r.$ref&&!(0,mg.schemaHasRulesButRef)(r,this.RULES)){let a=(0,vt.resolveUrl)(this.opts.uriResolver,e,r.$ref);s=vi.call(this,n,a)}let{schemaId:i}=this.opts;if(s=s||new zn({schema:r,schemaId:i,root:n,baseId:e}),s.schema!==s.root.schema)return s}});var gg=k((cM,fT)=>{fT.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var Zu=k((lM,bg)=>{"use strict";var pT=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),_g=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function Lu(t){let e="",r=0,n=0;for(n=0;n<t.length;n++)if(r=t[n].charCodeAt(0),r!==48){if(!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n];break}for(n+=1;n<t.length;n++){if(r=t[n].charCodeAt(0),!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n]}return e}var mT=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function yg(t){return t.length=0,!0}function hT(t,e,r){if(t.length){let n=Lu(t);if(n!=="")e.push(n);else return r.error=!0,!1;t.length=0}return!0}function gT(t){let e=0,r={error:!1,address:"",zone:""},n=[],o=[],s=!1,i=!1,a=hT;for(let c=0;c<t.length;c++){let l=t[c];if(!(l==="["||l==="]"))if(l===":"){if(s===!0&&(i=!0),!a(o,n,r))break;if(++e>7){r.error=!0;break}c>0&&t[c-1]===":"&&(s=!0),n.push(":");continue}else if(l==="%"){if(!a(o,n,r))break;a=yg}else{o.push(l);continue}}return o.length&&(a===yg?r.zone=o.join(""):i?n.push(o.join("")):n.push(Lu(o))),r.address=n.join(""),r}function vg(t){if(yT(t,":")<2)return{host:t,isIPV6:!1};let e=gT(t);if(e.error)return{host:t,isIPV6:!1};{let r=e.address,n=e.address;return e.zone&&(r+="%"+e.zone,n+="%25"+e.zone),{host:r,isIPV6:!0,escapedHost:n}}}function yT(t,e){let r=0;for(let n=0;n<t.length;n++)t[n]===e&&r++;return r}function _T(t){let e=t,r=[],n=-1,o=0;for(;o=e.length;){if(o===1){if(e===".")break;if(e==="/"){r.push("/");break}else{r.push(e);break}}else if(o===2){if(e[0]==="."){if(e[1]===".")break;if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&(e[1]==="."||e[1]==="/")){r.push("/");break}}else if(o===3&&e==="/.."){r.length!==0&&r.pop(),r.push("/");break}if(e[0]==="."){if(e[1]==="."){if(e[2]==="/"){e=e.slice(3);continue}}else if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&e[1]==="."){if(e[2]==="/"){e=e.slice(2);continue}else if(e[2]==="."&&e[3]==="/"){e=e.slice(3),r.length!==0&&r.pop();continue}}if((n=e.indexOf("/",1))===-1){r.push(e);break}else r.push(e.slice(0,n)),e=e.slice(n)}return r.join("")}function vT(t,e){let r=e!==!0?escape:unescape;return t.scheme!==void 0&&(t.scheme=r(t.scheme)),t.userinfo!==void 0&&(t.userinfo=r(t.userinfo)),t.host!==void 0&&(t.host=r(t.host)),t.path!==void 0&&(t.path=r(t.path)),t.query!==void 0&&(t.query=r(t.query)),t.fragment!==void 0&&(t.fragment=r(t.fragment)),t}function bT(t){let e=[];if(t.userinfo!==void 0&&(e.push(t.userinfo),e.push("@")),t.host!==void 0){let r=unescape(t.host);if(!_g(r)){let n=vg(r);n.isIPV6===!0?r=`[${n.escapedHost}]`:r=t.host}e.push(r)}return(typeof t.port=="number"||typeof t.port=="string")&&(e.push(":"),e.push(String(t.port))),e.length?e.join(""):void 0}bg.exports={nonSimpleDomain:mT,recomposeAuthority:bT,normalizeComponentEncoding:vT,removeDotSegments:_T,isIPv4:_g,isUUID:pT,normalizeIPv6:vg,stringArrayToHexStripped:Lu}});var kg=k((uM,$g)=>{"use strict";var{isUUID:xT}=Zu(),wT=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,ST=["http","https","ws","wss","urn","urn:uuid"];function $T(t){return ST.indexOf(t)!==-1}function Fu(t){return t.secure===!0?!0:t.secure===!1?!1:t.scheme?t.scheme.length===3&&(t.scheme[0]==="w"||t.scheme[0]==="W")&&(t.scheme[1]==="s"||t.scheme[1]==="S")&&(t.scheme[2]==="s"||t.scheme[2]==="S"):!1}function xg(t){return t.host||(t.error=t.error||"HTTP URIs must have a host."),t}function wg(t){let e=String(t.scheme).toLowerCase()==="https";return(t.port===(e?443:80)||t.port==="")&&(t.port=void 0),t.path||(t.path="/"),t}function kT(t){return t.secure=Fu(t),t.resourceName=(t.path||"/")+(t.query?"?"+t.query:""),t.path=void 0,t.query=void 0,t}function TT(t){if((t.port===(Fu(t)?443:80)||t.port==="")&&(t.port=void 0),typeof t.secure=="boolean"&&(t.scheme=t.secure?"wss":"ws",t.secure=void 0),t.resourceName){let[e,r]=t.resourceName.split("?");t.path=e&&e!=="/"?e:void 0,t.query=r,t.resourceName=void 0}return t.fragment=void 0,t}function ET(t,e){if(!t.path)return t.error="URN can not be parsed",t;let r=t.path.match(wT);if(r){let n=e.scheme||t.scheme||"urn";t.nid=r[1].toLowerCase(),t.nss=r[2];let o=`${n}:${e.nid||t.nid}`,s=Uu(o);t.path=void 0,s&&(t=s.parse(t,e))}else t.error=t.error||"URN can not be parsed.";return t}function IT(t,e){if(t.nid===void 0)throw new Error("URN without nid cannot be serialized");let r=e.scheme||t.scheme||"urn",n=t.nid.toLowerCase(),o=`${r}:${e.nid||n}`,s=Uu(o);s&&(t=s.serialize(t,e));let i=t,a=t.nss;return i.path=`${n||e.nid}:${a}`,e.skipEscape=!0,i}function zT(t,e){let r=t;return r.uuid=r.nss,r.nss=void 0,!e.tolerant&&(!r.uuid||!xT(r.uuid))&&(r.error=r.error||"UUID is not valid."),r}function PT(t){let e=t;return e.nss=(t.uuid||"").toLowerCase(),e}var Sg={scheme:"http",domainHost:!0,parse:xg,serialize:wg},NT={scheme:"https",domainHost:Sg.domainHost,parse:xg,serialize:wg},xi={scheme:"ws",domainHost:!0,parse:kT,serialize:TT},OT={scheme:"wss",domainHost:xi.domainHost,parse:xi.parse,serialize:xi.serialize},RT={scheme:"urn",parse:ET,serialize:IT,skipNormalize:!0},CT={scheme:"urn:uuid",parse:zT,serialize:PT,skipNormalize:!0},wi={http:Sg,https:NT,ws:xi,wss:OT,urn:RT,"urn:uuid":CT};Object.setPrototypeOf(wi,null);function Uu(t){return t&&(wi[t]||wi[t.toLowerCase()])||void 0}$g.exports={wsIsSecure:Fu,SCHEMES:wi,isValidSchemeName:$T,getSchemeHandler:Uu}});var Ig=k((dM,$i)=>{"use strict";var{normalizeIPv6:AT,removeDotSegments:Co,recomposeAuthority:MT,normalizeComponentEncoding:Si,isIPv4:DT,nonSimpleDomain:jT}=Zu(),{SCHEMES:LT,getSchemeHandler:Tg}=kg();function ZT(t,e){return typeof t=="string"?t=zt(Bt(t,e),e):typeof t=="object"&&(t=Bt(zt(t,e),e)),t}function FT(t,e,r){let n=r?Object.assign({scheme:"null"},r):{scheme:"null"},o=Eg(Bt(t,n),Bt(e,n),n,!0);return n.skipEscape=!0,zt(o,n)}function Eg(t,e,r,n){let o={};return n||(t=Bt(zt(t,r),r),e=Bt(zt(e,r),r)),r=r||{},!r.tolerant&&e.scheme?(o.scheme=e.scheme,o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=Co(e.path||""),o.query=e.query):(e.userinfo!==void 0||e.host!==void 0||e.port!==void 0?(o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=Co(e.path||""),o.query=e.query):(e.path?(e.path[0]==="/"?o.path=Co(e.path):((t.userinfo!==void 0||t.host!==void 0||t.port!==void 0)&&!t.path?o.path="/"+e.path:t.path?o.path=t.path.slice(0,t.path.lastIndexOf("/")+1)+e.path:o.path=e.path,o.path=Co(o.path)),o.query=e.query):(o.path=t.path,e.query!==void 0?o.query=e.query:o.query=t.query),o.userinfo=t.userinfo,o.host=t.host,o.port=t.port),o.scheme=t.scheme),o.fragment=e.fragment,o}function UT(t,e,r){return typeof t=="string"?(t=unescape(t),t=zt(Si(Bt(t,r),!0),{...r,skipEscape:!0})):typeof t=="object"&&(t=zt(Si(t,!0),{...r,skipEscape:!0})),typeof e=="string"?(e=unescape(e),e=zt(Si(Bt(e,r),!0),{...r,skipEscape:!0})):typeof e=="object"&&(e=zt(Si(e,!0),{...r,skipEscape:!0})),t.toLowerCase()===e.toLowerCase()}function zt(t,e){let r={host:t.host,scheme:t.scheme,userinfo:t.userinfo,port:t.port,path:t.path,query:t.query,nid:t.nid,nss:t.nss,uuid:t.uuid,fragment:t.fragment,reference:t.reference,resourceName:t.resourceName,secure:t.secure,error:""},n=Object.assign({},e),o=[],s=Tg(n.scheme||r.scheme);s&&s.serialize&&s.serialize(r,n),r.path!==void 0&&(n.skipEscape?r.path=unescape(r.path):(r.path=escape(r.path),r.scheme!==void 0&&(r.path=r.path.split("%3A").join(":")))),n.reference!=="suffix"&&r.scheme&&o.push(r.scheme,":");let i=MT(r);if(i!==void 0&&(n.reference!=="suffix"&&o.push("//"),o.push(i),r.path&&r.path[0]!=="/"&&o.push("/")),r.path!==void 0){let a=r.path;!n.absolutePath&&(!s||!s.absolutePath)&&(a=Co(a)),i===void 0&&a[0]==="/"&&a[1]==="/"&&(a="/%2F"+a.slice(2)),o.push(a)}return r.query!==void 0&&o.push("?",r.query),r.fragment!==void 0&&o.push("#",r.fragment),o.join("")}var qT=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function Bt(t,e){let r=Object.assign({},e),n={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},o=!1;r.reference==="suffix"&&(r.scheme?t=r.scheme+":"+t:t="//"+t);let s=t.match(qT);if(s){if(n.scheme=s[1],n.userinfo=s[3],n.host=s[4],n.port=parseInt(s[5],10),n.path=s[6]||"",n.query=s[7],n.fragment=s[8],isNaN(n.port)&&(n.port=s[5]),n.host)if(DT(n.host)===!1){let c=AT(n.host);n.host=c.host.toLowerCase(),o=c.isIPV6}else o=!0;n.scheme===void 0&&n.userinfo===void 0&&n.host===void 0&&n.port===void 0&&n.query===void 0&&!n.path?n.reference="same-document":n.scheme===void 0?n.reference="relative":n.fragment===void 0?n.reference="absolute":n.reference="uri",r.reference&&r.reference!=="suffix"&&r.reference!==n.reference&&(n.error=n.error||"URI is not a "+r.reference+" reference.");let i=Tg(r.scheme||n.scheme);if(!r.unicodeSupport&&(!i||!i.unicodeSupport)&&n.host&&(r.domainHost||i&&i.domainHost)&&o===!1&&jT(n.host))try{n.host=URL.domainToASCII(n.host.toLowerCase())}catch(a){n.error=n.error||"Host's domain name can not be converted to ASCII: "+a}(!i||i&&!i.skipNormalize)&&(t.indexOf("%")!==-1&&(n.scheme!==void 0&&(n.scheme=unescape(n.scheme)),n.host!==void 0&&(n.host=unescape(n.host))),n.path&&(n.path=escape(unescape(n.path))),n.fragment&&(n.fragment=encodeURI(decodeURIComponent(n.fragment)))),i&&i.parse&&i.parse(n,r)}else n.error=n.error||"URI can not be parsed.";return n}var qu={SCHEMES:LT,normalize:ZT,resolve:FT,resolveComponent:Eg,equal:UT,serialize:zt,parse:Bt};$i.exports=qu;$i.exports.default=qu;$i.exports.fastUri=qu});var Pg=k(Vu=>{"use strict";Object.defineProperty(Vu,"__esModule",{value:!0});var zg=Ig();zg.code='require("ajv/dist/runtime/uri").default';Vu.default=zg});var jg=k(Ie=>{"use strict";Object.defineProperty(Ie,"__esModule",{value:!0});Ie.CodeGen=Ie.Name=Ie.nil=Ie.stringify=Ie.str=Ie._=Ie.KeywordCxt=void 0;var VT=Oo();Object.defineProperty(Ie,"KeywordCxt",{enumerable:!0,get:function(){return VT.KeywordCxt}});var Pn=B();Object.defineProperty(Ie,"_",{enumerable:!0,get:function(){return Pn._}});Object.defineProperty(Ie,"str",{enumerable:!0,get:function(){return Pn.str}});Object.defineProperty(Ie,"stringify",{enumerable:!0,get:function(){return Pn.stringify}});Object.defineProperty(Ie,"nil",{enumerable:!0,get:function(){return Pn.nil}});Object.defineProperty(Ie,"Name",{enumerable:!0,get:function(){return Pn.Name}});Object.defineProperty(Ie,"CodeGen",{enumerable:!0,get:function(){return Pn.CodeGen}});var BT=_i(),Ag=Ro(),HT=vu(),Ao=bi(),GT=B(),Mo=zo(),ki=Io(),Hu=te(),Ng=gg(),WT=Pg(),Mg=(t,e)=>new RegExp(t,e);Mg.code="new RegExp";var JT=["removeAdditional","useDefaults","coerceTypes"],KT=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),XT={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},YT={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},Og=200;function QT(t){var e,r,n,o,s,i,a,c,l,u,d,g,h,f,m,y,b,x,w,I,C,ve,Oe,At,vr;let br=t.strict,pa=(e=t.code)===null||e===void 0?void 0:e.optimize,wf=pa===!0||pa===void 0?1:pa||0,Sf=(n=(r=t.code)===null||r===void 0?void 0:r.regExp)!==null&&n!==void 0?n:Mg,Jv=(o=t.uriResolver)!==null&&o!==void 0?o:WT.default;return{strictSchema:(i=(s=t.strictSchema)!==null&&s!==void 0?s:br)!==null&&i!==void 0?i:!0,strictNumbers:(c=(a=t.strictNumbers)!==null&&a!==void 0?a:br)!==null&&c!==void 0?c:!0,strictTypes:(u=(l=t.strictTypes)!==null&&l!==void 0?l:br)!==null&&u!==void 0?u:"log",strictTuples:(g=(d=t.strictTuples)!==null&&d!==void 0?d:br)!==null&&g!==void 0?g:"log",strictRequired:(f=(h=t.strictRequired)!==null&&h!==void 0?h:br)!==null&&f!==void 0?f:!1,code:t.code?{...t.code,optimize:wf,regExp:Sf}:{optimize:wf,regExp:Sf},loopRequired:(m=t.loopRequired)!==null&&m!==void 0?m:Og,loopEnum:(y=t.loopEnum)!==null&&y!==void 0?y:Og,meta:(b=t.meta)!==null&&b!==void 0?b:!0,messages:(x=t.messages)!==null&&x!==void 0?x:!0,inlineRefs:(w=t.inlineRefs)!==null&&w!==void 0?w:!0,schemaId:(I=t.schemaId)!==null&&I!==void 0?I:"$id",addUsedSchema:(C=t.addUsedSchema)!==null&&C!==void 0?C:!0,validateSchema:(ve=t.validateSchema)!==null&&ve!==void 0?ve:!0,validateFormats:(Oe=t.validateFormats)!==null&&Oe!==void 0?Oe:!0,unicodeRegExp:(At=t.unicodeRegExp)!==null&&At!==void 0?At:!0,int32range:(vr=t.int32range)!==null&&vr!==void 0?vr:!0,uriResolver:Jv}}var Do=class{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...QT(e)};let{es5:r,lines:n}=this.opts.code;this.scope=new GT.ValueScope({scope:{},prefixes:KT,es5:r,lines:n}),this.logger=sE(e.logger);let o=e.validateFormats;e.validateFormats=!1,this.RULES=(0,HT.getRules)(),Rg.call(this,XT,e,"NOT SUPPORTED"),Rg.call(this,YT,e,"DEPRECATED","warn"),this._metaOpts=nE.call(this),e.formats&&tE.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&rE.call(this,e.keywords),typeof e.meta=="object"&&this.addMetaSchema(e.meta),eE.call(this),e.validateFormats=o}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:e,meta:r,schemaId:n}=this.opts,o=Ng;n==="id"&&(o={...Ng},o.id=o.$id,delete o.$id),r&&e&&this.addMetaSchema(o,o[n],!1)}defaultMeta(){let{meta:e,schemaId:r}=this.opts;return this.opts.defaultMeta=typeof e=="object"?e[r]||e:void 0}validate(e,r){let n;if(typeof e=="string"){if(n=this.getSchema(e),!n)throw new Error(`no schema with key or ref "${e}"`)}else n=this.compile(e);let o=n(r);return"$async"in n||(this.errors=n.errors),o}compile(e,r){let n=this._addSchema(e,r);return n.validate||this._compileSchemaEnv(n)}compileAsync(e,r){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");let{loadSchema:n}=this.opts;return o.call(this,e,r);async function o(u,d){await s.call(this,u.$schema);let g=this._addSchema(u,d);return g.validate||i.call(this,g)}async function s(u){u&&!this.getSchema(u)&&await o.call(this,{$ref:u},!0)}async function i(u){try{return this._compileSchemaEnv(u)}catch(d){if(!(d instanceof Ag.default))throw d;return a.call(this,d),await c.call(this,d.missingSchema),i.call(this,u)}}function a({missingSchema:u,missingRef:d}){if(this.refs[u])throw new Error(`AnySchema ${u} is loaded but ${d} cannot be resolved`)}async function c(u){let d=await l.call(this,u);this.refs[u]||await s.call(this,d.$schema),this.refs[u]||this.addSchema(d,u,r)}async function l(u){let d=this._loading[u];if(d)return d;try{return await(this._loading[u]=n(u))}finally{delete this._loading[u]}}}addSchema(e,r,n,o=this.opts.validateSchema){if(Array.isArray(e)){for(let i of e)this.addSchema(i,void 0,n,o);return this}let s;if(typeof e=="object"){let{schemaId:i}=this.opts;if(s=e[i],s!==void 0&&typeof s!="string")throw new Error(`schema ${i} must be string`)}return r=(0,Mo.normalizeId)(r||s),this._checkUnique(r),this.schemas[r]=this._addSchema(e,n,r,o,!0),this}addMetaSchema(e,r,n=this.opts.validateSchema){return this.addSchema(e,r,!0,n),this}validateSchema(e,r){if(typeof e=="boolean")return!0;let n;if(n=e.$schema,n!==void 0&&typeof n!="string")throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let o=this.validate(n,e);if(!o&&r){let s="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(s);else throw new Error(s)}return o}getSchema(e){let r;for(;typeof(r=Cg.call(this,e))=="string";)e=r;if(r===void 0){let{schemaId:n}=this.opts,o=new Ao.SchemaEnv({schema:{},schemaId:n});if(r=Ao.resolveSchema.call(this,o,e),!r)return;this.refs[e]=r}return r.validate||this._compileSchemaEnv(r)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let r=Cg.call(this,e);return typeof r=="object"&&this._cache.delete(r.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{let r=e;this._cache.delete(r);let n=e[this.opts.schemaId];return n&&(n=(0,Mo.normalizeId)(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(let r of e)this.addKeyword(r);return this}addKeyword(e,r){let n;if(typeof e=="string")n=e,typeof r=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),r.keyword=n);else if(typeof e=="object"&&r===void 0){if(r=e,n=r.keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(aE.call(this,n,r),!r)return(0,Hu.eachItem)(n,s=>Bu.call(this,s)),this;lE.call(this,r);let o={...r,type:(0,ki.getJSONTypes)(r.type),schemaType:(0,ki.getJSONTypes)(r.schemaType)};return(0,Hu.eachItem)(n,o.type.length===0?s=>Bu.call(this,s,o):s=>o.type.forEach(i=>Bu.call(this,s,o,i))),this}getKeyword(e){let r=this.RULES.all[e];return typeof r=="object"?r.definition:!!r}removeKeyword(e){let{RULES:r}=this;delete r.keywords[e],delete r.all[e];for(let n of r.rules){let o=n.rules.findIndex(s=>s.keyword===e);o>=0&&n.rules.splice(o,1)}return this}addFormat(e,r){return typeof r=="string"&&(r=new RegExp(r)),this.formats[e]=r,this}errorsText(e=this.errors,{separator:r=", ",dataVar:n="data"}={}){return!e||e.length===0?"No errors":e.map(o=>`${n}${o.instancePath} ${o.message}`).reduce((o,s)=>o+r+s)}$dataMetaSchema(e,r){let n=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(let o of r){let s=o.split("/").slice(1),i=e;for(let a of s)i=i[a];for(let a in n){let c=n[a];if(typeof c!="object")continue;let{$data:l}=c.definition,u=i[a];l&&u&&(i[a]=Dg(u))}}return e}_removeAllSchemas(e,r){for(let n in e){let o=e[n];(!r||r.test(n))&&(typeof o=="string"?delete e[n]:o&&!o.meta&&(this._cache.delete(o.schema),delete e[n]))}}_addSchema(e,r,n,o=this.opts.validateSchema,s=this.opts.addUsedSchema){let i,{schemaId:a}=this.opts;if(typeof e=="object")i=e[a];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof e!="boolean")throw new Error("schema must be object or boolean")}let c=this._cache.get(e);if(c!==void 0)return c;n=(0,Mo.normalizeId)(i||n);let l=Mo.getSchemaRefs.call(this,e,n);return c=new Ao.SchemaEnv({schema:e,schemaId:a,meta:r,baseId:n,localRefs:l}),this._cache.set(c.schema,c),s&&!n.startsWith("#")&&(n&&this._checkUnique(n),this.refs[n]=c),o&&this.validateSchema(e,!0),c}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):Ao.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){let r=this.opts;this.opts=this._metaOpts;try{Ao.compileSchema.call(this,e)}finally{this.opts=r}}};Do.ValidationError=BT.default;Do.MissingRefError=Ag.default;Ie.default=Do;function Rg(t,e,r,n="error"){for(let o in t){let s=o;s in e&&this.logger[n](`${r}: option ${o}. ${t[s]}`)}}function Cg(t){return t=(0,Mo.normalizeId)(t),this.schemas[t]||this.refs[t]}function eE(){let t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(let e in t)this.addSchema(t[e],e)}function tE(){for(let t in this.opts.formats){let e=this.opts.formats[t];e&&this.addFormat(t,e)}}function rE(t){if(Array.isArray(t)){this.addVocabulary(t);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let e in t){let r=t[e];r.keyword||(r.keyword=e),this.addKeyword(r)}}function nE(){let t={...this.opts};for(let e of JT)delete t[e];return t}var oE={log(){},warn(){},error(){}};function sE(t){if(t===!1)return oE;if(t===void 0)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}var iE=/^[a-z_$][a-z0-9_$:-]*$/i;function aE(t,e){let{RULES:r}=this;if((0,Hu.eachItem)(t,n=>{if(r.keywords[n])throw new Error(`Keyword ${n} is already defined`);if(!iE.test(n))throw new Error(`Keyword ${n} has invalid name`)}),!!e&&e.$data&&!("code"in e||"validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function Bu(t,e,r){var n;let o=e?.post;if(r&&o)throw new Error('keyword with "post" flag cannot have "type"');let{RULES:s}=this,i=o?s.post:s.rules.find(({type:c})=>c===r);if(i||(i={type:r,rules:[]},s.rules.push(i)),s.keywords[t]=!0,!e)return;let a={keyword:t,definition:{...e,type:(0,ki.getJSONTypes)(e.type),schemaType:(0,ki.getJSONTypes)(e.schemaType)}};e.before?cE.call(this,i,a,e.before):i.rules.push(a),s.all[t]=a,(n=e.implements)===null||n===void 0||n.forEach(c=>this.addKeyword(c))}function cE(t,e,r){let n=t.rules.findIndex(o=>o.keyword===r);n>=0?t.rules.splice(n,0,e):(t.rules.push(e),this.logger.warn(`rule ${r} is not defined`))}function lE(t){let{metaSchema:e}=t;e!==void 0&&(t.$data&&this.opts.$data&&(e=Dg(e)),t.validateSchema=this.compile(e,!0))}var uE={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function Dg(t){return{anyOf:[t,uE]}}});var Lg=k(Gu=>{"use strict";Object.defineProperty(Gu,"__esModule",{value:!0});var dE={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};Gu.default=dE});var qg=k(Xr=>{"use strict";Object.defineProperty(Xr,"__esModule",{value:!0});Xr.callRef=Xr.getValidate=void 0;var fE=Ro(),Zg=at(),Ke=B(),Nn=qt(),Fg=bi(),Ti=te(),pE={keyword:"$ref",schemaType:"string",code(t){let{gen:e,schema:r,it:n}=t,{baseId:o,schemaEnv:s,validateName:i,opts:a,self:c}=n,{root:l}=s;if((r==="#"||r==="#/")&&o===l.baseId)return d();let u=Fg.resolveRef.call(c,l,o,r);if(u===void 0)throw new fE.default(n.opts.uriResolver,o,r);if(u instanceof Fg.SchemaEnv)return g(u);return h(u);function d(){if(s===l)return Ei(t,i,s,s.$async);let f=e.scopeValue("root",{ref:l});return Ei(t,(0,Ke._)`${f}.validate`,l,l.$async)}function g(f){let m=Ug(t,f);Ei(t,m,f,f.$async)}function h(f){let m=e.scopeValue("schema",a.code.source===!0?{ref:f,code:(0,Ke.stringify)(f)}:{ref:f}),y=e.name("valid"),b=t.subschema({schema:f,dataTypes:[],schemaPath:Ke.nil,topSchemaRef:m,errSchemaPath:r},y);t.mergeEvaluated(b),t.ok(y)}}};function Ug(t,e){let{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,Ke._)`${r.scopeValue("wrapper",{ref:e})}.validate`}Xr.getValidate=Ug;function Ei(t,e,r,n){let{gen:o,it:s}=t,{allErrors:i,schemaEnv:a,opts:c}=s,l=c.passContext?Nn.default.this:Ke.nil;n?u():d();function u(){if(!a.$async)throw new Error("async schema referenced by sync schema");let f=o.let("valid");o.try(()=>{o.code((0,Ke._)`await ${(0,Zg.callValidateCode)(t,e,l)}`),h(e),i||o.assign(f,!0)},m=>{o.if((0,Ke._)`!(${m} instanceof ${s.ValidationError})`,()=>o.throw(m)),g(m),i||o.assign(f,!1)}),t.ok(f)}function d(){t.result((0,Zg.callValidateCode)(t,e,l),()=>h(e),()=>g(e))}function g(f){let m=(0,Ke._)`${f}.errors`;o.assign(Nn.default.vErrors,(0,Ke._)`${Nn.default.vErrors} === null ? ${m} : ${Nn.default.vErrors}.concat(${m})`),o.assign(Nn.default.errors,(0,Ke._)`${Nn.default.vErrors}.length`)}function h(f){var m;if(!s.opts.unevaluated)return;let y=(m=r?.validate)===null||m===void 0?void 0:m.evaluated;if(s.props!==!0)if(y&&!y.dynamicProps)y.props!==void 0&&(s.props=Ti.mergeEvaluated.props(o,y.props,s.props));else{let b=o.var("props",(0,Ke._)`${f}.evaluated.props`);s.props=Ti.mergeEvaluated.props(o,b,s.props,Ke.Name)}if(s.items!==!0)if(y&&!y.dynamicItems)y.items!==void 0&&(s.items=Ti.mergeEvaluated.items(o,y.items,s.items));else{let b=o.var("items",(0,Ke._)`${f}.evaluated.items`);s.items=Ti.mergeEvaluated.items(o,b,s.items,Ke.Name)}}}Xr.callRef=Ei;Xr.default=pE});var Vg=k(Wu=>{"use strict";Object.defineProperty(Wu,"__esModule",{value:!0});var mE=Lg(),hE=qg(),gE=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",mE.default,hE.default];Wu.default=gE});var Bg=k(Ju=>{"use strict";Object.defineProperty(Ju,"__esModule",{value:!0});var Ii=B(),mr=Ii.operators,zi={maximum:{okStr:"<=",ok:mr.LTE,fail:mr.GT},minimum:{okStr:">=",ok:mr.GTE,fail:mr.LT},exclusiveMaximum:{okStr:"<",ok:mr.LT,fail:mr.GTE},exclusiveMinimum:{okStr:">",ok:mr.GT,fail:mr.LTE}},yE={message:({keyword:t,schemaCode:e})=>(0,Ii.str)`must be ${zi[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,Ii._)`{comparison: ${zi[t].okStr}, limit: ${e}}`},_E={keyword:Object.keys(zi),type:"number",schemaType:"number",$data:!0,error:yE,code(t){let{keyword:e,data:r,schemaCode:n}=t;t.fail$data((0,Ii._)`${r} ${zi[e].fail} ${n} || isNaN(${r})`)}};Ju.default=_E});var Hg=k(Ku=>{"use strict";Object.defineProperty(Ku,"__esModule",{value:!0});var jo=B(),vE={message:({schemaCode:t})=>(0,jo.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,jo._)`{multipleOf: ${t}}`},bE={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:vE,code(t){let{gen:e,data:r,schemaCode:n,it:o}=t,s=o.opts.multipleOfPrecision,i=e.let("res"),a=s?(0,jo._)`Math.abs(Math.round(${i}) - ${i}) > 1e-${s}`:(0,jo._)`${i} !== parseInt(${i})`;t.fail$data((0,jo._)`(${n} === 0 || (${i} = ${r}/${n}, ${a}))`)}};Ku.default=bE});var Wg=k(Xu=>{"use strict";Object.defineProperty(Xu,"__esModule",{value:!0});function Gg(t){let e=t.length,r=0,n=0,o;for(;n<e;)r++,o=t.charCodeAt(n++),o>=55296&&o<=56319&&n<e&&(o=t.charCodeAt(n),(o&64512)===56320&&n++);return r}Xu.default=Gg;Gg.code='require("ajv/dist/runtime/ucs2length").default'});var Jg=k(Yu=>{"use strict";Object.defineProperty(Yu,"__esModule",{value:!0});var Yr=B(),xE=te(),wE=Wg(),SE={message({keyword:t,schemaCode:e}){let r=t==="maxLength"?"more":"fewer";return(0,Yr.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,Yr._)`{limit: ${t}}`},$E={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:SE,code(t){let{keyword:e,data:r,schemaCode:n,it:o}=t,s=e==="maxLength"?Yr.operators.GT:Yr.operators.LT,i=o.opts.unicode===!1?(0,Yr._)`${r}.length`:(0,Yr._)`${(0,xE.useFunc)(t.gen,wE.default)}(${r})`;t.fail$data((0,Yr._)`${i} ${s} ${n}`)}};Yu.default=$E});var Kg=k(Qu=>{"use strict";Object.defineProperty(Qu,"__esModule",{value:!0});var kE=at(),Pi=B(),TE={message:({schemaCode:t})=>(0,Pi.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,Pi._)`{pattern: ${t}}`},EE={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:TE,code(t){let{data:e,$data:r,schema:n,schemaCode:o,it:s}=t,i=s.opts.unicodeRegExp?"u":"",a=r?(0,Pi._)`(new RegExp(${o}, ${i}))`:(0,kE.usePattern)(t,n);t.fail$data((0,Pi._)`!${a}.test(${e})`)}};Qu.default=EE});var Xg=k(ed=>{"use strict";Object.defineProperty(ed,"__esModule",{value:!0});var Lo=B(),IE={message({keyword:t,schemaCode:e}){let r=t==="maxProperties"?"more":"fewer";return(0,Lo.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,Lo._)`{limit: ${t}}`},zE={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:IE,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxProperties"?Lo.operators.GT:Lo.operators.LT;t.fail$data((0,Lo._)`Object.keys(${r}).length ${o} ${n}`)}};ed.default=zE});var Yg=k(td=>{"use strict";Object.defineProperty(td,"__esModule",{value:!0});var Zo=at(),Fo=B(),PE=te(),NE={message:({params:{missingProperty:t}})=>(0,Fo.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,Fo._)`{missingProperty: ${t}}`},OE={keyword:"required",type:"object",schemaType:"array",$data:!0,error:NE,code(t){let{gen:e,schema:r,schemaCode:n,data:o,$data:s,it:i}=t,{opts:a}=i;if(!s&&r.length===0)return;let c=r.length>=a.loopRequired;if(i.allErrors?l():u(),a.strictRequired){let h=t.parentSchema.properties,{definedProperties:f}=t.it;for(let m of r)if(h?.[m]===void 0&&!f.has(m)){let y=i.schemaEnv.baseId+i.errSchemaPath,b=`required property "${m}" is not defined at "${y}" (strictRequired)`;(0,PE.checkStrictMode)(i,b,i.opts.strictRequired)}}function l(){if(c||s)t.block$data(Fo.nil,d);else for(let h of r)(0,Zo.checkReportMissingProp)(t,h)}function u(){let h=e.let("missing");if(c||s){let f=e.let("valid",!0);t.block$data(f,()=>g(h,f)),t.ok(f)}else e.if((0,Zo.checkMissingProp)(t,r,h)),(0,Zo.reportMissingProp)(t,h),e.else()}function d(){e.forOf("prop",n,h=>{t.setParams({missingProperty:h}),e.if((0,Zo.noPropertyInData)(e,o,h,a.ownProperties),()=>t.error())})}function g(h,f){t.setParams({missingProperty:h}),e.forOf(h,n,()=>{e.assign(f,(0,Zo.propertyInData)(e,o,h,a.ownProperties)),e.if((0,Fo.not)(f),()=>{t.error(),e.break()})},Fo.nil)}}};td.default=OE});var Qg=k(rd=>{"use strict";Object.defineProperty(rd,"__esModule",{value:!0});var Uo=B(),RE={message({keyword:t,schemaCode:e}){let r=t==="maxItems"?"more":"fewer";return(0,Uo.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,Uo._)`{limit: ${t}}`},CE={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:RE,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxItems"?Uo.operators.GT:Uo.operators.LT;t.fail$data((0,Uo._)`${r}.length ${o} ${n}`)}};rd.default=CE});var Ni=k(nd=>{"use strict";Object.defineProperty(nd,"__esModule",{value:!0});var ey=Eu();ey.code='require("ajv/dist/runtime/equal").default';nd.default=ey});var ty=k(sd=>{"use strict";Object.defineProperty(sd,"__esModule",{value:!0});var od=Io(),ze=B(),AE=te(),ME=Ni(),DE={message:({params:{i:t,j:e}})=>(0,ze.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,ze._)`{i: ${t}, j: ${e}}`},jE={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:DE,code(t){let{gen:e,data:r,$data:n,schema:o,parentSchema:s,schemaCode:i,it:a}=t;if(!n&&!o)return;let c=e.let("valid"),l=s.items?(0,od.getSchemaTypes)(s.items):[];t.block$data(c,u,(0,ze._)`${i} === false`),t.ok(c);function u(){let f=e.let("i",(0,ze._)`${r}.length`),m=e.let("j");t.setParams({i:f,j:m}),e.assign(c,!0),e.if((0,ze._)`${f} > 1`,()=>(d()?g:h)(f,m))}function d(){return l.length>0&&!l.some(f=>f==="object"||f==="array")}function g(f,m){let y=e.name("item"),b=(0,od.checkDataTypes)(l,y,a.opts.strictNumbers,od.DataType.Wrong),x=e.const("indices",(0,ze._)`{}`);e.for((0,ze._)`;${f}--;`,()=>{e.let(y,(0,ze._)`${r}[${f}]`),e.if(b,(0,ze._)`continue`),l.length>1&&e.if((0,ze._)`typeof ${y} == "string"`,(0,ze._)`${y} += "_"`),e.if((0,ze._)`typeof ${x}[${y}] == "number"`,()=>{e.assign(m,(0,ze._)`${x}[${y}]`),t.error(),e.assign(c,!1).break()}).code((0,ze._)`${x}[${y}] = ${f}`)})}function h(f,m){let y=(0,AE.useFunc)(e,ME.default),b=e.name("outer");e.label(b).for((0,ze._)`;${f}--;`,()=>e.for((0,ze._)`${m} = ${f}; ${m}--;`,()=>e.if((0,ze._)`${y}(${r}[${f}], ${r}[${m}])`,()=>{t.error(),e.assign(c,!1).break(b)})))}}};sd.default=jE});var ry=k(ad=>{"use strict";Object.defineProperty(ad,"__esModule",{value:!0});var id=B(),LE=te(),ZE=Ni(),FE={message:"must be equal to constant",params:({schemaCode:t})=>(0,id._)`{allowedValue: ${t}}`},UE={keyword:"const",$data:!0,error:FE,code(t){let{gen:e,data:r,$data:n,schemaCode:o,schema:s}=t;n||s&&typeof s=="object"?t.fail$data((0,id._)`!${(0,LE.useFunc)(e,ZE.default)}(${r}, ${o})`):t.fail((0,id._)`${s} !== ${r}`)}};ad.default=UE});var ny=k(cd=>{"use strict";Object.defineProperty(cd,"__esModule",{value:!0});var qo=B(),qE=te(),VE=Ni(),BE={message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,qo._)`{allowedValues: ${t}}`},HE={keyword:"enum",schemaType:"array",$data:!0,error:BE,code(t){let{gen:e,data:r,$data:n,schema:o,schemaCode:s,it:i}=t;if(!n&&o.length===0)throw new Error("enum must have non-empty array");let a=o.length>=i.opts.loopEnum,c,l=()=>c??(c=(0,qE.useFunc)(e,VE.default)),u;if(a||n)u=e.let("valid"),t.block$data(u,d);else{if(!Array.isArray(o))throw new Error("ajv implementation error");let h=e.const("vSchema",s);u=(0,qo.or)(...o.map((f,m)=>g(h,m)))}t.pass(u);function d(){e.assign(u,!1),e.forOf("v",s,h=>e.if((0,qo._)`${l()}(${r}, ${h})`,()=>e.assign(u,!0).break()))}function g(h,f){let m=o[f];return typeof m=="object"&&m!==null?(0,qo._)`${l()}(${r}, ${h}[${f}])`:(0,qo._)`${r} === ${m}`}}};cd.default=HE});var oy=k(ld=>{"use strict";Object.defineProperty(ld,"__esModule",{value:!0});var GE=Bg(),WE=Hg(),JE=Jg(),KE=Kg(),XE=Xg(),YE=Yg(),QE=Qg(),eI=ty(),tI=ry(),rI=ny(),nI=[GE.default,WE.default,JE.default,KE.default,XE.default,YE.default,QE.default,eI.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},tI.default,rI.default];ld.default=nI});var dd=k(Vo=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0});Vo.validateAdditionalItems=void 0;var Qr=B(),ud=te(),oI={message:({params:{len:t}})=>(0,Qr.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,Qr._)`{limit: ${t}}`},sI={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:oI,code(t){let{parentSchema:e,it:r}=t,{items:n}=e;if(!Array.isArray(n)){(0,ud.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}sy(t,n)}};function sy(t,e){let{gen:r,schema:n,data:o,keyword:s,it:i}=t;i.items=!0;let a=r.const("len",(0,Qr._)`${o}.length`);if(n===!1)t.setParams({len:e.length}),t.pass((0,Qr._)`${a} <= ${e.length}`);else if(typeof n=="object"&&!(0,ud.alwaysValidSchema)(i,n)){let l=r.var("valid",(0,Qr._)`${a} <= ${e.length}`);r.if((0,Qr.not)(l),()=>c(l)),t.ok(l)}function c(l){r.forRange("i",e.length,a,u=>{t.subschema({keyword:s,dataProp:u,dataPropType:ud.Type.Num},l),i.allErrors||r.if((0,Qr.not)(l),()=>r.break())})}}Vo.validateAdditionalItems=sy;Vo.default=sI});var fd=k(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.validateTuple=void 0;var iy=B(),Oi=te(),iI=at(),aI={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){let{schema:e,it:r}=t;if(Array.isArray(e))return ay(t,"additionalItems",e);r.items=!0,!(0,Oi.alwaysValidSchema)(r,e)&&t.ok((0,iI.validateArray)(t))}};function ay(t,e,r=t.schema){let{gen:n,parentSchema:o,data:s,keyword:i,it:a}=t;u(o),a.opts.unevaluated&&r.length&&a.items!==!0&&(a.items=Oi.mergeEvaluated.items(n,r.length,a.items));let c=n.name("valid"),l=n.const("len",(0,iy._)`${s}.length`);r.forEach((d,g)=>{(0,Oi.alwaysValidSchema)(a,d)||(n.if((0,iy._)`${l} > ${g}`,()=>t.subschema({keyword:i,schemaProp:g,dataProp:g},c)),t.ok(c))});function u(d){let{opts:g,errSchemaPath:h}=a,f=r.length,m=f===d.minItems&&(f===d.maxItems||d[e]===!1);if(g.strictTuples&&!m){let y=`"${i}" is ${f}-tuple, but minItems or maxItems/${e} are not specified or different at path "${h}"`;(0,Oi.checkStrictMode)(a,y,g.strictTuples)}}}Bo.validateTuple=ay;Bo.default=aI});var cy=k(pd=>{"use strict";Object.defineProperty(pd,"__esModule",{value:!0});var cI=fd(),lI={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,cI.validateTuple)(t,"items")};pd.default=lI});var uy=k(md=>{"use strict";Object.defineProperty(md,"__esModule",{value:!0});var ly=B(),uI=te(),dI=at(),fI=dd(),pI={message:({params:{len:t}})=>(0,ly.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,ly._)`{limit: ${t}}`},mI={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:pI,code(t){let{schema:e,parentSchema:r,it:n}=t,{prefixItems:o}=r;n.items=!0,!(0,uI.alwaysValidSchema)(n,e)&&(o?(0,fI.validateAdditionalItems)(t,o):t.ok((0,dI.validateArray)(t)))}};md.default=mI});var dy=k(hd=>{"use strict";Object.defineProperty(hd,"__esModule",{value:!0});var lt=B(),Ri=te(),hI={message:({params:{min:t,max:e}})=>e===void 0?(0,lt.str)`must contain at least ${t} valid item(s)`:(0,lt.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,lt._)`{minContains: ${t}}`:(0,lt._)`{minContains: ${t}, maxContains: ${e}}`},gI={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:hI,code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:s}=t,i,a,{minContains:c,maxContains:l}=n;s.opts.next?(i=c===void 0?1:c,a=l):i=1;let u=e.const("len",(0,lt._)`${o}.length`);if(t.setParams({min:i,max:a}),a===void 0&&i===0){(0,Ri.checkStrictMode)(s,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&i>a){(0,Ri.checkStrictMode)(s,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,Ri.alwaysValidSchema)(s,r)){let m=(0,lt._)`${u} >= ${i}`;a!==void 0&&(m=(0,lt._)`${m} && ${u} <= ${a}`),t.pass(m);return}s.items=!0;let d=e.name("valid");a===void 0&&i===1?h(d,()=>e.if(d,()=>e.break())):i===0?(e.let(d,!0),a!==void 0&&e.if((0,lt._)`${o}.length > 0`,g)):(e.let(d,!1),g()),t.result(d,()=>t.reset());function g(){let m=e.name("_valid"),y=e.let("count",0);h(m,()=>e.if(m,()=>f(y)))}function h(m,y){e.forRange("i",0,u,b=>{t.subschema({keyword:"contains",dataProp:b,dataPropType:Ri.Type.Num,compositeRule:!0},m),y()})}function f(m){e.code((0,lt._)`${m}++`),a===void 0?e.if((0,lt._)`${m} >= ${i}`,()=>e.assign(d,!0).break()):(e.if((0,lt._)`${m} > ${a}`,()=>e.assign(d,!1).break()),i===1?e.assign(d,!0):e.if((0,lt._)`${m} >= ${i}`,()=>e.assign(d,!0)))}}};hd.default=gI});var my=k(Pt=>{"use strict";Object.defineProperty(Pt,"__esModule",{value:!0});Pt.validateSchemaDeps=Pt.validatePropertyDeps=Pt.error=void 0;var gd=B(),yI=te(),Ho=at();Pt.error={message:({params:{property:t,depsCount:e,deps:r}})=>{let n=e===1?"property":"properties";return(0,gd.str)`must have ${n} ${r} when property ${t} is present`},params:({params:{property:t,depsCount:e,deps:r,missingProperty:n}})=>(0,gd._)`{property: ${t},
    missingProperty: ${n},
    depsCount: ${e},
    deps: ${r}}`};var _I={keyword:"dependencies",type:"object",schemaType:"object",error:Pt.error,code(t){let[e,r]=vI(t);fy(t,e),py(t,r)}};function vI({schema:t}){let e={},r={};for(let n in t){if(n==="__proto__")continue;let o=Array.isArray(t[n])?e:r;o[n]=t[n]}return[e,r]}function fy(t,e=t.schema){let{gen:r,data:n,it:o}=t;if(Object.keys(e).length===0)return;let s=r.let("missing");for(let i in e){let a=e[i];if(a.length===0)continue;let c=(0,Ho.propertyInData)(r,n,i,o.opts.ownProperties);t.setParams({property:i,depsCount:a.length,deps:a.join(", ")}),o.allErrors?r.if(c,()=>{for(let l of a)(0,Ho.checkReportMissingProp)(t,l)}):(r.if((0,gd._)`${c} && (${(0,Ho.checkMissingProp)(t,a,s)})`),(0,Ho.reportMissingProp)(t,s),r.else())}}Pt.validatePropertyDeps=fy;function py(t,e=t.schema){let{gen:r,data:n,keyword:o,it:s}=t,i=r.name("valid");for(let a in e)(0,yI.alwaysValidSchema)(s,e[a])||(r.if((0,Ho.propertyInData)(r,n,a,s.opts.ownProperties),()=>{let c=t.subschema({keyword:o,schemaProp:a},i);t.mergeValidEvaluated(c,i)},()=>r.var(i,!0)),t.ok(i))}Pt.validateSchemaDeps=py;Pt.default=_I});var gy=k(yd=>{"use strict";Object.defineProperty(yd,"__esModule",{value:!0});var hy=B(),bI=te(),xI={message:"property name must be valid",params:({params:t})=>(0,hy._)`{propertyName: ${t.propertyName}}`},wI={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:xI,code(t){let{gen:e,schema:r,data:n,it:o}=t;if((0,bI.alwaysValidSchema)(o,r))return;let s=e.name("valid");e.forIn("key",n,i=>{t.setParams({propertyName:i}),t.subschema({keyword:"propertyNames",data:i,dataTypes:["string"],propertyName:i,compositeRule:!0},s),e.if((0,hy.not)(s),()=>{t.error(!0),o.allErrors||e.break()})}),t.ok(s)}};yd.default=wI});var vd=k(_d=>{"use strict";Object.defineProperty(_d,"__esModule",{value:!0});var Ci=at(),bt=B(),SI=qt(),Ai=te(),$I={message:"must NOT have additional properties",params:({params:t})=>(0,bt._)`{additionalProperty: ${t.additionalProperty}}`},kI={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:$I,code(t){let{gen:e,schema:r,parentSchema:n,data:o,errsCount:s,it:i}=t;if(!s)throw new Error("ajv implementation error");let{allErrors:a,opts:c}=i;if(i.props=!0,c.removeAdditional!=="all"&&(0,Ai.alwaysValidSchema)(i,r))return;let l=(0,Ci.allSchemaProperties)(n.properties),u=(0,Ci.allSchemaProperties)(n.patternProperties);d(),t.ok((0,bt._)`${s} === ${SI.default.errors}`);function d(){e.forIn("key",o,y=>{!l.length&&!u.length?f(y):e.if(g(y),()=>f(y))})}function g(y){let b;if(l.length>8){let x=(0,Ai.schemaRefOrVal)(i,n.properties,"properties");b=(0,Ci.isOwnProperty)(e,x,y)}else l.length?b=(0,bt.or)(...l.map(x=>(0,bt._)`${y} === ${x}`)):b=bt.nil;return u.length&&(b=(0,bt.or)(b,...u.map(x=>(0,bt._)`${(0,Ci.usePattern)(t,x)}.test(${y})`))),(0,bt.not)(b)}function h(y){e.code((0,bt._)`delete ${o}[${y}]`)}function f(y){if(c.removeAdditional==="all"||c.removeAdditional&&r===!1){h(y);return}if(r===!1){t.setParams({additionalProperty:y}),t.error(),a||e.break();return}if(typeof r=="object"&&!(0,Ai.alwaysValidSchema)(i,r)){let b=e.name("valid");c.removeAdditional==="failing"?(m(y,b,!1),e.if((0,bt.not)(b),()=>{t.reset(),h(y)})):(m(y,b),a||e.if((0,bt.not)(b),()=>e.break()))}}function m(y,b,x){let w={keyword:"additionalProperties",dataProp:y,dataPropType:Ai.Type.Str};x===!1&&Object.assign(w,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(w,b)}}};_d.default=kI});var vy=k(xd=>{"use strict";Object.defineProperty(xd,"__esModule",{value:!0});var TI=Oo(),yy=at(),bd=te(),_y=vd(),EI={keyword:"properties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:s}=t;s.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&_y.default.code(new TI.KeywordCxt(s,_y.default,"additionalProperties"));let i=(0,yy.allSchemaProperties)(r);for(let d of i)s.definedProperties.add(d);s.opts.unevaluated&&i.length&&s.props!==!0&&(s.props=bd.mergeEvaluated.props(e,(0,bd.toHash)(i),s.props));let a=i.filter(d=>!(0,bd.alwaysValidSchema)(s,r[d]));if(a.length===0)return;let c=e.name("valid");for(let d of a)l(d)?u(d):(e.if((0,yy.propertyInData)(e,o,d,s.opts.ownProperties)),u(d),s.allErrors||e.else().var(c,!0),e.endIf()),t.it.definedProperties.add(d),t.ok(c);function l(d){return s.opts.useDefaults&&!s.compositeRule&&r[d].default!==void 0}function u(d){t.subschema({keyword:"properties",schemaProp:d,dataProp:d},c)}}};xd.default=EI});var Sy=k(wd=>{"use strict";Object.defineProperty(wd,"__esModule",{value:!0});var by=at(),Mi=B(),xy=te(),wy=te(),II={keyword:"patternProperties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,data:n,parentSchema:o,it:s}=t,{opts:i}=s,a=(0,by.allSchemaProperties)(r),c=a.filter(m=>(0,xy.alwaysValidSchema)(s,r[m]));if(a.length===0||c.length===a.length&&(!s.opts.unevaluated||s.props===!0))return;let l=i.strictSchema&&!i.allowMatchingProperties&&o.properties,u=e.name("valid");s.props!==!0&&!(s.props instanceof Mi.Name)&&(s.props=(0,wy.evaluatedPropsToName)(e,s.props));let{props:d}=s;g();function g(){for(let m of a)l&&h(m),s.allErrors?f(m):(e.var(u,!0),f(m),e.if(u))}function h(m){for(let y in l)new RegExp(m).test(y)&&(0,xy.checkStrictMode)(s,`property ${y} matches pattern ${m} (use allowMatchingProperties)`)}function f(m){e.forIn("key",n,y=>{e.if((0,Mi._)`${(0,by.usePattern)(t,m)}.test(${y})`,()=>{let b=c.includes(m);b||t.subschema({keyword:"patternProperties",schemaProp:m,dataProp:y,dataPropType:wy.Type.Str},u),s.opts.unevaluated&&d!==!0?e.assign((0,Mi._)`${d}[${y}]`,!0):!b&&!s.allErrors&&e.if((0,Mi.not)(u),()=>e.break())})})}}};wd.default=II});var $y=k(Sd=>{"use strict";Object.defineProperty(Sd,"__esModule",{value:!0});var zI=te(),PI={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){let{gen:e,schema:r,it:n}=t;if((0,zI.alwaysValidSchema)(n,r)){t.fail();return}let o=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),t.failResult(o,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};Sd.default=PI});var ky=k($d=>{"use strict";Object.defineProperty($d,"__esModule",{value:!0});var NI=at(),OI={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:NI.validateUnion,error:{message:"must match a schema in anyOf"}};$d.default=OI});var Ty=k(kd=>{"use strict";Object.defineProperty(kd,"__esModule",{value:!0});var Di=B(),RI=te(),CI={message:"must match exactly one schema in oneOf",params:({params:t})=>(0,Di._)`{passingSchemas: ${t.passing}}`},AI={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:CI,code(t){let{gen:e,schema:r,parentSchema:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(o.opts.discriminator&&n.discriminator)return;let s=r,i=e.let("valid",!1),a=e.let("passing",null),c=e.name("_valid");t.setParams({passing:a}),e.block(l),t.result(i,()=>t.reset(),()=>t.error(!0));function l(){s.forEach((u,d)=>{let g;(0,RI.alwaysValidSchema)(o,u)?e.var(c,!0):g=t.subschema({keyword:"oneOf",schemaProp:d,compositeRule:!0},c),d>0&&e.if((0,Di._)`${c} && ${i}`).assign(i,!1).assign(a,(0,Di._)`[${a}, ${d}]`).else(),e.if(c,()=>{e.assign(i,!0),e.assign(a,d),g&&t.mergeEvaluated(g,Di.Name)})})}}};kd.default=AI});var Ey=k(Td=>{"use strict";Object.defineProperty(Td,"__esModule",{value:!0});var MI=te(),DI={keyword:"allOf",schemaType:"array",code(t){let{gen:e,schema:r,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");let o=e.name("valid");r.forEach((s,i)=>{if((0,MI.alwaysValidSchema)(n,s))return;let a=t.subschema({keyword:"allOf",schemaProp:i},o);t.ok(o),t.mergeEvaluated(a)})}};Td.default=DI});var Py=k(Ed=>{"use strict";Object.defineProperty(Ed,"__esModule",{value:!0});var ji=B(),zy=te(),jI={message:({params:t})=>(0,ji.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,ji._)`{failingKeyword: ${t.ifClause}}`},LI={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:jI,code(t){let{gen:e,parentSchema:r,it:n}=t;r.then===void 0&&r.else===void 0&&(0,zy.checkStrictMode)(n,'"if" without "then" and "else" is ignored');let o=Iy(n,"then"),s=Iy(n,"else");if(!o&&!s)return;let i=e.let("valid",!0),a=e.name("_valid");if(c(),t.reset(),o&&s){let u=e.let("ifClause");t.setParams({ifClause:u}),e.if(a,l("then",u),l("else",u))}else o?e.if(a,l("then")):e.if((0,ji.not)(a),l("else"));t.pass(i,()=>t.error(!0));function c(){let u=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);t.mergeEvaluated(u)}function l(u,d){return()=>{let g=t.subschema({keyword:u},a);e.assign(i,a),t.mergeValidEvaluated(g,i),d?e.assign(d,(0,ji._)`${u}`):t.setParams({ifClause:u})}}}};function Iy(t,e){let r=t.schema[e];return r!==void 0&&!(0,zy.alwaysValidSchema)(t,r)}Ed.default=LI});var Ny=k(Id=>{"use strict";Object.defineProperty(Id,"__esModule",{value:!0});var ZI=te(),FI={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,ZI.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};Id.default=FI});var Oy=k(zd=>{"use strict";Object.defineProperty(zd,"__esModule",{value:!0});var UI=dd(),qI=cy(),VI=fd(),BI=uy(),HI=dy(),GI=my(),WI=gy(),JI=vd(),KI=vy(),XI=Sy(),YI=$y(),QI=ky(),ez=Ty(),tz=Ey(),rz=Py(),nz=Ny();function oz(t=!1){let e=[YI.default,QI.default,ez.default,tz.default,rz.default,nz.default,WI.default,JI.default,GI.default,KI.default,XI.default];return t?e.push(qI.default,BI.default):e.push(UI.default,VI.default),e.push(HI.default),e}zd.default=oz});var Ry=k(Pd=>{"use strict";Object.defineProperty(Pd,"__esModule",{value:!0});var _e=B(),sz={message:({schemaCode:t})=>(0,_e.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,_e._)`{format: ${t}}`},iz={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:sz,code(t,e){let{gen:r,data:n,$data:o,schema:s,schemaCode:i,it:a}=t,{opts:c,errSchemaPath:l,schemaEnv:u,self:d}=a;if(!c.validateFormats)return;o?g():h();function g(){let f=r.scopeValue("formats",{ref:d.formats,code:c.code.formats}),m=r.const("fDef",(0,_e._)`${f}[${i}]`),y=r.let("fType"),b=r.let("format");r.if((0,_e._)`typeof ${m} == "object" && !(${m} instanceof RegExp)`,()=>r.assign(y,(0,_e._)`${m}.type || "string"`).assign(b,(0,_e._)`${m}.validate`),()=>r.assign(y,(0,_e._)`"string"`).assign(b,m)),t.fail$data((0,_e.or)(x(),w()));function x(){return c.strictSchema===!1?_e.nil:(0,_e._)`${i} && !${b}`}function w(){let I=u.$async?(0,_e._)`(${m}.async ? await ${b}(${n}) : ${b}(${n}))`:(0,_e._)`${b}(${n})`,C=(0,_e._)`(typeof ${b} == "function" ? ${I} : ${b}.test(${n}))`;return(0,_e._)`${b} && ${b} !== true && ${y} === ${e} && !${C}`}}function h(){let f=d.formats[s];if(!f){x();return}if(f===!0)return;let[m,y,b]=w(f);m===e&&t.pass(I());function x(){if(c.strictSchema===!1){d.logger.warn(C());return}throw new Error(C());function C(){return`unknown format "${s}" ignored in schema at path "${l}"`}}function w(C){let ve=C instanceof RegExp?(0,_e.regexpCode)(C):c.code.formats?(0,_e._)`${c.code.formats}${(0,_e.getProperty)(s)}`:void 0,Oe=r.scopeValue("formats",{key:s,ref:C,code:ve});return typeof C=="object"&&!(C instanceof RegExp)?[C.type||"string",C.validate,(0,_e._)`${Oe}.validate`]:["string",C,Oe]}function I(){if(typeof f=="object"&&!(f instanceof RegExp)&&f.async){if(!u.$async)throw new Error("async format in sync schema");return(0,_e._)`await ${b}(${n})`}return typeof y=="function"?(0,_e._)`${b}(${n})`:(0,_e._)`${b}.test(${n})`}}}};Pd.default=iz});var Cy=k(Nd=>{"use strict";Object.defineProperty(Nd,"__esModule",{value:!0});var az=Ry(),cz=[az.default];Nd.default=cz});var Ay=k(On=>{"use strict";Object.defineProperty(On,"__esModule",{value:!0});On.contentVocabulary=On.metadataVocabulary=void 0;On.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];On.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var Dy=k(Od=>{"use strict";Object.defineProperty(Od,"__esModule",{value:!0});var lz=Vg(),uz=oy(),dz=Oy(),fz=Cy(),My=Ay(),pz=[lz.default,uz.default,(0,dz.default)(),fz.default,My.metadataVocabulary,My.contentVocabulary];Od.default=pz});var Ly=k(Li=>{"use strict";Object.defineProperty(Li,"__esModule",{value:!0});Li.DiscrError=void 0;var jy;(function(t){t.Tag="tag",t.Mapping="mapping"})(jy||(Li.DiscrError=jy={}))});var Fy=k(Cd=>{"use strict";Object.defineProperty(Cd,"__esModule",{value:!0});var Rn=B(),Rd=Ly(),Zy=bi(),mz=Ro(),hz=te(),gz={message:({params:{discrError:t,tagName:e}})=>t===Rd.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,Rn._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},yz={keyword:"discriminator",type:"object",schemaType:"object",error:gz,code(t){let{gen:e,data:r,schema:n,parentSchema:o,it:s}=t,{oneOf:i}=o;if(!s.opts.discriminator)throw new Error("discriminator: requires discriminator option");let a=n.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!i)throw new Error("discriminator: requires oneOf keyword");let c=e.let("valid",!1),l=e.const("tag",(0,Rn._)`${r}${(0,Rn.getProperty)(a)}`);e.if((0,Rn._)`typeof ${l} == "string"`,()=>u(),()=>t.error(!1,{discrError:Rd.DiscrError.Tag,tag:l,tagName:a})),t.ok(c);function u(){let h=g();e.if(!1);for(let f in h)e.elseIf((0,Rn._)`${l} === ${f}`),e.assign(c,d(h[f]));e.else(),t.error(!1,{discrError:Rd.DiscrError.Mapping,tag:l,tagName:a}),e.endIf()}function d(h){let f=e.name("valid"),m=t.subschema({keyword:"oneOf",schemaProp:h},f);return t.mergeEvaluated(m,Rn.Name),f}function g(){var h;let f={},m=b(o),y=!0;for(let I=0;I<i.length;I++){let C=i[I];if(C?.$ref&&!(0,hz.schemaHasRulesButRef)(C,s.self.RULES)){let Oe=C.$ref;if(C=Zy.resolveRef.call(s.self,s.schemaEnv.root,s.baseId,Oe),C instanceof Zy.SchemaEnv&&(C=C.schema),C===void 0)throw new mz.default(s.opts.uriResolver,s.baseId,Oe)}let ve=(h=C?.properties)===null||h===void 0?void 0:h[a];if(typeof ve!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);y=y&&(m||b(C)),x(ve,I)}if(!y)throw new Error(`discriminator: "${a}" must be required`);return f;function b({required:I}){return Array.isArray(I)&&I.includes(a)}function x(I,C){if(I.const)w(I.const,C);else if(I.enum)for(let ve of I.enum)w(ve,C);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function w(I,C){if(typeof I!="string"||I in f)throw new Error(`discriminator: "${a}" values must be unique strings`);f[I]=C}}}};Cd.default=yz});var Uy=k((QM,_z)=>{_z.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var Md=k((ue,Ad)=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.MissingRefError=ue.ValidationError=ue.CodeGen=ue.Name=ue.nil=ue.stringify=ue.str=ue._=ue.KeywordCxt=ue.Ajv=void 0;var vz=jg(),bz=Dy(),xz=Fy(),qy=Uy(),wz=["/properties"],Zi="http://json-schema.org/draft-07/schema",Cn=class extends vz.default{_addVocabularies(){super._addVocabularies(),bz.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(xz.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let e=this.opts.$data?this.$dataMetaSchema(qy,wz):qy;this.addMetaSchema(e,Zi,!1),this.refs["http://json-schema.org/schema"]=Zi}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(Zi)?Zi:void 0)}};ue.Ajv=Cn;Ad.exports=ue=Cn;Ad.exports.Ajv=Cn;Object.defineProperty(ue,"__esModule",{value:!0});ue.default=Cn;var Sz=Oo();Object.defineProperty(ue,"KeywordCxt",{enumerable:!0,get:function(){return Sz.KeywordCxt}});var An=B();Object.defineProperty(ue,"_",{enumerable:!0,get:function(){return An._}});Object.defineProperty(ue,"str",{enumerable:!0,get:function(){return An.str}});Object.defineProperty(ue,"stringify",{enumerable:!0,get:function(){return An.stringify}});Object.defineProperty(ue,"nil",{enumerable:!0,get:function(){return An.nil}});Object.defineProperty(ue,"Name",{enumerable:!0,get:function(){return An.Name}});Object.defineProperty(ue,"CodeGen",{enumerable:!0,get:function(){return An.CodeGen}});var $z=_i();Object.defineProperty(ue,"ValidationError",{enumerable:!0,get:function(){return $z.default}});var kz=Ro();Object.defineProperty(ue,"MissingRefError",{enumerable:!0,get:function(){return kz.default}})});var Xy=k(Ot=>{"use strict";Object.defineProperty(Ot,"__esModule",{value:!0});Ot.formatNames=Ot.fastFormats=Ot.fullFormats=void 0;function Nt(t,e){return{validate:t,compare:e}}Ot.fullFormats={date:Nt(Gy,Zd),time:Nt(jd(!0),Fd),"date-time":Nt(Vy(!0),Jy),"iso-time":Nt(jd(),Wy),"iso-date-time":Nt(Vy(),Ky),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:Nz,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:jz,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:Oz,int32:{type:"number",validate:Az},int64:{type:"number",validate:Mz},float:{type:"number",validate:Hy},double:{type:"number",validate:Hy},password:!0,binary:!0};Ot.fastFormats={...Ot.fullFormats,date:Nt(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,Zd),time:Nt(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,Fd),"date-time":Nt(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,Jy),"iso-time":Nt(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,Wy),"iso-date-time":Nt(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,Ky),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i};Ot.formatNames=Object.keys(Ot.fullFormats);function Tz(t){return t%4===0&&(t%100!==0||t%400===0)}var Ez=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,Iz=[0,31,28,31,30,31,30,31,31,30,31,30,31];function Gy(t){let e=Ez.exec(t);if(!e)return!1;let r=+e[1],n=+e[2],o=+e[3];return n>=1&&n<=12&&o>=1&&o<=(n===2&&Tz(r)?29:Iz[n])}function Zd(t,e){if(t&&e)return t>e?1:t<e?-1:0}var Dd=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function jd(t){return function(r){let n=Dd.exec(r);if(!n)return!1;let o=+n[1],s=+n[2],i=+n[3],a=n[4],c=n[5]==="-"?-1:1,l=+(n[6]||0),u=+(n[7]||0);if(l>23||u>59||t&&!a)return!1;if(o<=23&&s<=59&&i<60)return!0;let d=s-u*c,g=o-l*c-(d<0?1:0);return(g===23||g===-1)&&(d===59||d===-1)&&i<61}}function Fd(t,e){if(!(t&&e))return;let r=new Date("2020-01-01T"+t).valueOf(),n=new Date("2020-01-01T"+e).valueOf();if(r&&n)return r-n}function Wy(t,e){if(!(t&&e))return;let r=Dd.exec(t),n=Dd.exec(e);if(r&&n)return t=r[1]+r[2]+r[3],e=n[1]+n[2]+n[3],t>e?1:t<e?-1:0}var Ld=/t|\s/i;function Vy(t){let e=jd(t);return function(n){let o=n.split(Ld);return o.length===2&&Gy(o[0])&&e(o[1])}}function Jy(t,e){if(!(t&&e))return;let r=new Date(t).valueOf(),n=new Date(e).valueOf();if(r&&n)return r-n}function Ky(t,e){if(!(t&&e))return;let[r,n]=t.split(Ld),[o,s]=e.split(Ld),i=Zd(r,o);if(i!==void 0)return i||Fd(n,s)}var zz=/\/|:/,Pz=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function Nz(t){return zz.test(t)&&Pz.test(t)}var By=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function Oz(t){return By.lastIndex=0,By.test(t)}var Rz=-(2**31),Cz=2**31-1;function Az(t){return Number.isInteger(t)&&t<=Cz&&t>=Rz}function Mz(t){return Number.isInteger(t)}function Hy(){return!0}var Dz=/[^\\]\\Z/;function jz(t){if(Dz.test(t))return!1;try{return new RegExp(t),!0}catch{return!1}}});var Yy=k(Mn=>{"use strict";Object.defineProperty(Mn,"__esModule",{value:!0});Mn.formatLimitDefinition=void 0;var Lz=Md(),xt=B(),hr=xt.operators,Fi={formatMaximum:{okStr:"<=",ok:hr.LTE,fail:hr.GT},formatMinimum:{okStr:">=",ok:hr.GTE,fail:hr.LT},formatExclusiveMaximum:{okStr:"<",ok:hr.LT,fail:hr.GTE},formatExclusiveMinimum:{okStr:">",ok:hr.GT,fail:hr.LTE}},Zz={message:({keyword:t,schemaCode:e})=>(0,xt.str)`should be ${Fi[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,xt._)`{comparison: ${Fi[t].okStr}, limit: ${e}}`};Mn.formatLimitDefinition={keyword:Object.keys(Fi),type:"string",schemaType:"string",$data:!0,error:Zz,code(t){let{gen:e,data:r,schemaCode:n,keyword:o,it:s}=t,{opts:i,self:a}=s;if(!i.validateFormats)return;let c=new Lz.KeywordCxt(s,a.RULES.all.format.definition,"format");c.$data?l():u();function l(){let g=e.scopeValue("formats",{ref:a.formats,code:i.code.formats}),h=e.const("fmt",(0,xt._)`${g}[${c.schemaCode}]`);t.fail$data((0,xt.or)((0,xt._)`typeof ${h} != "object"`,(0,xt._)`${h} instanceof RegExp`,(0,xt._)`typeof ${h}.compare != "function"`,d(h)))}function u(){let g=c.schema,h=a.formats[g];if(!h||h===!0)return;if(typeof h!="object"||h instanceof RegExp||typeof h.compare!="function")throw new Error(`"${o}": format "${g}" does not define "compare" function`);let f=e.scopeValue("formats",{key:g,ref:h,code:i.code.formats?(0,xt._)`${i.code.formats}${(0,xt.getProperty)(g)}`:void 0});t.fail$data(d(f))}function d(g){return(0,xt._)`${g}.compare(${r}, ${n}) ${Fi[o].fail} 0`}},dependencies:["format"]};var Fz=t=>(t.addKeyword(Mn.formatLimitDefinition),t);Mn.default=Fz});var r_=k((Go,t_)=>{"use strict";Object.defineProperty(Go,"__esModule",{value:!0});var Dn=Xy(),Uz=Yy(),Ud=B(),Qy=new Ud.Name("fullFormats"),qz=new Ud.Name("fastFormats"),qd=(t,e={keywords:!0})=>{if(Array.isArray(e))return e_(t,e,Dn.fullFormats,Qy),t;let[r,n]=e.mode==="fast"?[Dn.fastFormats,qz]:[Dn.fullFormats,Qy],o=e.formats||Dn.formatNames;return e_(t,o,r,n),e.keywords&&(0,Uz.default)(t),t};qd.get=(t,e="full")=>{let n=(e==="fast"?Dn.fastFormats:Dn.fullFormats)[t];if(!n)throw new Error(`Unknown format "${t}"`);return n};function e_(t,e,r,n){var o,s;(o=(s=t.opts.code).formats)!==null&&o!==void 0||(s.formats=(0,Ud._)`require("ajv-formats/dist/formats").${n}`);for(let i of e)t.addFormat(i,r[i])}t_.exports=Go=qd;Object.defineProperty(Go,"__esModule",{value:!0});Go.default=qd});var Ht=k((RD,g_)=>{"use strict";var m_=["nodebuffer","arraybuffer","fragments"],h_=typeof Blob<"u";h_&&m_.push("blob");g_.exports={BINARY_TYPES:m_,CLOSE_TIMEOUT:3e4,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:h_,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var Jo=k((CD,Ji)=>{"use strict";var{EMPTY_BUFFER:Yz}=Ht(),Wd=Buffer[Symbol.species];function Qz(t,e){if(t.length===0)return Yz;if(t.length===1)return t[0];let r=Buffer.allocUnsafe(e),n=0;for(let o=0;o<t.length;o++){let s=t[o];r.set(s,n),n+=s.length}return n<e?new Wd(r.buffer,r.byteOffset,n):r}function y_(t,e,r,n,o){for(let s=0;s<o;s++)r[n+s]=t[s]^e[s&3]}function __(t,e){for(let r=0;r<t.length;r++)t[r]^=e[r&3]}function eP(t){return t.length===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}function Jd(t){if(Jd.readOnly=!0,Buffer.isBuffer(t))return t;let e;return t instanceof ArrayBuffer?e=new Wd(t):ArrayBuffer.isView(t)?e=new Wd(t.buffer,t.byteOffset,t.byteLength):(e=Buffer.from(t),Jd.readOnly=!1),e}Ji.exports={concat:Qz,mask:y_,toArrayBuffer:eP,toBuffer:Jd,unmask:__};if(!process.env.WS_NO_BUFFER_UTIL)try{let t=require("bufferutil");Ji.exports.mask=function(e,r,n,o,s){s<48?y_(e,r,n,o,s):t.mask(e,r,n,o,s)},Ji.exports.unmask=function(e,r){e.length<32?__(e,r):t.unmask(e,r)}}catch{}});var x_=k((AD,b_)=>{"use strict";var v_=Symbol("kDone"),Kd=Symbol("kRun"),Xd=class{constructor(e){this[v_]=()=>{this.pending--,this[Kd]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[Kd]()}[Kd](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[v_])}}};b_.exports=Xd});var Xo=k((MD,k_)=>{"use strict";var Ko=require("zlib"),w_=Jo(),tP=x_(),{kStatusCode:S_}=Ht(),rP=Buffer[Symbol.species],nP=Buffer.from([0,0,255,255]),Xi=Symbol("permessage-deflate"),Gt=Symbol("total-length"),jn=Symbol("callback"),yr=Symbol("buffers"),Ln=Symbol("error"),Ki,Yd=class{constructor(e,r,n){if(this._maxPayload=n|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!Ki){let o=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Ki=new tP(o)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[jn];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let r=this._options,n=e.find(o=>!(r.serverNoContextTakeover===!1&&o.server_no_context_takeover||o.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>o.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!o.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(n.server_no_context_takeover=!0),r.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(n.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?n.client_max_window_bits=r.clientMaxWindowBits:(n.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(e){let r=e[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(e){return e.forEach(r=>{Object.keys(r).forEach(n=>{let o=r[n];if(o.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(o=o[0],n==="client_max_window_bits"){if(o!==!0){let s=+o;if(!Number.isInteger(s)||s<8||s>15)throw new TypeError(`Invalid value for parameter "${n}": ${o}`);o=s}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${o}`)}else if(n==="server_max_window_bits"){let s=+o;if(!Number.isInteger(s)||s<8||s>15)throw new TypeError(`Invalid value for parameter "${n}": ${o}`);o=s}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(o!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${o}`)}else throw new Error(`Unknown parameter "${n}"`);r[n]=o})}),e}decompress(e,r,n){Ki.add(o=>{this._decompress(e,r,(s,i)=>{o(),n(s,i)})})}compress(e,r,n){Ki.add(o=>{this._compress(e,r,(s,i)=>{o(),n(s,i)})})}_decompress(e,r,n){let o=this._isServer?"client":"server";if(!this._inflate){let s=`${o}_max_window_bits`,i=typeof this.params[s]!="number"?Ko.Z_DEFAULT_WINDOWBITS:this.params[s];this._inflate=Ko.createInflateRaw({...this._options.zlibInflateOptions,windowBits:i}),this._inflate[Xi]=this,this._inflate[Gt]=0,this._inflate[yr]=[],this._inflate.on("error",sP),this._inflate.on("data",$_)}this._inflate[jn]=n,this._inflate.write(e),r&&this._inflate.write(nP),this._inflate.flush(()=>{let s=this._inflate[Ln];if(s){this._inflate.close(),this._inflate=null,n(s);return}let i=w_.concat(this._inflate[yr],this._inflate[Gt]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[Gt]=0,this._inflate[yr]=[],r&&this.params[`${o}_no_context_takeover`]&&this._inflate.reset()),n(null,i)})}_compress(e,r,n){let o=this._isServer?"server":"client";if(!this._deflate){let s=`${o}_max_window_bits`,i=typeof this.params[s]!="number"?Ko.Z_DEFAULT_WINDOWBITS:this.params[s];this._deflate=Ko.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:i}),this._deflate[Gt]=0,this._deflate[yr]=[],this._deflate.on("data",oP)}this._deflate[jn]=n,this._deflate.write(e),this._deflate.flush(Ko.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let s=w_.concat(this._deflate[yr],this._deflate[Gt]);r&&(s=new rP(s.buffer,s.byteOffset,s.length-4)),this._deflate[jn]=null,this._deflate[Gt]=0,this._deflate[yr]=[],r&&this.params[`${o}_no_context_takeover`]&&this._deflate.reset(),n(null,s)})}};k_.exports=Yd;function oP(t){this[yr].push(t),this[Gt]+=t.length}function $_(t){if(this[Gt]+=t.length,this[Xi]._maxPayload<1||this[Gt]<=this[Xi]._maxPayload){this[yr].push(t);return}this[Ln]=new RangeError("Max payload size exceeded"),this[Ln].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Ln][S_]=1009,this.removeListener("data",$_),this.reset()}function sP(t){if(this[Xi]._inflate=null,this[Ln]){this[jn](this[Ln]);return}t[S_]=1007,this[jn](t)}});var Zn=k((DD,Yi)=>{"use strict";var{isUtf8:T_}=require("buffer"),{hasBlob:iP}=Ht(),aP=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function cP(t){return t>=1e3&&t<=1014&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999}function Qd(t){let e=t.length,r=0;for(;r<e;)if(!(t[r]&128))r++;else if((t[r]&224)===192){if(r+1===e||(t[r+1]&192)!==128||(t[r]&254)===192)return!1;r+=2}else if((t[r]&240)===224){if(r+2>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||t[r]===224&&(t[r+1]&224)===128||t[r]===237&&(t[r+1]&224)===160)return!1;r+=3}else if((t[r]&248)===240){if(r+3>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||(t[r+3]&192)!==128||t[r]===240&&(t[r+1]&240)===128||t[r]===244&&t[r+1]>143||t[r]>244)return!1;r+=4}else return!1;return!0}function lP(t){return iP&&typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&(t[Symbol.toStringTag]==="Blob"||t[Symbol.toStringTag]==="File")}Yi.exports={isBlob:lP,isValidStatusCode:cP,isValidUTF8:Qd,tokenChars:aP};if(T_)Yi.exports.isValidUTF8=function(t){return t.length<24?Qd(t):T_(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=require("utf-8-validate");Yi.exports.isValidUTF8=function(e){return e.length<32?Qd(e):t(e)}}catch{}});var of=k((jD,R_)=>{"use strict";var{Writable:uP}=require("stream"),E_=Xo(),{BINARY_TYPES:dP,EMPTY_BUFFER:I_,kStatusCode:fP,kWebSocket:pP}=Ht(),{concat:ef,toArrayBuffer:mP,unmask:hP}=Jo(),{isValidStatusCode:gP,isValidUTF8:z_}=Zn(),Qi=Buffer[Symbol.species],ut=0,P_=1,N_=2,O_=3,tf=4,rf=5,ea=6,nf=class extends uP{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||dP[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[pP]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=ut}_write(e,r,n){if(this._opcode===8&&this._state==ut)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=new Qi(n.buffer,n.byteOffset+e,n.length-e),new Qi(n.buffer,n.byteOffset,e)}let r=Buffer.allocUnsafe(e);do{let n=this._buffers[0],o=r.length-e;e>=n.length?r.set(this._buffers.shift(),o):(r.set(new Uint8Array(n.buffer,n.byteOffset,e),o),this._buffers[0]=new Qi(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0);return r}startLoop(e){this._loop=!0;do switch(this._state){case ut:this.getInfo(e);break;case P_:this.getPayloadLength16(e);break;case N_:this.getPayloadLength64(e);break;case O_:this.getMask();break;case tf:this.getData(e);break;case rf:case ea:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let r=this.consume(2);if(r[0]&48){let o=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(o);return}let n=(r[0]&64)===64;if(n&&!this._extensions[E_.extensionName]){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(this._fin=(r[0]&128)===128,this._opcode=r[0]&15,this._payloadLength=r[1]&127,this._opcode===0){if(n){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(!this._fragmented){let o=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}this._compressed=n}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let o=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(o);return}if(n){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let o=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(o);return}}else{let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(r[1]&128)===128,this._isServer){if(!this._masked){let o=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(o);return}}else if(this._masked){let o=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(o);return}this._payloadLength===126?this._state=P_:this._payloadLength===127?this._state=N_:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let r=this.consume(8),n=r.readUInt32BE(0);if(n>Math.pow(2,21)-1){let o=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(o);return}this._payloadLength=n*Math.pow(2,32)+r.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let r=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(r);return}this._masked?this._state=O_:this._state=tf}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=tf}getData(e){let r=I_;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&hP(r,this._mask)}if(this._opcode>7){this.controlMessage(r,e);return}if(this._compressed){this._state=rf,this.decompress(r,e);return}r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage(e)}decompress(e,r){this._extensions[E_.extensionName].decompress(e,this._fin,(o,s)=>{if(o)return r(o);if(s.length){if(this._messageLength+=s.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let i=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");r(i);return}this._fragments.push(s)}this.dataMessage(r),this._state===ut&&this.startLoop(r)})}dataMessage(e){if(!this._fin){this._state=ut;return}let r=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let o;this._binaryType==="nodebuffer"?o=ef(n,r):this._binaryType==="arraybuffer"?o=mP(ef(n,r)):this._binaryType==="blob"?o=new Blob(n):o=n,this._allowSynchronousEvents?(this.emit("message",o,!0),this._state=ut):(this._state=ea,setImmediate(()=>{this.emit("message",o,!0),this._state=ut,this.startLoop(e)}))}else{let o=ef(n,r);if(!this._skipUTF8Validation&&!z_(o)){let s=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(s);return}this._state===rf||this._allowSynchronousEvents?(this.emit("message",o,!1),this._state=ut):(this._state=ea,setImmediate(()=>{this.emit("message",o,!1),this._state=ut,this.startLoop(e)}))}}controlMessage(e,r){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,I_),this.end();else{let n=e.readUInt16BE(0);if(!gP(n)){let s=this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");r(s);return}let o=new Qi(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!z_(o)){let s=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");r(s);return}this._loop=!1,this.emit("conclude",n,o),this.end()}this._state=ut;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=ut):(this._state=ea,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=ut,this.startLoop(r)}))}createError(e,r,n,o,s){this._loop=!1,this._errored=!0;let i=new e(n?`Invalid WebSocket frame: ${r}`:r);return Error.captureStackTrace(i,this.createError),i.code=s,i[fP]=o,i}};R_.exports=nf});var cf=k((ZD,M_)=>{"use strict";var{Duplex:LD}=require("stream"),{randomFillSync:yP}=require("crypto"),C_=Xo(),{EMPTY_BUFFER:_P,kWebSocket:vP,NOOP:bP}=Ht(),{isBlob:Fn,isValidStatusCode:xP}=Zn(),{mask:A_,toBuffer:en}=Jo(),dt=Symbol("kByteLength"),wP=Buffer.alloc(4),ta=8*1024,tn,Un=ta,wt=0,SP=1,$P=2,sf=class t{constructor(e,r,n){this._extensions=r||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=wt,this.onerror=bP,this[vP]=void 0}static frame(e,r){let n,o=!1,s=2,i=!1;r.mask&&(n=r.maskBuffer||wP,r.generateMask?r.generateMask(n):(Un===ta&&(tn===void 0&&(tn=Buffer.alloc(ta)),yP(tn,0,ta),Un=0),n[0]=tn[Un++],n[1]=tn[Un++],n[2]=tn[Un++],n[3]=tn[Un++]),i=(n[0]|n[1]|n[2]|n[3])===0,s=6);let a;typeof e=="string"?(!r.mask||i)&&r[dt]!==void 0?a=r[dt]:(e=Buffer.from(e),a=e.length):(a=e.length,o=r.mask&&r.readOnly&&!i);let c=a;a>=65536?(s+=8,c=127):a>125&&(s+=2,c=126);let l=Buffer.allocUnsafe(o?a+s:s);return l[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(l[0]|=64),l[1]=c,c===126?l.writeUInt16BE(a,2):c===127&&(l[2]=l[3]=0,l.writeUIntBE(a,4,6)),r.mask?(l[1]|=128,l[s-4]=n[0],l[s-3]=n[1],l[s-2]=n[2],l[s-1]=n[3],i?[l,e]:o?(A_(e,n,l,s,a),[l]):(A_(e,n,e,0,a),[l,e])):[l,e]}close(e,r,n,o){let s;if(e===void 0)s=_P;else{if(typeof e!="number"||!xP(e))throw new TypeError("First argument must be a valid error code number");if(r===void 0||!r.length)s=Buffer.allocUnsafe(2),s.writeUInt16BE(e,0);else{let a=Buffer.byteLength(r);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");s=Buffer.allocUnsafe(2+a),s.writeUInt16BE(e,0),typeof r=="string"?s.write(r,2):s.set(r,2)}}let i={[dt]:s.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==wt?this.enqueue([this.dispatch,s,!1,i,o]):this.sendFrame(t.frame(s,i),o)}ping(e,r,n){let o,s;if(typeof e=="string"?(o=Buffer.byteLength(e),s=!1):Fn(e)?(o=e.size,s=!1):(e=en(e),o=e.length,s=en.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let i={[dt]:o,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:9,readOnly:s,rsv1:!1};Fn(e)?this._state!==wt?this.enqueue([this.getBlobData,e,!1,i,n]):this.getBlobData(e,!1,i,n):this._state!==wt?this.enqueue([this.dispatch,e,!1,i,n]):this.sendFrame(t.frame(e,i),n)}pong(e,r,n){let o,s;if(typeof e=="string"?(o=Buffer.byteLength(e),s=!1):Fn(e)?(o=e.size,s=!1):(e=en(e),o=e.length,s=en.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let i={[dt]:o,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:10,readOnly:s,rsv1:!1};Fn(e)?this._state!==wt?this.enqueue([this.getBlobData,e,!1,i,n]):this.getBlobData(e,!1,i,n):this._state!==wt?this.enqueue([this.dispatch,e,!1,i,n]):this.sendFrame(t.frame(e,i),n)}send(e,r,n){let o=this._extensions[C_.extensionName],s=r.binary?2:1,i=r.compress,a,c;typeof e=="string"?(a=Buffer.byteLength(e),c=!1):Fn(e)?(a=e.size,c=!1):(e=en(e),a=e.length,c=en.readOnly),this._firstFragment?(this._firstFragment=!1,i&&o&&o.params[o._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(i=a>=o._threshold),this._compress=i):(i=!1,s=0),r.fin&&(this._firstFragment=!0);let l={[dt]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:s,readOnly:c,rsv1:i};Fn(e)?this._state!==wt?this.enqueue([this.getBlobData,e,this._compress,l,n]):this.getBlobData(e,this._compress,l,n):this._state!==wt?this.enqueue([this.dispatch,e,this._compress,l,n]):this.dispatch(e,this._compress,l,n)}getBlobData(e,r,n,o){this._bufferedBytes+=n[dt],this._state=$P,e.arrayBuffer().then(s=>{if(this._socket.destroyed){let a=new Error("The socket was closed while the blob was being read");process.nextTick(af,this,a,o);return}this._bufferedBytes-=n[dt];let i=en(s);r?this.dispatch(i,r,n,o):(this._state=wt,this.sendFrame(t.frame(i,n),o),this.dequeue())}).catch(s=>{process.nextTick(kP,this,s,o)})}dispatch(e,r,n,o){if(!r){this.sendFrame(t.frame(e,n),o);return}let s=this._extensions[C_.extensionName];this._bufferedBytes+=n[dt],this._state=SP,s.compress(e,n.fin,(i,a)=>{if(this._socket.destroyed){let c=new Error("The socket was closed while data was being compressed");af(this,c,o);return}this._bufferedBytes-=n[dt],this._state=wt,n.readOnly=!1,this.sendFrame(t.frame(a,n),o),this.dequeue()})}dequeue(){for(;this._state===wt&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][dt],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][dt],this._queue.push(e)}sendFrame(e,r){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],r),this._socket.uncork()):this._socket.write(e[0],r)}};M_.exports=sf;function af(t,e,r){typeof r=="function"&&r(e);for(let n=0;n<t._queue.length;n++){let o=t._queue[n],s=o[o.length-1];typeof s=="function"&&s(e)}}function kP(t,e,r){af(t,e,r),t.onerror(e)}});var B_=k((FD,V_)=>{"use strict";var{kForOnEventAttribute:Yo,kListener:lf}=Ht(),D_=Symbol("kCode"),j_=Symbol("kData"),L_=Symbol("kError"),Z_=Symbol("kMessage"),F_=Symbol("kReason"),qn=Symbol("kTarget"),U_=Symbol("kType"),q_=Symbol("kWasClean"),Wt=class{constructor(e){this[qn]=null,this[U_]=e}get target(){return this[qn]}get type(){return this[U_]}};Object.defineProperty(Wt.prototype,"target",{enumerable:!0});Object.defineProperty(Wt.prototype,"type",{enumerable:!0});var rn=class extends Wt{constructor(e,r={}){super(e),this[D_]=r.code===void 0?0:r.code,this[F_]=r.reason===void 0?"":r.reason,this[q_]=r.wasClean===void 0?!1:r.wasClean}get code(){return this[D_]}get reason(){return this[F_]}get wasClean(){return this[q_]}};Object.defineProperty(rn.prototype,"code",{enumerable:!0});Object.defineProperty(rn.prototype,"reason",{enumerable:!0});Object.defineProperty(rn.prototype,"wasClean",{enumerable:!0});var Vn=class extends Wt{constructor(e,r={}){super(e),this[L_]=r.error===void 0?null:r.error,this[Z_]=r.message===void 0?"":r.message}get error(){return this[L_]}get message(){return this[Z_]}};Object.defineProperty(Vn.prototype,"error",{enumerable:!0});Object.defineProperty(Vn.prototype,"message",{enumerable:!0});var Qo=class extends Wt{constructor(e,r={}){super(e),this[j_]=r.data===void 0?null:r.data}get data(){return this[j_]}};Object.defineProperty(Qo.prototype,"data",{enumerable:!0});var TP={addEventListener(t,e,r={}){for(let o of this.listeners(t))if(!r[Yo]&&o[lf]===e&&!o[Yo])return;let n;if(t==="message")n=function(s,i){let a=new Qo("message",{data:i?s:s.toString()});a[qn]=this,ra(e,this,a)};else if(t==="close")n=function(s,i){let a=new rn("close",{code:s,reason:i.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[qn]=this,ra(e,this,a)};else if(t==="error")n=function(s){let i=new Vn("error",{error:s,message:s.message});i[qn]=this,ra(e,this,i)};else if(t==="open")n=function(){let s=new Wt("open");s[qn]=this,ra(e,this,s)};else return;n[Yo]=!!r[Yo],n[lf]=e,r.once?this.once(t,n):this.on(t,n)},removeEventListener(t,e){for(let r of this.listeners(t))if(r[lf]===e&&!r[Yo]){this.removeListener(t,r);break}}};V_.exports={CloseEvent:rn,ErrorEvent:Vn,Event:Wt,EventTarget:TP,MessageEvent:Qo};function ra(t,e,r){typeof t=="object"&&t.handleEvent?t.handleEvent.call(t,r):t.call(e,r)}});var uf=k((UD,H_)=>{"use strict";var{tokenChars:es}=Zn();function Rt(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}function EP(t){let e=Object.create(null),r=Object.create(null),n=!1,o=!1,s=!1,i,a,c=-1,l=-1,u=-1,d=0;for(;d<t.length;d++)if(l=t.charCodeAt(d),i===void 0)if(u===-1&&es[l]===1)c===-1&&(c=d);else if(d!==0&&(l===32||l===9))u===-1&&c!==-1&&(u=d);else if(l===59||l===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);u===-1&&(u=d);let h=t.slice(c,u);l===44?(Rt(e,h,r),r=Object.create(null)):i=h,c=u=-1}else throw new SyntaxError(`Unexpected character at index ${d}`);else if(a===void 0)if(u===-1&&es[l]===1)c===-1&&(c=d);else if(l===32||l===9)u===-1&&c!==-1&&(u=d);else if(l===59||l===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);u===-1&&(u=d),Rt(r,t.slice(c,u),!0),l===44&&(Rt(e,i,r),r=Object.create(null),i=void 0),c=u=-1}else if(l===61&&c!==-1&&u===-1)a=t.slice(c,d),c=u=-1;else throw new SyntaxError(`Unexpected character at index ${d}`);else if(o){if(es[l]!==1)throw new SyntaxError(`Unexpected character at index ${d}`);c===-1?c=d:n||(n=!0),o=!1}else if(s)if(es[l]===1)c===-1&&(c=d);else if(l===34&&c!==-1)s=!1,u=d;else if(l===92)o=!0;else throw new SyntaxError(`Unexpected character at index ${d}`);else if(l===34&&t.charCodeAt(d-1)===61)s=!0;else if(u===-1&&es[l]===1)c===-1&&(c=d);else if(c!==-1&&(l===32||l===9))u===-1&&(u=d);else if(l===59||l===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);u===-1&&(u=d);let h=t.slice(c,u);n&&(h=h.replace(/\\/g,""),n=!1),Rt(r,a,h),l===44&&(Rt(e,i,r),r=Object.create(null),i=void 0),a=void 0,c=u=-1}else throw new SyntaxError(`Unexpected character at index ${d}`);if(c===-1||s||l===32||l===9)throw new SyntaxError("Unexpected end of input");u===-1&&(u=d);let g=t.slice(c,u);return i===void 0?Rt(e,g,r):(a===void 0?Rt(r,g,!0):n?Rt(r,a,g.replace(/\\/g,"")):Rt(r,a,g),Rt(e,i,r)),e}function IP(t){return Object.keys(t).map(e=>{let r=t[e];return Array.isArray(r)||(r=[r]),r.map(n=>[e].concat(Object.keys(n).map(o=>{let s=n[o];return Array.isArray(s)||(s=[s]),s.map(i=>i===!0?o:`${o}=${i}`).join("; ")})).join("; ")).join(", ")}).join(", ")}H_.exports={format:IP,parse:EP}});var ia=k((BD,ov)=>{"use strict";var zP=require("events"),PP=require("https"),NP=require("http"),J_=require("net"),OP=require("tls"),{randomBytes:RP,createHash:CP}=require("crypto"),{Duplex:qD,Readable:VD}=require("stream"),{URL:df}=require("url"),_r=Xo(),AP=of(),MP=cf(),{isBlob:DP}=Zn(),{BINARY_TYPES:G_,CLOSE_TIMEOUT:jP,EMPTY_BUFFER:na,GUID:LP,kForOnEventAttribute:ff,kListener:ZP,kStatusCode:FP,kWebSocket:we,NOOP:K_}=Ht(),{EventTarget:{addEventListener:UP,removeEventListener:qP}}=B_(),{format:VP,parse:BP}=uf(),{toBuffer:HP}=Jo(),X_=Symbol("kAborted"),pf=[8,13],Jt=["CONNECTING","OPEN","CLOSING","CLOSED"],GP=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,he=class t extends zP{constructor(e,r,n){super(),this._binaryType=G_[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=na,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=t.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,r===void 0?r=[]:Array.isArray(r)||(typeof r=="object"&&r!==null?(n=r,r=[]):r=[r]),Y_(this,e,r,n)):(this._autoPong=n.autoPong,this._closeTimeout=n.closeTimeout,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){G_.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,r,n){let o=new AP({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation}),s=new MP(e,this._extensions,n.generateMask);this._receiver=o,this._sender=s,this._socket=e,o[we]=this,s[we]=this,e[we]=this,o.on("conclude",KP),o.on("drain",XP),o.on("error",YP),o.on("message",QP),o.on("ping",eN),o.on("pong",tN),s.onerror=rN,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),r.length>0&&e.unshift(r),e.on("close",tv),e.on("data",sa),e.on("end",rv),e.on("error",nv),this._readyState=t.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[_r.extensionName]&&this._extensions[_r.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,r){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){et(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===t.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=t.CLOSING,this._sender.close(e,r,!this._isServer,n=>{n||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),ev(this)}}pause(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){mf(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.ping(e||na,r,n)}pong(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){mf(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.pong(e||na,r,n)}resume(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(n=r,r={}),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){mf(this,e,n);return}let o={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[_r.extensionName]||(o.compress=!1),this._sender.send(e||na,o,n)}terminate(){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){et(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=t.CLOSING,this._socket.destroy())}}};Object.defineProperty(he,"CONNECTING",{enumerable:!0,value:Jt.indexOf("CONNECTING")});Object.defineProperty(he.prototype,"CONNECTING",{enumerable:!0,value:Jt.indexOf("CONNECTING")});Object.defineProperty(he,"OPEN",{enumerable:!0,value:Jt.indexOf("OPEN")});Object.defineProperty(he.prototype,"OPEN",{enumerable:!0,value:Jt.indexOf("OPEN")});Object.defineProperty(he,"CLOSING",{enumerable:!0,value:Jt.indexOf("CLOSING")});Object.defineProperty(he.prototype,"CLOSING",{enumerable:!0,value:Jt.indexOf("CLOSING")});Object.defineProperty(he,"CLOSED",{enumerable:!0,value:Jt.indexOf("CLOSED")});Object.defineProperty(he.prototype,"CLOSED",{enumerable:!0,value:Jt.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(t=>{Object.defineProperty(he.prototype,t,{enumerable:!0})});["open","error","close","message"].forEach(t=>{Object.defineProperty(he.prototype,`on${t}`,{enumerable:!0,get(){for(let e of this.listeners(t))if(e[ff])return e[ZP];return null},set(e){for(let r of this.listeners(t))if(r[ff]){this.removeListener(t,r);break}typeof e=="function"&&this.addEventListener(t,e,{[ff]:!0})}})});he.prototype.addEventListener=UP;he.prototype.removeEventListener=qP;ov.exports=he;function Y_(t,e,r,n){let o={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:jP,protocolVersion:pf[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=o.autoPong,t._closeTimeout=o.closeTimeout,!pf.includes(o.protocolVersion))throw new RangeError(`Unsupported protocol version: ${o.protocolVersion} (supported versions: ${pf.join(", ")})`);let s;if(e instanceof df)s=e;else try{s=new df(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}s.protocol==="http:"?s.protocol="ws:":s.protocol==="https:"&&(s.protocol="wss:"),t._url=s.href;let i=s.protocol==="wss:",a=s.protocol==="ws+unix:",c;if(s.protocol!=="ws:"&&!i&&!a?c=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`:a&&!s.pathname?c="The URL's pathname is empty":s.hash&&(c="The URL contains a fragment identifier"),c){let m=new SyntaxError(c);if(t._redirects===0)throw m;oa(t,m);return}let l=i?443:80,u=RP(16).toString("base64"),d=i?PP.request:NP.request,g=new Set,h;if(o.createConnection=o.createConnection||(i?JP:WP),o.defaultPort=o.defaultPort||l,o.port=s.port||l,o.host=s.hostname.startsWith("[")?s.hostname.slice(1,-1):s.hostname,o.headers={...o.headers,"Sec-WebSocket-Version":o.protocolVersion,"Sec-WebSocket-Key":u,Connection:"Upgrade",Upgrade:"websocket"},o.path=s.pathname+s.search,o.timeout=o.handshakeTimeout,o.perMessageDeflate&&(h=new _r(o.perMessageDeflate!==!0?o.perMessageDeflate:{},!1,o.maxPayload),o.headers["Sec-WebSocket-Extensions"]=VP({[_r.extensionName]:h.offer()})),r.length){for(let m of r){if(typeof m!="string"||!GP.test(m)||g.has(m))throw new SyntaxError("An invalid or duplicated subprotocol was specified");g.add(m)}o.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(o.origin&&(o.protocolVersion<13?o.headers["Sec-WebSocket-Origin"]=o.origin:o.headers.Origin=o.origin),(s.username||s.password)&&(o.auth=`${s.username}:${s.password}`),a){let m=o.path.split(":");o.socketPath=m[0],o.path=m[1]}let f;if(o.followRedirects){if(t._redirects===0){t._originalIpc=a,t._originalSecure=i,t._originalHostOrSocketPath=a?o.socketPath:s.host;let m=n&&n.headers;if(n={...n,headers:{}},m)for(let[y,b]of Object.entries(m))n.headers[y.toLowerCase()]=b}else if(t.listenerCount("redirect")===0){let m=a?t._originalIpc?o.socketPath===t._originalHostOrSocketPath:!1:t._originalIpc?!1:s.host===t._originalHostOrSocketPath;(!m||t._originalSecure&&!i)&&(delete o.headers.authorization,delete o.headers.cookie,m||delete o.headers.host,o.auth=void 0)}o.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(o.auth).toString("base64")),f=t._req=d(o),t._redirects&&t.emit("redirect",t.url,f)}else f=t._req=d(o);o.timeout&&f.on("timeout",()=>{et(t,f,"Opening handshake has timed out")}),f.on("error",m=>{f===null||f[X_]||(f=t._req=null,oa(t,m))}),f.on("response",m=>{let y=m.headers.location,b=m.statusCode;if(y&&o.followRedirects&&b>=300&&b<400){if(++t._redirects>o.maxRedirects){et(t,f,"Maximum redirects exceeded");return}f.abort();let x;try{x=new df(y,e)}catch{let I=new SyntaxError(`Invalid URL: ${y}`);oa(t,I);return}Y_(t,x,r,n)}else t.emit("unexpected-response",f,m)||et(t,f,`Unexpected server response: ${m.statusCode}`)}),f.on("upgrade",(m,y,b)=>{if(t.emit("upgrade",m),t.readyState!==he.CONNECTING)return;f=t._req=null;let x=m.headers.upgrade;if(x===void 0||x.toLowerCase()!=="websocket"){et(t,y,"Invalid Upgrade header");return}let w=CP("sha1").update(u+LP).digest("base64");if(m.headers["sec-websocket-accept"]!==w){et(t,y,"Invalid Sec-WebSocket-Accept header");return}let I=m.headers["sec-websocket-protocol"],C;if(I!==void 0?g.size?g.has(I)||(C="Server sent an invalid subprotocol"):C="Server sent a subprotocol but none was requested":g.size&&(C="Server sent no subprotocol"),C){et(t,y,C);return}I&&(t._protocol=I);let ve=m.headers["sec-websocket-extensions"];if(ve!==void 0){if(!h){et(t,y,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let Oe;try{Oe=BP(ve)}catch{et(t,y,"Invalid Sec-WebSocket-Extensions header");return}let At=Object.keys(Oe);if(At.length!==1||At[0]!==_r.extensionName){et(t,y,"Server indicated an extension that was not requested");return}try{h.accept(Oe[_r.extensionName])}catch{et(t,y,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[_r.extensionName]=h}t.setSocket(y,b,{allowSynchronousEvents:o.allowSynchronousEvents,generateMask:o.generateMask,maxPayload:o.maxPayload,skipUTF8Validation:o.skipUTF8Validation})}),o.finishRequest?o.finishRequest(f,t):f.end()}function oa(t,e){t._readyState=he.CLOSING,t._errorEmitted=!0,t.emit("error",e),t.emitClose()}function WP(t){return t.path=t.socketPath,J_.connect(t)}function JP(t){return t.path=void 0,!t.servername&&t.servername!==""&&(t.servername=J_.isIP(t.host)?"":t.host),OP.connect(t)}function et(t,e,r){t._readyState=he.CLOSING;let n=new Error(r);Error.captureStackTrace(n,et),e.setHeader?(e[X_]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(oa,t,n)):(e.destroy(n),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}function mf(t,e,r){if(e){let n=DP(e)?e.size:HP(e).length;t._socket?t._sender._bufferedBytes+=n:t._bufferedAmount+=n}if(r){let n=new Error(`WebSocket is not open: readyState ${t.readyState} (${Jt[t.readyState]})`);process.nextTick(r,n)}}function KP(t,e){let r=this[we];r._closeFrameReceived=!0,r._closeMessage=e,r._closeCode=t,r._socket[we]!==void 0&&(r._socket.removeListener("data",sa),process.nextTick(Q_,r._socket),t===1005?r.close():r.close(t,e))}function XP(){let t=this[we];t.isPaused||t._socket.resume()}function YP(t){let e=this[we];e._socket[we]!==void 0&&(e._socket.removeListener("data",sa),process.nextTick(Q_,e._socket),e.close(t[FP])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t))}function W_(){this[we].emitClose()}function QP(t,e){this[we].emit("message",t,e)}function eN(t){let e=this[we];e._autoPong&&e.pong(t,!this._isServer,K_),e.emit("ping",t)}function tN(t){this[we].emit("pong",t)}function Q_(t){t.resume()}function rN(t){let e=this[we];e.readyState!==he.CLOSED&&(e.readyState===he.OPEN&&(e._readyState=he.CLOSING,ev(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t)))}function ev(t){t._closeTimer=setTimeout(t._socket.destroy.bind(t._socket),t._closeTimeout)}function tv(){let t=this[we];if(this.removeListener("close",tv),this.removeListener("data",sa),this.removeListener("end",rv),t._readyState=he.CLOSING,!this._readableState.endEmitted&&!t._closeFrameReceived&&!t._receiver._writableState.errorEmitted&&this._readableState.length!==0){let e=this.read(this._readableState.length);t._receiver.write(e)}t._receiver.end(),this[we]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",W_),t._receiver.on("finish",W_))}function sa(t){this[we]._receiver.write(t)||this.pause()}function rv(){let t=this[we];t._readyState=he.CLOSING,t._receiver.end(),this.end()}function nv(){let t=this[we];this.removeListener("error",nv),this.on("error",K_),t&&(t._readyState=he.CLOSING,this.destroy())}});var cv=k((GD,av)=>{"use strict";var HD=ia(),{Duplex:nN}=require("stream");function sv(t){t.emit("close")}function oN(){!this.destroyed&&this._writableState.finished&&this.destroy()}function iv(t){this.removeListener("error",iv),this.destroy(),this.listenerCount("error")===0&&this.emit("error",t)}function sN(t,e){let r=!0,n=new nN({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return t.on("message",function(s,i){let a=!i&&n._readableState.objectMode?s.toString():s;n.push(a)||t.pause()}),t.once("error",function(s){n.destroyed||(r=!1,n.destroy(s))}),t.once("close",function(){n.destroyed||n.push(null)}),n._destroy=function(o,s){if(t.readyState===t.CLOSED){s(o),process.nextTick(sv,n);return}let i=!1;t.once("error",function(c){i=!0,s(c)}),t.once("close",function(){i||s(o),process.nextTick(sv,n)}),r&&t.terminate()},n._final=function(o){if(t.readyState===t.CONNECTING){t.once("open",function(){n._final(o)});return}t._socket!==null&&(t._socket._writableState.finished?(o(),n._readableState.endEmitted&&n.destroy()):(t._socket.once("finish",function(){o()}),t.close()))},n._read=function(){t.isPaused&&t.resume()},n._write=function(o,s,i){if(t.readyState===t.CONNECTING){t.once("open",function(){n._write(o,s,i)});return}t.send(o,i)},n.on("end",oN),n.on("error",iv),n}av.exports=sN});var uv=k((WD,lv)=>{"use strict";var{tokenChars:iN}=Zn();function aN(t){let e=new Set,r=-1,n=-1,o=0;for(o;o<t.length;o++){let i=t.charCodeAt(o);if(n===-1&&iN[i]===1)r===-1&&(r=o);else if(o!==0&&(i===32||i===9))n===-1&&r!==-1&&(n=o);else if(i===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${o}`);n===-1&&(n=o);let a=t.slice(r,n);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),r=n=-1}else throw new SyntaxError(`Unexpected character at index ${o}`)}if(r===-1||n!==-1)throw new SyntaxError("Unexpected end of input");let s=t.slice(r,o);if(e.has(s))throw new SyntaxError(`The "${s}" subprotocol is duplicated`);return e.add(s),e}lv.exports={parse:aN}});var yv=k((KD,gv)=>{"use strict";var cN=require("events"),aa=require("http"),{Duplex:JD}=require("stream"),{createHash:lN}=require("crypto"),dv=uf(),nn=Xo(),uN=uv(),dN=ia(),{CLOSE_TIMEOUT:fN,GUID:pN,kWebSocket:mN}=Ht(),hN=/^[+/0-9A-Za-z]{22}==$/,fv=0,pv=1,hv=2,hf=class extends cN{constructor(e,r){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:fN,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:dN,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=aa.createServer((n,o)=>{let s=aa.STATUS_CODES[426];o.writeHead(426,{"Content-Length":s.length,"Content-Type":"text/plain"}),o.end(s)}),this._server.listen(e.port,e.host,e.backlog,r)):e.server&&(this._server=e.server),this._server){let n=this.emit.bind(this,"connection");this._removeListeners=gN(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(o,s,i)=>{this.handleUpgrade(o,s,i,n)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=fv}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===hv){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(ts,this);return}if(e&&this.once("close",e),this._state!==pv)if(this._state=pv,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(ts,this):process.nextTick(ts,this);else{let r=this._server;this._removeListeners(),this._removeListeners=this._server=null,r.close(()=>{ts(this)})}}shouldHandle(e){if(this.options.path){let r=e.url.indexOf("?");if((r!==-1?e.url.slice(0,r):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,r,n,o){r.on("error",mv);let s=e.headers["sec-websocket-key"],i=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){on(this,e,r,405,"Invalid HTTP method");return}if(i===void 0||i.toLowerCase()!=="websocket"){on(this,e,r,400,"Invalid Upgrade header");return}if(s===void 0||!hN.test(s)){on(this,e,r,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==13&&a!==8){on(this,e,r,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(e)){rs(r,400);return}let c=e.headers["sec-websocket-protocol"],l=new Set;if(c!==void 0)try{l=uN.parse(c)}catch{on(this,e,r,400,"Invalid Sec-WebSocket-Protocol header");return}let u=e.headers["sec-websocket-extensions"],d={};if(this.options.perMessageDeflate&&u!==void 0){let g=new nn(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let h=dv.parse(u);h[nn.extensionName]&&(g.accept(h[nn.extensionName]),d[nn.extensionName]=g)}catch{on(this,e,r,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let g={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(g,(h,f,m,y)=>{if(!h)return rs(r,f||401,m,y);this.completeUpgrade(d,s,l,e,r,n,o)});return}if(!this.options.verifyClient(g))return rs(r,401)}this.completeUpgrade(d,s,l,e,r,n,o)}completeUpgrade(e,r,n,o,s,i,a){if(!s.readable||!s.writable)return s.destroy();if(s[mN])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>fv)return rs(s,503);let l=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${lN("sha1").update(r+pN).digest("base64")}`],u=new this.options.WebSocket(null,void 0,this.options);if(n.size){let d=this.options.handleProtocols?this.options.handleProtocols(n,o):n.values().next().value;d&&(l.push(`Sec-WebSocket-Protocol: ${d}`),u._protocol=d)}if(e[nn.extensionName]){let d=e[nn.extensionName].params,g=dv.format({[nn.extensionName]:[d]});l.push(`Sec-WebSocket-Extensions: ${g}`),u._extensions=e}this.emit("headers",l,o),s.write(l.concat(`\r
`).join(`\r
`)),s.removeListener("error",mv),u.setSocket(s,i,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(u),u.on("close",()=>{this.clients.delete(u),this._shouldEmitClose&&!this.clients.size&&process.nextTick(ts,this)})),a(u,o)}};gv.exports=hf;function gN(t,e){for(let r of Object.keys(e))t.on(r,e[r]);return function(){for(let n of Object.keys(e))t.removeListener(n,e[n])}}function ts(t){t._state=hv,t.emit("close")}function mv(){this.destroy()}function rs(t,e,r,n){r=r||aa.STATUS_CODES[e],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...n},t.once("finish",t.destroy),t.end(`HTTP/1.1 ${e} ${aa.STATUS_CODES[e]}\r
`+Object.keys(n).map(o=>`${o}: ${n[o]}`).join(`\r
`)+`\r
\r
`+r)}function on(t,e,r,n,o,s){if(t.listenerCount("wsClientError")){let i=new Error(o);Error.captureStackTrace(i,on),t.emit("wsClientError",i,r,e)}else rs(r,n,o,s)}});var p={};ha(p,{BRAND:()=>Eb,DIRTY:()=>xr,EMPTY_PATH:()=>sb,INVALID:()=>j,NEVER:()=>ux,OK:()=>Re,ParseStatus:()=>Se,Schema:()=>V,ZodAny:()=>er,ZodArray:()=>Lt,ZodBigInt:()=>Sr,ZodBoolean:()=>$r,ZodBranded:()=>Hn,ZodCatch:()=>Ar,ZodDate:()=>kr,ZodDefault:()=>Cr,ZodDiscriminatedUnion:()=>as,ZodEffects:()=>rt,ZodEnum:()=>Or,ZodError:()=>qe,ZodFirstPartyTypeKind:()=>$,ZodFunction:()=>ls,ZodIntersection:()=>zr,ZodIssueCode:()=>S,ZodLazy:()=>Pr,ZodLiteral:()=>Nr,ZodMap:()=>dn,ZodNaN:()=>pn,ZodNativeEnum:()=>Rr,ZodNever:()=>pt,ZodNull:()=>Er,ZodNullable:()=>kt,ZodNumber:()=>wr,ZodObject:()=>Be,ZodOptional:()=>Ve,ZodParsedType:()=>z,ZodPipeline:()=>Gn,ZodPromise:()=>tr,ZodReadonly:()=>Mr,ZodRecord:()=>cs,ZodSchema:()=>V,ZodSet:()=>fn,ZodString:()=>Qt,ZodSymbol:()=>ln,ZodTransformer:()=>rt,ZodTuple:()=>$t,ZodType:()=>V,ZodUndefined:()=>Tr,ZodUnion:()=>Ir,ZodUnknown:()=>jt,ZodVoid:()=>un,addIssueToContext:()=>E,any:()=>Mb,array:()=>Zb,bigint:()=>Nb,boolean:()=>Cf,coerce:()=>lx,custom:()=>Nf,date:()=>Ob,datetimeRegex:()=>zf,defaultErrorMap:()=>Mt,discriminatedUnion:()=>qb,effect:()=>tx,enum:()=>Yb,function:()=>Jb,getErrorMap:()=>sn,getParsedType:()=>St,instanceof:()=>zb,intersection:()=>Vb,isAborted:()=>ss,isAsync:()=>an,isDirty:()=>is,isValid:()=>Yt,late:()=>Ib,lazy:()=>Kb,literal:()=>Xb,makeIssue:()=>Bn,map:()=>Gb,nan:()=>Pb,nativeEnum:()=>Qb,never:()=>jb,null:()=>Ab,nullable:()=>nx,number:()=>Rf,object:()=>va,objectUtil:()=>ga,oboolean:()=>cx,onumber:()=>ax,optional:()=>rx,ostring:()=>ix,pipeline:()=>sx,preprocess:()=>ox,promise:()=>ex,quotelessJson:()=>rb,record:()=>Hb,set:()=>Wb,setErrorMap:()=>ob,strictObject:()=>Fb,string:()=>Of,symbol:()=>Rb,transformer:()=>tx,tuple:()=>Bb,undefined:()=>Cb,union:()=>Ub,unknown:()=>Db,util:()=>W,void:()=>Lb});var W;(function(t){t.assertEqual=o=>{};function e(o){}t.assertIs=e;function r(o){throw new Error}t.assertNever=r,t.arrayToEnum=o=>{let s={};for(let i of o)s[i]=i;return s},t.getValidEnumValues=o=>{let s=t.objectKeys(o).filter(a=>typeof o[o[a]]!="number"),i={};for(let a of s)i[a]=o[a];return t.objectValues(i)},t.objectValues=o=>t.objectKeys(o).map(function(s){return o[s]}),t.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{let s=[];for(let i in o)Object.prototype.hasOwnProperty.call(o,i)&&s.push(i);return s},t.find=(o,s)=>{for(let i of o)if(s(i))return i},t.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&Number.isFinite(o)&&Math.floor(o)===o;function n(o,s=" | "){return o.map(i=>typeof i=="string"?`'${i}'`:i).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(o,s)=>typeof s=="bigint"?s.toString():s})(W||(W={}));var ga;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(ga||(ga={}));var z=W.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),St=t=>{switch(typeof t){case"undefined":return z.undefined;case"string":return z.string;case"number":return Number.isNaN(t)?z.nan:z.number;case"boolean":return z.boolean;case"function":return z.function;case"bigint":return z.bigint;case"symbol":return z.symbol;case"object":return Array.isArray(t)?z.array:t===null?z.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?z.promise:typeof Map<"u"&&t instanceof Map?z.map:typeof Set<"u"&&t instanceof Set?z.set:typeof Date<"u"&&t instanceof Date?z.date:z.object;default:return z.unknown}};var S=W.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),rb=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),qe=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},o=s=>{for(let i of s.issues)if(i.code==="invalid_union")i.unionErrors.map(o);else if(i.code==="invalid_return_type")o(i.returnTypeError);else if(i.code==="invalid_arguments")o(i.argumentsError);else if(i.path.length===0)n._errors.push(r(i));else{let a=n,c=0;for(;c<i.path.length;){let l=i.path[c];c===i.path.length-1?(a[l]=a[l]||{_errors:[]},a[l]._errors.push(r(i))):a[l]=a[l]||{_errors:[]},a=a[l],c++}}};return o(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,W.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let o of this.issues)if(o.path.length>0){let s=o.path[0];r[s]=r[s]||[],r[s].push(e(o))}else n.push(e(o));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};qe.create=t=>new qe(t);var nb=(t,e)=>{let r;switch(t.code){case S.invalid_type:t.received===z.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case S.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,W.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:r=`Unrecognized key(s) in object: ${W.joinValues(t.keys,", ")}`;break;case S.invalid_union:r="Invalid input";break;case S.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${W.joinValues(t.options)}`;break;case S.invalid_enum_value:r=`Invalid enum value. Expected ${W.joinValues(t.options)}, received '${t.received}'`;break;case S.invalid_arguments:r="Invalid function arguments";break;case S.invalid_return_type:r="Invalid function return type";break;case S.invalid_date:r="Invalid date";break;case S.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:W.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case S.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case S.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case S.custom:r="Invalid input";break;case S.invalid_intersection_types:r="Intersection results could not be merged";break;case S.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case S.not_finite:r="Number must be finite";break;default:r=e.defaultError,W.assertNever(t)}return{message:r}},Mt=nb;var $f=Mt;function ob(t){$f=t}function sn(){return $f}var Bn=t=>{let{data:e,path:r,errorMaps:n,issueData:o}=t,s=[...r,...o.path||[]],i={...o,path:s};if(o.message!==void 0)return{...o,path:s,message:o.message};let a="",c=n.filter(l=>!!l).slice().reverse();for(let l of c)a=l(i,{data:e,defaultError:a}).message;return{...o,path:s,message:a}},sb=[];function E(t,e){let r=sn(),n=Bn({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Mt?void 0:Mt].filter(o=>!!o)});t.common.issues.push(n)}var Se=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let o of r){if(o.status==="aborted")return j;o.status==="dirty"&&e.dirty(),n.push(o.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let o of r){let s=await o.key,i=await o.value;n.push({key:s,value:i})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let o of r){let{key:s,value:i}=o;if(s.status==="aborted"||i.status==="aborted")return j;s.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof i.value<"u"||o.alwaysSet)&&(n[s.value]=i.value)}return{status:e.value,value:n}}},j=Object.freeze({status:"aborted"}),xr=t=>({status:"dirty",value:t}),Re=t=>({status:"valid",value:t}),ss=t=>t.status==="aborted",is=t=>t.status==="dirty",Yt=t=>t.status==="valid",an=t=>typeof Promise<"u"&&t instanceof Promise;var N;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(N||(N={}));var tt=class{constructor(e,r,n,o){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},kf=(t,e)=>{if(Yt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new qe(t.common.issues);return this._error=r,this._error}}};function U(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:o}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:o}:{errorMap:(i,a)=>{let{message:c}=t;return i.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??n??a.defaultError}:i.code!=="invalid_type"?{message:a.defaultError}:{message:c??r??a.defaultError}},description:o}}var V=class{get description(){return this._def.description}_getType(e){return St(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:St(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Se,ctx:{common:e.parent.common,data:e.data,parsedType:St(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(an(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){let n={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:St(e)},o=this._parseSync({data:e,path:n.path,parent:n});return kf(n,o)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:St(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:r});return Yt(n)?{value:n.value}:{issues:r.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(n=>Yt(n)?{value:n.value}:{issues:r.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:St(e)},o=this._parse({data:e,path:n.path,parent:n}),s=await(an(o)?o:Promise.resolve(o));return kf(n,s)}refine(e,r){let n=o=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(o):r;return this._refinement((o,s)=>{let i=e(o),a=()=>s.addIssue({code:S.custom,...n(o)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(a(),!1)):i?!0:(a(),!1)})}refinement(e,r){return this._refinement((n,o)=>e(n)?!0:(o.addIssue(typeof r=="function"?r(n,o):r),!1))}_refinement(e){return new rt({schema:this,typeName:$.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Ve.create(this,this._def)}nullable(){return kt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Lt.create(this)}promise(){return tr.create(this,this._def)}or(e){return Ir.create([this,e],this._def)}and(e){return zr.create(this,e,this._def)}transform(e){return new rt({...U(this._def),schema:this,typeName:$.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Cr({...U(this._def),innerType:this,defaultValue:r,typeName:$.ZodDefault})}brand(){return new Hn({typeName:$.ZodBranded,type:this,...U(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Ar({...U(this._def),innerType:this,catchValue:r,typeName:$.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Gn.create(this,e)}readonly(){return Mr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},ib=/^c[^\s-]{8,}$/i,ab=/^[0-9a-z]+$/,cb=/^[0-9A-HJKMNP-TV-Z]{26}$/i,lb=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ub=/^[a-z0-9_-]{21}$/i,db=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,fb=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,pb=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,mb="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",ya,hb=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,gb=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,yb=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,_b=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,vb=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,bb=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Ef="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",xb=new RegExp(`^${Ef}$`);function If(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function wb(t){return new RegExp(`^${If(t)}$`)}function zf(t){let e=`${Ef}T${If(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function Sb(t,e){return!!((e==="v4"||!e)&&hb.test(t)||(e==="v6"||!e)&&yb.test(t))}function $b(t,e){if(!db.test(t))return!1;try{let[r]=t.split(".");if(!r)return!1;let n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),o=JSON.parse(atob(n));return!(typeof o!="object"||o===null||"typ"in o&&o?.typ!=="JWT"||!o.alg||e&&o.alg!==e)}catch{return!1}}function kb(t,e){return!!((e==="v4"||!e)&&gb.test(t)||(e==="v6"||!e)&&_b.test(t))}var Qt=class t extends V{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==z.string){let s=this._getOrReturnCtx(e);return E(s,{code:S.invalid_type,expected:z.string,received:s.parsedType}),j}let n=new Se,o;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(o=this._getOrReturnCtx(e,o),E(o,{code:S.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(o=this._getOrReturnCtx(e,o),E(o,{code:S.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let i=e.data.length>s.value,a=e.data.length<s.value;(i||a)&&(o=this._getOrReturnCtx(e,o),i?E(o,{code:S.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&E(o,{code:S.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")pb.test(e.data)||(o=this._getOrReturnCtx(e,o),E(o,{validation:"email",code:S.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")ya||(ya=new RegExp(mb,"u")),ya.test(e.data)||(o=this._getOrReturnCtx(e,o),E(o,{validation:"emoji",code:S.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")lb.test(e.data)||(o=this._getOrReturnCtx(e,o),E(o,{validation:"uuid",code:S.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")ub.test(e.data)||(o=this._getOrReturnCtx(e,o),E(o,{validation:"nanoid",code:S.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")ib.test(e.data)||(o=this._getOrReturnCtx(e,o),E(o,{validation:"cuid",code:S.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")ab.test(e.data)||(o=this._getOrReturnCtx(e,o),E(o,{validation:"cuid2",code:S.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")cb.test(e.data)||(o=this._getOrReturnCtx(e,o),E(o,{validation:"ulid",code:S.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{o=this._getOrReturnCtx(e,o),E(o,{validation:"url",code:S.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(o=this._getOrReturnCtx(e,o),E(o,{validation:"regex",code:S.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(o=this._getOrReturnCtx(e,o),E(o,{code:S.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(o=this._getOrReturnCtx(e,o),E(o,{code:S.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(o=this._getOrReturnCtx(e,o),E(o,{code:S.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?zf(s).test(e.data)||(o=this._getOrReturnCtx(e,o),E(o,{code:S.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?xb.test(e.data)||(o=this._getOrReturnCtx(e,o),E(o,{code:S.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?wb(s).test(e.data)||(o=this._getOrReturnCtx(e,o),E(o,{code:S.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?fb.test(e.data)||(o=this._getOrReturnCtx(e,o),E(o,{validation:"duration",code:S.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?Sb(e.data,s.version)||(o=this._getOrReturnCtx(e,o),E(o,{validation:"ip",code:S.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?$b(e.data,s.alg)||(o=this._getOrReturnCtx(e,o),E(o,{validation:"jwt",code:S.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?kb(e.data,s.version)||(o=this._getOrReturnCtx(e,o),E(o,{validation:"cidr",code:S.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?vb.test(e.data)||(o=this._getOrReturnCtx(e,o),E(o,{validation:"base64",code:S.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?bb.test(e.data)||(o=this._getOrReturnCtx(e,o),E(o,{validation:"base64url",code:S.invalid_string,message:s.message}),n.dirty()):W.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(o=>e.test(o),{validation:r,code:S.invalid_string,...N.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...N.errToObj(e)})}url(e){return this._addCheck({kind:"url",...N.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...N.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...N.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...N.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...N.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...N.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...N.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...N.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...N.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...N.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...N.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...N.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...N.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...N.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...N.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...N.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...N.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...N.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...N.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...N.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...N.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...N.errToObj(r)})}nonempty(e){return this.min(1,N.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Qt.create=t=>new Qt({checks:[],typeName:$.ZodString,coerce:t?.coerce??!1,...U(t)});function Tb(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,o=r>n?r:n,s=Number.parseInt(t.toFixed(o).replace(".","")),i=Number.parseInt(e.toFixed(o).replace(".",""));return s%i/10**o}var wr=class t extends V{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==z.number){let s=this._getOrReturnCtx(e);return E(s,{code:S.invalid_type,expected:z.number,received:s.parsedType}),j}let n,o=new Se;for(let s of this._def.checks)s.kind==="int"?W.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:S.invalid_type,expected:"integer",received:"float",message:s.message}),o.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:S.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:S.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="multipleOf"?Tb(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),E(n,{code:S.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:S.not_finite,message:s.message}),o.dirty()):W.assertNever(s);return{status:o.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:N.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:N.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:N.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:N.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&W.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};wr.create=t=>new wr({checks:[],typeName:$.ZodNumber,coerce:t?.coerce||!1,...U(t)});var Sr=class t extends V{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==z.bigint)return this._getInvalidInput(e);let n,o=new Se;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:S.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:S.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),E(n,{code:S.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):W.assertNever(s);return{status:o.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return E(r,{code:S.invalid_type,expected:z.bigint,received:r.parsedType}),j}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Sr.create=t=>new Sr({checks:[],typeName:$.ZodBigInt,coerce:t?.coerce??!1,...U(t)});var $r=class extends V{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==z.boolean){let n=this._getOrReturnCtx(e);return E(n,{code:S.invalid_type,expected:z.boolean,received:n.parsedType}),j}return Re(e.data)}};$r.create=t=>new $r({typeName:$.ZodBoolean,coerce:t?.coerce||!1,...U(t)});var kr=class t extends V{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==z.date){let s=this._getOrReturnCtx(e);return E(s,{code:S.invalid_type,expected:z.date,received:s.parsedType}),j}if(Number.isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return E(s,{code:S.invalid_date}),j}let n=new Se,o;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(o=this._getOrReturnCtx(e,o),E(o,{code:S.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(o=this._getOrReturnCtx(e,o),E(o,{code:S.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):W.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:N.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:N.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};kr.create=t=>new kr({checks:[],coerce:t?.coerce||!1,typeName:$.ZodDate,...U(t)});var ln=class extends V{_parse(e){if(this._getType(e)!==z.symbol){let n=this._getOrReturnCtx(e);return E(n,{code:S.invalid_type,expected:z.symbol,received:n.parsedType}),j}return Re(e.data)}};ln.create=t=>new ln({typeName:$.ZodSymbol,...U(t)});var Tr=class extends V{_parse(e){if(this._getType(e)!==z.undefined){let n=this._getOrReturnCtx(e);return E(n,{code:S.invalid_type,expected:z.undefined,received:n.parsedType}),j}return Re(e.data)}};Tr.create=t=>new Tr({typeName:$.ZodUndefined,...U(t)});var Er=class extends V{_parse(e){if(this._getType(e)!==z.null){let n=this._getOrReturnCtx(e);return E(n,{code:S.invalid_type,expected:z.null,received:n.parsedType}),j}return Re(e.data)}};Er.create=t=>new Er({typeName:$.ZodNull,...U(t)});var er=class extends V{constructor(){super(...arguments),this._any=!0}_parse(e){return Re(e.data)}};er.create=t=>new er({typeName:$.ZodAny,...U(t)});var jt=class extends V{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Re(e.data)}};jt.create=t=>new jt({typeName:$.ZodUnknown,...U(t)});var pt=class extends V{_parse(e){let r=this._getOrReturnCtx(e);return E(r,{code:S.invalid_type,expected:z.never,received:r.parsedType}),j}};pt.create=t=>new pt({typeName:$.ZodNever,...U(t)});var un=class extends V{_parse(e){if(this._getType(e)!==z.undefined){let n=this._getOrReturnCtx(e);return E(n,{code:S.invalid_type,expected:z.void,received:n.parsedType}),j}return Re(e.data)}};un.create=t=>new un({typeName:$.ZodVoid,...U(t)});var Lt=class t extends V{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),o=this._def;if(r.parsedType!==z.array)return E(r,{code:S.invalid_type,expected:z.array,received:r.parsedType}),j;if(o.exactLength!==null){let i=r.data.length>o.exactLength.value,a=r.data.length<o.exactLength.value;(i||a)&&(E(r,{code:i?S.too_big:S.too_small,minimum:a?o.exactLength.value:void 0,maximum:i?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),n.dirty())}if(o.minLength!==null&&r.data.length<o.minLength.value&&(E(r,{code:S.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),n.dirty()),o.maxLength!==null&&r.data.length>o.maxLength.value&&(E(r,{code:S.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((i,a)=>o.type._parseAsync(new tt(r,i,r.path,a)))).then(i=>Se.mergeArray(n,i));let s=[...r.data].map((i,a)=>o.type._parseSync(new tt(r,i,r.path,a)));return Se.mergeArray(n,s)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:N.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:N.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:N.toString(r)}})}nonempty(e){return this.min(1,e)}};Lt.create=(t,e)=>new Lt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:$.ZodArray,...U(e)});function cn(t){if(t instanceof Be){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=Ve.create(cn(n))}return new Be({...t._def,shape:()=>e})}else return t instanceof Lt?new Lt({...t._def,type:cn(t.element)}):t instanceof Ve?Ve.create(cn(t.unwrap())):t instanceof kt?kt.create(cn(t.unwrap())):t instanceof $t?$t.create(t.items.map(e=>cn(e))):t}var Be=class t extends V{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=W.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==z.object){let l=this._getOrReturnCtx(e);return E(l,{code:S.invalid_type,expected:z.object,received:l.parsedType}),j}let{status:n,ctx:o}=this._processInputParams(e),{shape:s,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof pt&&this._def.unknownKeys==="strip"))for(let l in o.data)i.includes(l)||a.push(l);let c=[];for(let l of i){let u=s[l],d=o.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new tt(o,d,o.path,l)),alwaysSet:l in o.data})}if(this._def.catchall instanceof pt){let l=this._def.unknownKeys;if(l==="passthrough")for(let u of a)c.push({key:{status:"valid",value:u},value:{status:"valid",value:o.data[u]}});else if(l==="strict")a.length>0&&(E(o,{code:S.unrecognized_keys,keys:a}),n.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let u of a){let d=o.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new tt(o,d,o.path,u)),alwaysSet:u in o.data})}}return o.common.async?Promise.resolve().then(async()=>{let l=[];for(let u of c){let d=await u.key,g=await u.value;l.push({key:d,value:g,alwaysSet:u.alwaysSet})}return l}).then(l=>Se.mergeObjectSync(n,l)):Se.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return N.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{let o=this._def.errorMap?.(r,n).message??n.defaultError;return r.code==="unrecognized_keys"?{message:N.errToObj(e).message??o}:{message:o}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:$.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};for(let n of W.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}omit(e){let r={};for(let n of W.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}deepPartial(){return cn(this)}partial(e){let r={};for(let n of W.objectKeys(this.shape)){let o=this.shape[n];e&&!e[n]?r[n]=o:r[n]=o.optional()}return new t({...this._def,shape:()=>r})}required(e){let r={};for(let n of W.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof Ve;)s=s._def.innerType;r[n]=s}return new t({...this._def,shape:()=>r})}keyof(){return Pf(W.objectKeys(this.shape))}};Be.create=(t,e)=>new Be({shape:()=>t,unknownKeys:"strip",catchall:pt.create(),typeName:$.ZodObject,...U(e)});Be.strictCreate=(t,e)=>new Be({shape:()=>t,unknownKeys:"strict",catchall:pt.create(),typeName:$.ZodObject,...U(e)});Be.lazycreate=(t,e)=>new Be({shape:t,unknownKeys:"strip",catchall:pt.create(),typeName:$.ZodObject,...U(e)});var Ir=class extends V{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function o(s){for(let a of s)if(a.result.status==="valid")return a.result;for(let a of s)if(a.result.status==="dirty")return r.common.issues.push(...a.ctx.common.issues),a.result;let i=s.map(a=>new qe(a.ctx.common.issues));return E(r,{code:S.invalid_union,unionErrors:i}),j}if(r.common.async)return Promise.all(n.map(async s=>{let i={...r,common:{...r.common,issues:[]},parent:null};return{result:await s._parseAsync({data:r.data,path:r.path,parent:i}),ctx:i}})).then(o);{let s,i=[];for(let c of n){let l={...r,common:{...r.common,issues:[]},parent:null},u=c._parseSync({data:r.data,path:r.path,parent:l});if(u.status==="valid")return u;u.status==="dirty"&&!s&&(s={result:u,ctx:l}),l.common.issues.length&&i.push(l.common.issues)}if(s)return r.common.issues.push(...s.ctx.common.issues),s.result;let a=i.map(c=>new qe(c));return E(r,{code:S.invalid_union,unionErrors:a}),j}}get options(){return this._def.options}};Ir.create=(t,e)=>new Ir({options:t,typeName:$.ZodUnion,...U(e)});var Dt=t=>t instanceof Pr?Dt(t.schema):t instanceof rt?Dt(t.innerType()):t instanceof Nr?[t.value]:t instanceof Or?t.options:t instanceof Rr?W.objectValues(t.enum):t instanceof Cr?Dt(t._def.innerType):t instanceof Tr?[void 0]:t instanceof Er?[null]:t instanceof Ve?[void 0,...Dt(t.unwrap())]:t instanceof kt?[null,...Dt(t.unwrap())]:t instanceof Hn||t instanceof Mr?Dt(t.unwrap()):t instanceof Ar?Dt(t._def.innerType):[],as=class t extends V{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==z.object)return E(r,{code:S.invalid_type,expected:z.object,received:r.parsedType}),j;let n=this.discriminator,o=r.data[n],s=this.optionsMap.get(o);return s?r.common.async?s._parseAsync({data:r.data,path:r.path,parent:r}):s._parseSync({data:r.data,path:r.path,parent:r}):(E(r,{code:S.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),j)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let o=new Map;for(let s of r){let i=Dt(s.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of i){if(o.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);o.set(a,s)}}return new t({typeName:$.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:o,...U(n)})}};function _a(t,e){let r=St(t),n=St(e);if(t===e)return{valid:!0,data:t};if(r===z.object&&n===z.object){let o=W.objectKeys(e),s=W.objectKeys(t).filter(a=>o.indexOf(a)!==-1),i={...t,...e};for(let a of s){let c=_a(t[a],e[a]);if(!c.valid)return{valid:!1};i[a]=c.data}return{valid:!0,data:i}}else if(r===z.array&&n===z.array){if(t.length!==e.length)return{valid:!1};let o=[];for(let s=0;s<t.length;s++){let i=t[s],a=e[s],c=_a(i,a);if(!c.valid)return{valid:!1};o.push(c.data)}return{valid:!0,data:o}}else return r===z.date&&n===z.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var zr=class extends V{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=(s,i)=>{if(ss(s)||ss(i))return j;let a=_a(s.value,i.value);return a.valid?((is(s)||is(i))&&r.dirty(),{status:r.value,value:a.data}):(E(n,{code:S.invalid_intersection_types}),j)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,i])=>o(s,i)):o(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};zr.create=(t,e,r)=>new zr({left:t,right:e,typeName:$.ZodIntersection,...U(r)});var $t=class t extends V{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==z.array)return E(n,{code:S.invalid_type,expected:z.array,received:n.parsedType}),j;if(n.data.length<this._def.items.length)return E(n,{code:S.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),j;!this._def.rest&&n.data.length>this._def.items.length&&(E(n,{code:S.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let s=[...n.data].map((i,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new tt(n,i,n.path,a)):null}).filter(i=>!!i);return n.common.async?Promise.all(s).then(i=>Se.mergeArray(r,i)):Se.mergeArray(r,s)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};$t.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new $t({items:t,typeName:$.ZodTuple,rest:null,...U(e)})};var cs=class t extends V{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==z.object)return E(n,{code:S.invalid_type,expected:z.object,received:n.parsedType}),j;let o=[],s=this._def.keyType,i=this._def.valueType;for(let a in n.data)o.push({key:s._parse(new tt(n,a,n.path,a)),value:i._parse(new tt(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?Se.mergeObjectAsync(r,o):Se.mergeObjectSync(r,o)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof V?new t({keyType:e,valueType:r,typeName:$.ZodRecord,...U(n)}):new t({keyType:Qt.create(),valueType:e,typeName:$.ZodRecord,...U(r)})}},dn=class extends V{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==z.map)return E(n,{code:S.invalid_type,expected:z.map,received:n.parsedType}),j;let o=this._def.keyType,s=this._def.valueType,i=[...n.data.entries()].map(([a,c],l)=>({key:o._parse(new tt(n,a,n.path,[l,"key"])),value:s._parse(new tt(n,c,n.path,[l,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of i){let l=await c.key,u=await c.value;if(l.status==="aborted"||u.status==="aborted")return j;(l.status==="dirty"||u.status==="dirty")&&r.dirty(),a.set(l.value,u.value)}return{status:r.value,value:a}})}else{let a=new Map;for(let c of i){let l=c.key,u=c.value;if(l.status==="aborted"||u.status==="aborted")return j;(l.status==="dirty"||u.status==="dirty")&&r.dirty(),a.set(l.value,u.value)}return{status:r.value,value:a}}}};dn.create=(t,e,r)=>new dn({valueType:e,keyType:t,typeName:$.ZodMap,...U(r)});var fn=class t extends V{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==z.set)return E(n,{code:S.invalid_type,expected:z.set,received:n.parsedType}),j;let o=this._def;o.minSize!==null&&n.data.size<o.minSize.value&&(E(n,{code:S.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),r.dirty()),o.maxSize!==null&&n.data.size>o.maxSize.value&&(E(n,{code:S.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),r.dirty());let s=this._def.valueType;function i(c){let l=new Set;for(let u of c){if(u.status==="aborted")return j;u.status==="dirty"&&r.dirty(),l.add(u.value)}return{status:r.value,value:l}}let a=[...n.data.values()].map((c,l)=>s._parse(new tt(n,c,n.path,l)));return n.common.async?Promise.all(a).then(c=>i(c)):i(a)}min(e,r){return new t({...this._def,minSize:{value:e,message:N.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:N.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};fn.create=(t,e)=>new fn({valueType:t,minSize:null,maxSize:null,typeName:$.ZodSet,...U(e)});var ls=class t extends V{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==z.function)return E(r,{code:S.invalid_type,expected:z.function,received:r.parsedType}),j;function n(a,c){return Bn({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,sn(),Mt].filter(l=>!!l),issueData:{code:S.invalid_arguments,argumentsError:c}})}function o(a,c){return Bn({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,sn(),Mt].filter(l=>!!l),issueData:{code:S.invalid_return_type,returnTypeError:c}})}let s={errorMap:r.common.contextualErrorMap},i=r.data;if(this._def.returns instanceof tr){let a=this;return Re(async function(...c){let l=new qe([]),u=await a._def.args.parseAsync(c,s).catch(h=>{throw l.addIssue(n(c,h)),l}),d=await Reflect.apply(i,this,u);return await a._def.returns._def.type.parseAsync(d,s).catch(h=>{throw l.addIssue(o(d,h)),l})})}else{let a=this;return Re(function(...c){let l=a._def.args.safeParse(c,s);if(!l.success)throw new qe([n(c,l.error)]);let u=Reflect.apply(i,this,l.data),d=a._def.returns.safeParse(u,s);if(!d.success)throw new qe([o(u,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:$t.create(e).rest(jt.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||$t.create([]).rest(jt.create()),returns:r||jt.create(),typeName:$.ZodFunction,...U(n)})}},Pr=class extends V{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};Pr.create=(t,e)=>new Pr({getter:t,typeName:$.ZodLazy,...U(e)});var Nr=class extends V{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return E(r,{received:r.data,code:S.invalid_literal,expected:this._def.value}),j}return{status:"valid",value:e.data}}get value(){return this._def.value}};Nr.create=(t,e)=>new Nr({value:t,typeName:$.ZodLiteral,...U(e)});function Pf(t,e){return new Or({values:t,typeName:$.ZodEnum,...U(e)})}var Or=class t extends V{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return E(r,{expected:W.joinValues(n),received:r.parsedType,code:S.invalid_type}),j}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return E(r,{received:r.data,code:S.invalid_enum_value,options:n}),j}return Re(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};Or.create=Pf;var Rr=class extends V{_parse(e){let r=W.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==z.string&&n.parsedType!==z.number){let o=W.objectValues(r);return E(n,{expected:W.joinValues(o),received:n.parsedType,code:S.invalid_type}),j}if(this._cache||(this._cache=new Set(W.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let o=W.objectValues(r);return E(n,{received:n.data,code:S.invalid_enum_value,options:o}),j}return Re(e.data)}get enum(){return this._def.values}};Rr.create=(t,e)=>new Rr({values:t,typeName:$.ZodNativeEnum,...U(e)});var tr=class extends V{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==z.promise&&r.common.async===!1)return E(r,{code:S.invalid_type,expected:z.promise,received:r.parsedType}),j;let n=r.parsedType===z.promise?r.data:Promise.resolve(r.data);return Re(n.then(o=>this._def.type.parseAsync(o,{path:r.path,errorMap:r.common.contextualErrorMap})))}};tr.create=(t,e)=>new tr({type:t,typeName:$.ZodPromise,...U(e)});var rt=class extends V{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===$.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=this._def.effect||null,s={addIssue:i=>{E(n,i),i.fatal?r.abort():r.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),o.type==="preprocess"){let i=o.transform(n.data,s);if(n.common.async)return Promise.resolve(i).then(async a=>{if(r.value==="aborted")return j;let c=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return c.status==="aborted"?j:c.status==="dirty"?xr(c.value):r.value==="dirty"?xr(c.value):c});{if(r.value==="aborted")return j;let a=this._def.schema._parseSync({data:i,path:n.path,parent:n});return a.status==="aborted"?j:a.status==="dirty"?xr(a.value):r.value==="dirty"?xr(a.value):a}}if(o.type==="refinement"){let i=a=>{let c=o.refinement(a,s);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?j:(a.status==="dirty"&&r.dirty(),i(a.value),{status:r.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?j:(a.status==="dirty"&&r.dirty(),i(a.value).then(()=>({status:r.value,value:a.value}))))}if(o.type==="transform")if(n.common.async===!1){let i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Yt(i))return j;let a=o.transform(i.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>Yt(i)?Promise.resolve(o.transform(i.value,s)).then(a=>({status:r.value,value:a})):j);W.assertNever(o)}};rt.create=(t,e,r)=>new rt({schema:t,typeName:$.ZodEffects,effect:e,...U(r)});rt.createWithPreprocess=(t,e,r)=>new rt({schema:e,effect:{type:"preprocess",transform:t},typeName:$.ZodEffects,...U(r)});var Ve=class extends V{_parse(e){return this._getType(e)===z.undefined?Re(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ve.create=(t,e)=>new Ve({innerType:t,typeName:$.ZodOptional,...U(e)});var kt=class extends V{_parse(e){return this._getType(e)===z.null?Re(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};kt.create=(t,e)=>new kt({innerType:t,typeName:$.ZodNullable,...U(e)});var Cr=class extends V{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===z.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Cr.create=(t,e)=>new Cr({innerType:t,typeName:$.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...U(e)});var Ar=class extends V{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},o=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return an(o)?o.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new qe(n.common.issues)},input:n.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new qe(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Ar.create=(t,e)=>new Ar({innerType:t,typeName:$.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...U(e)});var pn=class extends V{_parse(e){if(this._getType(e)!==z.nan){let n=this._getOrReturnCtx(e);return E(n,{code:S.invalid_type,expected:z.nan,received:n.parsedType}),j}return{status:"valid",value:e.data}}};pn.create=t=>new pn({typeName:$.ZodNaN,...U(t)});var Eb=Symbol("zod_brand"),Hn=class extends V{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},Gn=class t extends V{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?j:s.status==="dirty"?(r.dirty(),xr(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{let o=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?j:o.status==="dirty"?(r.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:$.ZodPipeline})}},Mr=class extends V{_parse(e){let r=this._def.innerType._parse(e),n=o=>(Yt(o)&&(o.value=Object.freeze(o.value)),o);return an(r)?r.then(o=>n(o)):n(r)}unwrap(){return this._def.innerType}};Mr.create=(t,e)=>new Mr({innerType:t,typeName:$.ZodReadonly,...U(e)});function Tf(t,e){let r=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function Nf(t,e={},r){return t?er.create().superRefine((n,o)=>{let s=t(n);if(s instanceof Promise)return s.then(i=>{if(!i){let a=Tf(e,n),c=a.fatal??r??!0;o.addIssue({code:"custom",...a,fatal:c})}});if(!s){let i=Tf(e,n),a=i.fatal??r??!0;o.addIssue({code:"custom",...i,fatal:a})}}):er.create()}var Ib={object:Be.lazycreate},$;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})($||($={}));var zb=(t,e={message:`Input not instance of ${t.name}`})=>Nf(r=>r instanceof t,e),Of=Qt.create,Rf=wr.create,Pb=pn.create,Nb=Sr.create,Cf=$r.create,Ob=kr.create,Rb=ln.create,Cb=Tr.create,Ab=Er.create,Mb=er.create,Db=jt.create,jb=pt.create,Lb=un.create,Zb=Lt.create,va=Be.create,Fb=Be.strictCreate,Ub=Ir.create,qb=as.create,Vb=zr.create,Bb=$t.create,Hb=cs.create,Gb=dn.create,Wb=fn.create,Jb=ls.create,Kb=Pr.create,Xb=Nr.create,Yb=Or.create,Qb=Rr.create,ex=tr.create,tx=rt.create,rx=Ve.create,nx=kt.create,ox=rt.createWithPreprocess,sx=Gn.create,ix=()=>Of().optional(),ax=()=>Rf().optional(),cx=()=>Cf().optional(),lx={string:t=>Qt.create({...t,coerce:!0}),number:t=>wr.create({...t,coerce:!0}),boolean:t=>$r.create({...t,coerce:!0}),bigint:t=>Sr.create({...t,coerce:!0}),date:t=>kr.create({...t,coerce:!0})};var ux=j;var dx=Object.freeze({status:"aborted"});function v(t,e,r){function n(a,c){var l;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(l=a._zod).traits??(l.traits=new Set),a._zod.traits.add(t),e(a,c);for(let u in i.prototype)u in a||Object.defineProperty(a,u,{value:i.prototype[u].bind(a)});a._zod.constr=i,a._zod.def=c}let o=r?.Parent??Object;class s extends o{}Object.defineProperty(s,"name",{value:t});function i(a){var c;let l=r?.Parent?new s:this;n(l,a),(c=l._zod).deferred??(c.deferred=[]);for(let u of l._zod.deferred)u();return l}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(t)}),Object.defineProperty(i,"name",{value:t}),i}var fx=Symbol("zod_brand"),Zt=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},us={};function Xe(t){return t&&Object.assign(us,t),us}var J={};ha(J,{BIGINT_FORMAT_RANGES:()=>Mf,Class:()=>xa,NUMBER_FORMAT_RANGES:()=>Ia,aborted:()=>jr,allowsEval:()=>ka,assert:()=>yx,assertEqual:()=>px,assertIs:()=>hx,assertNever:()=>gx,assertNotEqual:()=>mx,assignProp:()=>$a,cached:()=>Kn,captureStackTrace:()=>fs,cleanEnum:()=>Px,cleanRegex:()=>Yn,clone:()=>Ye,createTransparentProxy:()=>Sx,defineLazy:()=>ie,esc:()=>Dr,escapeRegex:()=>rr,extend:()=>Tx,finalizeIssue:()=>mt,floatSafeRemainder:()=>Sa,getElementAtPath:()=>_x,getEnumValues:()=>Jn,getLengthableOrigin:()=>Qn,getParsedType:()=>wx,getSizableOrigin:()=>Df,isObject:()=>mn,isPlainObject:()=>hn,issue:()=>za,joinValues:()=>ds,jsonStringifyReplacer:()=>wa,merge:()=>Ex,normalizeParams:()=>L,nullish:()=>Xn,numKeys:()=>xx,omit:()=>kx,optionalKeys:()=>Ea,partial:()=>Ix,pick:()=>$x,prefixIssues:()=>Tt,primitiveTypes:()=>Af,promiseAllObject:()=>vx,propertyKeyTypes:()=>Ta,randomString:()=>bx,required:()=>zx,stringifyPrimitive:()=>ps,unwrapMessage:()=>Wn});function px(t){return t}function mx(t){return t}function hx(t){}function gx(t){throw new Error}function yx(t){}function Jn(t){let e=Object.values(t).filter(n=>typeof n=="number");return Object.entries(t).filter(([n,o])=>e.indexOf(+n)===-1).map(([n,o])=>o)}function ds(t,e="|"){return t.map(r=>ps(r)).join(e)}function wa(t,e){return typeof e=="bigint"?e.toString():e}function Kn(t){return{get value(){{let r=t();return Object.defineProperty(this,"value",{value:r}),r}throw new Error("cached value already set")}}}function Xn(t){return t==null}function Yn(t){let e=t.startsWith("^")?1:0,r=t.endsWith("$")?t.length-1:t.length;return t.slice(e,r)}function Sa(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,o=r>n?r:n,s=Number.parseInt(t.toFixed(o).replace(".","")),i=Number.parseInt(e.toFixed(o).replace(".",""));return s%i/10**o}function ie(t,e,r){Object.defineProperty(t,e,{get(){{let o=r();return t[e]=o,o}throw new Error("cached value already set")},set(o){Object.defineProperty(t,e,{value:o})},configurable:!0})}function $a(t,e,r){Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}function _x(t,e){return e?e.reduce((r,n)=>r?.[n],t):t}function vx(t){let e=Object.keys(t),r=e.map(n=>t[n]);return Promise.all(r).then(n=>{let o={};for(let s=0;s<e.length;s++)o[e[s]]=n[s];return o})}function bx(t=10){let e="abcdefghijklmnopqrstuvwxyz",r="";for(let n=0;n<t;n++)r+=e[Math.floor(Math.random()*e.length)];return r}function Dr(t){return JSON.stringify(t)}var fs=Error.captureStackTrace?Error.captureStackTrace:(...t)=>{};function mn(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}var ka=Kn(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let t=Function;return new t(""),!0}catch{return!1}});function hn(t){if(mn(t)===!1)return!1;let e=t.constructor;if(e===void 0)return!0;let r=e.prototype;return!(mn(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function xx(t){let e=0;for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}var wx=t=>{let e=typeof t;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(t)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(t)?"array":t===null?"null":t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?"promise":typeof Map<"u"&&t instanceof Map?"map":typeof Set<"u"&&t instanceof Set?"set":typeof Date<"u"&&t instanceof Date?"date":typeof File<"u"&&t instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${e}`)}},Ta=new Set(["string","number","symbol"]),Af=new Set(["string","number","bigint","boolean","symbol","undefined"]);function rr(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ye(t,e,r){let n=new t._zod.constr(e??t._zod.def);return(!e||r?.parent)&&(n._zod.parent=t),n}function L(t){let e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function Sx(t){let e;return new Proxy({},{get(r,n,o){return e??(e=t()),Reflect.get(e,n,o)},set(r,n,o,s){return e??(e=t()),Reflect.set(e,n,o,s)},has(r,n){return e??(e=t()),Reflect.has(e,n)},deleteProperty(r,n){return e??(e=t()),Reflect.deleteProperty(e,n)},ownKeys(r){return e??(e=t()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(r,n){return e??(e=t()),Reflect.getOwnPropertyDescriptor(e,n)},defineProperty(r,n,o){return e??(e=t()),Reflect.defineProperty(e,n,o)}})}function ps(t){return typeof t=="bigint"?t.toString()+"n":typeof t=="string"?`"${t}"`:`${t}`}function Ea(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}var Ia={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},Mf={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function $x(t,e){let r={},n=t._zod.def;for(let o in e){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&(r[o]=n.shape[o])}return Ye(t,{...t._zod.def,shape:r,checks:[]})}function kx(t,e){let r={...t._zod.def.shape},n=t._zod.def;for(let o in e){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&delete r[o]}return Ye(t,{...t._zod.def,shape:r,checks:[]})}function Tx(t,e){if(!hn(e))throw new Error("Invalid input to extend: expected a plain object");let r={...t._zod.def,get shape(){let n={...t._zod.def.shape,...e};return $a(this,"shape",n),n},checks:[]};return Ye(t,r)}function Ex(t,e){return Ye(t,{...t._zod.def,get shape(){let r={...t._zod.def.shape,...e._zod.def.shape};return $a(this,"shape",r),r},catchall:e._zod.def.catchall,checks:[]})}function Ix(t,e,r){let n=e._zod.def.shape,o={...n};if(r)for(let s in r){if(!(s in n))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=t?new t({type:"optional",innerType:n[s]}):n[s])}else for(let s in n)o[s]=t?new t({type:"optional",innerType:n[s]}):n[s];return Ye(e,{...e._zod.def,shape:o,checks:[]})}function zx(t,e,r){let n=e._zod.def.shape,o={...n};if(r)for(let s in r){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=new t({type:"nonoptional",innerType:n[s]}))}else for(let s in n)o[s]=new t({type:"nonoptional",innerType:n[s]});return Ye(e,{...e._zod.def,shape:o,checks:[]})}function jr(t,e=0){for(let r=e;r<t.issues.length;r++)if(t.issues[r]?.continue!==!0)return!0;return!1}function Tt(t,e){return e.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(t),r})}function Wn(t){return typeof t=="string"?t:t?.message}function mt(t,e,r){let n={...t,path:t.path??[]};if(!t.message){let o=Wn(t.inst?._zod.def?.error?.(t))??Wn(e?.error?.(t))??Wn(r.customError?.(t))??Wn(r.localeError?.(t))??"Invalid input";n.message=o}return delete n.inst,delete n.continue,e?.reportInput||delete n.input,n}function Df(t){return t instanceof Set?"set":t instanceof Map?"map":t instanceof File?"file":"unknown"}function Qn(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function za(...t){let[e,r,n]=t;return typeof e=="string"?{message:e,code:"custom",input:r,inst:n}:{...e}}function Px(t){return Object.entries(t).filter(([e,r])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}var xa=class{constructor(...e){}};var jf=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),Object.defineProperty(t,"message",{get(){return JSON.stringify(e,wa,2)},enumerable:!0}),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},ms=v("$ZodError",jf),eo=v("$ZodError",jf,{Parent:Error});function Pa(t,e=r=>r.message){let r={},n=[];for(let o of t.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(e(o))):n.push(e(o));return{formErrors:n,fieldErrors:r}}function Na(t,e){let r=e||function(s){return s.message},n={_errors:[]},o=s=>{for(let i of s.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(a=>o({issues:a}));else if(i.code==="invalid_key")o({issues:i.issues});else if(i.code==="invalid_element")o({issues:i.issues});else if(i.path.length===0)n._errors.push(r(i));else{let a=n,c=0;for(;c<i.path.length;){let l=i.path[c];c===i.path.length-1?(a[l]=a[l]||{_errors:[]},a[l]._errors.push(r(i))):a[l]=a[l]||{_errors:[]},a=a[l],c++}}};return o(t),n}var Oa=t=>(e,r,n,o)=>{let s=n?Object.assign(n,{async:!1}):{async:!1},i=e._zod.run({value:r,issues:[]},s);if(i instanceof Promise)throw new Zt;if(i.issues.length){let a=new(o?.Err??t)(i.issues.map(c=>mt(c,s,Xe())));throw fs(a,o?.callee),a}return i.value},Ra=Oa(eo),Ca=t=>async(e,r,n,o)=>{let s=n?Object.assign(n,{async:!0}):{async:!0},i=e._zod.run({value:r,issues:[]},s);if(i instanceof Promise&&(i=await i),i.issues.length){let a=new(o?.Err??t)(i.issues.map(c=>mt(c,s,Xe())));throw fs(a,o?.callee),a}return i.value},Aa=Ca(eo),Ma=t=>(e,r,n)=>{let o=n?{...n,async:!1}:{async:!1},s=e._zod.run({value:r,issues:[]},o);if(s instanceof Promise)throw new Zt;return s.issues.length?{success:!1,error:new(t??ms)(s.issues.map(i=>mt(i,o,Xe())))}:{success:!0,data:s.value}},Lr=Ma(eo),Da=t=>async(e,r,n)=>{let o=n?Object.assign(n,{async:!0}):{async:!0},s=e._zod.run({value:r,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new t(s.issues.map(i=>mt(i,o,Xe())))}:{success:!0,data:s.value}},Zr=Da(eo);var Lf=/^[cC][^\s-]{8,}$/,Zf=/^[0-9a-z]+$/,Ff=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Uf=/^[0-9a-vA-V]{20}$/,qf=/^[A-Za-z0-9]{27}$/,Vf=/^[a-zA-Z0-9_-]{21}$/,Bf=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/;var Hf=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,ja=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/;var Gf=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;var Ox="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Wf(){return new RegExp(Ox,"u")}var Jf=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Kf=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,Xf=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Yf=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Qf=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,La=/^[A-Za-z0-9_-]*$/,ep=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/;var tp=/^\+(?:[0-9]){6,14}[0-9]$/,rp="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",np=new RegExp(`^${rp}$`);function op(t){let e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function sp(t){return new RegExp(`^${op(t)}$`)}function ip(t){let e=op({precision:t.precision}),r=["Z"];t.local&&r.push(""),t.offset&&r.push("([+-]\\d{2}:\\d{2})");let n=`${e}(?:${r.join("|")})`;return new RegExp(`^${rp}T(?:${n})$`)}var ap=t=>{let e=t?`[\\s\\S]{${t?.minimum??0},${t?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)};var cp=/^\d+$/,lp=/^-?\d+(?:\.\d+)?/i,up=/true|false/i,dp=/null/i;var fp=/^[^A-Z]*$/,pp=/^[^a-z]*$/;var $e=v("$ZodCheck",(t,e)=>{var r;t._zod??(t._zod={}),t._zod.def=e,(r=t._zod).onattach??(r.onattach=[])}),mp={number:"number",bigint:"bigint",object:"date"},Za=v("$ZodCheckLessThan",(t,e)=>{$e.init(t,e);let r=mp[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,s=(e.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<s&&(e.inclusive?o.maximum=e.value:o.exclusiveMaximum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value<=e.value:n.value<e.value)||n.issues.push({origin:r,code:"too_big",maximum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),Fa=v("$ZodCheckGreaterThan",(t,e)=>{$e.init(t,e);let r=mp[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,s=(e.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>s&&(e.inclusive?o.minimum=e.value:o.exclusiveMinimum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value>=e.value:n.value>e.value)||n.issues.push({origin:r,code:"too_small",minimum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),hp=v("$ZodCheckMultipleOf",(t,e)=>{$e.init(t,e),t._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=e.value)}),t._zod.check=r=>{if(typeof r.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%e.value===BigInt(0):Sa(r.value,e.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:e.value,input:r.value,inst:t,continue:!e.abort})}}),gp=v("$ZodCheckNumberFormat",(t,e)=>{$e.init(t,e),e.format=e.format||"float64";let r=e.format?.includes("int"),n=r?"int":"number",[o,s]=Ia[e.format];t._zod.onattach.push(i=>{let a=i._zod.bag;a.format=e.format,a.minimum=o,a.maximum=s,r&&(a.pattern=cp)}),t._zod.check=i=>{let a=i.value;if(r){if(!Number.isInteger(a)){i.issues.push({expected:n,format:e.format,code:"invalid_type",input:a,inst:t});return}if(!Number.isSafeInteger(a)){a>0?i.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort}):i.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort});return}}a<o&&i.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:t,continue:!e.abort}),a>s&&i.issues.push({origin:"number",input:a,code:"too_big",maximum:s,inst:t})}});var yp=v("$ZodCheckMaxLength",(t,e)=>{var r;$e.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Xn(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<o&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{let o=n.value;if(o.length<=e.maximum)return;let i=Qn(o);n.issues.push({origin:i,code:"too_big",maximum:e.maximum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),_p=v("$ZodCheckMinLength",(t,e)=>{var r;$e.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Xn(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>o&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{let o=n.value;if(o.length>=e.minimum)return;let i=Qn(o);n.issues.push({origin:i,code:"too_small",minimum:e.minimum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),vp=v("$ZodCheckLengthEquals",(t,e)=>{var r;$e.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Xn(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag;o.minimum=e.length,o.maximum=e.length,o.length=e.length}),t._zod.check=n=>{let o=n.value,s=o.length;if(s===e.length)return;let i=Qn(o),a=s>e.length;n.issues.push({origin:i,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),to=v("$ZodCheckStringFormat",(t,e)=>{var r,n;$e.init(t,e),t._zod.onattach.push(o=>{let s=o._zod.bag;s.format=e.format,e.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(e.pattern))}),e.pattern?(r=t._zod).check??(r.check=o=>{e.pattern.lastIndex=0,!e.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:e.format,input:o.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(n=t._zod).check??(n.check=()=>{})}),bp=v("$ZodCheckRegex",(t,e)=>{to.init(t,e),t._zod.check=r=>{e.pattern.lastIndex=0,!e.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),xp=v("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=fp),to.init(t,e)}),wp=v("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=pp),to.init(t,e)}),Sp=v("$ZodCheckIncludes",(t,e)=>{$e.init(t,e);let r=rr(e.includes),n=new RegExp(typeof e.position=="number"?`^.{${e.position}}${r}`:r);e.pattern=n,t._zod.onattach.push(o=>{let s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),t._zod.check=o=>{o.value.includes(e.includes,e.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:o.value,inst:t,continue:!e.abort})}}),$p=v("$ZodCheckStartsWith",(t,e)=>{$e.init(t,e);let r=new RegExp(`^${rr(e.prefix)}.*`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.startsWith(e.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:n.value,inst:t,continue:!e.abort})}}),kp=v("$ZodCheckEndsWith",(t,e)=>{$e.init(t,e);let r=new RegExp(`.*${rr(e.suffix)}$`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.endsWith(e.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:n.value,inst:t,continue:!e.abort})}});var Tp=v("$ZodCheckOverwrite",(t,e)=>{$e.init(t,e),t._zod.check=r=>{r.value=e.tx(r.value)}});var gs=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let n=e.split(`
`).filter(i=>i),o=Math.min(...n.map(i=>i.length-i.trimStart().length)),s=n.map(i=>i.slice(o)).map(i=>" ".repeat(this.indent*2)+i);for(let i of s)this.content.push(i)}compile(){let e=Function,r=this?.args,o=[...(this?.content??[""]).map(s=>`  ${s}`)];return new e(...r,o.join(`
`))}};var Ip={major:4,minor:0,patch:0};var ne=v("$ZodType",(t,e)=>{var r;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=Ip;let n=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&n.unshift(t);for(let o of n)for(let s of o._zod.onattach)s(t);if(n.length===0)(r=t._zod).deferred??(r.deferred=[]),t._zod.deferred?.push(()=>{t._zod.run=t._zod.parse});else{let o=(s,i,a)=>{let c=jr(s),l;for(let u of i){if(u._zod.def.when){if(!u._zod.def.when(s))continue}else if(c)continue;let d=s.issues.length,g=u._zod.check(s);if(g instanceof Promise&&a?.async===!1)throw new Zt;if(l||g instanceof Promise)l=(l??Promise.resolve()).then(async()=>{await g,s.issues.length!==d&&(c||(c=jr(s,d)))});else{if(s.issues.length===d)continue;c||(c=jr(s,d))}}return l?l.then(()=>s):s};t._zod.run=(s,i)=>{let a=t._zod.parse(s,i);if(a instanceof Promise){if(i.async===!1)throw new Zt;return a.then(c=>o(c,n,i))}return o(a,n,i)}}t["~standard"]={validate:o=>{try{let s=Lr(t,o);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return Zr(t,o).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}}),ro=v("$ZodString",(t,e)=>{ne.init(t,e),t._zod.pattern=[...t?._zod.bag?.patterns??[]].pop()??ap(t._zod.bag),t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:t}),r}}),ae=v("$ZodStringFormat",(t,e)=>{to.init(t,e),ro.init(t,e)}),qa=v("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=Hf),ae.init(t,e)}),Va=v("$ZodUUID",(t,e)=>{if(e.version){let n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(n===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=ja(n))}else e.pattern??(e.pattern=ja());ae.init(t,e)}),Ba=v("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=Gf),ae.init(t,e)}),Ha=v("$ZodURL",(t,e)=>{ae.init(t,e),t._zod.check=r=>{try{let n=r.value,o=new URL(n),s=o.href;e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(o.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:ep.source,input:r.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:r.value,inst:t,continue:!e.abort})),!n.endsWith("/")&&s.endsWith("/")?r.value=s.slice(0,-1):r.value=s;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:t,continue:!e.abort})}}}),Ga=v("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=Wf()),ae.init(t,e)}),Wa=v("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=Vf),ae.init(t,e)}),Ja=v("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=Lf),ae.init(t,e)}),Ka=v("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=Zf),ae.init(t,e)}),Xa=v("$ZodULID",(t,e)=>{e.pattern??(e.pattern=Ff),ae.init(t,e)}),Ya=v("$ZodXID",(t,e)=>{e.pattern??(e.pattern=Uf),ae.init(t,e)}),Qa=v("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=qf),ae.init(t,e)}),jp=v("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=ip(e)),ae.init(t,e)}),Lp=v("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=np),ae.init(t,e)}),Zp=v("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=sp(e)),ae.init(t,e)}),Fp=v("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=Bf),ae.init(t,e)}),ec=v("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=Jf),ae.init(t,e),t._zod.onattach.push(r=>{let n=r._zod.bag;n.format="ipv4"})}),tc=v("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=Kf),ae.init(t,e),t._zod.onattach.push(r=>{let n=r._zod.bag;n.format="ipv6"}),t._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:t,continue:!e.abort})}}}),rc=v("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=Xf),ae.init(t,e)}),nc=v("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=Yf),ae.init(t,e),t._zod.check=r=>{let[n,o]=r.value.split("/");try{if(!o)throw new Error;let s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${n}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:t,continue:!e.abort})}}});function Up(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}var oc=v("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=Qf),ae.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),t._zod.check=r=>{Up(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:t,continue:!e.abort})}});function Rx(t){if(!La.test(t))return!1;let e=t.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=e.padEnd(Math.ceil(e.length/4)*4,"=");return Up(r)}var sc=v("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=La),ae.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),t._zod.check=r=>{Rx(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:t,continue:!e.abort})}}),ic=v("$ZodE164",(t,e)=>{e.pattern??(e.pattern=tp),ae.init(t,e)});function Cx(t,e=null){try{let r=t.split(".");if(r.length!==3)return!1;let[n]=r;if(!n)return!1;let o=JSON.parse(atob(n));return!("typ"in o&&o?.typ!=="JWT"||!o.alg||e&&(!("alg"in o)||o.alg!==e))}catch{return!1}}var ac=v("$ZodJWT",(t,e)=>{ae.init(t,e),t._zod.check=r=>{Cx(r.value,e.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:t,continue:!e.abort})}});var _s=v("$ZodNumber",(t,e)=>{ne.init(t,e),t._zod.pattern=t._zod.bag.pattern??lp,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=Number(r.value)}catch{}let o=r.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return r;let s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:o,inst:t,...s?{received:s}:{}}),r}}),cc=v("$ZodNumber",(t,e)=>{gp.init(t,e),_s.init(t,e)}),lc=v("$ZodBoolean",(t,e)=>{ne.init(t,e),t._zod.pattern=up,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=!!r.value}catch{}let o=r.value;return typeof o=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:t}),r}});var uc=v("$ZodNull",(t,e)=>{ne.init(t,e),t._zod.pattern=dp,t._zod.values=new Set([null]),t._zod.parse=(r,n)=>{let o=r.value;return o===null||r.issues.push({expected:"null",code:"invalid_type",input:o,inst:t}),r}});var dc=v("$ZodUnknown",(t,e)=>{ne.init(t,e),t._zod.parse=r=>r}),fc=v("$ZodNever",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:t}),r)});function zp(t,e,r){t.issues.length&&e.issues.push(...Tt(r,t.issues)),e.value[r]=t.value}var pc=v("$ZodArray",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!Array.isArray(o))return r.issues.push({expected:"array",code:"invalid_type",input:o,inst:t}),r;r.value=Array(o.length);let s=[];for(let i=0;i<o.length;i++){let a=o[i],c=e.element._zod.run({value:a,issues:[]},n);c instanceof Promise?s.push(c.then(l=>zp(l,r,i))):zp(c,r,i)}return s.length?Promise.all(s).then(()=>r):r}});function ys(t,e,r){t.issues.length&&e.issues.push(...Tt(r,t.issues)),e.value[r]=t.value}function Pp(t,e,r,n){t.issues.length?n[r]===void 0?r in n?e.value[r]=void 0:e.value[r]=t.value:e.issues.push(...Tt(r,t.issues)):t.value===void 0?r in n&&(e.value[r]=void 0):e.value[r]=t.value}var vs=v("$ZodObject",(t,e)=>{ne.init(t,e);let r=Kn(()=>{let d=Object.keys(e.shape);for(let h of d)if(!(e.shape[h]instanceof ne))throw new Error(`Invalid element at key "${h}": expected a Zod schema`);let g=Ea(e.shape);return{shape:e.shape,keys:d,keySet:new Set(d),numKeys:d.length,optionalKeys:new Set(g)}});ie(t._zod,"propValues",()=>{let d=e.shape,g={};for(let h in d){let f=d[h]._zod;if(f.values){g[h]??(g[h]=new Set);for(let m of f.values)g[h].add(m)}}return g});let n=d=>{let g=new gs(["shape","payload","ctx"]),h=r.value,f=x=>{let w=Dr(x);return`shape[${w}]._zod.run({ value: input[${w}], issues: [] }, ctx)`};g.write("const input = payload.value;");let m=Object.create(null),y=0;for(let x of h.keys)m[x]=`key_${y++}`;g.write("const newResult = {}");for(let x of h.keys)if(h.optionalKeys.has(x)){let w=m[x];g.write(`const ${w} = ${f(x)};`);let I=Dr(x);g.write(`
        if (${w}.issues.length) {
          if (input[${I}] === undefined) {
            if (${I} in input) {
              newResult[${I}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${w}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${I}, ...iss.path] : [${I}],
              }))
            );
          }
        } else if (${w}.value === undefined) {
          if (${I} in input) newResult[${I}] = undefined;
        } else {
          newResult[${I}] = ${w}.value;
        }
        `)}else{let w=m[x];g.write(`const ${w} = ${f(x)};`),g.write(`
          if (${w}.issues.length) payload.issues = payload.issues.concat(${w}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Dr(x)}, ...iss.path] : [${Dr(x)}]
          })));`),g.write(`newResult[${Dr(x)}] = ${w}.value`)}g.write("payload.value = newResult;"),g.write("return payload;");let b=g.compile();return(x,w)=>b(d,x,w)},o,s=mn,i=!us.jitless,c=i&&ka.value,l=e.catchall,u;t._zod.parse=(d,g)=>{u??(u=r.value);let h=d.value;if(!s(h))return d.issues.push({expected:"object",code:"invalid_type",input:h,inst:t}),d;let f=[];if(i&&c&&g?.async===!1&&g.jitless!==!0)o||(o=n(e.shape)),d=o(d,g);else{d.value={};let w=u.shape;for(let I of u.keys){let C=w[I],ve=C._zod.run({value:h[I],issues:[]},g),Oe=C._zod.optin==="optional"&&C._zod.optout==="optional";ve instanceof Promise?f.push(ve.then(At=>Oe?Pp(At,d,I,h):ys(At,d,I))):Oe?Pp(ve,d,I,h):ys(ve,d,I)}}if(!l)return f.length?Promise.all(f).then(()=>d):d;let m=[],y=u.keySet,b=l._zod,x=b.def.type;for(let w of Object.keys(h)){if(y.has(w))continue;if(x==="never"){m.push(w);continue}let I=b.run({value:h[w],issues:[]},g);I instanceof Promise?f.push(I.then(C=>ys(C,d,w))):ys(I,d,w)}return m.length&&d.issues.push({code:"unrecognized_keys",keys:m,input:h,inst:t}),f.length?Promise.all(f).then(()=>d):d}});function Np(t,e,r,n){for(let o of t)if(o.issues.length===0)return e.value=o.value,e;return e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(o=>o.issues.map(s=>mt(s,n,Xe())))}),e}var bs=v("$ZodUnion",(t,e)=>{ne.init(t,e),ie(t._zod,"optin",()=>e.options.some(r=>r._zod.optin==="optional")?"optional":void 0),ie(t._zod,"optout",()=>e.options.some(r=>r._zod.optout==="optional")?"optional":void 0),ie(t._zod,"values",()=>{if(e.options.every(r=>r._zod.values))return new Set(e.options.flatMap(r=>Array.from(r._zod.values)))}),ie(t._zod,"pattern",()=>{if(e.options.every(r=>r._zod.pattern)){let r=e.options.map(n=>n._zod.pattern);return new RegExp(`^(${r.map(n=>Yn(n.source)).join("|")})$`)}}),t._zod.parse=(r,n)=>{let o=!1,s=[];for(let i of e.options){let a=i._zod.run({value:r.value,issues:[]},n);if(a instanceof Promise)s.push(a),o=!0;else{if(a.issues.length===0)return a;s.push(a)}}return o?Promise.all(s).then(i=>Np(i,r,t,n)):Np(s,r,t,n)}}),mc=v("$ZodDiscriminatedUnion",(t,e)=>{bs.init(t,e);let r=t._zod.parse;ie(t._zod,"propValues",()=>{let o={};for(let s of e.options){let i=s._zod.propValues;if(!i||Object.keys(i).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(let[a,c]of Object.entries(i)){o[a]||(o[a]=new Set);for(let l of c)o[a].add(l)}}return o});let n=Kn(()=>{let o=e.options,s=new Map;for(let i of o){let a=i._zod.propValues[e.discriminator];if(!a||a.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(i)}"`);for(let c of a){if(s.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);s.set(c,i)}}return s});t._zod.parse=(o,s)=>{let i=o.value;if(!mn(i))return o.issues.push({code:"invalid_type",expected:"object",input:i,inst:t}),o;let a=n.value.get(i?.[e.discriminator]);return a?a._zod.run(o,s):e.unionFallback?r(o,s):(o.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:i,path:[e.discriminator],inst:t}),o)}}),hc=v("$ZodIntersection",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=r.value,s=e.left._zod.run({value:o,issues:[]},n),i=e.right._zod.run({value:o,issues:[]},n);return s instanceof Promise||i instanceof Promise?Promise.all([s,i]).then(([c,l])=>Op(r,c,l)):Op(r,s,i)}});function Ua(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(hn(t)&&hn(e)){let r=Object.keys(e),n=Object.keys(t).filter(s=>r.indexOf(s)!==-1),o={...t,...e};for(let s of n){let i=Ua(t[s],e[s]);if(!i.valid)return{valid:!1,mergeErrorPath:[s,...i.mergeErrorPath]};o[s]=i.data}return{valid:!0,data:o}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};let r=[];for(let n=0;n<t.length;n++){let o=t[n],s=e[n],i=Ua(o,s);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};r.push(i.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function Op(t,e,r){if(e.issues.length&&t.issues.push(...e.issues),r.issues.length&&t.issues.push(...r.issues),jr(t))return t;let n=Ua(e.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return t.value=n.data,t}var gc=v("$ZodRecord",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!hn(o))return r.issues.push({expected:"record",code:"invalid_type",input:o,inst:t}),r;let s=[];if(e.keyType._zod.values){let i=e.keyType._zod.values;r.value={};for(let c of i)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){let l=e.valueType._zod.run({value:o[c],issues:[]},n);l instanceof Promise?s.push(l.then(u=>{u.issues.length&&r.issues.push(...Tt(c,u.issues)),r.value[c]=u.value})):(l.issues.length&&r.issues.push(...Tt(c,l.issues)),r.value[c]=l.value)}let a;for(let c in o)i.has(c)||(a=a??[],a.push(c));a&&a.length>0&&r.issues.push({code:"unrecognized_keys",input:o,inst:t,keys:a})}else{r.value={};for(let i of Reflect.ownKeys(o)){if(i==="__proto__")continue;let a=e.keyType._zod.run({value:i,issues:[]},n);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){r.issues.push({origin:"record",code:"invalid_key",issues:a.issues.map(l=>mt(l,n,Xe())),input:i,path:[i],inst:t}),r.value[a.value]=a.value;continue}let c=e.valueType._zod.run({value:o[i],issues:[]},n);c instanceof Promise?s.push(c.then(l=>{l.issues.length&&r.issues.push(...Tt(i,l.issues)),r.value[a.value]=l.value})):(c.issues.length&&r.issues.push(...Tt(i,c.issues)),r.value[a.value]=c.value)}}return s.length?Promise.all(s).then(()=>r):r}});var yc=v("$ZodEnum",(t,e)=>{ne.init(t,e);let r=Jn(e.entries);t._zod.values=new Set(r),t._zod.pattern=new RegExp(`^(${r.filter(n=>Ta.has(typeof n)).map(n=>typeof n=="string"?rr(n):n.toString()).join("|")})$`),t._zod.parse=(n,o)=>{let s=n.value;return t._zod.values.has(s)||n.issues.push({code:"invalid_value",values:r,input:s,inst:t}),n}}),_c=v("$ZodLiteral",(t,e)=>{ne.init(t,e),t._zod.values=new Set(e.values),t._zod.pattern=new RegExp(`^(${e.values.map(r=>typeof r=="string"?rr(r):r?r.toString():String(r)).join("|")})$`),t._zod.parse=(r,n)=>{let o=r.value;return t._zod.values.has(o)||r.issues.push({code:"invalid_value",values:e.values,input:o,inst:t}),r}});var vc=v("$ZodTransform",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=e.transform(r.value,r);if(n.async)return(o instanceof Promise?o:Promise.resolve(o)).then(i=>(r.value=i,r));if(o instanceof Promise)throw new Zt;return r.value=o,r}}),bc=v("$ZodOptional",(t,e)=>{ne.init(t,e),t._zod.optin="optional",t._zod.optout="optional",ie(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),ie(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${Yn(r.source)})?$`):void 0}),t._zod.parse=(r,n)=>e.innerType._zod.optin==="optional"?e.innerType._zod.run(r,n):r.value===void 0?r:e.innerType._zod.run(r,n)}),xc=v("$ZodNullable",(t,e)=>{ne.init(t,e),ie(t._zod,"optin",()=>e.innerType._zod.optin),ie(t._zod,"optout",()=>e.innerType._zod.optout),ie(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${Yn(r.source)}|null)$`):void 0}),ie(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(r,n)=>r.value===null?r:e.innerType._zod.run(r,n)}),wc=v("$ZodDefault",(t,e)=>{ne.init(t,e),t._zod.optin="optional",ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(r.value===void 0)return r.value=e.defaultValue,r;let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>Rp(s,e)):Rp(o,e)}});function Rp(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}var Sc=v("$ZodPrefault",(t,e)=>{ne.init(t,e),t._zod.optin="optional",ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>(r.value===void 0&&(r.value=e.defaultValue),e.innerType._zod.run(r,n))}),$c=v("$ZodNonOptional",(t,e)=>{ne.init(t,e),ie(t._zod,"values",()=>{let r=e.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>Cp(s,t)):Cp(o,t)}});function Cp(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}var kc=v("$ZodCatch",(t,e)=>{ne.init(t,e),t._zod.optin="optional",ie(t._zod,"optout",()=>e.innerType._zod.optout),ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>(r.value=s.value,s.issues.length&&(r.value=e.catchValue({...r,error:{issues:s.issues.map(i=>mt(i,n,Xe()))},input:r.value}),r.issues=[]),r)):(r.value=o.value,o.issues.length&&(r.value=e.catchValue({...r,error:{issues:o.issues.map(s=>mt(s,n,Xe()))},input:r.value}),r.issues=[]),r)}});var Tc=v("$ZodPipe",(t,e)=>{ne.init(t,e),ie(t._zod,"values",()=>e.in._zod.values),ie(t._zod,"optin",()=>e.in._zod.optin),ie(t._zod,"optout",()=>e.out._zod.optout),t._zod.parse=(r,n)=>{let o=e.in._zod.run(r,n);return o instanceof Promise?o.then(s=>Ap(s,e,n)):Ap(o,e,n)}});function Ap(t,e,r){return jr(t)?t:e.out._zod.run({value:t.value,issues:t.issues},r)}var Ec=v("$ZodReadonly",(t,e)=>{ne.init(t,e),ie(t._zod,"propValues",()=>e.innerType._zod.propValues),ie(t._zod,"values",()=>e.innerType._zod.values),ie(t._zod,"optin",()=>e.innerType._zod.optin),ie(t._zod,"optout",()=>e.innerType._zod.optout),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(Mp):Mp(o)}});function Mp(t){return t.value=Object.freeze(t.value),t}var Ic=v("$ZodCustom",(t,e)=>{$e.init(t,e),ne.init(t,e),t._zod.parse=(r,n)=>r,t._zod.check=r=>{let n=r.value,o=e.fn(n);if(o instanceof Promise)return o.then(s=>Dp(s,r,n,t));Dp(o,r,n,t)}});function Dp(t,e,r,n){if(!t){let o={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(o.params=n._zod.def.params),e.issues.push(za(o))}}var Ax=t=>{let e=typeof t;switch(e){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return e},Mx=()=>{let t={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}};function e(n){return t[n]??null}let r={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return n=>{switch(n.code){case"invalid_type":return`Invalid input: expected ${n.expected}, received ${Ax(n.input)}`;case"invalid_value":return n.values.length===1?`Invalid input: expected ${ps(n.values[0])}`:`Invalid option: expected one of ${ds(n.values,"|")}`;case"too_big":{let o=n.inclusive?"<=":"<",s=e(n.origin);return s?`Too big: expected ${n.origin??"value"} to have ${o}${n.maximum.toString()} ${s.unit??"elements"}`:`Too big: expected ${n.origin??"value"} to be ${o}${n.maximum.toString()}`}case"too_small":{let o=n.inclusive?">=":">",s=e(n.origin);return s?`Too small: expected ${n.origin} to have ${o}${n.minimum.toString()} ${s.unit}`:`Too small: expected ${n.origin} to be ${o}${n.minimum.toString()}`}case"invalid_format":{let o=n;return o.format==="starts_with"?`Invalid string: must start with "${o.prefix}"`:o.format==="ends_with"?`Invalid string: must end with "${o.suffix}"`:o.format==="includes"?`Invalid string: must include "${o.includes}"`:o.format==="regex"?`Invalid string: must match pattern ${o.pattern}`:`Invalid ${r[o.format]??n.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${n.divisor}`;case"unrecognized_keys":return`Unrecognized key${n.keys.length>1?"s":""}: ${ds(n.keys,", ")}`;case"invalid_key":return`Invalid key in ${n.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${n.origin}`;default:return"Invalid input"}}};function qp(){return{localeError:Mx()}}var Dx=Symbol("ZodOutput"),jx=Symbol("ZodInput"),no=class{constructor(){this._map=new Map,this._idmap=new Map}add(e,...r){let n=r[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let r=this._map.get(e);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(e),this}get(e){let r=e._zod.parent;if(r){let n={...this.get(r)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}};function Vp(){return new no}var nr=Vp();function zc(t,e){return new t({type:"string",...L(e)})}function Pc(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...L(e)})}function xs(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...L(e)})}function Nc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...L(e)})}function Oc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...L(e)})}function Rc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...L(e)})}function Cc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...L(e)})}function Ac(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...L(e)})}function Mc(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...L(e)})}function Dc(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...L(e)})}function jc(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...L(e)})}function Lc(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...L(e)})}function Zc(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...L(e)})}function Fc(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...L(e)})}function Uc(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...L(e)})}function qc(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...L(e)})}function Vc(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...L(e)})}function Bc(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...L(e)})}function Hc(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...L(e)})}function Gc(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...L(e)})}function Wc(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...L(e)})}function Jc(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...L(e)})}function Kc(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...L(e)})}function Bp(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...L(e)})}function Hp(t,e){return new t({type:"string",format:"date",check:"string_format",...L(e)})}function Gp(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...L(e)})}function Wp(t,e){return new t({type:"string",format:"duration",check:"string_format",...L(e)})}function Xc(t,e){return new t({type:"number",checks:[],...L(e)})}function Yc(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...L(e)})}function Qc(t,e){return new t({type:"boolean",...L(e)})}function el(t,e){return new t({type:"null",...L(e)})}function tl(t){return new t({type:"unknown"})}function rl(t,e){return new t({type:"never",...L(e)})}function ws(t,e){return new Za({check:"less_than",...L(e),value:t,inclusive:!1})}function oo(t,e){return new Za({check:"less_than",...L(e),value:t,inclusive:!0})}function Ss(t,e){return new Fa({check:"greater_than",...L(e),value:t,inclusive:!1})}function so(t,e){return new Fa({check:"greater_than",...L(e),value:t,inclusive:!0})}function $s(t,e){return new hp({check:"multiple_of",...L(e),value:t})}function ks(t,e){return new yp({check:"max_length",...L(e),maximum:t})}function gn(t,e){return new _p({check:"min_length",...L(e),minimum:t})}function Ts(t,e){return new vp({check:"length_equals",...L(e),length:t})}function nl(t,e){return new bp({check:"string_format",format:"regex",...L(e),pattern:t})}function ol(t){return new xp({check:"string_format",format:"lowercase",...L(t)})}function sl(t){return new wp({check:"string_format",format:"uppercase",...L(t)})}function il(t,e){return new Sp({check:"string_format",format:"includes",...L(e),includes:t})}function al(t,e){return new $p({check:"string_format",format:"starts_with",...L(e),prefix:t})}function cl(t,e){return new kp({check:"string_format",format:"ends_with",...L(e),suffix:t})}function Fr(t){return new Tp({check:"overwrite",tx:t})}function ll(t){return Fr(e=>e.normalize(t))}function ul(){return Fr(t=>t.trim())}function dl(){return Fr(t=>t.toLowerCase())}function fl(){return Fr(t=>t.toUpperCase())}function Jp(t,e,r){return new t({type:"array",element:e,...L(r)})}function pl(t,e,r){let n=L(r);return n.abort??(n.abort=!0),new t({type:"custom",check:"custom",fn:e,...n})}function ml(t,e,r){return new t({type:"custom",check:"custom",fn:e,...L(r)})}var Es=class{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??nr,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,r={path:[],schemaPath:[]}){var n;let o=e._zod.def,s={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},i=this.seen.get(e);if(i)return i.count++,r.schemaPath.includes(e)&&(i.cycle=r.path),i.schema;let a={schema:{},count:1,cycle:void 0,path:r.path};this.seen.set(e,a);let c=e._zod.toJSONSchema?.();if(c)a.schema=c;else{let d={...r,schemaPath:[...r.schemaPath,e],path:r.path},g=e._zod.parent;if(g)a.ref=g,this.process(g,d),this.seen.get(g).isParent=!0;else{let h=a.schema;switch(o.type){case"string":{let f=h;f.type="string";let{minimum:m,maximum:y,format:b,patterns:x,contentEncoding:w}=e._zod.bag;if(typeof m=="number"&&(f.minLength=m),typeof y=="number"&&(f.maxLength=y),b&&(f.format=s[b]??b,f.format===""&&delete f.format),w&&(f.contentEncoding=w),x&&x.size>0){let I=[...x];I.length===1?f.pattern=I[0].source:I.length>1&&(a.schema.allOf=[...I.map(C=>({...this.target==="draft-7"?{type:"string"}:{},pattern:C.source}))])}break}case"number":{let f=h,{minimum:m,maximum:y,format:b,multipleOf:x,exclusiveMaximum:w,exclusiveMinimum:I}=e._zod.bag;typeof b=="string"&&b.includes("int")?f.type="integer":f.type="number",typeof I=="number"&&(f.exclusiveMinimum=I),typeof m=="number"&&(f.minimum=m,typeof I=="number"&&(I>=m?delete f.minimum:delete f.exclusiveMinimum)),typeof w=="number"&&(f.exclusiveMaximum=w),typeof y=="number"&&(f.maximum=y,typeof w=="number"&&(w<=y?delete f.maximum:delete f.exclusiveMaximum)),typeof x=="number"&&(f.multipleOf=x);break}case"boolean":{let f=h;f.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{h.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{h.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{let f=h,{minimum:m,maximum:y}=e._zod.bag;typeof m=="number"&&(f.minItems=m),typeof y=="number"&&(f.maxItems=y),f.type="array",f.items=this.process(o.element,{...d,path:[...d.path,"items"]});break}case"object":{let f=h;f.type="object",f.properties={};let m=o.shape;for(let x in m)f.properties[x]=this.process(m[x],{...d,path:[...d.path,"properties",x]});let y=new Set(Object.keys(m)),b=new Set([...y].filter(x=>{let w=o.shape[x]._zod;return this.io==="input"?w.optin===void 0:w.optout===void 0}));b.size>0&&(f.required=Array.from(b)),o.catchall?._zod.def.type==="never"?f.additionalProperties=!1:o.catchall?o.catchall&&(f.additionalProperties=this.process(o.catchall,{...d,path:[...d.path,"additionalProperties"]})):this.io==="output"&&(f.additionalProperties=!1);break}case"union":{let f=h;f.anyOf=o.options.map((m,y)=>this.process(m,{...d,path:[...d.path,"anyOf",y]}));break}case"intersection":{let f=h,m=this.process(o.left,{...d,path:[...d.path,"allOf",0]}),y=this.process(o.right,{...d,path:[...d.path,"allOf",1]}),b=w=>"allOf"in w&&Object.keys(w).length===1,x=[...b(m)?m.allOf:[m],...b(y)?y.allOf:[y]];f.allOf=x;break}case"tuple":{let f=h;f.type="array";let m=o.items.map((x,w)=>this.process(x,{...d,path:[...d.path,"prefixItems",w]}));if(this.target==="draft-2020-12"?f.prefixItems=m:f.items=m,o.rest){let x=this.process(o.rest,{...d,path:[...d.path,"items"]});this.target==="draft-2020-12"?f.items=x:f.additionalItems=x}o.rest&&(f.items=this.process(o.rest,{...d,path:[...d.path,"items"]}));let{minimum:y,maximum:b}=e._zod.bag;typeof y=="number"&&(f.minItems=y),typeof b=="number"&&(f.maxItems=b);break}case"record":{let f=h;f.type="object",f.propertyNames=this.process(o.keyType,{...d,path:[...d.path,"propertyNames"]}),f.additionalProperties=this.process(o.valueType,{...d,path:[...d.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{let f=h,m=Jn(o.entries);m.every(y=>typeof y=="number")&&(f.type="number"),m.every(y=>typeof y=="string")&&(f.type="string"),f.enum=m;break}case"literal":{let f=h,m=[];for(let y of o.values)if(y===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof y=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");m.push(Number(y))}else m.push(y);if(m.length!==0)if(m.length===1){let y=m[0];f.type=y===null?"null":typeof y,f.const=y}else m.every(y=>typeof y=="number")&&(f.type="number"),m.every(y=>typeof y=="string")&&(f.type="string"),m.every(y=>typeof y=="boolean")&&(f.type="string"),m.every(y=>y===null)&&(f.type="null"),f.enum=m;break}case"file":{let f=h,m={type:"string",format:"binary",contentEncoding:"binary"},{minimum:y,maximum:b,mime:x}=e._zod.bag;y!==void 0&&(m.minLength=y),b!==void 0&&(m.maxLength=b),x?x.length===1?(m.contentMediaType=x[0],Object.assign(f,m)):f.anyOf=x.map(w=>({...m,contentMediaType:w})):Object.assign(f,m);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{let f=this.process(o.innerType,d);h.anyOf=[f,{type:"null"}];break}case"nonoptional":{this.process(o.innerType,d),a.ref=o.innerType;break}case"success":{let f=h;f.type="boolean";break}case"default":{this.process(o.innerType,d),a.ref=o.innerType,h.default=JSON.parse(JSON.stringify(o.defaultValue));break}case"prefault":{this.process(o.innerType,d),a.ref=o.innerType,this.io==="input"&&(h._prefault=JSON.parse(JSON.stringify(o.defaultValue)));break}case"catch":{this.process(o.innerType,d),a.ref=o.innerType;let f;try{f=o.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}h.default=f;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{let f=h,m=e._zod.pattern;if(!m)throw new Error("Pattern not found in template literal");f.type="string",f.pattern=m.source;break}case"pipe":{let f=this.io==="input"?o.in._zod.def.type==="transform"?o.out:o.in:o.out;this.process(f,d),a.ref=f;break}case"readonly":{this.process(o.innerType,d),a.ref=o.innerType,h.readOnly=!0;break}case"promise":{this.process(o.innerType,d),a.ref=o.innerType;break}case"optional":{this.process(o.innerType,d),a.ref=o.innerType;break}case"lazy":{let f=e._zod.innerType;this.process(f,d),a.ref=f;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}default:}}}let l=this.metadataRegistry.get(e);return l&&Object.assign(a.schema,l),this.io==="input"&&be(e)&&(delete a.schema.examples,delete a.schema.default),this.io==="input"&&a.schema._prefault&&((n=a.schema).default??(n.default=a.schema._prefault)),delete a.schema._prefault,this.seen.get(e).schema}emit(e,r){let n={cycles:r?.cycles??"ref",reused:r?.reused??"inline",external:r?.external??void 0},o=this.seen.get(e);if(!o)throw new Error("Unprocessed schema. This is a bug in Zod.");let s=u=>{let d=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){let m=n.external.registry.get(u[0])?.id,y=n.external.uri??(x=>x);if(m)return{ref:y(m)};let b=u[1].defId??u[1].schema.id??`schema${this.counter++}`;return u[1].defId=b,{defId:b,ref:`${y("__shared")}#/${d}/${b}`}}if(u[1]===o)return{ref:"#"};let h=`#/${d}/`,f=u[1].schema.id??`__schema${this.counter++}`;return{defId:f,ref:h+f}},i=u=>{if(u[1].schema.$ref)return;let d=u[1],{ref:g,defId:h}=s(u);d.def={...d.schema},h&&(d.defId=h);let f=d.schema;for(let m in f)delete f[m];f.$ref=g};if(n.cycles==="throw")for(let u of this.seen.entries()){let d=u[1];if(d.cycle)throw new Error(`Cycle detected: #/${d.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let u of this.seen.entries()){let d=u[1];if(e===u[0]){i(u);continue}if(n.external){let h=n.external.registry.get(u[0])?.id;if(e!==u[0]&&h){i(u);continue}}if(this.metadataRegistry.get(u[0])?.id){i(u);continue}if(d.cycle){i(u);continue}if(d.count>1&&n.reused==="ref"){i(u);continue}}let a=(u,d)=>{let g=this.seen.get(u),h=g.def??g.schema,f={...h};if(g.ref===null)return;let m=g.ref;if(g.ref=null,m){a(m,d);let y=this.seen.get(m).schema;y.$ref&&d.target==="draft-7"?(h.allOf=h.allOf??[],h.allOf.push(y)):(Object.assign(h,y),Object.assign(h,f))}g.isParent||this.override({zodSchema:u,jsonSchema:h,path:g.path??[]})};for(let u of[...this.seen.entries()].reverse())a(u[0],{target:this.target});let c={};if(this.target==="draft-2020-12"?c.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?c.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),n.external?.uri){let u=n.external.registry.get(e)?.id;if(!u)throw new Error("Schema is missing an `id` property");c.$id=n.external.uri(u)}Object.assign(c,o.def);let l=n.external?.defs??{};for(let u of this.seen.entries()){let d=u[1];d.def&&d.defId&&(l[d.defId]=d.def)}n.external||Object.keys(l).length>0&&(this.target==="draft-2020-12"?c.$defs=l:c.definitions=l);try{return JSON.parse(JSON.stringify(c))}catch{throw new Error("Error converting schema to JSON.")}}};function hl(t,e){if(t instanceof no){let n=new Es(e),o={};for(let a of t._idmap.entries()){let[c,l]=a;n.process(l)}let s={},i={registry:t,uri:e?.uri,defs:o};for(let a of t._idmap.entries()){let[c,l]=a;s[c]=n.emit(l,{...e,external:i})}if(Object.keys(o).length>0){let a=n.target==="draft-2020-12"?"$defs":"definitions";s.__shared={[a]:o}}return{schemas:s}}let r=new Es(e);return r.process(t),r.emit(t,e)}function be(t,e){let r=e??{seen:new Set};if(r.seen.has(t))return!1;r.seen.add(t);let o=t._zod.def;switch(o.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return be(o.element,r);case"object":{for(let s in o.shape)if(be(o.shape[s],r))return!0;return!1}case"union":{for(let s of o.options)if(be(s,r))return!0;return!1}case"intersection":return be(o.left,r)||be(o.right,r);case"tuple":{for(let s of o.items)if(be(s,r))return!0;return!!(o.rest&&be(o.rest,r))}case"record":return be(o.keyType,r)||be(o.valueType,r);case"map":return be(o.keyType,r)||be(o.valueType,r);case"set":return be(o.valueType,r);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return be(o.innerType,r);case"lazy":return be(o.getter(),r);case"default":return be(o.innerType,r);case"prefault":return be(o.innerType,r);case"custom":return!1;case"transform":return!0;case"pipe":return be(o.in,r)||be(o.out,r);case"success":return!1;case"catch":return!1;default:}throw new Error(`Unknown schema type: ${o.type}`)}var v0=v("ZodMiniType",(t,e)=>{if(!t._zod)throw new Error("Uninitialized schema in ZodMiniType.");ne.init(t,e),t.def=e,t.parse=(r,n)=>Ra(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>Lr(t,r,n),t.parseAsync=async(r,n)=>Aa(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>Zr(t,r,n),t.check=(...r)=>t.clone({...e,checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),t.clone=(r,n)=>Ye(t,r,n),t.brand=()=>t,t.register=(r,n)=>(r.add(t,n),t)});var b0=v("ZodMiniObject",(t,e)=>{vs.init(t,e),v0.init(t,e),J.defineLazy(t,"shape",()=>e.shape)});function gl(t,e){let r={type:"object",get shape(){return J.assignProp(this,"shape",{...t}),this.shape},...J.normalizeParams(e)};return new b0(r)}function nt(t){return!!t._zod}function qr(t){let e=Object.values(t);if(e.length===0)return gl({});let r=e.every(nt),n=e.every(o=>!nt(o));if(r)return gl(t);if(n)return va(t);throw new Error("Mixed Zod versions detected in object shape.")}function or(t,e){return nt(t)?Lr(t,e):t.safeParse(e)}async function Is(t,e){return nt(t)?await Zr(t,e):await t.safeParseAsync(e)}function sr(t){if(!t)return;let e;if(nt(t)?e=t._zod?.def?.shape:e=t.shape,!!e){if(typeof e=="function")try{return e()}catch{return}return e}}function yn(t){if(t){if(typeof t=="object"){let e=t,r=t;if(!e._def&&!r._zod){let n=Object.values(t);if(n.length>0&&n.every(o=>typeof o=="object"&&o!==null&&(o._def!==void 0||o._zod!==void 0||typeof o.parse=="function")))return qr(t)}}if(nt(t)){let r=t._zod?.def;if(r&&(r.type==="object"||r.shape!==void 0))return t}else if(t.shape!==void 0)return t}}function zs(t){if(t&&typeof t=="object"){if("message"in t&&typeof t.message=="string")return t.message;if("issues"in t&&Array.isArray(t.issues)&&t.issues.length>0){let e=t.issues[0];if(e&&typeof e=="object"&&"message"in e)return String(e.message)}try{return JSON.stringify(t)}catch{return String(t)}}return String(t)}function Xp(t){return t.description}function Yp(t){if(nt(t))return t._zod?.def?.type==="optional";let e=t;return typeof t.isOptional=="function"?t.isOptional():e._def?.typeName==="ZodOptional"}function Ps(t){if(nt(t)){let s=t._zod?.def;if(s){if(s.value!==void 0)return s.value;if(Array.isArray(s.values)&&s.values.length>0)return s.values[0]}}let r=t._def;if(r){if(r.value!==void 0)return r.value;if(Array.isArray(r.values)&&r.values.length>0)return r.values[0]}let n=t.value;if(n!==void 0)return n}var io={};ha(io,{ZodISODate:()=>em,ZodISODateTime:()=>Qp,ZodISODuration:()=>rm,ZodISOTime:()=>tm,date:()=>_l,datetime:()=>yl,duration:()=>bl,time:()=>vl});var Qp=v("ZodISODateTime",(t,e)=>{jp.init(t,e),de.init(t,e)});function yl(t){return Bp(Qp,t)}var em=v("ZodISODate",(t,e)=>{Lp.init(t,e),de.init(t,e)});function _l(t){return Hp(em,t)}var tm=v("ZodISOTime",(t,e)=>{Zp.init(t,e),de.init(t,e)});function vl(t){return Gp(tm,t)}var rm=v("ZodISODuration",(t,e)=>{Fp.init(t,e),de.init(t,e)});function bl(t){return Wp(rm,t)}var nm=(t,e)=>{ms.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:r=>Na(t,r)},flatten:{value:r=>Pa(t,r)},addIssue:{value:r=>t.issues.push(r)},addIssues:{value:r=>t.issues.push(...r)},isEmpty:{get(){return t.issues.length===0}}})},hR=v("ZodError",nm),ao=v("ZodError",nm,{Parent:Error});var om=Oa(ao),sm=Ca(ao),im=Ma(ao),am=Da(ao);var ye=v("ZodType",(t,e)=>(ne.init(t,e),t.def=e,Object.defineProperty(t,"_def",{value:e}),t.check=(...r)=>t.clone({...e,checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),t.clone=(r,n)=>Ye(t,r,n),t.brand=()=>t,t.register=(r,n)=>(r.add(t,n),t),t.parse=(r,n)=>om(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>im(t,r,n),t.parseAsync=async(r,n)=>sm(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>am(t,r,n),t.spa=t.safeParseAsync,t.refine=(r,n)=>t.check(yw(r,n)),t.superRefine=r=>t.check(_w(r)),t.overwrite=r=>t.check(Fr(r)),t.optional=()=>ge(t),t.nullable=()=>um(t),t.nullish=()=>ge(um(t)),t.nonoptional=r=>uw(t,r),t.array=()=>K(t),t.or=r=>ce([t,r]),t.and=r=>Os(t,r),t.transform=r=>wl(t,hm(r)),t.default=r=>aw(t,r),t.prefault=r=>lw(t,r),t.catch=r=>fw(t,r),t.pipe=r=>wl(t,r),t.readonly=()=>hw(t),t.describe=r=>{let n=t.clone();return nr.add(n,{description:r}),n},Object.defineProperty(t,"description",{get(){return nr.get(t)?.description},configurable:!0}),t.meta=(...r)=>{if(r.length===0)return nr.get(t);let n=t.clone();return nr.add(n,r[0]),n},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t)),dm=v("_ZodString",(t,e)=>{ro.init(t,e),ye.init(t,e);let r=t._zod.bag;t.format=r.format??null,t.minLength=r.minimum??null,t.maxLength=r.maximum??null,t.regex=(...n)=>t.check(nl(...n)),t.includes=(...n)=>t.check(il(...n)),t.startsWith=(...n)=>t.check(al(...n)),t.endsWith=(...n)=>t.check(cl(...n)),t.min=(...n)=>t.check(gn(...n)),t.max=(...n)=>t.check(ks(...n)),t.length=(...n)=>t.check(Ts(...n)),t.nonempty=(...n)=>t.check(gn(1,...n)),t.lowercase=n=>t.check(ol(n)),t.uppercase=n=>t.check(sl(n)),t.trim=()=>t.check(ul()),t.normalize=(...n)=>t.check(ll(...n)),t.toLowerCase=()=>t.check(dl()),t.toUpperCase=()=>t.check(fl())}),z0=v("ZodString",(t,e)=>{ro.init(t,e),dm.init(t,e),t.email=r=>t.check(Pc(P0,r)),t.url=r=>t.check(Ac(N0,r)),t.jwt=r=>t.check(Kc(H0,r)),t.emoji=r=>t.check(Mc(O0,r)),t.guid=r=>t.check(xs(cm,r)),t.uuid=r=>t.check(Nc(Ns,r)),t.uuidv4=r=>t.check(Oc(Ns,r)),t.uuidv6=r=>t.check(Rc(Ns,r)),t.uuidv7=r=>t.check(Cc(Ns,r)),t.nanoid=r=>t.check(Dc(R0,r)),t.guid=r=>t.check(xs(cm,r)),t.cuid=r=>t.check(jc(C0,r)),t.cuid2=r=>t.check(Lc(A0,r)),t.ulid=r=>t.check(Zc(M0,r)),t.base64=r=>t.check(Gc(q0,r)),t.base64url=r=>t.check(Wc(V0,r)),t.xid=r=>t.check(Fc(D0,r)),t.ksuid=r=>t.check(Uc(j0,r)),t.ipv4=r=>t.check(qc(L0,r)),t.ipv6=r=>t.check(Vc(Z0,r)),t.cidrv4=r=>t.check(Bc(F0,r)),t.cidrv6=r=>t.check(Hc(U0,r)),t.e164=r=>t.check(Jc(B0,r)),t.datetime=r=>t.check(yl(r)),t.date=r=>t.check(_l(r)),t.time=r=>t.check(vl(r)),t.duration=r=>t.check(bl(r))});function _(t){return zc(z0,t)}var de=v("ZodStringFormat",(t,e)=>{ae.init(t,e),dm.init(t,e)}),P0=v("ZodEmail",(t,e)=>{Ba.init(t,e),de.init(t,e)});var cm=v("ZodGUID",(t,e)=>{qa.init(t,e),de.init(t,e)});var Ns=v("ZodUUID",(t,e)=>{Va.init(t,e),de.init(t,e)});var N0=v("ZodURL",(t,e)=>{Ha.init(t,e),de.init(t,e)});var O0=v("ZodEmoji",(t,e)=>{Ga.init(t,e),de.init(t,e)});var R0=v("ZodNanoID",(t,e)=>{Wa.init(t,e),de.init(t,e)});var C0=v("ZodCUID",(t,e)=>{Ja.init(t,e),de.init(t,e)});var A0=v("ZodCUID2",(t,e)=>{Ka.init(t,e),de.init(t,e)});var M0=v("ZodULID",(t,e)=>{Xa.init(t,e),de.init(t,e)});var D0=v("ZodXID",(t,e)=>{Ya.init(t,e),de.init(t,e)});var j0=v("ZodKSUID",(t,e)=>{Qa.init(t,e),de.init(t,e)});var L0=v("ZodIPv4",(t,e)=>{ec.init(t,e),de.init(t,e)});var Z0=v("ZodIPv6",(t,e)=>{tc.init(t,e),de.init(t,e)});var F0=v("ZodCIDRv4",(t,e)=>{rc.init(t,e),de.init(t,e)});var U0=v("ZodCIDRv6",(t,e)=>{nc.init(t,e),de.init(t,e)});var q0=v("ZodBase64",(t,e)=>{oc.init(t,e),de.init(t,e)});var V0=v("ZodBase64URL",(t,e)=>{sc.init(t,e),de.init(t,e)});var B0=v("ZodE164",(t,e)=>{ic.init(t,e),de.init(t,e)});var H0=v("ZodJWT",(t,e)=>{ac.init(t,e),de.init(t,e)});var fm=v("ZodNumber",(t,e)=>{_s.init(t,e),ye.init(t,e),t.gt=(n,o)=>t.check(Ss(n,o)),t.gte=(n,o)=>t.check(so(n,o)),t.min=(n,o)=>t.check(so(n,o)),t.lt=(n,o)=>t.check(ws(n,o)),t.lte=(n,o)=>t.check(oo(n,o)),t.max=(n,o)=>t.check(oo(n,o)),t.int=n=>t.check(lm(n)),t.safe=n=>t.check(lm(n)),t.positive=n=>t.check(Ss(0,n)),t.nonnegative=n=>t.check(so(0,n)),t.negative=n=>t.check(ws(0,n)),t.nonpositive=n=>t.check(oo(0,n)),t.multipleOf=(n,o)=>t.check($s(n,o)),t.step=(n,o)=>t.check($s(n,o)),t.finite=()=>t;let r=t._zod.bag;t.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),t.isFinite=!0,t.format=r.format??null});function re(t){return Xc(fm,t)}var G0=v("ZodNumberFormat",(t,e)=>{cc.init(t,e),fm.init(t,e)});function lm(t){return Yc(G0,t)}var W0=v("ZodBoolean",(t,e)=>{lc.init(t,e),ye.init(t,e)});function xe(t){return Qc(W0,t)}var J0=v("ZodNull",(t,e)=>{uc.init(t,e),ye.init(t,e)});function Sl(t){return el(J0,t)}var K0=v("ZodUnknown",(t,e)=>{dc.init(t,e),ye.init(t,e)});function fe(){return tl(K0)}var X0=v("ZodNever",(t,e)=>{fc.init(t,e),ye.init(t,e)});function Y0(t){return rl(X0,t)}var Q0=v("ZodArray",(t,e)=>{pc.init(t,e),ye.init(t,e),t.element=e.element,t.min=(r,n)=>t.check(gn(r,n)),t.nonempty=r=>t.check(gn(1,r)),t.max=(r,n)=>t.check(ks(r,n)),t.length=(r,n)=>t.check(Ts(r,n)),t.unwrap=()=>t.element});function K(t,e){return Jp(Q0,t,e)}var pm=v("ZodObject",(t,e)=>{vs.init(t,e),ye.init(t,e),J.defineLazy(t,"shape",()=>e.shape),t.keyof=()=>He(Object.keys(t._zod.def.shape)),t.catchall=r=>t.clone({...t._zod.def,catchall:r}),t.passthrough=()=>t.clone({...t._zod.def,catchall:fe()}),t.loose=()=>t.clone({...t._zod.def,catchall:fe()}),t.strict=()=>t.clone({...t._zod.def,catchall:Y0()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=r=>J.extend(t,r),t.merge=r=>J.merge(t,r),t.pick=r=>J.pick(t,r),t.omit=r=>J.omit(t,r),t.partial=(...r)=>J.partial(gm,t,r[0]),t.required=(...r)=>J.required(ym,t,r[0])});function P(t,e){let r={type:"object",get shape(){return J.assignProp(this,"shape",{...t}),this.shape},...J.normalizeParams(e)};return new pm(r)}function je(t,e){return new pm({type:"object",get shape(){return J.assignProp(this,"shape",{...t}),this.shape},catchall:fe(),...J.normalizeParams(e)})}var mm=v("ZodUnion",(t,e)=>{bs.init(t,e),ye.init(t,e),t.options=e.options});function ce(t,e){return new mm({type:"union",options:t,...J.normalizeParams(e)})}var ew=v("ZodDiscriminatedUnion",(t,e)=>{mm.init(t,e),mc.init(t,e)});function $l(t,e,r){return new ew({type:"union",options:e,discriminator:t,...J.normalizeParams(r)})}var tw=v("ZodIntersection",(t,e)=>{hc.init(t,e),ye.init(t,e)});function Os(t,e){return new tw({type:"intersection",left:t,right:e})}var rw=v("ZodRecord",(t,e)=>{gc.init(t,e),ye.init(t,e),t.keyType=e.keyType,t.valueType=e.valueType});function pe(t,e,r){return new rw({type:"record",keyType:t,valueType:e,...J.normalizeParams(r)})}var xl=v("ZodEnum",(t,e)=>{yc.init(t,e),ye.init(t,e),t.enum=e.entries,t.options=Object.values(e.entries);let r=new Set(Object.keys(e.entries));t.extract=(n,o)=>{let s={};for(let i of n)if(r.has(i))s[i]=e.entries[i];else throw new Error(`Key ${i} not found in enum`);return new xl({...e,checks:[],...J.normalizeParams(o),entries:s})},t.exclude=(n,o)=>{let s={...e.entries};for(let i of n)if(r.has(i))delete s[i];else throw new Error(`Key ${i} not found in enum`);return new xl({...e,checks:[],...J.normalizeParams(o),entries:s})}});function He(t,e){let r=Array.isArray(t)?Object.fromEntries(t.map(n=>[n,n])):t;return new xl({type:"enum",entries:r,...J.normalizeParams(e)})}var nw=v("ZodLiteral",(t,e)=>{_c.init(t,e),ye.init(t,e),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function A(t,e){return new nw({type:"literal",values:Array.isArray(t)?t:[t],...J.normalizeParams(e)})}var ow=v("ZodTransform",(t,e)=>{vc.init(t,e),ye.init(t,e),t._zod.parse=(r,n)=>{r.addIssue=s=>{if(typeof s=="string")r.issues.push(J.issue(s,r.value,e));else{let i=s;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=t),i.continue??(i.continue=!0),r.issues.push(J.issue(i))}};let o=e.transform(r.value,r);return o instanceof Promise?o.then(s=>(r.value=s,r)):(r.value=o,r)}});function hm(t){return new ow({type:"transform",transform:t})}var gm=v("ZodOptional",(t,e)=>{bc.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType});function ge(t){return new gm({type:"optional",innerType:t})}var sw=v("ZodNullable",(t,e)=>{xc.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType});function um(t){return new sw({type:"nullable",innerType:t})}var iw=v("ZodDefault",(t,e)=>{wc.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function aw(t,e){return new iw({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}var cw=v("ZodPrefault",(t,e)=>{Sc.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType});function lw(t,e){return new cw({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}var ym=v("ZodNonOptional",(t,e)=>{$c.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType});function uw(t,e){return new ym({type:"nonoptional",innerType:t,...J.normalizeParams(e)})}var dw=v("ZodCatch",(t,e)=>{kc.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function fw(t,e){return new dw({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}var pw=v("ZodPipe",(t,e)=>{Tc.init(t,e),ye.init(t,e),t.in=e.in,t.out=e.out});function wl(t,e){return new pw({type:"pipe",in:t,out:e})}var mw=v("ZodReadonly",(t,e)=>{Ec.init(t,e),ye.init(t,e)});function hw(t){return new mw({type:"readonly",innerType:t})}var _m=v("ZodCustom",(t,e)=>{Ic.init(t,e),ye.init(t,e)});function gw(t){let e=new $e({check:"custom"});return e._zod.check=t,e}function vm(t,e){return pl(_m,t??(()=>!0),e)}function yw(t,e={}){return ml(_m,t,e)}function _w(t){let e=gw(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(J.issue(n,r.value,e._zod.def));else{let o=n;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=e),o.continue??(o.continue=!e._zod.def.abort),r.issues.push(J.issue(o))}},t(r.value,r)));return e}function kl(t,e){return wl(hm(t),e)}Xe(qp());var El="2025-11-25";var bm=[El,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],ir="io.modelcontextprotocol/related-task",Cs="2.0",ke=vm(t=>t!==null&&(typeof t=="object"||typeof t=="function")),xm=ce([_(),re().int()]),wm=_(),zR=je({ttl:ce([re(),Sl()]).optional(),pollInterval:re().optional()}),vw=P({ttl:re().optional()}),bw=P({taskId:_()}),Il=je({progressToken:xm.optional(),[ir]:bw.optional()}),Qe=P({_meta:Il.optional()}),co=Qe.extend({task:vw.optional()}),Sm=t=>co.safeParse(t).success,Te=P({method:_(),params:Qe.loose().optional()}),ot=P({_meta:Il.optional()}),st=P({method:_(),params:ot.loose().optional()}),Ee=je({_meta:Il.optional()}),As=ce([_(),re().int()]),$m=P({jsonrpc:A(Cs),id:As,...Te.shape}).strict(),zl=t=>$m.safeParse(t).success,km=P({jsonrpc:A(Cs),...st.shape}).strict(),Tm=t=>km.safeParse(t).success,Pl=P({jsonrpc:A(Cs),id:As,result:Ee}).strict(),lo=t=>Pl.safeParse(t).success;var D;(function(t){t[t.ConnectionClosed=-32e3]="ConnectionClosed",t[t.RequestTimeout=-32001]="RequestTimeout",t[t.ParseError=-32700]="ParseError",t[t.InvalidRequest=-32600]="InvalidRequest",t[t.MethodNotFound=-32601]="MethodNotFound",t[t.InvalidParams=-32602]="InvalidParams",t[t.InternalError=-32603]="InternalError",t[t.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(D||(D={}));var Nl=P({jsonrpc:A(Cs),id:As.optional(),error:P({code:re().int(),message:_(),data:fe().optional()})}).strict();var Em=t=>Nl.safeParse(t).success;var Im=ce([$m,km,Pl,Nl]),PR=ce([Pl,Nl]),Ms=Ee.strict(),xw=ot.extend({requestId:As.optional(),reason:_().optional()}),Ds=st.extend({method:A("notifications/cancelled"),params:xw}),ww=P({src:_(),mimeType:_().optional(),sizes:K(_()).optional(),theme:He(["light","dark"]).optional()}),uo=P({icons:K(ww).optional()}),_n=P({name:_(),title:_().optional()}),zm=_n.extend({..._n.shape,...uo.shape,version:_(),websiteUrl:_().optional(),description:_().optional()}),Sw=Os(P({applyDefaults:xe().optional()}),pe(_(),fe())),$w=kl(t=>t&&typeof t=="object"&&!Array.isArray(t)&&Object.keys(t).length===0?{form:{}}:t,Os(P({form:Sw.optional(),url:ke.optional()}),pe(_(),fe()).optional())),kw=je({list:ke.optional(),cancel:ke.optional(),requests:je({sampling:je({createMessage:ke.optional()}).optional(),elicitation:je({create:ke.optional()}).optional()}).optional()}),Tw=je({list:ke.optional(),cancel:ke.optional(),requests:je({tools:je({call:ke.optional()}).optional()}).optional()}),Ew=P({experimental:pe(_(),ke).optional(),sampling:P({context:ke.optional(),tools:ke.optional()}).optional(),elicitation:$w.optional(),roots:P({listChanged:xe().optional()}).optional(),tasks:kw.optional()}),Iw=Qe.extend({protocolVersion:_(),capabilities:Ew,clientInfo:zm}),Ol=Te.extend({method:A("initialize"),params:Iw});var zw=P({experimental:pe(_(),ke).optional(),logging:ke.optional(),completions:ke.optional(),prompts:P({listChanged:xe().optional()}).optional(),resources:P({subscribe:xe().optional(),listChanged:xe().optional()}).optional(),tools:P({listChanged:xe().optional()}).optional(),tasks:Tw.optional()}),Pw=Ee.extend({protocolVersion:_(),capabilities:zw,serverInfo:zm,instructions:_().optional()}),Rl=st.extend({method:A("notifications/initialized"),params:ot.optional()});var js=Te.extend({method:A("ping"),params:Qe.optional()}),Nw=P({progress:re(),total:ge(re()),message:ge(_())}),Ow=P({...ot.shape,...Nw.shape,progressToken:xm}),Ls=st.extend({method:A("notifications/progress"),params:Ow}),Rw=Qe.extend({cursor:wm.optional()}),fo=Te.extend({params:Rw.optional()}),po=Ee.extend({nextCursor:wm.optional()}),Cw=He(["working","input_required","completed","failed","cancelled"]),mo=P({taskId:_(),status:Cw,ttl:ce([re(),Sl()]),createdAt:_(),lastUpdatedAt:_(),pollInterval:ge(re()),statusMessage:ge(_())}),vn=Ee.extend({task:mo}),Aw=ot.merge(mo),ho=st.extend({method:A("notifications/tasks/status"),params:Aw}),Zs=Te.extend({method:A("tasks/get"),params:Qe.extend({taskId:_()})}),Fs=Ee.merge(mo),Us=Te.extend({method:A("tasks/result"),params:Qe.extend({taskId:_()})}),NR=Ee.loose(),qs=fo.extend({method:A("tasks/list")}),Vs=po.extend({tasks:K(mo)}),Bs=Te.extend({method:A("tasks/cancel"),params:Qe.extend({taskId:_()})}),Pm=Ee.merge(mo),Nm=P({uri:_(),mimeType:ge(_()),_meta:pe(_(),fe()).optional()}),Om=Nm.extend({text:_()}),Cl=_().refine(t=>{try{return atob(t),!0}catch{return!1}},{message:"Invalid Base64 string"}),Rm=Nm.extend({blob:Cl}),go=He(["user","assistant"]),bn=P({audience:K(go).optional(),priority:re().min(0).max(1).optional(),lastModified:io.datetime({offset:!0}).optional()}),Cm=P({..._n.shape,...uo.shape,uri:_(),description:ge(_()),mimeType:ge(_()),annotations:bn.optional(),_meta:ge(je({}))}),Mw=P({..._n.shape,...uo.shape,uriTemplate:_(),description:ge(_()),mimeType:ge(_()),annotations:bn.optional(),_meta:ge(je({}))}),Hs=fo.extend({method:A("resources/list")}),Dw=po.extend({resources:K(Cm)}),Gs=fo.extend({method:A("resources/templates/list")}),jw=po.extend({resourceTemplates:K(Mw)}),Al=Qe.extend({uri:_()}),Lw=Al,Ws=Te.extend({method:A("resources/read"),params:Lw}),Zw=Ee.extend({contents:K(ce([Om,Rm]))}),Fw=st.extend({method:A("notifications/resources/list_changed"),params:ot.optional()}),Uw=Al,qw=Te.extend({method:A("resources/subscribe"),params:Uw}),Vw=Al,Bw=Te.extend({method:A("resources/unsubscribe"),params:Vw}),Hw=ot.extend({uri:_()}),Gw=st.extend({method:A("notifications/resources/updated"),params:Hw}),Ww=P({name:_(),description:ge(_()),required:ge(xe())}),Jw=P({..._n.shape,...uo.shape,description:ge(_()),arguments:ge(K(Ww)),_meta:ge(je({}))}),Js=fo.extend({method:A("prompts/list")}),Kw=po.extend({prompts:K(Jw)}),Xw=Qe.extend({name:_(),arguments:pe(_(),_()).optional()}),Ks=Te.extend({method:A("prompts/get"),params:Xw}),Ml=P({type:A("text"),text:_(),annotations:bn.optional(),_meta:pe(_(),fe()).optional()}),Dl=P({type:A("image"),data:Cl,mimeType:_(),annotations:bn.optional(),_meta:pe(_(),fe()).optional()}),jl=P({type:A("audio"),data:Cl,mimeType:_(),annotations:bn.optional(),_meta:pe(_(),fe()).optional()}),Yw=P({type:A("tool_use"),name:_(),id:_(),input:pe(_(),fe()),_meta:pe(_(),fe()).optional()}),Qw=P({type:A("resource"),resource:ce([Om,Rm]),annotations:bn.optional(),_meta:pe(_(),fe()).optional()}),eS=Cm.extend({type:A("resource_link")}),Ll=ce([Ml,Dl,jl,eS,Qw]),tS=P({role:go,content:Ll}),rS=Ee.extend({description:_().optional(),messages:K(tS)}),nS=st.extend({method:A("notifications/prompts/list_changed"),params:ot.optional()}),oS=P({title:_().optional(),readOnlyHint:xe().optional(),destructiveHint:xe().optional(),idempotentHint:xe().optional(),openWorldHint:xe().optional()}),sS=P({taskSupport:He(["required","optional","forbidden"]).optional()}),Am=P({..._n.shape,...uo.shape,description:_().optional(),inputSchema:P({type:A("object"),properties:pe(_(),ke).optional(),required:K(_()).optional()}).catchall(fe()),outputSchema:P({type:A("object"),properties:pe(_(),ke).optional(),required:K(_()).optional()}).catchall(fe()).optional(),annotations:oS.optional(),execution:sS.optional(),_meta:pe(_(),fe()).optional()}),Xs=fo.extend({method:A("tools/list")}),iS=po.extend({tools:K(Am)}),Ys=Ee.extend({content:K(Ll).default([]),structuredContent:pe(_(),fe()).optional(),isError:xe().optional()}),OR=Ys.or(Ee.extend({toolResult:fe()})),aS=co.extend({name:_(),arguments:pe(_(),fe()).optional()}),xn=Te.extend({method:A("tools/call"),params:aS}),cS=st.extend({method:A("notifications/tools/list_changed"),params:ot.optional()}),RR=P({autoRefresh:xe().default(!0),debounceMs:re().int().nonnegative().default(300)}),yo=He(["debug","info","notice","warning","error","critical","alert","emergency"]),lS=Qe.extend({level:yo}),Zl=Te.extend({method:A("logging/setLevel"),params:lS}),uS=ot.extend({level:yo,logger:_().optional(),data:fe()}),dS=st.extend({method:A("notifications/message"),params:uS}),fS=P({name:_().optional()}),pS=P({hints:K(fS).optional(),costPriority:re().min(0).max(1).optional(),speedPriority:re().min(0).max(1).optional(),intelligencePriority:re().min(0).max(1).optional()}),mS=P({mode:He(["auto","required","none"]).optional()}),hS=P({type:A("tool_result"),toolUseId:_().describe("The unique identifier for the corresponding tool call."),content:K(Ll).default([]),structuredContent:P({}).loose().optional(),isError:xe().optional(),_meta:pe(_(),fe()).optional()}),gS=$l("type",[Ml,Dl,jl]),Rs=$l("type",[Ml,Dl,jl,Yw,hS]),yS=P({role:go,content:ce([Rs,K(Rs)]),_meta:pe(_(),fe()).optional()}),_S=co.extend({messages:K(yS),modelPreferences:pS.optional(),systemPrompt:_().optional(),includeContext:He(["none","thisServer","allServers"]).optional(),temperature:re().optional(),maxTokens:re().int(),stopSequences:K(_()).optional(),metadata:ke.optional(),tools:K(Am).optional(),toolChoice:mS.optional()}),vS=Te.extend({method:A("sampling/createMessage"),params:_S}),Fl=Ee.extend({model:_(),stopReason:ge(He(["endTurn","stopSequence","maxTokens"]).or(_())),role:go,content:gS}),Ul=Ee.extend({model:_(),stopReason:ge(He(["endTurn","stopSequence","maxTokens","toolUse"]).or(_())),role:go,content:ce([Rs,K(Rs)])}),bS=P({type:A("boolean"),title:_().optional(),description:_().optional(),default:xe().optional()}),xS=P({type:A("string"),title:_().optional(),description:_().optional(),minLength:re().optional(),maxLength:re().optional(),format:He(["email","uri","date","date-time"]).optional(),default:_().optional()}),wS=P({type:He(["number","integer"]),title:_().optional(),description:_().optional(),minimum:re().optional(),maximum:re().optional(),default:re().optional()}),SS=P({type:A("string"),title:_().optional(),description:_().optional(),enum:K(_()),default:_().optional()}),$S=P({type:A("string"),title:_().optional(),description:_().optional(),oneOf:K(P({const:_(),title:_()})),default:_().optional()}),kS=P({type:A("string"),title:_().optional(),description:_().optional(),enum:K(_()),enumNames:K(_()).optional(),default:_().optional()}),TS=ce([SS,$S]),ES=P({type:A("array"),title:_().optional(),description:_().optional(),minItems:re().optional(),maxItems:re().optional(),items:P({type:A("string"),enum:K(_())}),default:K(_()).optional()}),IS=P({type:A("array"),title:_().optional(),description:_().optional(),minItems:re().optional(),maxItems:re().optional(),items:P({anyOf:K(P({const:_(),title:_()}))}),default:K(_()).optional()}),zS=ce([ES,IS]),PS=ce([kS,TS,zS]),NS=ce([PS,bS,xS,wS]),OS=co.extend({mode:A("form").optional(),message:_(),requestedSchema:P({type:A("object"),properties:pe(_(),NS),required:K(_()).optional()})}),RS=co.extend({mode:A("url"),message:_(),elicitationId:_(),url:_().url()}),CS=ce([OS,RS]),AS=Te.extend({method:A("elicitation/create"),params:CS}),MS=ot.extend({elicitationId:_()}),DS=st.extend({method:A("notifications/elicitation/complete"),params:MS}),Qs=Ee.extend({action:He(["accept","decline","cancel"]),content:kl(t=>t===null?void 0:t,pe(_(),ce([_(),re(),xe(),K(_())])).optional())}),jS=P({type:A("ref/resource"),uri:_()});var LS=P({type:A("ref/prompt"),name:_()}),ZS=Qe.extend({ref:ce([LS,jS]),argument:P({name:_(),value:_()}),context:P({arguments:pe(_(),_()).optional()}).optional()}),ei=Te.extend({method:A("completion/complete"),params:ZS});function Mm(t){if(t.params.ref.type!=="ref/prompt")throw new TypeError(`Expected CompleteRequestPrompt, but got ${t.params.ref.type}`)}function Dm(t){if(t.params.ref.type!=="ref/resource")throw new TypeError(`Expected CompleteRequestResourceTemplate, but got ${t.params.ref.type}`)}var FS=Ee.extend({completion:je({values:K(_()).max(100),total:ge(re().int()),hasMore:ge(xe())})}),US=P({uri:_().startsWith("file://"),name:_().optional(),_meta:pe(_(),fe()).optional()}),qS=Te.extend({method:A("roots/list"),params:Qe.optional()}),ql=Ee.extend({roots:K(US)}),VS=st.extend({method:A("notifications/roots/list_changed"),params:ot.optional()}),CR=ce([js,Ol,ei,Zl,Ks,Js,Hs,Gs,Ws,qw,Bw,xn,Xs,Zs,Us,qs,Bs]),AR=ce([Ds,Ls,Rl,VS,ho]),MR=ce([Ms,Fl,Ul,Qs,ql,Fs,Vs,vn]),DR=ce([js,vS,AS,qS,Zs,Us,qs,Bs]),jR=ce([Ds,Ls,dS,Gw,Fw,cS,nS,ho,DS]),LR=ce([Ms,Pw,FS,rS,Kw,Dw,jw,Zw,Ys,iS,Fs,Vs,vn]),R=class t extends Error{constructor(e,r,n){super(`MCP error ${e}: ${r}`),this.code=e,this.data=n,this.name="McpError"}static fromError(e,r,n){if(e===D.UrlElicitationRequired&&n){let o=n;if(o.elicitations)return new Tl(o.elicitations,r)}return new t(e,r,n)}},Tl=class extends R{constructor(e,r=`URL elicitation${e.length>1?"s":""} required`){super(D.UrlElicitationRequired,r,{elicitations:e})}get elicitations(){return this.data?.elicitations??[]}};function ar(t){return t==="completed"||t==="failed"||t==="cancelled"}var Lm=Symbol("Let zodToJsonSchema decide on which parser to use");var jm={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Zm=t=>typeof t=="string"?{...jm,name:t}:{...jm,...t};var Fm=t=>{let e=Zm(t),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,o])=>[o._def,{def:o._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function Vl(t,e,r,n){n?.errorMessages&&r&&(t.errorMessage={...t.errorMessage,[e]:r})}function X(t,e,r,n,o){t[e]=r,Vl(t,e,n,o)}var ti=(t,e)=>{let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);return[(t.length-r).toString(),...e.slice(r)].join("/")};function me(t){if(t.target!=="openAi")return{};let e=[...t.basePath,t.definitionPath,t.openAiAnyTypeName];return t.flags.hasReferencedOpenAiAnyType=!0,{$ref:t.$refStrategy==="relative"?ti(e,t.currentPath):e.join("/")}}function Um(t,e){let r={type:"array"};return t.type?._def&&t.type?._def?.typeName!==$.ZodAny&&(r.items=Z(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&X(r,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&X(r,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(X(r,"minItems",t.exactLength.value,t.exactLength.message,e),X(r,"maxItems",t.exactLength.value,t.exactLength.message,e)),r}function qm(t,e){let r={type:"integer",format:"int64"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?X(r,"minimum",n.value,n.message,e):X(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),X(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?X(r,"maximum",n.value,n.message,e):X(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),X(r,"maximum",n.value,n.message,e));break;case"multipleOf":X(r,"multipleOf",n.value,n.message,e);break}return r}function Vm(){return{type:"boolean"}}function ri(t,e){return Z(t.type._def,e)}var Bm=(t,e)=>Z(t.innerType._def,e);function Bl(t,e,r){let n=r??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((o,s)=>Bl(t,e,o))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return BS(t,e)}}var BS=(t,e)=>{let r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(let n of t.checks)switch(n.kind){case"min":X(r,"minimum",n.value,n.message,e);break;case"max":X(r,"maximum",n.value,n.message,e);break}return r};function Hm(t,e){return{...Z(t.innerType._def,e),default:t.defaultValue()}}function Gm(t,e){return e.effectStrategy==="input"?Z(t.schema._def,e):me(e)}function Wm(t){return{type:"string",enum:Array.from(t.values)}}var HS=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function Jm(t,e){let r=[Z(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Z(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,o=[];return r.forEach(s=>{if(HS(s))o.push(...s.allOf),s.unevaluatedProperties===void 0&&(n=void 0);else{let i=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:a,...c}=s;i=c}else n=void 0;o.push(i)}}),o.length?{allOf:o,...n}:void 0}function Km(t,e){let r=typeof t.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[t.value]}:{type:r==="bigint"?"integer":r,const:t.value}}var Hl,ht={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Hl===void 0&&(Hl=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Hl),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function ni(t,e){let r={type:"string"};if(t.checks)for(let n of t.checks)switch(n.kind){case"min":X(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e);break;case"max":X(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":gt(r,"email",n.message,e);break;case"format:idn-email":gt(r,"idn-email",n.message,e);break;case"pattern:zod":Le(r,ht.email,n.message,e);break}break;case"url":gt(r,"uri",n.message,e);break;case"uuid":gt(r,"uuid",n.message,e);break;case"regex":Le(r,n.regex,n.message,e);break;case"cuid":Le(r,ht.cuid,n.message,e);break;case"cuid2":Le(r,ht.cuid2,n.message,e);break;case"startsWith":Le(r,RegExp(`^${Gl(n.value,e)}`),n.message,e);break;case"endsWith":Le(r,RegExp(`${Gl(n.value,e)}$`),n.message,e);break;case"datetime":gt(r,"date-time",n.message,e);break;case"date":gt(r,"date",n.message,e);break;case"time":gt(r,"time",n.message,e);break;case"duration":gt(r,"duration",n.message,e);break;case"length":X(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e),X(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"includes":{Le(r,RegExp(Gl(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&gt(r,"ipv4",n.message,e),n.version!=="v4"&&gt(r,"ipv6",n.message,e);break}case"base64url":Le(r,ht.base64url,n.message,e);break;case"jwt":Le(r,ht.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&Le(r,ht.ipv4Cidr,n.message,e),n.version!=="v4"&&Le(r,ht.ipv6Cidr,n.message,e);break}case"emoji":Le(r,ht.emoji(),n.message,e);break;case"ulid":{Le(r,ht.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{gt(r,"binary",n.message,e);break}case"contentEncoding:base64":{X(r,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{Le(r,ht.base64,n.message,e);break}}break}case"nanoid":Le(r,ht.nanoid,n.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}function Gl(t,e){return e.patternStrategy==="escape"?WS(t):t}var GS=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function WS(t){let e="";for(let r=0;r<t.length;r++)GS.has(t[r])||(e+="\\"),e+=t[r];return e}function gt(t,e,r,n){t.format||t.anyOf?.some(o=>o.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&n.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...r&&n.errorMessages&&{errorMessage:{format:r}}})):X(t,"format",e,r,n)}function Le(t,e,r,n){t.pattern||t.allOf?.some(o=>o.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&n.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:Xm(e,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):X(t,"pattern",Xm(e,n),r,n)}function Xm(t,e){if(!e.applyRegexFlags||!t.flags)return t.source;let r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},n=r.i?t.source.toLowerCase():t.source,o="",s=!1,i=!1,a=!1;for(let c=0;c<n.length;c++){if(s){o+=n[c],s=!1;continue}if(r.i){if(i){if(n[c].match(/[a-z]/)){a?(o+=n[c],o+=`${n[c-2]}-${n[c]}`.toUpperCase(),a=!1):n[c+1]==="-"&&n[c+2]?.match(/[a-z]/)?(o+=n[c],a=!0):o+=`${n[c]}${n[c].toUpperCase()}`;continue}}else if(n[c].match(/[a-z]/)){o+=`[${n[c]}${n[c].toUpperCase()}]`;continue}}if(r.m){if(n[c]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(n[c]==="$"){o+=`($|(?=[\r
]))`;continue}}if(r.s&&n[c]==="."){o+=i?`${n[c]}\r
`:`[${n[c]}\r
]`;continue}o+=n[c],n[c]==="\\"?s=!0:i&&n[c]==="]"?i=!1:!i&&n[c]==="["&&(i=!0)}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return o}function oi(t,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&t.keyType?._def.typeName===$.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((n,o)=>({...n,[o]:Z(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",o]})??me(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let r={type:"object",additionalProperties:Z(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return r;if(t.keyType?._def.typeName===$.ZodString&&t.keyType._def.checks?.length){let{type:n,...o}=ni(t.keyType._def,e);return{...r,propertyNames:o}}else{if(t.keyType?._def.typeName===$.ZodEnum)return{...r,propertyNames:{enum:t.keyType._def.values}};if(t.keyType?._def.typeName===$.ZodBranded&&t.keyType._def.type._def.typeName===$.ZodString&&t.keyType._def.type._def.checks?.length){let{type:n,...o}=ri(t.keyType._def,e);return{...r,propertyNames:o}}}return r}function Ym(t,e){if(e.mapStrategy==="record")return oi(t,e);let r=Z(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||me(e),n=Z(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||me(e);return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function Qm(t){let e=t.values,n=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),o=Array.from(new Set(n.map(s=>typeof s)));return{type:o.length===1?o[0]==="string"?"string":"number":["string","number"],enum:n}}function eh(t){return t.target==="openAi"?void 0:{not:me({...t,currentPath:[...t.currentPath,"not"]})}}function th(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var _o={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function nh(t,e){if(e.target==="openApi3")return rh(t,e);let r=t.options instanceof Map?Array.from(t.options.values()):t.options;if(r.every(n=>n._def.typeName in _o&&(!n._def.checks||!n._def.checks.length))){let n=r.reduce((o,s)=>{let i=_o[s._def.typeName];return i&&!o.includes(i)?[...o,i]:o},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=r.reduce((o,s)=>{let i=typeof s._def.value;switch(i){case"string":case"number":case"boolean":return[...o,i];case"bigint":return[...o,"integer"];case"object":if(s._def.value===null)return[...o,"null"];case"symbol":case"undefined":case"function":default:return o}},[]);if(n.length===r.length){let o=n.filter((s,i,a)=>a.indexOf(s)===i);return{type:o.length>1?o:o[0],enum:r.reduce((s,i)=>s.includes(i._def.value)?s:[...s,i._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,o)=>[...n,...o._def.values.filter(s=>!n.includes(s))],[])};return rh(t,e)}var rh=(t,e)=>{let r=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((n,o)=>Z(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${o}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function oh(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:_o[t.innerType._def.typeName],nullable:!0}:{type:[_o[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=Z(t.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let r=Z(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function sh(t,e){let r={type:"number"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"int":r.type="integer",Vl(r,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?X(r,"minimum",n.value,n.message,e):X(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),X(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?X(r,"maximum",n.value,n.message,e):X(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),X(r,"maximum",n.value,n.message,e));break;case"multipleOf":X(r,"multipleOf",n.value,n.message,e);break}return r}function ih(t,e){let r=e.target==="openAi",n={type:"object",properties:{}},o=[],s=t.shape();for(let a in s){let c=s[a];if(c===void 0||c._def===void 0)continue;let l=KS(c);l&&r&&(c._def.typeName==="ZodOptional"&&(c=c._def.innerType),c.isNullable()||(c=c.nullable()),l=!1);let u=Z(c._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});u!==void 0&&(n.properties[a]=u,l||o.push(a))}o.length&&(n.required=o);let i=JS(t,e);return i!==void 0&&(n.additionalProperties=i),n}function JS(t,e){if(t.catchall._def.typeName!=="ZodNever")return Z(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function KS(t){try{return t.isOptional()}catch{return!0}}var ah=(t,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return Z(t.innerType._def,e);let r=Z(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:me(e)},r]}:me(e)};var ch=(t,e)=>{if(e.pipeStrategy==="input")return Z(t.in._def,e);if(e.pipeStrategy==="output")return Z(t.out._def,e);let r=Z(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Z(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(o=>o!==void 0)}};function lh(t,e){return Z(t.type._def,e)}function uh(t,e){let n={type:"array",uniqueItems:!0,items:Z(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&X(n,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&X(n,"maxItems",t.maxSize.value,t.maxSize.message,e),n}function dh(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((r,n)=>Z(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:Z(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((r,n)=>Z(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function fh(t){return{not:me(t)}}function ph(t){return me(t)}var mh=(t,e)=>Z(t.innerType._def,e);var hh=(t,e,r)=>{switch(e){case $.ZodString:return ni(t,r);case $.ZodNumber:return sh(t,r);case $.ZodObject:return ih(t,r);case $.ZodBigInt:return qm(t,r);case $.ZodBoolean:return Vm();case $.ZodDate:return Bl(t,r);case $.ZodUndefined:return fh(r);case $.ZodNull:return th(r);case $.ZodArray:return Um(t,r);case $.ZodUnion:case $.ZodDiscriminatedUnion:return nh(t,r);case $.ZodIntersection:return Jm(t,r);case $.ZodTuple:return dh(t,r);case $.ZodRecord:return oi(t,r);case $.ZodLiteral:return Km(t,r);case $.ZodEnum:return Wm(t);case $.ZodNativeEnum:return Qm(t);case $.ZodNullable:return oh(t,r);case $.ZodOptional:return ah(t,r);case $.ZodMap:return Ym(t,r);case $.ZodSet:return uh(t,r);case $.ZodLazy:return()=>t.getter()._def;case $.ZodPromise:return lh(t,r);case $.ZodNaN:case $.ZodNever:return eh(r);case $.ZodEffects:return Gm(t,r);case $.ZodAny:return me(r);case $.ZodUnknown:return ph(r);case $.ZodDefault:return Hm(t,r);case $.ZodBranded:return ri(t,r);case $.ZodReadonly:return mh(t,r);case $.ZodCatch:return Bm(t,r);case $.ZodPipeline:return ch(t,r);case $.ZodFunction:case $.ZodVoid:case $.ZodSymbol:return;default:return(n=>{})(e)}};function Z(t,e,r=!1){let n=e.seen.get(t);if(e.override){let a=e.override?.(t,e,n,r);if(a!==Lm)return a}if(n&&!r){let a=XS(n,e);if(a!==void 0)return a}let o={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,o);let s=hh(t,t.typeName,e),i=typeof s=="function"?Z(s(),e):s;if(i&&YS(t,e,i),e.postProcess){let a=e.postProcess(i,t,e);return o.jsonSchema=i,a}return o.jsonSchema=i,i}var XS=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:ti(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,n)=>e.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),me(e)):e.$refStrategy==="seen"?me(e):void 0}},YS=(t,e,r)=>(t.description&&(r.description=t.description,e.markdownDescription&&(r.markdownDescription=t.description)),r);var Wl=(t,e)=>{let r=Fm(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((c,[l,u])=>({...c,[l]:Z(u._def,{...r,currentPath:[...r.basePath,r.definitionPath,l]},!0)??me(r)}),{}):void 0,o=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,s=Z(t._def,o===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,o]},!1)??me(r),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i),r.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[r.openAiAnyTypeName]||(n[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:r.$refStrategy==="relative"?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));let a=o===void 0?n?{...s,[r.definitionPath]:n}:s:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,o].join("/"),[r.definitionPath]:{...n,[o]:s}};return r.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function QS(t){return!t||t==="jsonSchema7"||t==="draft-7"?"draft-7":t==="jsonSchema2019-09"||t==="draft-2020-12"?"draft-2020-12":"draft-7"}function Jl(t,e){return nt(t)?hl(t,{target:QS(e?.target),io:e?.pipeStrategy??"input"}):Wl(t,{strictUnions:e?.strictUnions??!0,pipeStrategy:e?.pipeStrategy??"input"})}function Kl(t){let r=sr(t)?.method;if(!r)throw new Error("Schema is missing a method literal");let n=Ps(r);if(typeof n!="string")throw new Error("Schema method literal must be a string");return n}function Xl(t,e){let r=or(t,e);if(!r.success)throw r.error;return r.data}var e$=6e4,si=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(Ds,r=>{this._oncancel(r)}),this.setNotificationHandler(Ls,r=>{this._onprogress(r)}),this.setRequestHandler(js,r=>({})),this._taskStore=e?.taskStore,this._taskMessageQueue=e?.taskMessageQueue,this._taskStore&&(this.setRequestHandler(Zs,async(r,n)=>{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new R(D.InvalidParams,"Failed to retrieve task: Task not found");return{...o}}),this.setRequestHandler(Us,async(r,n)=>{let o=async()=>{let s=r.params.taskId;if(this._taskMessageQueue){let a;for(;a=await this._taskMessageQueue.dequeue(s,n.sessionId);){if(a.type==="response"||a.type==="error"){let c=a.message,l=c.id,u=this._requestResolvers.get(l);if(u)if(this._requestResolvers.delete(l),a.type==="response")u(c);else{let d=c,g=new R(d.error.code,d.error.message,d.error.data);u(g)}else{let d=a.type==="response"?"Response":"Error";this._onerror(new Error(`${d} handler missing for request ${l}`))}continue}await this._transport?.send(a.message,{relatedRequestId:n.requestId})}}let i=await this._taskStore.getTask(s,n.sessionId);if(!i)throw new R(D.InvalidParams,`Task not found: ${s}`);if(!ar(i.status))return await this._waitForTaskUpdate(s,n.signal),await o();if(ar(i.status)){let a=await this._taskStore.getTaskResult(s,n.sessionId);return this._clearTaskQueue(s),{...a,_meta:{...a._meta,[ir]:{taskId:s}}}}return await o()};return await o()}),this.setRequestHandler(qs,async(r,n)=>{try{let{tasks:o,nextCursor:s}=await this._taskStore.listTasks(r.params?.cursor,n.sessionId);return{tasks:o,nextCursor:s,_meta:{}}}catch(o){throw new R(D.InvalidParams,`Failed to list tasks: ${o instanceof Error?o.message:String(o)}`)}}),this.setRequestHandler(Bs,async(r,n)=>{try{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new R(D.InvalidParams,`Task not found: ${r.params.taskId}`);if(ar(o.status))throw new R(D.InvalidParams,`Cannot cancel task in terminal status: ${o.status}`);await this._taskStore.updateTaskStatus(r.params.taskId,"cancelled","Client cancelled task execution.",n.sessionId),this._clearTaskQueue(r.params.taskId);let s=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!s)throw new R(D.InvalidParams,`Task not found after cancellation: ${r.params.taskId}`);return{_meta:{},...s}}catch(o){throw o instanceof R?o:new R(D.InvalidRequest,`Failed to cancel task: ${o instanceof Error?o.message:String(o)}`)}}))}async _oncancel(e){if(!e.params.requestId)return;this._requestHandlerAbortControllers.get(e.params.requestId)?.abort(e.params.reason)}_setupTimeout(e,r,n,o,s=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(o,r),startTime:Date.now(),timeout:r,maxTotalTimeout:n,resetTimeoutOnProgress:s,onTimeout:o})}_resetTimeout(e){let r=this._timeoutInfo.get(e);if(!r)return!1;let n=Date.now()-r.startTime;if(r.maxTotalTimeout&&n>=r.maxTotalTimeout)throw this._timeoutInfo.delete(e),R.fromError(D.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:r.maxTotalTimeout,totalElapsed:n});return clearTimeout(r.timeoutId),r.timeoutId=setTimeout(r.onTimeout,r.timeout),!0}_cleanupTimeout(e){let r=this._timeoutInfo.get(e);r&&(clearTimeout(r.timeoutId),this._timeoutInfo.delete(e))}async connect(e){if(this._transport)throw new Error("Already connected to a transport. Call close() before connecting to a new transport, or use a separate Protocol instance per connection.");this._transport=e;let r=this.transport?.onclose;this._transport.onclose=()=>{r?.(),this._onclose()};let n=this.transport?.onerror;this._transport.onerror=s=>{n?.(s),this._onerror(s)};let o=this._transport?.onmessage;this._transport.onmessage=(s,i)=>{o?.(s,i),lo(s)||Em(s)?this._onresponse(s):zl(s)?this._onrequest(s,i):Tm(s)?this._onnotification(s):this._onerror(new Error(`Unknown message type: ${JSON.stringify(s)}`))},await this._transport.start()}_onclose(){let e=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();for(let n of this._requestHandlerAbortControllers.values())n.abort();this._requestHandlerAbortControllers.clear();let r=R.fromError(D.ConnectionClosed,"Connection closed");this._transport=void 0,this.onclose?.();for(let n of e.values())n(r)}_onerror(e){this.onerror?.(e)}_onnotification(e){let r=this._notificationHandlers.get(e.method)??this.fallbackNotificationHandler;r!==void 0&&Promise.resolve().then(()=>r(e)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(e,r){let n=this._requestHandlers.get(e.method)??this.fallbackRequestHandler,o=this._transport,s=e.params?._meta?.[ir]?.taskId;if(n===void 0){let u={jsonrpc:"2.0",id:e.id,error:{code:D.MethodNotFound,message:"Method not found"}};s&&this._taskMessageQueue?this._enqueueTaskMessage(s,{type:"error",message:u,timestamp:Date.now()},o?.sessionId).catch(d=>this._onerror(new Error(`Failed to enqueue error response: ${d}`))):o?.send(u).catch(d=>this._onerror(new Error(`Failed to send an error response: ${d}`)));return}let i=new AbortController;this._requestHandlerAbortControllers.set(e.id,i);let a=Sm(e.params)?e.params.task:void 0,c=this._taskStore?this.requestTaskStore(e,o?.sessionId):void 0,l={signal:i.signal,sessionId:o?.sessionId,_meta:e.params?._meta,sendNotification:async u=>{if(i.signal.aborted)return;let d={relatedRequestId:e.id};s&&(d.relatedTask={taskId:s}),await this.notification(u,d)},sendRequest:async(u,d,g)=>{if(i.signal.aborted)throw new R(D.ConnectionClosed,"Request was cancelled");let h={...g,relatedRequestId:e.id};s&&!h.relatedTask&&(h.relatedTask={taskId:s});let f=h.relatedTask?.taskId??s;return f&&c&&await c.updateTaskStatus(f,"input_required"),await this.request(u,d,h)},authInfo:r?.authInfo,requestId:e.id,requestInfo:r?.requestInfo,taskId:s,taskStore:c,taskRequestedTtl:a?.ttl,closeSSEStream:r?.closeSSEStream,closeStandaloneSSEStream:r?.closeStandaloneSSEStream};Promise.resolve().then(()=>{a&&this.assertTaskHandlerCapability(e.method)}).then(()=>n(e,l)).then(async u=>{if(i.signal.aborted)return;let d={result:u,jsonrpc:"2.0",id:e.id};s&&this._taskMessageQueue?await this._enqueueTaskMessage(s,{type:"response",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)},async u=>{if(i.signal.aborted)return;let d={jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(u.code)?u.code:D.InternalError,message:u.message??"Internal error",...u.data!==void 0&&{data:u.data}}};s&&this._taskMessageQueue?await this._enqueueTaskMessage(s,{type:"error",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)}).catch(u=>this._onerror(new Error(`Failed to send response: ${u}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){let{progressToken:r,...n}=e.params,o=Number(r),s=this._progressHandlers.get(o);if(!s){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}let i=this._responseHandlers.get(o),a=this._timeoutInfo.get(o);if(a&&i&&a.resetTimeoutOnProgress)try{this._resetTimeout(o)}catch(c){this._responseHandlers.delete(o),this._progressHandlers.delete(o),this._cleanupTimeout(o),i(c);return}s(n)}_onresponse(e){let r=Number(e.id),n=this._requestResolvers.get(r);if(n){if(this._requestResolvers.delete(r),lo(e))n(e);else{let i=new R(e.error.code,e.error.message,e.error.data);n(i)}return}let o=this._responseHandlers.get(r);if(o===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}this._responseHandlers.delete(r),this._cleanupTimeout(r);let s=!1;if(lo(e)&&e.result&&typeof e.result=="object"){let i=e.result;if(i.task&&typeof i.task=="object"){let a=i.task;typeof a.taskId=="string"&&(s=!0,this._taskProgressTokens.set(a.taskId,r))}}if(s||this._progressHandlers.delete(r),lo(e))o(e);else{let i=R.fromError(e.error.code,e.error.message,e.error.data);o(i)}}get transport(){return this._transport}async close(){await this._transport?.close()}async*requestStream(e,r,n){let{task:o}=n??{};if(!o){try{yield{type:"result",result:await this.request(e,r,n)}}catch(i){yield{type:"error",error:i instanceof R?i:new R(D.InternalError,String(i))}}return}let s;try{let i=await this.request(e,vn,n);if(i.task)s=i.task.taskId,yield{type:"taskCreated",task:i.task};else throw new R(D.InternalError,"Task creation did not return a task");for(;;){let a=await this.getTask({taskId:s},n);if(yield{type:"taskStatus",task:a},ar(a.status)){a.status==="completed"?yield{type:"result",result:await this.getTaskResult({taskId:s},r,n)}:a.status==="failed"?yield{type:"error",error:new R(D.InternalError,`Task ${s} failed`)}:a.status==="cancelled"&&(yield{type:"error",error:new R(D.InternalError,`Task ${s} was cancelled`)});return}if(a.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:s},r,n)};return}let c=a.pollInterval??this._options?.defaultTaskPollInterval??1e3;await new Promise(l=>setTimeout(l,c)),n?.signal?.throwIfAborted()}}catch(i){yield{type:"error",error:i instanceof R?i:new R(D.InternalError,String(i))}}}request(e,r,n){let{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i,task:a,relatedTask:c}=n??{};return new Promise((l,u)=>{let d=x=>{u(x)};if(!this._transport){d(new Error("Not connected"));return}if(this._options?.enforceStrictCapabilities===!0)try{this.assertCapabilityForMethod(e.method),a&&this.assertTaskCapability(e.method)}catch(x){d(x);return}n?.signal?.throwIfAborted();let g=this._requestMessageId++,h={...e,jsonrpc:"2.0",id:g};n?.onprogress&&(this._progressHandlers.set(g,n.onprogress),h.params={...e.params,_meta:{...e.params?._meta||{},progressToken:g}}),a&&(h.params={...h.params,task:a}),c&&(h.params={...h.params,_meta:{...h.params?._meta||{},[ir]:c}});let f=x=>{this._responseHandlers.delete(g),this._progressHandlers.delete(g),this._cleanupTimeout(g),this._transport?.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:g,reason:String(x)}},{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i}).catch(I=>this._onerror(new Error(`Failed to send cancellation: ${I}`)));let w=x instanceof R?x:new R(D.RequestTimeout,String(x));u(w)};this._responseHandlers.set(g,x=>{if(!n?.signal?.aborted){if(x instanceof Error)return u(x);try{let w=or(r,x.result);w.success?l(w.data):u(w.error)}catch(w){u(w)}}}),n?.signal?.addEventListener("abort",()=>{f(n?.signal?.reason)});let m=n?.timeout??e$,y=()=>f(R.fromError(D.RequestTimeout,"Request timed out",{timeout:m}));this._setupTimeout(g,m,n?.maxTotalTimeout,y,n?.resetTimeoutOnProgress??!1);let b=c?.taskId;if(b){let x=w=>{let I=this._responseHandlers.get(g);I?I(w):this._onerror(new Error(`Response handler missing for side-channeled request ${g}`))};this._requestResolvers.set(g,x),this._enqueueTaskMessage(b,{type:"request",message:h,timestamp:Date.now()}).catch(w=>{this._cleanupTimeout(g),u(w)})}else this._transport.send(h,{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i}).catch(x=>{this._cleanupTimeout(g),u(x)})})}async getTask(e,r){return this.request({method:"tasks/get",params:e},Fs,r)}async getTaskResult(e,r,n){return this.request({method:"tasks/result",params:e},r,n)}async listTasks(e,r){return this.request({method:"tasks/list",params:e},Vs,r)}async cancelTask(e,r){return this.request({method:"tasks/cancel",params:e},Pm,r)}async notification(e,r){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);let n=r?.relatedTask?.taskId;if(n){let a={...e,jsonrpc:"2.0",params:{...e.params,_meta:{...e.params?._meta||{},[ir]:r.relatedTask}}};await this._enqueueTaskMessage(n,{type:"notification",message:a,timestamp:Date.now()});return}if((this._options?.debouncedNotificationMethods??[]).includes(e.method)&&!e.params&&!r?.relatedRequestId&&!r?.relatedTask){if(this._pendingDebouncedNotifications.has(e.method))return;this._pendingDebouncedNotifications.add(e.method),Promise.resolve().then(()=>{if(this._pendingDebouncedNotifications.delete(e.method),!this._transport)return;let a={...e,jsonrpc:"2.0"};r?.relatedTask&&(a={...a,params:{...a.params,_meta:{...a.params?._meta||{},[ir]:r.relatedTask}}}),this._transport?.send(a,r).catch(c=>this._onerror(c))});return}let i={...e,jsonrpc:"2.0"};r?.relatedTask&&(i={...i,params:{...i.params,_meta:{...i.params?._meta||{},[ir]:r.relatedTask}}}),await this._transport.send(i,r)}setRequestHandler(e,r){let n=Kl(e);this.assertRequestHandlerCapability(n),this._requestHandlers.set(n,(o,s)=>{let i=Xl(e,o);return Promise.resolve(r(i,s))})}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,r){let n=Kl(e);this._notificationHandlers.set(n,o=>{let s=Xl(e,o);return Promise.resolve(r(s))})}removeNotificationHandler(e){this._notificationHandlers.delete(e)}_cleanupTaskProgressHandler(e){let r=this._taskProgressTokens.get(e);r!==void 0&&(this._progressHandlers.delete(r),this._taskProgressTokens.delete(e))}async _enqueueTaskMessage(e,r,n){if(!this._taskStore||!this._taskMessageQueue)throw new Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");let o=this._options?.maxTaskQueueSize;await this._taskMessageQueue.enqueue(e,r,n,o)}async _clearTaskQueue(e,r){if(this._taskMessageQueue){let n=await this._taskMessageQueue.dequeueAll(e,r);for(let o of n)if(o.type==="request"&&zl(o.message)){let s=o.message.id,i=this._requestResolvers.get(s);i?(i(new R(D.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(s)):this._onerror(new Error(`Resolver missing for request ${s} during task ${e} cleanup`))}}}async _waitForTaskUpdate(e,r){let n=this._options?.defaultTaskPollInterval??1e3;try{let o=await this._taskStore?.getTask(e);o?.pollInterval&&(n=o.pollInterval)}catch{}return new Promise((o,s)=>{if(r.aborted){s(new R(D.InvalidRequest,"Request cancelled"));return}let i=setTimeout(o,n);r.addEventListener("abort",()=>{clearTimeout(i),s(new R(D.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(e,r){let n=this._taskStore;if(!n)throw new Error("No task store configured");return{createTask:async o=>{if(!e)throw new Error("No request provided");return await n.createTask(o,e.id,{method:e.method,params:e.params},r)},getTask:async o=>{let s=await n.getTask(o,r);if(!s)throw new R(D.InvalidParams,"Failed to retrieve task: Task not found");return s},storeTaskResult:async(o,s,i)=>{await n.storeTaskResult(o,s,i,r);let a=await n.getTask(o,r);if(a){let c=ho.parse({method:"notifications/tasks/status",params:a});await this.notification(c),ar(a.status)&&this._cleanupTaskProgressHandler(o)}},getTaskResult:o=>n.getTaskResult(o,r),updateTaskStatus:async(o,s,i)=>{let a=await n.getTask(o,r);if(!a)throw new R(D.InvalidParams,`Task "${o}" not found - it may have been cleaned up`);if(ar(a.status))throw new R(D.InvalidParams,`Cannot update task "${o}" from terminal status "${a.status}" to "${s}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await n.updateTaskStatus(o,s,i,r);let c=await n.getTask(o,r);if(c){let l=ho.parse({method:"notifications/tasks/status",params:c});await this.notification(l),ar(c.status)&&this._cleanupTaskProgressHandler(o)}},listTasks:o=>n.listTasks(o,r)}}};function gh(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function yh(t,e){let r={...t};for(let n in e){let o=n,s=e[o];if(s===void 0)continue;let i=r[o];gh(i)&&gh(s)?r[o]={...i,...s}:r[o]=s}return r}var n_=Xt(Md(),1),o_=Xt(r_(),1);function Vz(){let t=new n_.default({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return(0,o_.default)(t),t}var Ui=class{constructor(e){this._ajv=e??Vz()}getValidator(e){let r="$id"in e&&typeof e.$id=="string"?this._ajv.getSchema(e.$id)??this._ajv.compile(e):this._ajv.compile(e);return n=>r(n)?{valid:!0,data:n,errorMessage:void 0}:{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(r.errors)}}};var qi=class{constructor(e){this._server=e}requestStream(e,r,n){return this._server.requestStream(e,r,n)}async getTask(e,r){return this._server.getTask({taskId:e},r)}async getTaskResult(e,r,n){return this._server.getTaskResult({taskId:e},r,n)}async listTasks(e,r){return this._server.listTasks(e?{cursor:e}:void 0,r)}async cancelTask(e,r){return this._server.cancelTask({taskId:e},r)}};function s_(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"tools/call":if(!t.tools?.call)throw new Error(`${r} does not support task creation for tools/call (required for ${e})`);break;default:break}}function i_(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"sampling/createMessage":if(!t.sampling?.createMessage)throw new Error(`${r} does not support task creation for sampling/createMessage (required for ${e})`);break;case"elicitation/create":if(!t.elicitation?.create)throw new Error(`${r} does not support task creation for elicitation/create (required for ${e})`);break;default:break}}var Vi=class extends si{constructor(e,r){super(r),this._serverInfo=e,this._loggingLevels=new Map,this.LOG_LEVEL_SEVERITY=new Map(yo.options.map((n,o)=>[n,o])),this.isMessageIgnored=(n,o)=>{let s=this._loggingLevels.get(o);return s?this.LOG_LEVEL_SEVERITY.get(n)<this.LOG_LEVEL_SEVERITY.get(s):!1},this._capabilities=r?.capabilities??{},this._instructions=r?.instructions,this._jsonSchemaValidator=r?.jsonSchemaValidator??new Ui,this.setRequestHandler(Ol,n=>this._oninitialize(n)),this.setNotificationHandler(Rl,()=>this.oninitialized?.()),this._capabilities.logging&&this.setRequestHandler(Zl,async(n,o)=>{let s=o.sessionId||o.requestInfo?.headers["mcp-session-id"]||void 0,{level:i}=n.params,a=yo.safeParse(i);return a.success&&this._loggingLevels.set(s,a.data),{}})}get experimental(){return this._experimental||(this._experimental={tasks:new qi(this)}),this._experimental}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=yh(this._capabilities,e)}setRequestHandler(e,r){let o=sr(e)?.method;if(!o)throw new Error("Schema is missing a method literal");let s;if(nt(o)){let a=o;s=a._zod?.def?.value??a.value}else{let a=o;s=a._def?.value??a.value}if(typeof s!="string")throw new Error("Schema method literal must be a string");if(s==="tools/call"){let a=async(c,l)=>{let u=or(xn,c);if(!u.success){let f=u.error instanceof Error?u.error.message:String(u.error);throw new R(D.InvalidParams,`Invalid tools/call request: ${f}`)}let{params:d}=u.data,g=await Promise.resolve(r(c,l));if(d.task){let f=or(vn,g);if(!f.success){let m=f.error instanceof Error?f.error.message:String(f.error);throw new R(D.InvalidParams,`Invalid task creation result: ${m}`)}return f.data}let h=or(Ys,g);if(!h.success){let f=h.error instanceof Error?h.error.message:String(h.error);throw new R(D.InvalidParams,`Invalid tools/call result: ${f}`)}return h.data};return super.setRequestHandler(e,a)}return super.setRequestHandler(e,r)}assertCapabilityForMethod(e){switch(e){case"sampling/createMessage":if(!this._clientCapabilities?.sampling)throw new Error(`Client does not support sampling (required for ${e})`);break;case"elicitation/create":if(!this._clientCapabilities?.elicitation)throw new Error(`Client does not support elicitation (required for ${e})`);break;case"roots/list":if(!this._clientCapabilities?.roots)throw new Error(`Client does not support listing roots (required for ${e})`);break;case"ping":break}}assertNotificationCapability(e){switch(e){case"notifications/message":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw new Error(`Server does not support notifying about resources (required for ${e})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw new Error(`Server does not support notifying of tool list changes (required for ${e})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw new Error(`Server does not support notifying of prompt list changes (required for ${e})`);break;case"notifications/elicitation/complete":if(!this._clientCapabilities?.elicitation?.url)throw new Error(`Client does not support URL elicitation (required for ${e})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){if(this._capabilities)switch(e){case"completion/complete":if(!this._capabilities.completions)throw new Error(`Server does not support completions (required for ${e})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw new Error(`Server does not support resources (required for ${e})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw new Error(`Server does not support tools (required for ${e})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw new Error(`Server does not support tasks capability (required for ${e})`);break;case"ping":case"initialize":break}}assertTaskCapability(e){i_(this._clientCapabilities?.tasks?.requests,e,"Client")}assertTaskHandlerCapability(e){this._capabilities&&s_(this._capabilities.tasks?.requests,e,"Server")}async _oninitialize(e){let r=e.params.protocolVersion;return this._clientCapabilities=e.params.capabilities,this._clientVersion=e.params.clientInfo,{protocolVersion:bm.includes(r)?r:El,capabilities:this.getCapabilities(),serverInfo:this._serverInfo,...this._instructions&&{instructions:this._instructions}}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},Ms)}async createMessage(e,r){if((e.tools||e.toolChoice)&&!this._clientCapabilities?.sampling?.tools)throw new Error("Client does not support sampling tools capability.");if(e.messages.length>0){let n=e.messages[e.messages.length-1],o=Array.isArray(n.content)?n.content:[n.content],s=o.some(l=>l.type==="tool_result"),i=e.messages.length>1?e.messages[e.messages.length-2]:void 0,a=i?Array.isArray(i.content)?i.content:[i.content]:[],c=a.some(l=>l.type==="tool_use");if(s){if(o.some(l=>l.type!=="tool_result"))throw new Error("The last message must contain only tool_result content if any is present");if(!c)throw new Error("tool_result blocks are not matching any tool_use from the previous message")}if(c){let l=new Set(a.filter(d=>d.type==="tool_use").map(d=>d.id)),u=new Set(o.filter(d=>d.type==="tool_result").map(d=>d.toolUseId));if(l.size!==u.size||![...l].every(d=>u.has(d)))throw new Error("ids of tool_result blocks and tool_use blocks from previous message do not match")}}return e.tools?this.request({method:"sampling/createMessage",params:e},Ul,r):this.request({method:"sampling/createMessage",params:e},Fl,r)}async elicitInput(e,r){switch(e.mode??"form"){case"url":{if(!this._clientCapabilities?.elicitation?.url)throw new Error("Client does not support url elicitation.");let o=e;return this.request({method:"elicitation/create",params:o},Qs,r)}case"form":{if(!this._clientCapabilities?.elicitation?.form)throw new Error("Client does not support form elicitation.");let o=e.mode==="form"?e:{...e,mode:"form"},s=await this.request({method:"elicitation/create",params:o},Qs,r);if(s.action==="accept"&&s.content&&o.requestedSchema)try{let a=this._jsonSchemaValidator.getValidator(o.requestedSchema)(s.content);if(!a.valid)throw new R(D.InvalidParams,`Elicitation response content does not match requested schema: ${a.errorMessage}`)}catch(i){throw i instanceof R?i:new R(D.InternalError,`Error validating elicitation response: ${i instanceof Error?i.message:String(i)}`)}return s}}}createElicitationCompletionNotifier(e,r){if(!this._clientCapabilities?.elicitation?.url)throw new Error("Client does not support URL elicitation (required for notifications/elicitation/complete)");return()=>this.notification({method:"notifications/elicitation/complete",params:{elicitationId:e}},r)}async listRoots(e,r){return this.request({method:"roots/list",params:e},ql,r)}async sendLoggingMessage(e,r){if(this._capabilities.logging&&!this.isMessageIgnored(e.level,r))return this.notification({method:"notifications/message",params:e})}async sendResourceUpdated(e){return this.notification({method:"notifications/resources/updated",params:e})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}};var c_=Symbol.for("mcp.completable");function Vd(t){return!!t&&typeof t=="object"&&c_ in t}function l_(t){return t[c_]?.complete}var a_;(function(t){t.Completable="McpCompletable"})(a_||(a_={}));var Bz=/^[A-Za-z0-9._-]{1,128}$/;function Hz(t){let e=[];if(t.length===0)return{isValid:!1,warnings:["Tool name cannot be empty"]};if(t.length>128)return{isValid:!1,warnings:[`Tool name exceeds maximum length of 128 characters (current: ${t.length})`]};if(t.includes(" ")&&e.push("Tool name contains spaces, which may cause parsing issues"),t.includes(",")&&e.push("Tool name contains commas, which may cause parsing issues"),(t.startsWith("-")||t.endsWith("-"))&&e.push("Tool name starts or ends with a dash, which may cause parsing issues in some contexts"),(t.startsWith(".")||t.endsWith("."))&&e.push("Tool name starts or ends with a dot, which may cause parsing issues in some contexts"),!Bz.test(t)){let r=t.split("").filter(n=>!/[A-Za-z0-9._-]/.test(n)).filter((n,o,s)=>s.indexOf(n)===o);return e.push(`Tool name contains invalid characters: ${r.map(n=>`"${n}"`).join(", ")}`,"Allowed characters are: A-Z, a-z, 0-9, underscore (_), dash (-), and dot (.)"),{isValid:!1,warnings:e}}return{isValid:!0,warnings:e}}function Gz(t,e){if(e.length>0){console.warn(`Tool name validation warning for "${t}":`);for(let r of e)console.warn(`  - ${r}`);console.warn("Tool registration will proceed, but this may cause compatibility issues."),console.warn("Consider updating the tool name to conform to the MCP tool naming standard."),console.warn("See SEP: Specify Format for Tool Names (https://github.com/modelcontextprotocol/modelcontextprotocol/issues/986) for more details.")}}function Bd(t){let e=Hz(t);return Gz(t,e.warnings),e.isValid}var Bi=class{constructor(e){this._mcpServer=e}registerToolTask(e,r,n){let o={taskSupport:"required",...r.execution};if(o.taskSupport==="forbidden")throw new Error(`Cannot register task-based tool '${e}' with taskSupport 'forbidden'. Use registerTool() instead.`);return this._mcpServer._createRegisteredTool(e,r.title,r.description,r.inputSchema,r.outputSchema,r.annotations,o,r._meta,n)}};var Hi=class{constructor(e,r){this._registeredResources={},this._registeredResourceTemplates={},this._registeredTools={},this._registeredPrompts={},this._toolHandlersInitialized=!1,this._completionHandlerInitialized=!1,this._resourceHandlersInitialized=!1,this._promptHandlersInitialized=!1,this.server=new Vi(e,r)}get experimental(){return this._experimental||(this._experimental={tasks:new Bi(this)}),this._experimental}async connect(e){return await this.server.connect(e)}async close(){await this.server.close()}setToolRequestHandlers(){this._toolHandlersInitialized||(this.server.assertCanSetRequestHandler(gr(Xs)),this.server.assertCanSetRequestHandler(gr(xn)),this.server.registerCapabilities({tools:{listChanged:!0}}),this.server.setRequestHandler(Xs,()=>({tools:Object.entries(this._registeredTools).filter(([,e])=>e.enabled).map(([e,r])=>{let n={name:e,title:r.title,description:r.description,inputSchema:(()=>{let o=yn(r.inputSchema);return o?Jl(o,{strictUnions:!0,pipeStrategy:"input"}):Wz})(),annotations:r.annotations,execution:r.execution,_meta:r._meta};if(r.outputSchema){let o=yn(r.outputSchema);o&&(n.outputSchema=Jl(o,{strictUnions:!0,pipeStrategy:"output"}))}return n})})),this.server.setRequestHandler(xn,async(e,r)=>{try{let n=this._registeredTools[e.params.name];if(!n)throw new R(D.InvalidParams,`Tool ${e.params.name} not found`);if(!n.enabled)throw new R(D.InvalidParams,`Tool ${e.params.name} disabled`);let o=!!e.params.task,s=n.execution?.taskSupport,i="createTask"in n.handler;if((s==="required"||s==="optional")&&!i)throw new R(D.InternalError,`Tool ${e.params.name} has taskSupport '${s}' but was not registered with registerToolTask`);if(s==="required"&&!o)throw new R(D.MethodNotFound,`Tool ${e.params.name} requires task augmentation (taskSupport: 'required')`);if(s==="optional"&&!o&&i)return await this.handleAutomaticTaskPolling(n,e,r);let a=await this.validateToolInput(n,e.params.arguments,e.params.name),c=await this.executeToolHandler(n,a,r);return o||await this.validateToolOutput(n,c,e.params.name),c}catch(n){if(n instanceof R&&n.code===D.UrlElicitationRequired)throw n;return this.createToolError(n instanceof Error?n.message:String(n))}}),this._toolHandlersInitialized=!0)}createToolError(e){return{content:[{type:"text",text:e}],isError:!0}}async validateToolInput(e,r,n){if(!e.inputSchema)return;let s=yn(e.inputSchema)??e.inputSchema,i=await Is(s,r);if(!i.success){let a="error"in i?i.error:"Unknown error",c=zs(a);throw new R(D.InvalidParams,`Input validation error: Invalid arguments for tool ${n}: ${c}`)}return i.data}async validateToolOutput(e,r,n){if(!e.outputSchema||!("content"in r)||r.isError)return;if(!r.structuredContent)throw new R(D.InvalidParams,`Output validation error: Tool ${n} has an output schema but no structured content was provided`);let o=yn(e.outputSchema),s=await Is(o,r.structuredContent);if(!s.success){let i="error"in s?s.error:"Unknown error",a=zs(i);throw new R(D.InvalidParams,`Output validation error: Invalid structured content for tool ${n}: ${a}`)}}async executeToolHandler(e,r,n){let o=e.handler;if("createTask"in o){if(!n.taskStore)throw new Error("No task store provided.");let i={...n,taskStore:n.taskStore};if(e.inputSchema){let a=o;return await Promise.resolve(a.createTask(r,i))}else{let a=o;return await Promise.resolve(a.createTask(i))}}if(e.inputSchema){let i=o;return await Promise.resolve(i(r,n))}else{let i=o;return await Promise.resolve(i(n))}}async handleAutomaticTaskPolling(e,r,n){if(!n.taskStore)throw new Error("No task store provided for task-capable tool.");let o=await this.validateToolInput(e,r.params.arguments,r.params.name),s=e.handler,i={...n,taskStore:n.taskStore},a=o?await Promise.resolve(s.createTask(o,i)):await Promise.resolve(s.createTask(i)),c=a.task.taskId,l=a.task,u=l.pollInterval??5e3;for(;l.status!=="completed"&&l.status!=="failed"&&l.status!=="cancelled";){await new Promise(g=>setTimeout(g,u));let d=await n.taskStore.getTask(c);if(!d)throw new R(D.InternalError,`Task ${c} not found during polling`);l=d}return await n.taskStore.getTaskResult(c)}setCompletionRequestHandler(){this._completionHandlerInitialized||(this.server.assertCanSetRequestHandler(gr(ei)),this.server.registerCapabilities({completions:{}}),this.server.setRequestHandler(ei,async e=>{switch(e.params.ref.type){case"ref/prompt":return Mm(e),this.handlePromptCompletion(e,e.params.ref);case"ref/resource":return Dm(e),this.handleResourceCompletion(e,e.params.ref);default:throw new R(D.InvalidParams,`Invalid completion reference: ${e.params.ref}`)}}),this._completionHandlerInitialized=!0)}async handlePromptCompletion(e,r){let n=this._registeredPrompts[r.name];if(!n)throw new R(D.InvalidParams,`Prompt ${r.name} not found`);if(!n.enabled)throw new R(D.InvalidParams,`Prompt ${r.name} disabled`);if(!n.argsSchema)return Wo;let s=sr(n.argsSchema)?.[e.params.argument.name];if(!Vd(s))return Wo;let i=l_(s);if(!i)return Wo;let a=await i(e.params.argument.value,e.params.context);return d_(a)}async handleResourceCompletion(e,r){let n=Object.values(this._registeredResourceTemplates).find(i=>i.resourceTemplate.uriTemplate.toString()===r.uri);if(!n){if(this._registeredResources[r.uri])return Wo;throw new R(D.InvalidParams,`Resource template ${e.params.ref.uri} not found`)}let o=n.resourceTemplate.completeCallback(e.params.argument.name);if(!o)return Wo;let s=await o(e.params.argument.value,e.params.context);return d_(s)}setResourceRequestHandlers(){this._resourceHandlersInitialized||(this.server.assertCanSetRequestHandler(gr(Hs)),this.server.assertCanSetRequestHandler(gr(Gs)),this.server.assertCanSetRequestHandler(gr(Ws)),this.server.registerCapabilities({resources:{listChanged:!0}}),this.server.setRequestHandler(Hs,async(e,r)=>{let n=Object.entries(this._registeredResources).filter(([s,i])=>i.enabled).map(([s,i])=>({uri:s,name:i.name,...i.metadata})),o=[];for(let s of Object.values(this._registeredResourceTemplates)){if(!s.resourceTemplate.listCallback)continue;let i=await s.resourceTemplate.listCallback(r);for(let a of i.resources)o.push({...s.metadata,...a})}return{resources:[...n,...o]}}),this.server.setRequestHandler(Gs,async()=>({resourceTemplates:Object.entries(this._registeredResourceTemplates).map(([r,n])=>({name:r,uriTemplate:n.resourceTemplate.uriTemplate.toString(),...n.metadata}))})),this.server.setRequestHandler(Ws,async(e,r)=>{let n=new URL(e.params.uri),o=this._registeredResources[n.toString()];if(o){if(!o.enabled)throw new R(D.InvalidParams,`Resource ${n} disabled`);return o.readCallback(n,r)}for(let s of Object.values(this._registeredResourceTemplates)){let i=s.resourceTemplate.uriTemplate.match(n.toString());if(i)return s.readCallback(n,i,r)}throw new R(D.InvalidParams,`Resource ${n} not found`)}),this._resourceHandlersInitialized=!0)}setPromptRequestHandlers(){this._promptHandlersInitialized||(this.server.assertCanSetRequestHandler(gr(Js)),this.server.assertCanSetRequestHandler(gr(Ks)),this.server.registerCapabilities({prompts:{listChanged:!0}}),this.server.setRequestHandler(Js,()=>({prompts:Object.entries(this._registeredPrompts).filter(([,e])=>e.enabled).map(([e,r])=>({name:e,title:r.title,description:r.description,arguments:r.argsSchema?Kz(r.argsSchema):void 0}))})),this.server.setRequestHandler(Ks,async(e,r)=>{let n=this._registeredPrompts[e.params.name];if(!n)throw new R(D.InvalidParams,`Prompt ${e.params.name} not found`);if(!n.enabled)throw new R(D.InvalidParams,`Prompt ${e.params.name} disabled`);if(n.argsSchema){let o=yn(n.argsSchema),s=await Is(o,e.params.arguments);if(!s.success){let c="error"in s?s.error:"Unknown error",l=zs(c);throw new R(D.InvalidParams,`Invalid arguments for prompt ${e.params.name}: ${l}`)}let i=s.data,a=n.callback;return await Promise.resolve(a(i,r))}else{let o=n.callback;return await Promise.resolve(o(r))}}),this._promptHandlersInitialized=!0)}resource(e,r,...n){let o;typeof n[0]=="object"&&(o=n.shift());let s=n[0];if(typeof r=="string"){if(this._registeredResources[r])throw new Error(`Resource ${r} is already registered`);let i=this._createRegisteredResource(e,void 0,r,o,s);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),i}else{if(this._registeredResourceTemplates[e])throw new Error(`Resource template ${e} is already registered`);let i=this._createRegisteredResourceTemplate(e,void 0,r,o,s);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),i}}registerResource(e,r,n,o){if(typeof r=="string"){if(this._registeredResources[r])throw new Error(`Resource ${r} is already registered`);let s=this._createRegisteredResource(e,n.title,r,n,o);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),s}else{if(this._registeredResourceTemplates[e])throw new Error(`Resource template ${e} is already registered`);let s=this._createRegisteredResourceTemplate(e,n.title,r,n,o);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),s}}_createRegisteredResource(e,r,n,o,s){let i={name:e,title:r,metadata:o,readCallback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({uri:null}),update:a=>{typeof a.uri<"u"&&a.uri!==n&&(delete this._registeredResources[n],a.uri&&(this._registeredResources[a.uri]=i)),typeof a.name<"u"&&(i.name=a.name),typeof a.title<"u"&&(i.title=a.title),typeof a.metadata<"u"&&(i.metadata=a.metadata),typeof a.callback<"u"&&(i.readCallback=a.callback),typeof a.enabled<"u"&&(i.enabled=a.enabled),this.sendResourceListChanged()}};return this._registeredResources[n]=i,i}_createRegisteredResourceTemplate(e,r,n,o,s){let i={resourceTemplate:n,title:r,metadata:o,readCallback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({name:null}),update:l=>{typeof l.name<"u"&&l.name!==e&&(delete this._registeredResourceTemplates[e],l.name&&(this._registeredResourceTemplates[l.name]=i)),typeof l.title<"u"&&(i.title=l.title),typeof l.template<"u"&&(i.resourceTemplate=l.template),typeof l.metadata<"u"&&(i.metadata=l.metadata),typeof l.callback<"u"&&(i.readCallback=l.callback),typeof l.enabled<"u"&&(i.enabled=l.enabled),this.sendResourceListChanged()}};this._registeredResourceTemplates[e]=i;let a=n.uriTemplate.variableNames;return Array.isArray(a)&&a.some(l=>!!n.completeCallback(l))&&this.setCompletionRequestHandler(),i}_createRegisteredPrompt(e,r,n,o,s){let i={title:r,description:n,argsSchema:o===void 0?void 0:qr(o),callback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({name:null}),update:a=>{typeof a.name<"u"&&a.name!==e&&(delete this._registeredPrompts[e],a.name&&(this._registeredPrompts[a.name]=i)),typeof a.title<"u"&&(i.title=a.title),typeof a.description<"u"&&(i.description=a.description),typeof a.argsSchema<"u"&&(i.argsSchema=qr(a.argsSchema)),typeof a.callback<"u"&&(i.callback=a.callback),typeof a.enabled<"u"&&(i.enabled=a.enabled),this.sendPromptListChanged()}};return this._registeredPrompts[e]=i,o&&Object.values(o).some(c=>{let l=c instanceof Ve?c._def?.innerType:c;return Vd(l)})&&this.setCompletionRequestHandler(),i}_createRegisteredTool(e,r,n,o,s,i,a,c,l){Bd(e);let u={title:r,description:n,inputSchema:u_(o),outputSchema:u_(s),annotations:i,execution:a,_meta:c,handler:l,enabled:!0,disable:()=>u.update({enabled:!1}),enable:()=>u.update({enabled:!0}),remove:()=>u.update({name:null}),update:d=>{typeof d.name<"u"&&d.name!==e&&(typeof d.name=="string"&&Bd(d.name),delete this._registeredTools[e],d.name&&(this._registeredTools[d.name]=u)),typeof d.title<"u"&&(u.title=d.title),typeof d.description<"u"&&(u.description=d.description),typeof d.paramsSchema<"u"&&(u.inputSchema=qr(d.paramsSchema)),typeof d.outputSchema<"u"&&(u.outputSchema=qr(d.outputSchema)),typeof d.callback<"u"&&(u.handler=d.callback),typeof d.annotations<"u"&&(u.annotations=d.annotations),typeof d._meta<"u"&&(u._meta=d._meta),typeof d.enabled<"u"&&(u.enabled=d.enabled),this.sendToolListChanged()}};return this._registeredTools[e]=u,this.setToolRequestHandlers(),this.sendToolListChanged(),u}tool(e,...r){if(this._registeredTools[e])throw new Error(`Tool ${e} is already registered`);let n,o,s,i;if(typeof r[0]=="string"&&(n=r.shift()),r.length>1){let c=r[0];Hd(c)?(o=r.shift(),r.length>1&&typeof r[0]=="object"&&r[0]!==null&&!Hd(r[0])&&(i=r.shift())):typeof c=="object"&&c!==null&&(i=r.shift())}let a=r[0];return this._createRegisteredTool(e,void 0,n,o,s,i,{taskSupport:"forbidden"},void 0,a)}registerTool(e,r,n){if(this._registeredTools[e])throw new Error(`Tool ${e} is already registered`);let{title:o,description:s,inputSchema:i,outputSchema:a,annotations:c,_meta:l}=r;return this._createRegisteredTool(e,o,s,i,a,c,{taskSupport:"forbidden"},l,n)}prompt(e,...r){if(this._registeredPrompts[e])throw new Error(`Prompt ${e} is already registered`);let n;typeof r[0]=="string"&&(n=r.shift());let o;r.length>1&&(o=r.shift());let s=r[0],i=this._createRegisteredPrompt(e,void 0,n,o,s);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),i}registerPrompt(e,r,n){if(this._registeredPrompts[e])throw new Error(`Prompt ${e} is already registered`);let{title:o,description:s,argsSchema:i}=r,a=this._createRegisteredPrompt(e,o,s,i,n);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),a}isConnected(){return this.server.transport!==void 0}async sendLoggingMessage(e,r){return this.server.sendLoggingMessage(e,r)}sendResourceListChanged(){this.isConnected()&&this.server.sendResourceListChanged()}sendToolListChanged(){this.isConnected()&&this.server.sendToolListChanged()}sendPromptListChanged(){this.isConnected()&&this.server.sendPromptListChanged()}};var Wz={type:"object",properties:{}};function f_(t){return t!==null&&typeof t=="object"&&"parse"in t&&typeof t.parse=="function"&&"safeParse"in t&&typeof t.safeParse=="function"}function Jz(t){return"_def"in t||"_zod"in t||f_(t)}function Hd(t){return typeof t!="object"||t===null||Jz(t)?!1:Object.keys(t).length===0?!0:Object.values(t).some(f_)}function u_(t){if(t)return Hd(t)?qr(t):t}function Kz(t){let e=sr(t);return e?Object.entries(e).map(([r,n])=>{let o=Xp(n),s=Yp(n);return{name:r,description:o,required:!s}}):[]}function gr(t){let r=sr(t)?.method;if(!r)throw new Error("Schema is missing a method literal");let n=Ps(r);if(typeof n=="string")return n;throw new Error("Schema method literal must be a string")}function d_(t){return{completion:{values:t.slice(0,100),total:t.length,hasMore:t.length>100}}}var Wo={completion:{values:[],hasMore:!1}};var Gd=Xt(require("node:process"),1);var Gi=class{append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;let e=this._buffer.indexOf(`
`);if(e===-1)return null;let r=this._buffer.toString("utf8",0,e).replace(/\r$/,"");return this._buffer=this._buffer.subarray(e+1),Xz(r)}clear(){this._buffer=void 0}};function Xz(t){return Im.parse(JSON.parse(t))}function p_(t){return JSON.stringify(t)+`
`}var Wi=class{constructor(e=Gd.default.stdin,r=Gd.default.stdout){this._stdin=e,this._stdout=r,this._readBuffer=new Gi,this._started=!1,this._ondata=n=>{this._readBuffer.append(n),this.processReadBuffer()},this._onerror=n=>{this.onerror?.(n)}}async start(){if(this._started)throw new Error("StdioServerTransport already started! If using Server class, note that connect() calls start() automatically.");this._started=!0,this._stdin.on("data",this._ondata),this._stdin.on("error",this._onerror)}processReadBuffer(){for(;;)try{let e=this._readBuffer.readMessage();if(e===null)break;this.onmessage?.(e)}catch(e){this.onerror?.(e)}}async close(){this._stdin.off("data",this._ondata),this._stdin.off("error",this._onerror),this._stdin.listenerCount("data")===0&&this._stdin.pause(),this._readBuffer.clear(),this.onclose?.()}send(e){return new Promise(r=>{let n=p_(e);this._stdout.write(n)?r():this._stdout.once("drain",r)})}};var yN=Xt(cv(),1),_N=Xt(of(),1),vN=Xt(cf(),1),De=Xt(ia(),1),gf=Xt(yv(),1);var Pe=[];for(let t=0;t<256;++t)Pe.push((t+256).toString(16).slice(1));function _v(t,e=0){return(Pe[t[e+0]]+Pe[t[e+1]]+Pe[t[e+2]]+Pe[t[e+3]]+"-"+Pe[t[e+4]]+Pe[t[e+5]]+"-"+Pe[t[e+6]]+Pe[t[e+7]]+"-"+Pe[t[e+8]]+Pe[t[e+9]]+"-"+Pe[t[e+10]]+Pe[t[e+11]]+Pe[t[e+12]]+Pe[t[e+13]]+Pe[t[e+14]]+Pe[t[e+15]]).toLowerCase()}var vv=require("crypto"),la=new Uint8Array(256),ca=la.length;function yf(){return ca>la.length-16&&((0,vv.randomFillSync)(la),ca=0),la.slice(ca,ca+=16)}var bv=require("crypto"),_f={randomUUID:bv.randomUUID};function bN(t,e,r){if(_f.randomUUID&&!e&&!t)return _f.randomUUID();t=t||{};let n=t.random??t.rng?.()??yf();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){if(r=r||0,r<0||r+16>e.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let o=0;o<16;++o)e[r+o]=n[o];return e}return _v(n)}var ua=bN;var Ne=require("node:fs"),Sv=require("node:os"),os=require("node:path"),xN=3055,wN=3e4,xv=500,SN=5e3,Ue=[3055,3056,3057,3058,3059,3060],ns=3,wv=5e3,Kt=(0,os.join)((0,Sv.tmpdir)(),"figma-bridge-ports"),da=class{wss=null;clients=new Map;pending=new Map;activeClientId=null;serverState="stopped";consoleLogs=new Map;preferredPort;portOrder;boundPort;portScanIndex=0;fullScanAttempt=0;retryTimer=null;heartbeatInterval=null;portFilePath=null;portDirWatcher=null;portScanInterval=null;knownRegistryPorts=new Set;constructor(e=xN){this.preferredPort=e,this.boundPort=e,Ue.includes(e)?this.portOrder=[e,...Ue.filter(r=>r!==e)]:this.portOrder=[e,...Ue]}start(){this.serverState="starting",this.portScanIndex=0,this.fullScanAttempt=0,this.attemptListen()}attemptListen(){if(this.wss){try{this.wss.close()}catch{}this.wss=null}let e=this.portOrder[this.portScanIndex];this.serverState="starting",this.wss=new gf.default({port:e,host:"0.0.0.0"}),this.wss.on("listening",()=>{this.serverState="listening",this.boundPort=e,e!==this.preferredPort?this.log(`WebSocket bridge listening on ws://localhost:${e} (preferred port ${this.preferredPort} was in use)`):this.log(`WebSocket bridge listening on ws://localhost:${e}`),this.portScanIndex=0,this.fullScanAttempt=0,this.registerPort(e),this.startPortDiscovery(),this.startHeartbeat()}),this.setupConnectionHandler(),this.wss.on("error",r=>{if(r.code==="EADDRINUSE"){let n=this.portScanIndex+1;n<this.portOrder.length?(this.log(`Port ${e} is in use \u2014 trying ${this.portOrder[n]}`),this.portScanIndex=n,this.attemptListen()):(this.fullScanAttempt++,this.fullScanAttempt<ns?(this.log(`All ports ${Ue[0]}-${Ue[Ue.length-1]} are in use \u2014 retrying full scan in ${wv/1e3}s (attempt ${this.fullScanAttempt+1}/${ns})`),this.portScanIndex=0,this.retryTimer=setTimeout(()=>{this.retryTimer=null,this.attemptListen()},wv)):(this.serverState="port_conflict",this.log(`All ports ${Ue[0]}-${Ue[Ue.length-1]} are in use after ${ns} full scans. ${this.portOrder.length} editor(s) or processes may be occupying all ports.`)))}else this.serverState="error",this.log(`WebSocket server error: ${r.message}`)})}setupConnectionHandler(){this.wss&&this.wss.on("connection",e=>{let r=ua(),n={ws:e,clientId:r,fileName:"Unknown File",documentId:"",currentPageId:"",currentPageName:"",connectedAt:new Date};this.clients.set(r,n),this.log(`Figma plugin connected (clientId=${r}, total=${this.clients.size})`),this.clients.size===1&&(this.activeClientId=r),this.sendKnownPortsTo(e),e.on("message",o=>{try{let s=JSON.parse(o.toString());if(s.__register){n.fileName=s.fileName??"Unknown File",n.documentId=s.documentId??"",n.currentPageId=s.currentPageId??"",n.currentPageName=s.currentPageName??"",this.log(`Registered file: "${n.fileName}" (clientId=${r})`);return}if(s.__pageChange){n.currentPageId=s.currentPageId??"",n.currentPageName=s.currentPageName??"",this.log(`Page changed in "${n.fileName}": ${n.currentPageName}`);return}if(s.__console){this.pushConsoleLog(r,n.fileName,s);return}this.handleResponse(s)}catch{this.log("Received malformed message from plugin")}}),e.on("close",()=>{this.log(`Figma plugin disconnected: "${n.fileName}" (clientId=${r})`),this.clients.delete(r);for(let[o,s]of this.pending)s.clientId===r&&(clearTimeout(s.timer),s.reject(new Error(`Figma plugin disconnected: "${n.fileName}"`)),this.pending.delete(o));this.consoleLogs.delete(r),this.activeClientId===r&&(this.clients.size===1?this.activeClientId=this.clients.keys().next().value:this.activeClientId=null)}),e.on("error",o=>{this.log(`WebSocket error (clientId=${r}): ${o.message}`)})})}sendCommand(e,r={},n,o){return new Promise((s,i)=>{if(this.serverState==="port_conflict"){i(new Error(`All ports ${Ue[0]}-${Ue[Ue.length-1]} are in use by other editors or processes. Close another editor or wait for a port to free up.`));return}if(this.serverState==="starting"){i(new Error(`WebSocket server is scanning for an available port (trying ${this.portOrder[this.portScanIndex]}, scan ${this.fullScanAttempt+1}/${ns}). Please wait a moment and try again.`));return}if(this.serverState!=="listening"){i(new Error(`WebSocket server is not running (state: ${this.serverState}). Restart the editor.`));return}let a=this.resolveClient(o);if(!a){i(this.buildRoutingError(o));return}if(a.ws.readyState!==De.default.OPEN){i(new Error(`Figma plugin "${a.fileName}" is not connected.`));return}let c=ua(),l={id:c,type:e,params:r},u=n??wN,d=setTimeout(()=>{this.pending.delete(c),i(new Error(`Command "${e}" timed out after ${u}ms`))},u);this.pending.set(c,{resolve:s,reject:i,timer:d,clientId:a.clientId}),a.ws.send(JSON.stringify(l),g=>{g&&(clearTimeout(d),this.pending.delete(c),i(new Error(`Failed to send command: ${g.message}`)))})})}isConnected(){for(let e of this.clients.values())if(e.ws.readyState===De.default.OPEN)return!0;return!1}listClients(){let e=[];for(let r of this.clients.values())r.ws.readyState===De.default.OPEN&&e.push({clientId:r.clientId,fileName:r.fileName,documentId:r.documentId,currentPageId:r.currentPageId,currentPageName:r.currentPageName,connectedAt:r.connectedAt,isActive:r.clientId===this.activeClientId});return e}setActiveClient(e){let r=this.findClient(e);if(!r){let n=this.getConnectedFileNames();throw new Error(`No connected file matching "${e}". Connected files: ${n.join(", ")||"(none)"}`)}return this.activeClientId=r.clientId,this.log(`Active file set to: "${r.fileName}" (clientId=${r.clientId})`),{clientId:r.clientId,fileName:r.fileName,documentId:r.documentId,currentPageId:r.currentPageId,currentPageName:r.currentPageName,connectedAt:r.connectedAt}}getActiveClient(){if(!this.activeClientId)return null;let e=this.clients.get(this.activeClientId);return!e||e.ws.readyState!==De.default.OPEN?null:{clientId:e.clientId,fileName:e.fileName,documentId:e.documentId,currentPageId:e.currentPageId,currentPageName:e.currentPageName,connectedAt:e.connectedAt,isActive:!0}}stop(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null),this.portScanIndex=0,this.fullScanAttempt=0,this.stopHeartbeat(),this.stopPortDiscovery(),this.removePortFile();for(let[e,r]of this.pending)clearTimeout(r.timer),r.reject(new Error("Bridge shutting down")),this.pending.delete(e);for(let e of this.clients.values())e.ws.close();this.clients.clear(),this.activeClientId=null,this.wss&&(this.wss.close(),this.wss=null),this.serverState="stopped"}removePortFile(){if(this.portFilePath){try{(0,Ne.unlinkSync)(this.portFilePath)}catch{}this.portFilePath=null}}getStatus(){return{server:{state:this.serverState,port:this.boundPort,preferredPort:this.preferredPort,portRange:[...Ue],currentTryPort:this.portOrder[this.portScanIndex]??this.preferredPort,fullScanAttempt:this.fullScanAttempt,maxFullScans:ns},connections:{count:this.clients.size,files:this.getConnectedFileNames(),registeredCount:this.countRegisteredClients(),registeredFiles:this.getRegisteredFileNames(),activeFile:this.activeClientId?this.clients.get(this.activeClientId)?.fileName??null:null},pending:this.pending.size}}getConsoleLogs(e){let r=this.resolveClient(e?.fileId);if(!r)return[];let n=this.consoleLogs.get(r.clientId)||[];return e?.level&&(n=n.filter(o=>o.level===e.level)),e?.since&&(n=n.filter(o=>o.timestamp>=e.since)),e?.limit&&e.limit>0&&(n=n.slice(-e.limit)),n}clearConsoleLogs(e){let r=this.resolveClient(e);if(!r)return{cleared:0,clientId:null};let o=this.consoleLogs.get(r.clientId)?.length??0;return this.consoleLogs.delete(r.clientId),{cleared:o,clientId:r.clientId}}pushConsoleLog(e,r,n){let o=this.consoleLogs.get(e);o||(o=[],this.consoleLogs.set(e,o)),o.push({level:n.level,message:n.message,args:n.args??[],timestamp:n.timestamp??Date.now(),clientId:e,fileName:r}),o.length>xv&&o.splice(0,o.length-xv)}resolveClient(e){if(e)return this.findClient(e);if(this.clients.size===1){let r=this.clients.values().next().value;return r.ws.readyState===De.default.OPEN?r:null}if(this.activeClientId){let r=this.clients.get(this.activeClientId);if(r&&r.ws.readyState===De.default.OPEN)return r}return null}findClient(e){let r=this.clients.get(e);if(r&&r.ws.readyState===De.default.OPEN)return r;for(let n of this.clients.values())if(n.ws.readyState===De.default.OPEN&&n.fileName.toLowerCase()===e.toLowerCase())return n;for(let n of this.clients.values())if(n.ws.readyState===De.default.OPEN&&n.fileName.toLowerCase().includes(e.toLowerCase()))return n;return null}buildRoutingError(e){let r=this.getConnectedFileNames();return this.clients.size===0?new Error("No Figma plugin connected. Open Figma and run the Outreach Figma MCP Bridge plugin first."):e?new Error(`No connected file matching "${e}". Connected files: ${r.join(", ")}`):new Error(`Multiple Figma files are connected but no active file is set. Connected files: ${r.join(", ")}. Use set_active_file to choose one, or pass fileId to target a specific file.`)}getConnectedFileNames(){let e=[];for(let r of this.clients.values())r.ws.readyState===De.default.OPEN&&e.push(`"${r.fileName}"`);return e}getRegisteredFileNames(){let e="Unknown File",r=[];for(let n of this.clients.values())n.ws.readyState===De.default.OPEN&&n.fileName!==e&&r.push(`"${n.fileName}"`);return r}countRegisteredClients(){let e="Unknown File",r=0;for(let n of this.clients.values())n.ws.readyState===De.default.OPEN&&n.fileName!==e&&r++;return r}handleResponse(e){let r=this.pending.get(e.id);if(!r){this.log(`Received response for unknown request: ${e.id}`);return}clearTimeout(r.timer),this.pending.delete(e.id),e.success?r.resolve(e.result):r.reject(new Error(e.error??"Unknown error from Figma plugin"))}log(e){process.stderr.write(`[outreach-figma-bridge] ${e}
`)}startHeartbeat(){this.stopHeartbeat(),this.heartbeatInterval=setInterval(()=>{let e=JSON.stringify({__heartbeat:Date.now()});for(let r of this.clients.values())if(r.ws.readyState===De.default.OPEN)try{r.ws.send(e)}catch{}},SN)}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}registerPort(e){if(Ue.includes(e))try{(0,Ne.existsSync)(Kt)||(0,Ne.mkdirSync)(Kt,{recursive:!0}),this.portFilePath=(0,os.join)(Kt,`${e}.pid`),(0,Ne.writeFileSync)(this.portFilePath,String(process.pid),"utf-8"),this.knownRegistryPorts.add(e)}catch(r){this.log(`Port registry write failed: ${r.message}`)}}startPortDiscovery(){if(Ue.includes(this.boundPort)){this.scanPortRegistry();try{(0,Ne.existsSync)(Kt)||(0,Ne.mkdirSync)(Kt,{recursive:!0}),this.portDirWatcher=(0,Ne.watch)(Kt,(e,r)=>{r&&r.endsWith(".pid")&&this.scanPortRegistry()}),this.portDirWatcher.on("error",()=>{this.portDirWatcher?.close(),this.portDirWatcher=null,this.portScanInterval||(this.portScanInterval=setInterval(()=>this.scanPortRegistry(),1e4))})}catch{this.portScanInterval=setInterval(()=>this.scanPortRegistry(),1e4)}}}stopPortDiscovery(){this.portDirWatcher&&(this.portDirWatcher.close(),this.portDirWatcher=null),this.portScanInterval&&(clearInterval(this.portScanInterval),this.portScanInterval=null)}scanPortRegistry(){try{let e=(0,Ne.readdirSync)(Kt).filter(r=>r.endsWith(".pid"));for(let r of e){let n=parseInt(r.replace(".pid",""),10);if(isNaN(n)||n===this.boundPort||this.knownRegistryPorts.has(n))continue;let o=(0,Ne.readFileSync)((0,os.join)(Kt,r),"utf-8").trim(),s=parseInt(o,10);if(isNaN(s)||!this.isProcessAlive(s)){try{(0,Ne.unlinkSync)((0,os.join)(Kt,r))}catch{}continue}this.knownRegistryPorts.add(n),this.notifyPluginsNewPort(n)}}catch{}}isProcessAlive(e){try{return process.kill(e,0),!0}catch{return!1}}notifyPluginsNewPort(e){let r=JSON.stringify({__discoverPort:e});for(let n of this.clients.values())if(n.ws.readyState===De.default.OPEN)try{n.ws.send(r)}catch{}this.log(`Notified plugins: new editor discovered on port ${e}`)}sendKnownPortsTo(e){for(let r of this.knownRegistryPorts)if(r!==this.boundPort)try{e.send(JSON.stringify({__discoverPort:r}))}catch{}}};function $v(t,e){t.tool("list_connected_files","List all Figma files that currently have the Outreach Figma MCP Bridge plugin running. Returns file names, IDs, current pages, and which file is active.",{},async()=>{let r=e.listClients();return{content:[{type:"text",text:JSON.stringify({connectedFiles:r.length,files:r},null,2)}]}}),t.tool("set_active_file","Set the default Figma file for subsequent commands. Accepts a file name or client ID. Required when multiple files are connected and you want to avoid passing fileId on every call.",{fileId:p.string().describe("File name or client ID to set as active. Matches by exact name, partial name, or client ID.")},async({fileId:r})=>{let n=e.setActiveClient(r);return{content:[{type:"text",text:JSON.stringify({message:`Active file set to "${n.fileName}"`,activeFile:n},null,2)}]}}),t.tool("get_document_info","Get information about the current Figma document (name, pages, etc.)",{fileId:T},async({fileId:r})=>{let n=await e.sendCommand("get_document_info",{},void 0,r);return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}}),t.tool("get_current_page","Get the current page name, ID, and top-level children",{fileId:T},async({fileId:r})=>{let n=await e.sendCommand("get_current_page",{},void 0,r);return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}}),t.tool("get_selection","Get the currently selected nodes in Figma",{fileId:T},async({fileId:r})=>{let n=await e.sendCommand("get_selection",{},void 0,r);return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}}),t.tool("get_node_by_id","Get detailed information about a node by its ID",{nodeId:p.string().describe("The Figma node ID (e.g. '12:34')"),fileId:T},async({nodeId:r,fileId:n})=>{let o=await e.sendCommand("get_node_by_id",{nodeId:r},void 0,n);return{content:[{type:"text",text:JSON.stringify(o,null,2)}]}}),t.tool("get_children","Get the direct children of a node",{nodeId:p.string().describe("Parent node ID"),depth:p.number().optional().describe("How deep to recurse (default 1)"),fileId:T},async({nodeId:r,depth:n,fileId:o})=>{let s=await e.sendCommand("get_children",{nodeId:r,depth:n??1},void 0,o);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("scan_page","Scan the current page and return a tree of all nodes (name, type, id)",{depth:p.number().optional().describe("Max depth to scan (default 3)"),fileId:T},async({depth:r,fileId:n})=>{let o=await e.sendCommand("scan_page",{depth:r??3},void 0,n);return{content:[{type:"text",text:JSON.stringify(o,null,2)}]}}),t.tool("read_my_design","Get detailed node information about the current selection without parameters (deep read of selected nodes)",{fileId:T},async({fileId:r})=>{let n=await e.sendCommand("read_my_design",{},void 0,r);return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}}),t.tool("get_nodes_info","Get detailed information about multiple nodes by providing an array of node IDs",{nodeIds:p.array(p.string()).describe("Array of node IDs to get info for"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("get_nodes_info",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("create_page","Create a new page in the Figma document",{name:p.string().optional().describe("Page name"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("create_page",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_current_page","Switch the active page by its ID",{pageId:p.string().describe("The page ID to switch to"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("set_current_page",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("get_available_fonts","List all font families available in Figma. Use this before creating text to ensure the font exists and avoid load errors. Returns up to 200 families.",{fileId:T},async({fileId:r})=>{let n=await e.sendCommand("get_available_fonts",{},void 0,r);return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}})}function kv(t,e){t.tool("create_instance","Create an instance of an existing component",{componentId:p.string().describe("The component node ID to instantiate"),x:p.number().optional().describe("X position"),y:p.number().optional().describe("Y position"),parentId:p.string().optional().describe("Parent node ID"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("create_instance",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("get_local_components","Get information about all local components. Use allPages: true to scan the entire document (all pages), which is required for library file scanning to discover all component keys.",{allPages:p.boolean().optional().describe("If true, scan all pages in the document (not just the current page). Use this when scanning a library file for component key discovery."),fileId:T},async r=>{let{fileId:n,...o}=r,s=await e.sendCommand("get_local_components",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("get_instance_overrides","Extract override properties (text, fills, visibility) from a component instance",{nodeId:p.string().describe("Instance node ID to extract overrides from"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("get_instance_overrides",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_instance_overrides","Apply multiple overrides to a component instance's children (text, fill, visibility) in one call. childName supports path syntax ('Parent > Child') for disambiguation when multiple children share the same name. Smart matching: prefers TEXT nodes when characters is set, uses breadth-first (shallowest) match by default.",{nodeId:p.string().describe("Instance node ID to apply overrides to"),overrides:p.array(p.object({childName:p.string().describe("Name of the child node, or path syntax 'Parent > Child' for disambiguation"),characters:p.string().optional().describe("New text content (for TEXT children)"),fillColor:p.object({r:p.number(),g:p.number(),b:p.number()}).optional().describe("Override fill color (r, g, b values 0-1)"),visible:p.boolean().optional().describe("Override visibility")})).describe("Array of overrides to apply"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("set_instance_overrides",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}})}var Tv=p.object({r:p.number(),g:p.number(),b:p.number()}),$N=p.object({r:p.number(),g:p.number(),b:p.number(),a:p.number()});function Ev(t,e){t.tool("set_node_property","Set general properties on a node (name, visible, opacity, rotation, locked)",{nodeId:p.string().describe("Target node ID"),name:p.string().optional().describe("New node name"),visible:p.boolean().optional().describe("Visibility"),opacity:p.number().min(0).max(1).optional().describe("Opacity 0-1"),rotation:p.number().optional().describe("Rotation in degrees"),locked:p.boolean().optional().describe("Whether node is locked"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("set_node_property",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_fill","Set the fill color(s) on a node",{nodeId:p.string().describe("Target node ID"),color:Tv.describe("Solid fill color (r, g, b values 0-1)"),opacity:p.number().min(0).max(1).optional().describe("Fill opacity"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("set_fill",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_stroke","Set the stroke on a node",{nodeId:p.string().describe("Target node ID"),color:Tv.describe("Stroke color (r, g, b values 0-1)"),weight:p.number().describe("Stroke weight"),opacity:p.number().min(0).max(1).optional().describe("Stroke opacity"),align:p.enum(["INSIDE","OUTSIDE","CENTER"]).optional().describe("Stroke alignment"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("set_stroke",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_corner_radius","Set corner radius on a node (uniform or per-corner)",{nodeId:p.string().describe("Target node ID"),radius:p.number().optional().describe("Uniform corner radius"),topLeft:p.number().optional().describe("Top-left corner radius"),topRight:p.number().optional().describe("Top-right corner radius"),bottomRight:p.number().optional().describe("Bottom-right corner radius"),bottomLeft:p.number().optional().describe("Bottom-left corner radius"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("set_corner_radius",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_text_content","Change the text characters of an existing text node",{nodeId:p.string().describe("Text node ID"),characters:p.string().describe("New text content"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("set_text_content",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_font","Set font properties on a text node",{nodeId:p.string().describe("Text node ID"),fontFamily:p.string().optional().describe("Font family (e.g. 'Inter')"),fontStyle:p.string().optional().describe("Font style (e.g. 'Bold')"),fontSize:p.number().optional().describe("Font size"),letterSpacing:p.number().optional().describe("Letter spacing"),lineHeight:p.number().optional().describe("Line height in px (use -1 for AUTO)"),textAlignHorizontal:p.enum(["LEFT","CENTER","RIGHT","JUSTIFIED"]).optional().describe("Horizontal alignment"),textAlignVertical:p.enum(["TOP","CENTER","BOTTOM"]).optional().describe("Vertical alignment"),textDecoration:p.enum(["NONE","UNDERLINE","STRIKETHROUGH"]).optional().describe("Text decoration"),textCase:p.enum(["ORIGINAL","UPPER","LOWER","TITLE"]).optional().describe("Text case transform"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("set_font",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_effects","Set effects (drop shadow, inner shadow, blur) on a node",{nodeId:p.string().describe("Target node ID"),effects:p.array(p.object({type:p.enum(["DROP_SHADOW","INNER_SHADOW","LAYER_BLUR","BACKGROUND_BLUR"]).describe("Effect type"),color:$N.optional().describe("Effect color (for shadows)"),offset:p.object({x:p.number(),y:p.number()}).optional().describe("Shadow offset"),radius:p.number().describe("Blur radius"),spread:p.number().optional().describe("Shadow spread"),visible:p.boolean().optional().describe("Effect visibility")})).describe("Array of effects to apply"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("set_effects",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("scan_text_nodes","Scan text nodes with intelligent chunking for large designs. Returns text content, font info, and position.",{nodeId:p.string().optional().describe("Optional root node ID to scope the scan (defaults to current page)"),chunkSize:p.number().optional().describe("Number of text nodes per chunk (defaults to all)"),chunkIndex:p.number().optional().describe("Which chunk to return (0-based, defaults to 0)"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("scan_text_nodes",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_multiple_text_contents","Batch update the text content of multiple text nodes efficiently",{entries:p.array(p.object({nodeId:p.string().describe("Text node ID"),characters:p.string().describe("New text content")})).describe("Array of {nodeId, characters} entries to update"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("set_multiple_text_contents",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}})}function Iv(t,e){t.tool("set_auto_layout","Configure auto layout on a frame or component",{nodeId:p.string().describe("Target frame/component ID"),mode:p.enum(["HORIZONTAL","VERTICAL"]).describe("Layout direction"),itemSpacing:p.number().optional().describe("Spacing between items"),paddingTop:p.number().optional().describe("Top padding"),paddingRight:p.number().optional().describe("Right padding"),paddingBottom:p.number().optional().describe("Bottom padding"),paddingLeft:p.number().optional().describe("Left padding"),primaryAxisAlignItems:p.enum(["MIN","MAX","CENTER","SPACE_BETWEEN"]).optional().describe("Primary axis alignment"),counterAxisAlignItems:p.enum(["MIN","MAX","CENTER"]).optional().describe("Counter axis alignment"),primaryAxisSizingMode:p.enum(["FIXED","AUTO"]).optional().describe("Primary axis sizing"),counterAxisSizingMode:p.enum(["FIXED","AUTO"]).optional().describe("Counter axis sizing"),layoutWrap:p.enum(["NO_WRAP","WRAP"]).optional().describe("Whether children wrap"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("set_auto_layout",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("move_node","Move a node to a new x, y position",{nodeId:p.string().describe("Target node ID"),x:p.number().describe("New X position"),y:p.number().describe("New Y position"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("move_node",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("resize_node","Resize a node to new dimensions",{nodeId:p.string().describe("Target node ID"),width:p.number().describe("New width"),height:p.number().describe("New height"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("resize_node",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("append_child","Move a node to become the last child of a parent",{parentId:p.string().describe("Parent node ID"),childId:p.string().describe("Child node ID to move"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("append_child",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("remove_node","Delete a node from the document",{nodeId:p.string().describe("Node ID to remove"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("remove_node",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("clone_node","Clone/duplicate a node",{nodeId:p.string().describe("Node ID to clone"),parentId:p.string().optional().describe("Parent to place clone into (default: same parent)"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("clone_node",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("delete_multiple_nodes","Delete multiple nodes at once efficiently",{nodeIds:p.array(p.string()).describe("Array of node IDs to delete"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("delete_multiple_nodes",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_layout_sizing","Set layout sizing behavior on an auto-layout child (FILL to stretch, HUG to fit content, FIXED for explicit size)",{nodeId:p.string().describe("Target node ID (must be a child of an auto-layout frame)"),horizontal:p.enum(["FILL","HUG","FIXED"]).optional().describe("Horizontal sizing: FILL (stretch), HUG (fit content), or FIXED"),vertical:p.enum(["FILL","HUG","FIXED"]).optional().describe("Vertical sizing: FILL (stretch), HUG (fit content), or FIXED"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("set_layout_sizing",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}})}function zv(t,e){t.tool("export_node","Export a node as an image (returns base64-encoded data)",{nodeId:p.string().describe("Node ID to export"),format:p.enum(["PNG","JPG","SVG","PDF"]).optional().describe("Export format (default PNG)"),scale:p.number().optional().describe("Export scale (default 1)"),contentsOnly:p.boolean().optional().describe("Export only contents, not the node background"),fileId:T},async r=>{let n=await e.sendCommand("export_node",{nodeId:r.nodeId,format:r.format??"PNG",scale:r.scale??1,contentsOnly:r.contentsOnly??!1},void 0,r.fileId);return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}}),t.tool("verify_design","Export a node as a PNG screenshot and return it alongside the node tree for visual verification. Use this after creating or modifying designs to close the feedback loop: create \u2192 verify \u2192 fix.",{nodeId:p.string().describe("Node ID to export and verify (typically a frame)"),width:p.number().optional().describe("Width constraint for the exported PNG in pixels (default 800)"),depth:p.number().optional().describe("How deep to serialize the node tree (default 2)"),fileId:T},async r=>{let n=await e.sendCommand("verify_design",{nodeId:r.nodeId,width:r.width??800,depth:r.depth??2},void 0,r.fileId),o=[];return n.image&&o.push({type:"image",data:n.image,mimeType:"image/png"}),o.push({type:"text",text:JSON.stringify({nodeInfo:n.nodeInfo,byteLength:n.byteLength},null,2)}),{content:o}})}var Pv=p.object({r:p.number().min(0).max(1).describe("Red channel (0-1)"),g:p.number().min(0).max(1).describe("Green channel (0-1)"),b:p.number().min(0).max(1).describe("Blue channel (0-1)")}),Nv=p.object({type:p.enum(["DROP_SHADOW","INNER_SHADOW","LAYER_BLUR","BACKGROUND_BLUR"]).describe("Effect type"),radius:p.number().describe("Blur radius in pixels"),color:p.object({r:p.number().min(0).max(1),g:p.number().min(0).max(1),b:p.number().min(0).max(1),a:p.number().min(0).max(1).optional()}).optional().describe("Effect color with alpha (for shadows)"),offset:p.object({x:p.number(),y:p.number()}).optional().describe("Shadow offset in pixels (for shadows)"),spread:p.number().optional().describe("Shadow spread in pixels (for shadows)")});function Ov(t,e){t.tool("get_local_styles","Get all local paint, text, and effect styles in the document",{styleType:p.enum(["PAINT","TEXT","EFFECT","GRID","ALL"]).optional().describe("Filter by style type (default ALL)"),fileId:T},async({styleType:r})=>{let n=await e.sendCommand("get_local_styles",{styleType:r??"ALL"});return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}}),t.tool("get_node_styles",`Extract all paint, text, and effect style references from a node and its entire subtree. Returns style IDs, keys, names, and where they were found.

Use this to discover library styles by inspecting library component instances: create an instance of a library component, then call this tool on it to find all the style keys used. Those keys can then be reused with fillStyleKey/strokeStyleKey/textStyleKey/effectStyleKey in build specs.

Workflow for library style discovery:
1. create_instance of a library component (e.g. a button)
2. get_node_styles on the instance \u2192 returns all style keys
3. Use those keys in specs or remove the temporary instance`,{nodeId:p.string().describe("Node ID to extract styles from (walks the entire subtree)"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("get_node_styles",o,3e4,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("create_paint_style","Create a new paint style with a solid fill color. Used in design system authoring (create mode) to define reusable color styles.",{name:p.string().describe("Style name (e.g. 'Primary/Main', 'Background/Default')"),color:Pv.describe("Solid fill color (RGB 0-1)"),opacity:p.number().min(0).max(1).optional().describe("Fill opacity (default 1)"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("create_paint_style",o,15e3,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("create_text_style","Create a new text style with font family, size, and optional line height / letter spacing. Used in design system authoring (create mode) to define reusable typography styles.",{name:p.string().describe("Style name (e.g. 'Heading/H1', 'Body/Body 1')"),fontFamily:p.string().describe("Font family name (e.g. 'Inter', 'Roboto Flex')"),fontStyle:p.string().describe("Font style (e.g. 'Regular', 'Bold', 'SemiBold')"),fontSize:p.number().describe("Font size in pixels"),lineHeight:p.number().optional().describe("Line height in pixels, or -1 for AUTO"),letterSpacing:p.number().optional().describe("Letter spacing in pixels"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("create_text_style",o,15e3,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("create_effect_style","Create a new effect style with one or more effects (shadows, blurs). Used in design system authoring (create mode) to define reusable elevation/effect styles.",{name:p.string().describe("Style name (e.g. 'Elevation/Level 1', 'Shadow/Card')"),effects:p.array(Nv).describe("Array of effects to apply"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("create_effect_style",o,15e3,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("apply_style","Apply an existing style (paint, text, or effect) to a node by style ID.",{nodeId:p.string().describe("Target node ID"),styleId:p.string().describe("Style ID to apply"),styleType:p.enum(["FILL","STROKE","TEXT","EFFECT"]).describe("Type of style to apply"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("apply_style",o,15e3,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("update_paint_style","Update an existing paint style's color and/or opacity. Finds the style by ID and replaces its paint values.",{styleId:p.string().describe("ID of the paint style to update"),color:Pv.optional().describe("New solid fill color (RGB 0-1)"),opacity:p.number().min(0).max(1).optional().describe("New fill opacity"),name:p.string().optional().describe("New name for the style"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("update_paint_style",o,15e3,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("update_text_style","Update an existing text style's font properties. Finds the style by ID and updates the specified properties.",{styleId:p.string().describe("ID of the text style to update"),name:p.string().optional().describe("New name for the style"),fontFamily:p.string().optional().describe("New font family"),fontStyle:p.string().optional().describe("New font style (e.g. 'Bold', 'Regular')"),fontSize:p.number().optional().describe("New font size in pixels"),lineHeight:p.number().optional().describe("New line height in pixels, or -1 for AUTO"),letterSpacing:p.number().optional().describe("New letter spacing in pixels"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("update_text_style",o,15e3,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("update_effect_style","Update an existing effect style's effects. Finds the style by ID and replaces all effects.",{styleId:p.string().describe("ID of the effect style to update"),name:p.string().optional().describe("New name for the style"),effects:p.array(Nv).optional().describe("New array of effects (replaces all existing effects)"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("update_effect_style",o,15e3,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("rename_style","Rename any style (paint, text, or effect) by ID.",{styleId:p.string().describe("ID of the style to rename"),name:p.string().describe("New name for the style"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("rename_style",o,15e3,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("delete_style","Delete a style (paint, text, or effect) by ID. This permanently removes it from the document.",{styleId:p.string().describe("ID of the style to delete"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("delete_style",o,15e3,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}})}function Rv(t,e){t.tool("find_nodes_by_name","Search for nodes by name (supports substring matching). Returns matching nodes from the current page.",{query:p.string().describe("Name or substring to search for"),caseSensitive:p.boolean().optional().describe("Whether the search is case-sensitive (default false)"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("find_nodes_by_name",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("find_nodes_by_type","Find all nodes of a given type on the current page (e.g. TEXT, FRAME, RECTANGLE, COMPONENT, INSTANCE)",{nodeType:p.string().describe("The node type to filter by (e.g. 'TEXT', 'FRAME', 'RECTANGLE', 'COMPONENT', 'INSTANCE')"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("find_nodes_by_type",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}})}var Cv=new Set(["frame","text","rectangle","ellipse","line","component","vector","instance"]),kN=new Set(["HORIZONTAL","VERTICAL"]),TN=new Set(["MIN","MAX","CENTER","SPACE_BETWEEN"]),EN=new Set(["MIN","MAX","CENTER"]),Av=new Set(["FIXED","AUTO"]),Mv=new Set(["FILL","HUG","FIXED"]),IN=new Set(["LEFT","CENTER","RIGHT","JUSTIFIED"]),zN=new Set(["DROP_SHADOW","INNER_SHADOW","LAYER_BLUR","BACKGROUND_BLUR"]),PN=new Set(["COLUMNS","ROWS","GRID"]),NN=new Set(["MIN","MAX","CENTER","STRETCH"]);function vf(t){let e=[];function r(o,s){if(!o||typeof o!="object")return e.push(`${s}: must be an {r, g, b} object`),!1;let i=o;return typeof i.r!="number"||typeof i.g!="number"||typeof i.b!="number"?(e.push(`${s}: r, g, b must all be numbers (0-1)`),!1):!0}function n(o,s){if(!o||typeof o!="object"){e.push(`${s}: must be an object`);return}let i=o;if((!i.name||typeof i.name!="string")&&e.push(`${s}: "name" is required and must be a string`),!i.type||typeof i.type!="string"||!Cv.has(i.type)){e.push(`${s}: "type" must be one of: ${[...Cv].join(", ")}`);return}if(i.type==="text"&&(i.characters===void 0||i.characters===null?e.push(`${s}: text nodes require a "characters" field`):typeof i.characters!="string"&&e.push(`${s}: "characters" must be a string`)),i.type==="instance"&&(!i.componentKey&&!i.componentId&&e.push(`${s}: instance nodes require "componentKey" (library) or "componentId" (local)`),i.componentKey&&typeof i.componentKey!="string"&&e.push(`${s}: "componentKey" must be a string`),i.componentId&&typeof i.componentId!="string"&&e.push(`${s}: "componentId" must be a string`),i.instanceOverrides!==void 0))if(!Array.isArray(i.instanceOverrides))e.push(`${s}.instanceOverrides: must be an array`);else for(let a=0;a<i.instanceOverrides.length;a++){let c=i.instanceOverrides[a];(!c.childName||typeof c.childName!="string")&&e.push(`${s}.instanceOverrides[${a}].childName: required string`)}for(let a of["x","y","width","height","cornerRadius","opacity","fillOpacity","fontSize"])i[a]!==void 0&&typeof i[a]!="number"&&e.push(`${s}: "${a}" must be a number`);if(i.fill!==void 0&&r(i.fill,`${s}.fill`),i.stroke!==void 0){let a=i.stroke;!a||typeof a!="object"?e.push(`${s}.stroke: must be an object`):(r(a.color,`${s}.stroke.color`),typeof a.weight!="number"&&e.push(`${s}.stroke.weight: must be a number`))}if(i.autoLayout!==void 0){i.type!=="frame"&&i.type!=="component"&&e.push(`${s}: autoLayout is only valid on frame or component types`);let a=i.autoLayout;!a||typeof a!="object"?e.push(`${s}.autoLayout: must be an object`):((!a.mode||!kN.has(a.mode))&&e.push(`${s}.autoLayout.mode: must be "HORIZONTAL" or "VERTICAL"`),a.primaryAxisAlignItems!==void 0&&!TN.has(a.primaryAxisAlignItems)&&e.push(`${s}.autoLayout.primaryAxisAlignItems: invalid value`),a.counterAxisAlignItems!==void 0&&!EN.has(a.counterAxisAlignItems)&&e.push(`${s}.autoLayout.counterAxisAlignItems: invalid value`),a.primaryAxisSizingMode!==void 0&&!Av.has(a.primaryAxisSizingMode)&&e.push(`${s}.autoLayout.primaryAxisSizingMode: must be "FIXED" or "AUTO"`),a.counterAxisSizingMode!==void 0&&!Av.has(a.counterAxisSizingMode)&&e.push(`${s}.autoLayout.counterAxisSizingMode: must be "FIXED" or "AUTO"`))}if(i.layoutSizing!==void 0){let a=i.layoutSizing;!a||typeof a!="object"?e.push(`${s}.layoutSizing: must be an object`):(a.horizontal!==void 0&&!Mv.has(a.horizontal)&&e.push(`${s}.layoutSizing.horizontal: must be "FILL", "HUG", or "FIXED"`),a.vertical!==void 0&&!Mv.has(a.vertical)&&e.push(`${s}.layoutSizing.vertical: must be "FILL", "HUG", or "FIXED"`))}for(let a of["fillVariable","strokeVariable","textFillVariable"])i[a]!==void 0&&typeof i[a]!="string"&&e.push(`${s}: "${a}" must be a string (Figma variable ID)`);if(i.layoutGrids!==void 0)if(i.type!=="frame"&&i.type!=="component"&&e.push(`${s}: layoutGrids is only valid on frame or component types`),!Array.isArray(i.layoutGrids))e.push(`${s}.layoutGrids: must be an array`);else for(let a=0;a<i.layoutGrids.length;a++){let c=i.layoutGrids[a];(!c.pattern||!PN.has(c.pattern))&&e.push(`${s}.layoutGrids[${a}].pattern: must be "COLUMNS", "ROWS", or "GRID"`),c.alignment!==void 0&&!NN.has(c.alignment)&&e.push(`${s}.layoutGrids[${a}].alignment: must be "MIN", "MAX", "CENTER", or "STRETCH"`);for(let l of["sectionSize","count","gutterSize","offset"])c[l]!==void 0&&typeof c[l]!="number"&&e.push(`${s}.layoutGrids[${a}].${l}: must be a number`)}if(i.textAlignHorizontal!==void 0&&!IN.has(i.textAlignHorizontal)&&e.push(`${s}.textAlignHorizontal: invalid value`),i.effects!==void 0)if(!Array.isArray(i.effects))e.push(`${s}.effects: must be an array`);else for(let a=0;a<i.effects.length;a++){let c=i.effects[a];(!c.type||!zN.has(c.type))&&e.push(`${s}.effects[${a}].type: invalid effect type`),typeof c.radius!="number"&&e.push(`${s}.effects[${a}].radius: must be a number`)}if(i.children!==void 0)if(i.type!=="frame"&&i.type!=="component")e.push(`${s}: only frame and component types can have children (use instanceOverrides for instance type)`);else if(!Array.isArray(i.children))e.push(`${s}.children: must be an array`);else for(let a=0;a<i.children.length;a++)n(i.children[a],`${s}.children[${a}]`)}return n(t,"spec"),{valid:e.length===0,errors:e}}function fa(t){if(!t||typeof t!="object")return 0;let e=t,r=1;if(Array.isArray(e.children))for(let n of e.children)r+=fa(n);return r}var ON=3e4,RN=2e3;function Dv(t){return ON+t*RN}var jv=`
The spec is a JSON object describing a component tree. Every node requires "name" and "type".

Supported types: frame, text, rectangle, ellipse, line, component, vector, instance.

Key fields:
  - name (string, required): Semantic layer name
  - type (string, required): Node type
  - x, y (number): Position
  - width, height (number): Dimensions
  - fill ({r,g,b}): Solid fill color (values 0-1)
  - fillOpacity (number): Fill opacity 0-1
  - stroke ({color:{r,g,b}, weight, align?}): Stroke
  - cornerRadius (number): Corner radius
  - opacity (number): Node opacity 0-1
  - visible (boolean): Visibility
  - clipContent (boolean): Clip children to frame bounds
  - effects ([{type, radius, color?, offset?, spread?}]): Shadows/blurs

Variable bindings (bind fills/strokes to Figma variables for theme support):
  - fillVariable (string): Figma variable ID to bind to fill color (e.g. "VariableID:abc/123:456")
  - strokeVariable (string): Figma variable ID to bind to stroke color
  - textFillVariable (string): Figma variable ID to bind to text fill color (text nodes only)

Text-specific (type: "text"):
  - characters (string, required): Text content
  - fontSize (number): Font size in px
  - fontFamily (string): Font family (default "Inter")
  - fontStyle (string): Font style (default "Regular")
  - textAlignHorizontal: LEFT | CENTER | RIGHT | JUSTIFIED

Auto-layout (type: "frame" or "component"):
  - autoLayout ({mode, itemSpacing?, padding?, primaryAxisAlignItems?, counterAxisAlignItems?, primaryAxisSizingMode?, counterAxisSizingMode?})
  - autoLayout.padding: number (uniform) or {top?, right?, bottom?, left?}

Layout grids (type: "frame" or "component"):
  - layoutGrids ([{pattern, sectionSize?, count?, gutterSize?, offset?, alignment?, color?, visible?}])
  - pattern: "COLUMNS" | "ROWS" | "GRID"
  - alignment: "MIN" | "MAX" | "CENTER" | "STRETCH" (for COLUMNS/ROWS)

Layout sizing (when inside an auto-layout parent):
  - layoutSizing ({horizontal?: FILL|HUG|FIXED, vertical?: FILL|HUG|FIXED})

Instance (type: "instance" \u2014 use library or local components):
  - componentKey (string): Component key from a published Figma library
  - componentId (string): Local component node ID (alternative to componentKey)
  - instanceOverrides ([{childName, characters?, fillColor?, visible?}]): Overrides for instance children
    childName supports path syntax ("Parent > Child") for disambiguation when names collide.
    Smart matching: prefers TEXT nodes when characters is set, uses breadth-first (shallowest) match.

Nesting:
  - children (array of spec nodes): Only for frame and component types (instances use instanceOverrides)

Example:
{
  "name": "Card",
  "type": "frame",
  "width": 320,
  "height": 200,
  "fill": {"r": 1, "g": 1, "b": 1},
  "fillVariable": "VariableID:abc/123:456",
  "cornerRadius": 12,
  "autoLayout": {"mode": "VERTICAL", "itemSpacing": 16, "padding": 24},
  "layoutGrids": [{"pattern": "COLUMNS", "count": 4, "gutterSize": 16, "alignment": "STRETCH"}],
  "effects": [{"type": "DROP_SHADOW", "radius": 8, "color": {"r":0,"g":0,"b":0,"a":0.15}, "offset": {"x":0,"y":2}}],
  "children": [
    {"name": "Title", "type": "text", "characters": "Hello World", "fontSize": 24, "fontStyle": "Bold", "fill": {"r":0.1,"g":0.1,"b":0.1}},
    {"name": "Body", "type": "text", "characters": "Description text here", "fontSize": 14, "fill": {"r":0.4,"g":0.4,"b":0.4}, "layoutSizing": {"horizontal": "FILL"}}
  ]
}`.trim();function Lv(t,e){t.tool("build_from_spec",`Build a complete Figma component tree from a structured JSON specification in a single atomic operation. Instead of calling create_frame, create_text, set_auto_layout, etc. individually (50+ calls for a complex screen), pass a single spec that describes the entire tree. The plugin builds everything atomically with correct ordering: auto-layout is set before children are appended, layoutSizing is set after parent attachment. Returns the full created tree with all node IDs.

${jv}`,{spec:p.string().describe("JSON string of the component tree specification. Must have 'name' and 'type' at minimum. See tool description for full schema."),parentId:p.string().optional().describe("Parent node ID to build into (defaults to current page)"),fileId:T},async r=>{let n;try{n=JSON.parse(r.spec)}catch(c){return{content:[{type:"text",text:`Error: Failed to parse spec JSON.
${c instanceof Error?c.message:String(c)}

Make sure the spec is valid JSON.`}]}}let o=vf(n);if(!o.valid)return{content:[{type:"text",text:`Spec validation failed (${o.errors.length} error(s)):

${o.errors.map((c,l)=>`${l+1}. ${c}`).join(`
`)}`}]};let s=fa(n),i=Dv(s),a=await e.sendCommand("build_component_tree",{spec:n,parentId:r.parentId},i,r.fileId);return{content:[{type:"text",text:JSON.stringify({summary:{nodesCreated:s,rootNodeId:a?.id},tree:a},null,2)}]}}),t.tool("build_and_verify",`Build a component tree from spec AND automatically verify the result. This is the recommended workflow \u2014 it builds the tree atomically, exports a screenshot for visual inspection, and runs structural validation against the spec. Returns: screenshot image, validation report, and full node tree.

Workflow: parse spec \u2192 validate \u2192 build atomically \u2192 export screenshot \u2192 structural diff \u2192 return everything.

${jv}`,{spec:p.string().describe("JSON string of the component tree specification (same format as build_from_spec)"),parentId:p.string().optional().describe("Parent node ID to build into (defaults to current page)"),screenshotWidth:p.number().optional().describe("Width for the verification screenshot in pixels (default: auto from spec width, or 800)"),fileId:T},async r=>{let n;try{n=JSON.parse(r.spec)}catch(f){return{content:[{type:"text",text:`Error: Failed to parse spec JSON.
${f instanceof Error?f.message:String(f)}`}]}}let o=vf(n);if(!o.valid)return{content:[{type:"text",text:`Spec validation failed (${o.errors.length} error(s)):

${o.errors.map((f,m)=>`${m+1}. ${f}`).join(`
`)}`}]};let s=fa(n),i=Dv(s),a=await e.sendCommand("build_component_tree",{spec:n,parentId:r.parentId},i,r.fileId),c=a?.id;if(!c)return{content:[{type:"text",text:`Build failed: no root node ID returned.
${JSON.stringify(a,null,2)}`}]};let l=r.screenshotWidth??n.width??800,u=await e.sendCommand("verify_design",{nodeId:c,width:l,depth:6},void 0,r.fileId),d=await e.sendCommand("validate_tree",{nodeId:c,spec:n},void 0,r.fileId),g=[];u.image&&g.push({type:"image",data:u.image,mimeType:"image/png"});let h={summary:{nodesCreated:s,rootNodeId:c,screenshotBytes:u.byteLength},validation:d,nodeTree:u.nodeInfo};return g.push({type:"text",text:JSON.stringify(h,null,2)}),{content:g}}),t.tool("validate_tree","Validate an existing Figma node tree against a component tree spec. Walks both trees in parallel and reports structural differences: type mismatches, dimension drift, missing children, text content changes, and layout property deviations. Use this to verify that a built design matches its spec, or to audit spec compliance after manual edits.",{nodeId:p.string().describe("Root node ID of the Figma tree to validate"),spec:p.string().describe("JSON string of the expected component tree specification"),fileId:T},async r=>{let n;try{n=JSON.parse(r.spec)}catch(s){return{content:[{type:"text",text:`Error: Failed to parse spec JSON.
${s instanceof Error?s.message:String(s)}`}]}}let o=await e.sendCommand("validate_tree",{nodeId:r.nodeId,spec:n},void 0,r.fileId);return{content:[{type:"text",text:JSON.stringify(o,null,2)}]}})}var bf=3e4,xf=500;function Zv(t,e){t.tool("get_local_variables","Get all local variables and variable collections in the document. When includeLibrary is true (default), also imports and returns all variables from enabled team libraries \u2014 making them available for use with fillVariable/strokeVariable/textFillVariable bindings. Returns variables with their types, values per mode, scopes, and descriptions, plus all collections with their modes and variable IDs.",{includeLibrary:p.boolean().optional().describe("When true (default), also imports and returns variables from enabled team libraries. Set to false for local-only variables."),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("get_local_variables",o,18e4,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("get_variable_by_id","Get detailed information about a specific variable by its ID",{variableId:p.string().describe("The variable ID (e.g. 'VariableID:123:456')"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("get_variable_by_id",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("get_variable_collection_by_id","Get detailed information about a specific variable collection by its ID",{collectionId:p.string().describe("The variable collection ID"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("get_variable_collection_by_id",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("create_variable_collection","Create a new variable collection with optional initial mode name and additional modes. Collections group related design tokens (e.g. 'Brand Colors', 'Spacing').",{name:p.string().describe("Collection name (e.g. 'Brand Colors')"),initialModeName:p.string().optional().describe("Name for the default mode (default is 'Mode 1'). E.g. 'Light'"),additionalModes:p.array(p.string()).optional().describe("Additional modes to create (e.g. ['Dark', 'High Contrast'])"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("create_variable_collection",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("create_variable","Create a new variable (design token) in a collection. Supports COLOR, FLOAT, STRING, and BOOLEAN types. For COLOR values, you can pass hex strings (e.g. '#5E5EAF') or RGB objects ({r, g, b} with 0-1 values). Use 'VariableID:...' strings to create variable aliases.",{name:p.string().describe("Variable name (e.g. 'primary/main' or 'spacing/sm')"),collectionId:p.string().describe("ID of the collection to add the variable to"),resolvedType:p.enum(["COLOR","FLOAT","STRING","BOOLEAN"]).describe("The variable data type"),valuesByMode:p.record(p.unknown()).optional().describe("Initial values per mode. Keys are mode IDs, values depend on type. COLOR: hex string or {r,g,b} object. FLOAT: number. STRING: string. BOOLEAN: true/false."),description:p.string().optional().describe("Variable description"),scopes:p.array(p.string()).optional().describe("Scopes limiting where the variable can be applied (e.g. ['ALL_FILLS', 'STROKE_COLOR'])"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("create_variable",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("update_variable","Update a variable's value for a specific mode. For COLOR variables, accepts hex strings or RGB objects. Use 'VariableID:...' strings to set variable aliases.",{variableId:p.string().describe("The variable ID to update"),modeId:p.string().describe("The mode ID to set the value for"),value:p.unknown().describe("The new value. COLOR: hex or {r,g,b}. FLOAT: number. STRING: string. BOOLEAN: boolean."),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("update_variable",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("rename_variable","Rename a variable while preserving all its values and references",{variableId:p.string().describe("The variable ID to rename"),newName:p.string().describe("The new variable name"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("rename_variable",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("delete_variable","Delete a variable. This will remove all values and break any references to this variable.",{variableId:p.string().describe("The variable ID to delete"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("delete_variable",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("delete_variable_collection","Delete a variable collection and all its variables",{collectionId:p.string().describe("The collection ID to delete"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("delete_variable_collection",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("add_mode","Add a new mode to a variable collection (e.g. add 'Dark' mode to a color collection)",{collectionId:p.string().describe("The collection ID to add the mode to"),modeName:p.string().describe("Name for the new mode (e.g. 'Dark')"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("add_mode",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("rename_mode","Rename a mode in a variable collection (e.g. rename 'Mode 1' to 'Light')",{collectionId:p.string().describe("The collection ID containing the mode"),modeId:p.string().describe("The mode ID to rename"),newName:p.string().describe("The new mode name"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("rename_mode",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("batch_create_variables","Create up to 100 variables in a single collection in one call. Much faster than individual create_variable calls for bulk token setup. Returns per-item success/failure results.",{collectionId:p.string().describe("The collection ID to add variables to"),variables:p.array(p.object({name:p.string().describe("Variable name"),resolvedType:p.enum(["COLOR","FLOAT","STRING","BOOLEAN"]).describe("Data type"),valuesByMode:p.record(p.unknown()).optional().describe("Values per mode"),description:p.string().optional().describe("Description"),scopes:p.array(p.string()).optional().describe("Scopes")})).describe("Array of variable definitions to create (max 100)"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=o.variables||[],i=bf+s.length*xf,a=await e.sendCommand("batch_create_variables",o,i,n);return{content:[{type:"text",text:JSON.stringify(a,null,2)}]}}),t.tool("batch_update_variables","Update up to 100 variable values in one call. Each update specifies a variable ID, mode ID, and new value. Much faster than individual update_variable calls.",{updates:p.array(p.object({variableId:p.string().describe("Variable ID to update"),modeId:p.string().describe("Mode ID to set the value for"),value:p.unknown().describe("New value")})).describe("Array of variable updates to apply (max 100)"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=o.updates||[],i=bf+s.length*xf,a=await e.sendCommand("batch_update_variables",o,i,n);return{content:[{type:"text",text:JSON.stringify(a,null,2)}]}}),t.tool("setup_design_tokens",`Create a complete design token system atomically in one call: collection + modes + variables with all values. This is the fastest way to bootstrap a token system from scratch.

Variable values are mapped positionally to modes. For example, if modes are ["Light", "Dark"] and a variable has values ["#5E5EAF", "#8481C9"], then Light gets #5E5EAF and Dark gets #8481C9.

Example spec:
{
  "collectionName": "Brand Colors",
  "modes": ["Light", "Dark"],
  "variables": [
    { "name": "primary/main", "resolvedType": "COLOR", "values": ["#5E5EAF", "#8481C9"], "description": "Primary brand color" },
    { "name": "primary/light", "resolvedType": "COLOR", "values": ["#797BBD", "#AA9BFD"] },
    { "name": "spacing/sm", "resolvedType": "FLOAT", "values": [8, 8] },
    { "name": "compact", "resolvedType": "BOOLEAN", "values": [false, true] }
  ]
}`,{collectionName:p.string().describe("Name for the new collection (e.g. 'Brand Colors')"),modes:p.array(p.string()).optional().describe("Mode names in order (e.g. ['Light', 'Dark']). If omitted, uses the default single mode."),variables:p.array(p.object({name:p.string().describe("Variable name (e.g. 'primary/main')"),resolvedType:p.enum(["COLOR","FLOAT","STRING","BOOLEAN"]).describe("Data type"),values:p.array(p.unknown()).describe("Values mapped positionally to modes. COLOR: hex or {r,g,b}. FLOAT: number. STRING: string. BOOLEAN: boolean."),description:p.string().optional().describe("Variable description"),scopes:p.array(p.string()).optional().describe("Variable scopes")})).describe("Array of variable definitions (max 100)"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=o.variables||[],i=bf+s.length*xf,a=await e.sendCommand("setup_design_tokens",o,i,n);return{content:[{type:"text",text:JSON.stringify(a,null,2)}]}})}function Fv(t,e){t.tool("get_console_logs","Retrieve captured console logs from the Figma plugin. Logs are captured from console.log/info/warn/error/debug calls in the plugin sandbox. Supports filtering by level and timestamp, and limiting the number of results. Use the 'since' parameter for polling (pass the timestamp of the last retrieved log).",{limit:p.number().optional().describe("Maximum number of log entries to return (most recent first). Default: all."),level:p.enum(["log","info","warn","error","debug"]).optional().describe("Filter by log level"),since:p.number().optional().describe("Only return logs with timestamp >= this value (Unix ms). Use for polling."),fileId:T},async r=>{let n=e.getConsoleLogs({fileId:r.fileId,limit:r.limit,level:r.level,since:r.since});return{content:[{type:"text",text:JSON.stringify({count:n.length,logs:n.map(o=>({level:o.level,message:o.message,args:o.args,timestamp:o.timestamp,file:o.fileName}))},null,2)}]}}),t.tool("clear_console_logs","Clear all buffered console logs for the target Figma file. Useful to reset the buffer before testing a specific interaction.",{fileId:T},async r=>{let n=e.clearConsoleLogs(r.fileId);return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}})}function Uv(t,e){t.tool("arrange_component_set",'Combine multiple component nodes into a proper Figma component set (variant group). This is the programmatic equivalent of "Combine as Variants" in Figma. Components must follow the variant naming convention: "Property=Value, Property2=Value2" (e.g. "Size=md, State=default"). Returns the created component set with parsed variant axes.',{componentIds:p.array(p.string()).describe("Array of component node IDs to combine into a variant set. Each must be a COMPONENT type node."),name:p.string().optional().describe("Optional name for the component set (e.g. 'Button')"),parentId:p.string().optional().describe("Parent node ID for the component set (defaults to the first component's parent)"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("arrange_component_set",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("get_component_set_info","Get detailed information about a component set including all variant axes (properties and their possible values), individual variants with their properties, the default variant, and component property definitions. Use this to understand the variant structure before creating instances.",{nodeId:p.string().describe("The COMPONENT_SET node ID to inspect"),fileId:T},async r=>{let{fileId:n,rest:o}=O(r),s=await e.sendCommand("get_component_set_info",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}})}function qv(t,e,r=.02){return Math.abs(t.r-e.r)<=r&&Math.abs(t.g-e.g)<=r&&Math.abs(t.b-e.b)<=r}function CN(t){return Array.isArray(t)?t.filter(e=>e.type==="SOLID"&&e.visible!==!1).map(e=>e.color):[]}function AN(t){switch(t){case"critical":return 0;case"warning":return .5;case"info":return .9}}function Vv(t,e){t.tool("check_design_parity",`Compare a Figma design node against a structured code specification to find mismatches between design and implementation. The tool fetches the Figma node's properties and diffs them against the code spec.

The codeSpec should be a JSON object with any of these optional sections:
- colors: Array of {name, value: {r,g,b}} \u2014 expected fill/stroke colors (0-1 range)
- typography: {fontFamily?, fontSize?, fontWeight?, lineHeight?, letterSpacing?}
- spacing: {padding?: {top,right,bottom,left}, gap?, margin?}
- borderRadius: number or {topLeft, topRight, bottomRight, bottomLeft}
- border: {width?, color?: {r,g,b}}
- dimensions: {width?, height?}
- opacity: number (0-1)

Returns a scored report (0-100) with per-property comparison and actionable fix items.`,{nodeId:p.string().describe("Figma node ID to inspect"),codeSpec:p.string().describe("JSON string describing the code implementation properties"),depth:p.number().optional().describe("How deep to inspect children (default 1)"),fileId:T},async r=>{let{fileId:n}=O(r),o;try{o=JSON.parse(r.codeSpec)}catch(m){return{content:[{type:"text",text:`Error: Failed to parse codeSpec JSON.
${m instanceof Error?m.message:String(m)}`}]}}let s=await e.sendCommand("get_node_by_id",{nodeId:r.nodeId},void 0,n),i=[],a=0;if(o.colors&&Array.isArray(o.colors)){let m=CN(s.fills);for(let y of o.colors){a++;let b=y.value;m.find(w=>qv(w,b))||i.push({category:"color",property:y.name||"fill",severity:"critical",designValue:m.length>0?m[0]:null,codeValue:b,message:`Color "${y.name||"fill"}" not found in design fills`})}}if(o.typography&&s.type==="TEXT"){let m=o.typography;if(m.fontFamily){a++;let y=s.fontName&&typeof s.fontName=="object"&&s.fontName.family;y&&y!==m.fontFamily&&i.push({category:"typography",property:"fontFamily",severity:"critical",designValue:y,codeValue:m.fontFamily,message:`Font family: design uses "${y}", code uses "${m.fontFamily}"`})}if(m.fontSize!==void 0&&(a++,s.fontSize!==void 0&&s.fontSize!==m.fontSize&&i.push({category:"typography",property:"fontSize",severity:"warning",designValue:s.fontSize,codeValue:m.fontSize,message:`Font size: design ${s.fontSize}px vs code ${m.fontSize}px`})),m.lineHeight!==void 0){a++;let y=s.lineHeight;y&&typeof y=="object"&&y.value!==m.lineHeight&&i.push({category:"typography",property:"lineHeight",severity:"info",designValue:y,codeValue:m.lineHeight,message:"Line height differs"})}}if(o.spacing){let m=o.spacing;if(m.padding){for(let y of["top","right","bottom","left"])if(m.padding[y]!==void 0){a++;let b=`padding${y.charAt(0).toUpperCase()+y.slice(1)}`,x=s[b];x!==void 0&&x!==m.padding[y]&&i.push({category:"spacing",property:`padding.${y}`,severity:"warning",designValue:x,codeValue:m.padding[y],message:`Padding ${y}: design ${x}px vs code ${m.padding[y]}px`})}}m.gap!==void 0&&(a++,s.itemSpacing!==void 0&&s.itemSpacing!==m.gap&&i.push({category:"spacing",property:"gap",severity:"warning",designValue:s.itemSpacing,codeValue:m.gap,message:`Gap/itemSpacing: design ${s.itemSpacing}px vs code ${m.gap}px`}))}if(o.borderRadius!==void 0){a++;let m=s.cornerRadius,y=o.borderRadius;typeof y=="number"&&m!==void 0&&m!==y&&i.push({category:"shape",property:"borderRadius",severity:"warning",designValue:m,codeValue:y,message:`Border radius: design ${m}px vs code ${y}px`})}if(o.border&&(o.border.width!==void 0&&(a++,s.strokeWeight!==void 0&&s.strokeWeight!==o.border.width&&i.push({category:"border",property:"borderWidth",severity:"warning",designValue:s.strokeWeight,codeValue:o.border.width,message:`Border width: design ${s.strokeWeight}px vs code ${o.border.width}px`})),o.border.color)){a++;let m=s.strokes;if(Array.isArray(m)&&m.length>0){let y=m[0].color;y&&!qv(y,o.border.color)&&i.push({category:"border",property:"borderColor",severity:"warning",designValue:y,codeValue:o.border.color,message:"Border color differs"})}}o.dimensions&&(o.dimensions.width!==void 0&&(a++,s.width!==void 0&&Math.abs(s.width-o.dimensions.width)>1&&i.push({category:"dimensions",property:"width",severity:"warning",designValue:s.width,codeValue:o.dimensions.width,message:`Width: design ${s.width}px vs code ${o.dimensions.width}px`})),o.dimensions.height!==void 0&&(a++,s.height!==void 0&&Math.abs(s.height-o.dimensions.height)>1&&i.push({category:"dimensions",property:"height",severity:"info",designValue:s.height,codeValue:o.dimensions.height,message:`Height: design ${s.height}px vs code ${o.dimensions.height}px`}))),o.opacity!==void 0&&(a++,s.opacity!==void 0&&Math.abs(s.opacity-o.opacity)>.01&&i.push({category:"visual",property:"opacity",severity:"warning",designValue:s.opacity,codeValue:o.opacity,message:`Opacity: design ${s.opacity} vs code ${o.opacity}`})),a===0&&(a=1);let c=i.reduce((m,y)=>m+(1-AN(y.severity)),0),l=Math.max(0,1-c/a),u=Math.round(l*100),d=i.filter(m=>m.severity==="critical").length,g=i.filter(m=>m.severity==="warning").length,h=i.filter(m=>m.severity==="info").length,f={score:u,verdict:u>=90?"PASS":u>=70?"NEEDS_REVIEW":"FAIL",checksPerformed:a,issues:{critical:d,warning:g,info:h,total:i.length},details:i,designNode:{id:s.id,name:s.name,type:s.type}};return{content:[{type:"text",text:JSON.stringify(f,null,2)}]}})}var ft=require("fs"),Bv=require("crypto"),Ct=require("path");var MN=["design-system-config.mdc","figma-tool-usage-rules.mdc","interactive-specs.mdc"],DN=[];function Hv(t,e){t.tool("verify_workspace_setup","Verify that the workspace has the required Figma MCP Bridge rules installed. Call this before your first design operation in each session. Returns a pass/fail status with details about missing files.",{workspacePath:p.string().describe("Absolute path to the workspace root directory (the project folder open in the editor)")},async({workspacePath:r})=>{let n=(0,Ct.join)(r,".cursor","rules"),o=(0,Ct.join)(r,".cursor","specs"),s=(0,Ct.join)(r,".cursor","cache"),i=[],a=[],c=[];for(let f of MN){let m=(0,Ct.join)(n,f);(0,ft.existsSync)(m)?a.push(f):i.push(f)}for(let f of DN){let m=(0,Ct.join)(n,f);(0,ft.existsSync)(m)?a.push(f):c.push(`Optional rule "${f}" not found \u2014 design system features may be limited`)}let l=(0,Ct.join)(n,".integrity.json");if((0,ft.existsSync)(l))try{let f=JSON.parse((0,ft.readFileSync)(l,"utf-8"));if(f.managedFiles)for(let[m,y]of Object.entries(f.managedFiles)){let b=(0,Ct.join)(n,m);if((0,ft.existsSync)(b)){let x=(0,ft.readFileSync)(b,"utf-8");(0,Bv.createHash)("sha256").update(x).digest("hex")!==y.sha256&&c.push(`"${m}" has been modified \u2014 run setup.js to restore the original`)}}}catch{}(0,ft.existsSync)(o)||c.push(".cursor/specs/ directory not found \u2014 spec validation will not work");let u=(0,Ct.join)(r,".cursor","libraries");(0,ft.existsSync)(u)||c.push(".cursor/libraries/ directory not found \u2014 library packages are not installed. Run setup.js to copy library packages from the distribution."),(0,ft.existsSync)(s)||c.push(".cursor/cache/ directory not found \u2014 will be created on first design operation for runtime variable resolution");let d=(0,Ct.join)(r,".github","instructions"),g=(0,ft.existsSync)(d);return i.length>0?{content:[{type:"text",text:["SETUP INCOMPLETE \u2014 Required rules are missing.","",`Missing (${i.length}):`,...i.map(m=>`  \u2717 .cursor/rules/${m}`),"",a.length>0?`Present (${a.length}):
${a.map(m=>`  \u2713 .cursor/rules/${m}`).join(`
`)}`:"","",c.length>0?`Warnings:
${c.map(m=>`  \u26A0 ${m}`).join(`
`)}`:"","","To fix: run the setup script targeting this workspace:",`  node ~/outreach-figma-bridge/setup.js --workspace ${r}`,"","DO NOT proceed with design operations until setup is complete."].filter(Boolean).join(`
`)}],isError:!0}:{content:[{type:"text",text:["SETUP VERIFIED \u2014 All required rules are present.","",`Rules (${a.length}):`,...a.map(f=>`  \u2713 .cursor/rules/${f}`),"",g?"  \u2713 .github/instructions/ (VS Code)":"  \u25CB .github/instructions/ (not found \u2014 VS Code users may need setup)","",c.length>0?`Warnings:
${c.map(f=>`  \u26A0 ${f}`).join(`
`)}
`:"","You may proceed with design operations."].filter(Boolean).join(`
`)}]}}),t.tool("check_health","Check the health of the MCP-to-Figma connection pipeline. Returns server state, WebSocket port, connected Figma files, and actionable guidance if something is wrong. Call this when design operations fail or before starting a session.",{},async()=>{let r=e.getStatus(),{server:n,connections:o,pending:s}=r,i=`${n.portRange[0]}-${n.portRange[n.portRange.length-1]}`;if(n.state==="port_conflict")return{content:[{type:"text",text:["CONNECTION PROBLEM \u2014 All ports in use",`  Ports:   ${i} (all occupied)`,`  Scans:   exhausted ${n.maxFullScans} full scan attempts`,"","  Every port in the range is occupied by other editors or processes.","  The Figma plugin can connect to up to 6 editors simultaneously,","  but all 6 slots are taken.","","  To fix:","  - Close an editor that you are not using, OR","  - Restart this editor (the server will re-scan for a free port)"].join(`
`)}],isError:!0};if(n.state==="starting")return{content:[{type:"text",text:["CONNECTION IN PROGRESS \u2014 Scanning for available port",`  Ports:   trying ${n.currentTryPort} (range ${i})`,`  Scan:    ${n.fullScanAttempt+1}/${n.maxFullScans}`,"","  The server is looking for a free port. This happens when other","  editors already occupy some ports. Please wait a moment."].join(`
`)}],isError:!0};if(n.state!=="listening")return{content:[{type:"text",text:["CONNECTION PROBLEM \u2014 Server not running",`  Server:  state is "${n.state}" (expected "listening")`,`  Port:    ${n.port}`,"","  To fix:","  - Restart your editor to reinitialize the MCP server","  - Check the terminal/output for startup errors"].join(`
`)}],isError:!0};if(o.count===0)return{content:[{type:"text",text:["CONNECTION PROBLEM \u2014 No Figma plugin",`  Server:  listening on port ${n.port}`,"  Plugin:  0 files connected","","  To fix:","  1. Open a Figma file in the Desktop App or Browser","  2. Run Plugins > Outreach Figma MCP Bridge",'  3. Wait for the "Connected" indicator in the plugin'].join(`
`)}],isError:!0};if(o.registeredCount===0&&o.count>0){let h=Date.now(),f=r;for(;Date.now()-h<2e3&&(await new Promise(m=>setTimeout(m,200)),f=e.getStatus(),!(f.connections.registeredCount>0)););Object.assign(r,f),Object.assign(n,f.server),Object.assign(o,f.connections)}let a=o.registeredCount===1?"1 file connected":o.registeredCount>1?`${o.registeredCount} files connected`:`${o.count} connection(s), awaiting registration`,c=n.port!==n.preferredPort?` (escalated from ${n.preferredPort})`:"",l=o.registeredFiles.length>0?o.registeredFiles:o.files;return{content:[{type:"text",text:["CONNECTION HEALTHY",`  Server:  listening on port ${n.port}${c}`,`  Plugin:  ${a}`,...l.length>0?[`  Files:   ${l.join(", ")}`]:[],...o.activeFile&&o.activeFile!=="Unknown File"?[`  Active:  "${o.activeFile}"`]:[],`  Pending: ${s} command${s===1?"":"s"} in flight`].join(`
`)}]}}),t.tool("wait_for_connection","Block until both the MCP server is listening AND at least one Figma plugin is connected. Polls every few seconds and returns a detailed status report. Use this as a connection gate before starting any design work \u2014 call it after check_health reports a problem, or at the start of a session. Returns CONNECTION READY when both conditions are met, or CONNECTION TIMEOUT if the deadline is reached. The user should be told to enable the Figma plugin while this waits.",{timeoutSeconds:p.number().optional().describe("Max seconds to wait for a healthy connection (default 120, max 300)")},async({timeoutSeconds:r})=>{let o=Math.min(r??120,300)*1e3,s=3e3,i=Date.now(),a="",c=[],l=()=>{let b=e.getStatus(),x=b.server.state==="listening",w=b.connections.registeredCount>0;return{status:b,serverOk:x,pluginOk:w}},{status:u,serverOk:d,pluginOk:g}=l();if(d&&g){let b=u.server.port!==u.server.preferredPort?` (escalated from ${u.server.preferredPort})`:"",x=u.connections.registeredFiles.length>0?u.connections.registeredFiles:u.connections.files;return{content:[{type:"text",text:["CONNECTION READY",`  Server:  listening on port ${u.server.port}${b}`,`  Plugin:  ${u.connections.registeredCount} file(s) connected`,...x.length>0?[`  Files:   ${x.join(", ")}`]:[],"","  You may proceed with design operations."].join(`
`)}]}}let h=(b,x,w)=>!b&&!x?`Server not ready (state: ${w.server.state}) and no Figma plugin connected`:b?w.connections.count>0&&w.connections.registeredCount===0?"Plugin connected but still registering (waiting for file info)":"Server is listening but no Figma plugin is connected":`Server not ready (state: ${w.server.state})`;for(a=h(d,g,u),c.push(`[0s] Waiting \u2014 ${a}`);Date.now()-i<o;){await new Promise(w=>setTimeout(w,s)),{status:u,serverOk:d,pluginOk:g}=l();let b=Math.round((Date.now()-i)/1e3);if(d&&g){c.push(`[${b}s] Connected!`);let w=u.server.port!==u.server.preferredPort?` (escalated from ${u.server.preferredPort})`:"",I=u.connections.registeredFiles.length>0?u.connections.registeredFiles:u.connections.files;return{content:[{type:"text",text:["CONNECTION READY",`  Server:  listening on port ${u.server.port}${w}`,`  Plugin:  ${u.connections.registeredCount} file(s) connected`,...I.length>0?[`  Files:   ${I.join(", ")}`]:[],"",`  Connected after ${b} seconds.`,"","  Progress:",...c.map(ve=>`    ${ve}`),"","  You may proceed with design operations."].join(`
`)}]}}let x=h(d,g,u);x!==a&&(c.push(`[${b}s] ${x}`),a=x)}let f=Math.round((Date.now()-i)/1e3);c.push(`[${f}s] Timed out`);let m=[];return d||m.push("  Server is not listening:",`    - State: ${u.server.state}`,"    - Restart your editor to reinitialize the MCP server"),g||m.push("  Figma plugin is not connected:","    1. Open a Figma file in the Desktop App or Browser","    2. Run Plugins \u2192 Outreach Figma MCP Bridge",'    3. Wait for the "Connected" indicator in the plugin'),{content:[{type:"text",text:[`CONNECTION TIMEOUT \u2014 waited ${f}s, still not ready`,"",...m,"","  Progress:",...c.map(b=>`    ${b}`),"","  After fixing the issue, call wait_for_connection again or use check_health.","  DO NOT proceed with design operations until the connection is healthy."].join(`
`)}],isError:!0}}),t.tool("discover_libraries","Discover all design system libraries attached to the current Figma file. Returns library names and their variable collections. Use this at the start of a session to let the user select which libraries to use. This is a lightweight call that does NOT import any variables.",{fileId:T},async({fileId:r})=>{let n=await e.sendCommand("discover_libraries",{},void 0,r);return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}})}var T=p.string().optional().describe("Target Figma file name or ID. Required when multiple files are connected. Omit when only one file is open.");function O(t){let{fileId:e,...r}=t;return{fileId:e,rest:r}}function Gv(t,e){Hv(t,e),$v(t,e),Rv(t,e),kv(t,e),Ev(t,e),Iv(t,e),zv(t,e),Ov(t,e),Lv(t,e),Zv(t,e),Fv(t,e),Uv(t,e),Vv(t,e)}function Wv(t){t.prompt("design_screen","Generate a structured design plan from a natural-language screen description, following the active design system rules",{description:p.string().describe("Natural-language screen description (e.g. 'a settings page with profile section and toggles')")},async({description:e})=>({messages:[{role:"user",content:{type:"text",text:`You are a Figma design assistant. Design the following screen using the project's design system (defined in the cursor rules).

## Screen Description
${e}

## Instructions
Follow this structured approach:

1. **Consult the design system rules** for colors, typography, spacing, corner radius, elevation, and component specs. Never hardcode values \u2014 always use the tokens from the rules.
2. **Root Frame**: Create a screen frame at the size specified in the design system (e.g. desktop 1440px or mobile 375px). Apply the appropriate background color from the design system tokens.
3. **Navigation / App Bar**: If the design system specifies a header or sidebar, include it with the correct dimensions, fill, and typography.
4. **Content Area**: Auto layout VERTICAL frame with the design system's standard content padding and section spacing.
5. **Components**: For each UI element mentioned in the description, use the component specs from the design system rules:
   - "button" \u2192 the default button variant (check rules for height, radius, fill, text style)
   - "input" / "field" \u2192 the default text field (check rules for height, radius, stroke, label style)
   - "card" \u2192 the default card variant (check rules for radius, fill, elevation, padding)
   - "toggle" / "switch" \u2192 switch component from the rules
   - Use the correct typography styles, colors, and spacing from the design system.
6. **Spacing**: Follow the design system's spacing scale (typically multiples of a base unit).
7. **Typography**: Use the font families and styles specified in the design system rules.
8. **Name all layers semantically** (e.g. "Login Form", "Email Field", "Submit Button").
9. **Always set auto layout** on every frame before appending children.
10. **Use build_from_spec or build_and_verify** to create the design atomically from a single spec.

Build the design step by step, creating the outermost containers first, then inner components.`}}]})),t.prompt("design_from_prd","Parse a PRD (Product Requirements Document) and generate a multi-screen Figma design plan",{prd_content:p.string().describe("The full PRD content to parse")},async({prd_content:e})=>({messages:[{role:"user",content:{type:"text",text:`You are a Figma design assistant. Read the following PRD and create all the screens it describes using the project's design system (defined in the cursor rules).

## PRD Content
${e}

## Instructions
1. Identify each distinct screen or page described in the PRD.
2. For each screen, create a frame at the standard screen size from the design system, spaced 100px apart horizontally on the canvas.
3. Follow the design system rules exactly for:
   - Background colors, surface colors, text colors
   - Typography scale (font families, sizes, weights)
   - Component specs (buttons, inputs, cards, etc.)
   - Spacing tokens and corner radius values
   - Elevation / shadow tokens
4. Use auto layout on every container frame.
5. Name all layers semantically based on their function.
6. Apply proper elevation shadows as specified in the design system.
7. Use build_from_spec or build_and_verify to create each screen atomically.
8. Build each screen completely before moving to the next.`}}]})),t.prompt("audit_design","Audit an existing Figma design for design system compliance (colors, spacing, typography, components)",{nodeId:p.string().describe("The root node ID to audit (e.g. a frame or page)")},async({nodeId:e})=>({messages:[{role:"user",content:{type:"text",text:`You are a Figma design auditor. Inspect the node with ID "${e}" and all its children for design system compliance. Refer to the project's design system rules for the expected token values.

## Audit Checklist
1. **Colors**: Check that fills and text colors match the design system's color tokens. Flag any non-standard or hardcoded colors.
2. **Typography**: Verify font families, sizes, and weights match the design system's type scale. Flag mismatches.
3. **Spacing**: Check that padding and item spacing follow the design system's spacing scale. Flag values that aren't on the scale.
4. **Corner Radius**: Verify radii match the design system's shape tokens.
5. **Component Specs**: Check component dimensions (button heights, input heights, app bar heights, etc.) against the design system's specifications.
6. **Auto Layout**: Verify all container frames use auto layout.
7. **Layer Naming**: Check that layers have semantic names, not defaults like "Frame 1" or "Rectangle 3".

Use get_node_by_id and get_children to traverse the tree. Report findings as a structured list with severity (error/warning/info) and specific fix recommendations referencing the correct design system token.`}}]})),t.prompt("responsive_variants","Create tablet and desktop variants from an existing design",{nodeId:p.string().describe("The source frame node ID to create variants from"),breakpoints:p.string().optional().describe("Comma-separated breakpoint widths (default: '768,1440' for tablet and desktop)")},async({nodeId:e,breakpoints:r})=>{let n=(r||"768,1440").split(",").map(o=>o.trim());return{messages:[{role:"user",content:{type:"text",text:`You are a responsive design specialist. Take the existing design at node ID "${e}" and create responsive variants for these breakpoints: ${n.join("px, ")}px.

## Instructions
1. First, use get_node_by_id to inspect the source design and understand its structure.
2. For each breakpoint width (${n.join(", ")}):
   a. Clone the source frame using clone_node.
   b. Resize the clone to the new width (keep height auto or adjust proportionally).
   c. Position the clone 100px to the right of the previous frame.
   d. Rename it with the breakpoint suffix (e.g. "Login Screen - Tablet", "Login Screen - Desktop").
   e. Adjust the layout for the new width:
      - For tablet (~768px): Increase horizontal padding, widen content areas.
      - For desktop (~1440px): Center content in a max-width container, use the design system's desktop padding values.
   f. Adjust text fields, buttons, and other components to appropriate widths for the breakpoint.
3. Maintain all design system tokens (colors, typography, spacing) \u2014 refer to the cursor rules.
4. Ensure auto layout is preserved and adapts correctly.`}}]}}),t.prompt("design_strategy","Best practices for working with Figma designs \u2013 structure, auto layout, naming, and efficient tool usage",{},async()=>({messages:[{role:"user",content:{type:"text",text:`You are a Figma design expert. Follow these best practices when creating or modifying Figma designs:

## Structure & Hierarchy
1. **Always use auto layout** on container frames before appending children. Set the layout mode (HORIZONTAL/VERTICAL) first, then add children.
2. **Build outside-in**: Create the root frame first, then nested containers, then leaf elements.
3. **Use semantic layer names**: "Login Card", "Email Field Row", "Primary Button" \u2014 never "Frame 42" or "Rectangle 3".
4. **Group related elements** using frames with auto layout, not loose grouping.

## Auto Layout Best Practices
- Set layout mode BEFORE appending children.
- Use primaryAxisSizingMode: "AUTO" (hug) for content-driven frames, "FIXED" for constrained widths.
- Use counterAxisSizingMode: "AUTO" for height-hugging, "FIXED" for explicit heights.
- Use set_layout_sizing with "FILL" on children that should stretch to fill their parent.
- For centered content: primaryAxisAlignItems: "CENTER" and counterAxisAlignItems: "CENTER".

## Spacing & Layout
- Follow the design system's spacing scale (defined in the cursor rules). Typically based on an 8px or 4px grid.
- set_auto_layout accepts padding values (paddingTop, paddingRight, paddingBottom, paddingLeft) and itemSpacing directly.
- For equal padding on all sides, set all four values the same.

## Typography
- Use get_available_fonts to check font availability before creating text.
- Use the font families and type scale from the project's design system rules.

## Colors
- Always use color tokens from the design system rules. Never hardcode arbitrary color values.
- Apply fills and strokes using the token values specified in the rules.

## Atomic Building
- Use build_from_spec or build_and_verify to create entire component trees in one call.
- Use build_and_verify for visual confirmation \u2014 it builds + screenshots + validates in one call.
- Reserve individual tools (set_fill, set_font, etc.) for post-creation modifications only.

## Efficiency
- Use batch tools (set_multiple_text_contents, delete_multiple_nodes) when operating on 3+ nodes.
- Use scan_text_nodes with chunking for large designs.
- Use read_my_design to quickly inspect the current selection.`}}]})),t.prompt("read_design_strategy","Best practices for reading and understanding existing Figma designs",{},async()=>({messages:[{role:"user",content:{type:"text",text:`You are a Figma design analyst. Follow these best practices when reading and understanding existing designs:

## Reading Strategy
1. **Start with the big picture**: Use get_document_info to understand the document structure and pages.
2. **Scan the page**: Use scan_page with depth 2-3 to get an overview of top-level frames and their children.
3. **Drill down selectively**: Use get_node_by_id or get_children with increasing depth on specific nodes of interest.
4. **Use read_my_design**: When the user has something selected, use this to get detailed info without needing node IDs.

## Efficient Inspection
- Use get_nodes_info to batch-fetch multiple nodes in one call.
- Use find_nodes_by_name for targeted name searches.
- Use find_nodes_by_type to find all nodes of a specific type (e.g., all TEXT, FRAME, or COMPONENT nodes).
- Use scan_text_nodes for a comprehensive text inventory with font metadata.

## Understanding Layout
- Check layoutMode on frames: "HORIZONTAL", "VERTICAL", or "NONE" (absolute positioning).
- Check primaryAxisSizingMode and counterAxisSizingMode for sizing behavior.
- Check padding and itemSpacing for spacing values.
- Look at children's layoutSizingHorizontal/layoutSizingVertical for fill/hug/fixed behavior.

## Understanding Components
- Use get_local_components to list all components on the page.
- Use get_instance_overrides to understand what has been customized on an instance.
- Check mainComponent on instances to find the source component.

## Reporting
- Summarize findings in a structured format: hierarchy tree, color palette, typography used, spacing patterns.
- Note any inconsistencies or deviations from the project's design system (refer to cursor rules for expected values).`}}]})),t.prompt("text_replacement_strategy","Systematic approach for replacing text across Figma designs \u2013 scan, match, and batch-update",{find:p.string().describe("Text to find"),replace:p.string().describe("Text to replace with"),scope:p.string().optional().describe("Optional node ID to scope the replacement (defaults to entire page)")},async({find:e,replace:r,scope:n})=>({messages:[{role:"user",content:{type:"text",text:`You are a Figma text replacement specialist. Replace all occurrences of "${e}" with "${r}"${n?` within node ${n}`:" on the current page"}.

## Strategy
1. **Scan**: Use scan_text_nodes${n?` with nodeId "${n}"`:""} to get all text nodes and their current content.
2. **Match**: Filter the results to find text nodes containing "${e}".
3. **Preview**: List all matching nodes with their IDs, names, and current text before making changes.
4. **Replace**: Use set_multiple_text_contents to batch-update all matching nodes at once.
   - For each matching node, replace "${e}" with "${r}" in the characters string.
   - Preserve any surrounding text that doesn't match.
5. **Verify**: Use scan_text_nodes again to confirm all replacements were applied correctly.
6. **Report**: Summarize how many nodes were updated and list any that couldn't be updated (e.g., mixed fonts).

## Important
- Text nodes with mixed font styles (different fonts within the same node) may fail if the replacement changes the text length. Handle these individually with set_text_content.
- Always preview before replacing \u2013 ask the user to confirm if the list of changes looks correct.
- Use chunked scanning for large designs to avoid timeouts.`}}]})),t.prompt("swap_overrides_instances","Strategy for transferring overrides between component instances in Figma",{sourceInstanceId:p.string().describe("Source instance ID to copy overrides from"),targetInstanceIds:p.string().describe("Comma-separated target instance IDs to apply overrides to")},async({sourceInstanceId:e,targetInstanceIds:r})=>{let n=r.split(",").map(o=>o.trim());return{messages:[{role:"user",content:{type:"text",text:`You are a Figma component specialist. Transfer overrides from instance "${e}" to these target instances: ${n.join(", ")}.

## Strategy
1. **Extract source overrides**: Use get_instance_overrides with nodeId "${e}" to get all current overrides (text, fills, visibility).
2. **Review overrides**: List the extracted overrides and confirm which ones should be transferred.
3. **Apply to targets**: For each target instance (${n.join(", ")}):
   a. Use set_instance_overrides with the target instance ID and the extracted overrides array.
   b. Map overrides by childName \u2013 ensure the child names match between source and target instances.
4. **Verify**: Use get_instance_overrides on each target to confirm the overrides were applied correctly.
5. **Handle mismatches**: If child names don't match (different component variants), report which overrides couldn't be applied and suggest alternatives.

## Important
- Only transfer overrides for children that exist in both source and target instances.
- Text overrides require the target child to be a TEXT node.
- Fill overrides require the target child to support fills.
- Visibility overrides can be applied to any node.
- If source and target are instances of different components, some children may not exist in the target.`}}]}}),t.prompt("spec_format","Reference guide for the component tree spec format used by build_from_spec and build_and_verify. Describes all supported fields, types, and patterns with examples.",{},async()=>({messages:[{role:"user",content:{type:"text",text:`You are a Figma design assistant that uses the component tree spec format to build designs atomically.

## Component Tree Spec Format

The spec is a JSON object that describes a Figma component tree declaratively. Instead of making many individual tool calls, you write a single spec and pass it to \`build_from_spec\` or \`build_and_verify\`.

### Required Fields

Every node MUST have:
- **name** (string): Semantic layer name. Use descriptive names like "Login Card", "Email Field", "Submit Button".
- **type** (string): One of: \`frame\`, \`text\`, \`rectangle\`, \`ellipse\`, \`line\`, \`component\`, \`vector\`

### Geometry Fields (all optional)

- **x** (number): X position in pixels
- **y** (number): Y position in pixels
- **width** (number): Width in pixels
- **height** (number): Height in pixels

### Visual Fields (all optional)

- **fill** ({r, g, b}): Solid fill color. Values are 0-1, not 0-255.
  - Example: \`{"r": 0.369, "g": 0.369, "b": 0.686}\` \u2014 always use token values from the design system rules.
- **fillOpacity** (number): Fill opacity, 0-1. Default 1.
- **stroke** ({color: {r,g,b}, weight: number, align?: string}): Stroke config.
  - align: "INSIDE" | "OUTSIDE" | "CENTER"
- **cornerRadius** (number): Uniform corner radius in pixels.
- **opacity** (number): Node opacity, 0-1. Default 1.
- **visible** (boolean): Node visibility. Default true.
- **clipContent** (boolean): Clip children to frame bounds. Default true for frames.
- **effects** (array): Shadows and blurs.
  - \`{"type": "DROP_SHADOW", "radius": 8, "color": {"r":0,"g":0,"b":0,"a":0.15}, "offset": {"x":0,"y":2}, "spread": 0}\`
  - \`{"type": "INNER_SHADOW", "radius": 4, "color": {"r":0,"g":0,"b":0,"a":0.1}, "offset": {"x":0,"y":1}}\`
  - \`{"type": "LAYER_BLUR", "radius": 10}\`

### Text Fields (only for type: "text")

- **characters** (string, REQUIRED for text): The text content.
- **fontSize** (number): Font size in px. Default 14.
- **fontFamily** (string): Font family name. Default "Inter".
- **fontStyle** (string): Font style. Default "Regular". Options: "Regular", "Bold", "Medium", "Light", "SemiBold", "Italic", etc.
- **textAlignHorizontal**: "LEFT" | "CENTER" | "RIGHT" | "JUSTIFIED"
- **textAlignVertical**: "TOP" | "CENTER" | "BOTTOM"

### Auto-Layout (only for frame/component)

- **autoLayout** (object): Configure auto-layout on this container.
  - **mode** (REQUIRED): "HORIZONTAL" | "VERTICAL"
  - **itemSpacing** (number): Gap between children in px
  - **padding** (number OR object): Uniform padding or per-side:
    - Number: \`16\` \u2192 16px on all sides
    - Object: \`{"top": 24, "right": 16, "bottom": 24, "left": 16}\`
  - **primaryAxisAlignItems**: "MIN" | "MAX" | "CENTER" | "SPACE_BETWEEN"
  - **counterAxisAlignItems**: "MIN" | "MAX" | "CENTER"
  - **primaryAxisSizingMode**: "FIXED" | "AUTO" (hug)
  - **counterAxisSizingMode**: "FIXED" | "AUTO" (hug)
  - **layoutWrap**: "NO_WRAP" | "WRAP"

### Layout Sizing (when inside an auto-layout parent)

- **layoutSizing** (object): How this node sizes within its parent.
  - **horizontal**: "FILL" (stretch) | "HUG" (fit content) | "FIXED"
  - **vertical**: "FILL" | "HUG" | "FIXED"

### Children (only for frame/component)

- **children** (array): Ordered list of child spec nodes. Each child follows the same schema recursively.

### Vector Fields (type: "vector")

- **svgPath** (string): SVG path data string, e.g. "M 0 0 L 100 0 L 100 100 Z"

---

## Examples

### Simple Card

\`\`\`json
{
  "name": "Info Card",
  "type": "frame",
  "width": 320,
  "fill": {"r": 0.996, "g": 0.992, "b": 0.988},
  "cornerRadius": 8,
  "autoLayout": {
    "mode": "VERTICAL",
    "itemSpacing": 8,
    "padding": 16,
    "counterAxisSizingMode": "FIXED",
    "primaryAxisSizingMode": "AUTO"
  },
  "stroke": {"color": {"r": 0.8, "g": 0.808, "b": 0.859}, "weight": 1},
  "children": [
    {
      "name": "Title",
      "type": "text",
      "characters": "Card Title",
      "fontSize": 20,
      "fontFamily": "Work Sans",
      "fontStyle": "SemiBold",
      "fill": {"r": 0.271, "g": 0.259, "b": 0.384},
      "layoutSizing": {"horizontal": "FILL"}
    },
    {
      "name": "Description",
      "type": "text",
      "characters": "This is a description of the card content.",
      "fontSize": 14,
      "fontFamily": "Roboto Flex",
      "fontStyle": "Regular",
      "fill": {"r": 0.408, "g": 0.404, "b": 0.514},
      "layoutSizing": {"horizontal": "FILL"}
    }
  ]
}
\`\`\`

### Button

\`\`\`json
{
  "name": "Primary Button",
  "type": "frame",
  "height": 36,
  "fill": {"r": 0.369, "g": 0.369, "b": 0.686},
  "cornerRadius": 100,
  "autoLayout": {
    "mode": "HORIZONTAL",
    "padding": {"top": 8, "right": 12, "bottom": 8, "left": 12},
    "primaryAxisSizingMode": "AUTO",
    "counterAxisSizingMode": "FIXED",
    "primaryAxisAlignItems": "CENTER",
    "counterAxisAlignItems": "CENTER",
    "itemSpacing": 4
  },
  "children": [
    {
      "name": "Button Label",
      "type": "text",
      "characters": "Click Me",
      "fontSize": 14,
      "fontFamily": "Roboto Flex",
      "fontStyle": "SemiBold",
      "fill": {"r": 1, "g": 1, "b": 1}
    }
  ]
}
\`\`\`

> **Note:** The colors in these examples are illustrative. Always look up the correct token values from the project's design system rules.

## Best Practices

1. **Always use autoLayout on container frames** before specifying children. This ensures Figma arranges children correctly.
2. **Use layoutSizing: {"horizontal": "FILL"}** on children that should stretch to fill their parent width.
3. **Build outside-in**: Define the root frame first, then nested containers, then leaf elements.
4. **Use semantic names**: "Login Card", "Email Field Row", "Submit Button" \u2014 never "Frame 1" or "Rectangle 3".
5. **Use build_and_verify** instead of build_from_spec when you want visual confirmation. It builds + screenshots + validates in one call.
6. **After build_and_verify**, check the validation report for any mismatches and fix them.
7. **Use design system tokens**: Always reference the color, typography, and spacing tokens from the project's cursor rules. Never hardcode arbitrary values.
8. **Prefer uniform padding** (number) when all sides are equal: \`"padding": 16\` instead of \`{"top":16,"right":16,"bottom":16,"left":16}\`.`}}]})),t.prompt("design_code_parity","Guide for checking design-code parity. Explains how to extract design properties from Figma, extract code properties from the codebase, and run check_design_parity to produce a scored diff report.",{nodeId:p.string().describe("Figma node ID of the component to check"),componentPath:p.string().describe("File path of the code component to compare against")},async({nodeId:e,componentPath:r})=>({messages:[{role:"user",content:{type:"text",text:`# Design-Code Parity Check

## Objective
Compare the Figma design for node **${e}** against the code implementation at **${r}** and produce a scored diff report.

## Steps

### 1. Read the Figma design
Use \`get_node_by_id\` with nodeId "${e}" to get the design properties.

### 2. Read the code implementation
Read the file at "${r}" and extract visual properties into a codeSpec JSON:

\`\`\`json
{
  "colors": [
    { "name": "background", "value": { "r": 0.369, "g": 0.369, "b": 0.686 } }
  ],
  "typography": {
    "fontFamily": "Roboto Flex",
    "fontSize": 14,
    "fontWeight": "600"
  },
  "spacing": {
    "padding": { "top": 8, "right": 12, "bottom": 8, "left": 12 },
    "gap": 4
  },
  "borderRadius": 8,
  "border": {
    "width": 1,
    "color": { "r": 0.8, "g": 0.808, "b": 0.859 }
  },
  "dimensions": {
    "width": 220,
    "height": 36
  },
  "opacity": 1
}
\`\`\`

### 3. Run the parity check
Call \`check_design_parity\` with the nodeId and the codeSpec JSON string.

### 4. Interpret the results
- **Score 90-100 (PASS)**: Design and code are aligned.
- **Score 70-89 (NEEDS_REVIEW)**: Minor discrepancies to review.
- **Score below 70 (FAIL)**: Significant mismatches that need fixing.

### 5. Generate fix recommendations
For each issue in the report:
- **Critical**: Must fix \u2014 wrong colors, wrong fonts.
- **Warning**: Should fix \u2014 spacing, radius, border differences.
- **Info**: Nice to fix \u2014 minor dimension or opacity drift.

Provide specific code changes needed to bring the implementation into alignment with the design.`}}]})),t.prompt("design_system_audit","Run a comprehensive design system audit: library health (T1) and component architecture (T2). Generates a self-contained HTML report in audits/.",{focus:p.string().optional().describe("Audit scope: 'full' (default), 'library-health' (T1 only), 'component-architecture' (T2 only)")},async({focus:e})=>{let r=e||"full";return{messages:[{role:"user",content:{type:"text",text:`# Design System Audit \u2014 Library Health & Component Architecture

> **CRITICAL FIRST INSTRUCTION \u2014 READ BEFORE DOING ANYTHING ELSE:**
> This audit inspects the **connected Figma file** using live Figma MCP tool calls. It does NOT inspect workspace files.
> **Do NOT read ANY local files** \u2014 no \`.cursor/cache/library-data.json\`, no \`design-system-config.mdc\`, no component mapping files, no token files, no \`.cursor/rules/\` files, no \`.cursor/specs/\` files.
> **Your ONLY data sources are Figma MCP tools**: \`get_document_info\`, \`get_local_variables\`, \`get_local_styles\`, \`scan_page\`, \`get_component_set_info\`, etc.
> If you find yourself about to read a workspace file or cache file \u2014 **STOP. That is wrong. Call a Figma MCP tool instead.**
> The ONLY pre-requisite is RULE ZERO (Connection Gate): call \`verify_workspace_setup\` and \`check_health\` to confirm the Figma connection is active. After that, go straight to Figma MCP calls.

You are a design system auditor. Run a comprehensive audit on the connected Figma library file. Analyze both library-level health and internal component architecture. Generate a self-contained HTML report.

**Audit scope: ${r}**
${r==="library-health"?"Skip T2 (component architecture) checks. Run T1 only.":""}
${r==="component-architecture"?"Skip T1 (library health) checks. Run T2 only.":""}
${r==="full"?"Run both T1 and T2 checks.":""}

---

## AGNOSTICISM OVERRIDE \u2014 REINFORCEMENT

> **This audit MUST be completely unbiased and agnostic to whatever design system the workspace is configured for.**

The workspace has cursor rules that configure a specific design system (library mode, cached library data, component key mappings, token files). **For the purpose of this audit, ALL of those rules are overridden.** The workspace rules themselves contain an AUDIT EXCEPTION that exempts this prompt. Specifically:

1. **Do NOT read from the library data cache** (\`.cursor/cache/library-data.json\`). The cache contains data from the workspace's configured library, which may be a DIFFERENT file than the one being audited.
2. **Do NOT reference any component key mapping or token files.** The audit must discover components directly from the connected file.
3. **Do NOT assume any specific design system** \u2014 no specific library or framework. Audit the file as-is.
4. **ALL data must come from live Figma MCP calls** to the currently connected file: \`get_document_info\`, \`get_local_variables\`, \`get_local_styles\`, \`scan_page\`, \`get_component_set_info\`, etc.
5. **Use the file name returned by \`get_document_info\`** as the report title \u2014 do NOT use any name from the workspace configuration.
6. **The \`design-system-config.mdc\` mode setting (library/tokens/custom/none) is IRRELEVANT** to this audit. The audit always fetches fresh data and analyzes it objectively.
7. **Do NOT read \`design-system-config.mdc\`, \`figma-tool-usage-rules.mdc\`, or any other \`.cursor/rules/\` file** \u2014 those are for design building, not auditing. The audit prompt (this text) contains all the instructions you need.

This override exists because the audit must be able to run on ANY Figma library file the user connects to, not just the one configured in the workspace. The user may open a completely different library and expect an unbiased analysis.

---

## CALL OPTIMIZATION \u2014 READ FIRST

Minimize MCP round-trips. Follow this EXACT strategy:

**GLOBAL (3 calls):**
1. get_document_info \u2014 page list, file name
2. get_local_variables with includeLibrary: false \u2014 all local variables
3. get_local_styles \u2014 all paint, text, effect styles

**PER PAGE (1 + N calls, where N = component sets on that page):**
4. set_current_page(pageId) then scan_page with depth: 3 \u2014 returns the ENTIRE page tree. From this single response, extract:
   - All COMPONENT_SET nodes and their IDs (type === "COMPONENT_SET")
   - All COMPONENT nodes and their parent types (ghost detection: parent is FRAME/GROUP instead of COMPONENT_SET)
   - Internal structure of each variant (child types, layoutMode, layer names, fills) \u2014 variants are the COMPONENT children of each COMPONENT_SET
   - Variant names for axis parsing (e.g. "Style=Primary, Size=Small" \u2014 split by comma, split by =)
5. For EACH COMPONENT_SET found in the scan data: get_component_set_info(setId) \u2014 returns componentPropertyDefinitions (BOOLEAN/TEXT/INSTANCE_SWAP). This is the ONLY per-component call needed.

**DO NOT call these \u2014 scan_page already provides the data:**
- get_children (redundant with scan_page depth 3)
- get_node_by_id (redundant \u2014 all node info is in scan data)
- find_nodes_by_type (redundant \u2014 filter scan data by type instead)
- get_node_styles per component (too expensive \u2014 use global style audit)

**Total calls: 3 + (2 x pages) + (total component sets)**
Target: under 50 calls for a typical library.

---

## Phase 1 \u2014 Data Collection

Execute calls above. Collect and organize into these data structures:

**A. GLOBAL DATA:**
- fileName, pageCount, pageNames
- variables: totalCount, unaliasedCount, unaliasedList (variables where valuesByMode values are raw RGB objects, not VARIABLE_ALIAS references). Group unaliased by name prefix (primary/, secondary/, grey/, common/).
- paintStyles: totalCount, unboundCount, unboundList (styles where paints lack boundVariables). Group by name prefix.
- textStyles: totalCount, names
- effectStyles: totalCount, names

**B. PER-PAGE DATA (from scan_page):**
- pageName, componentSetCount, variantCount
- ghostComponents: variants whose parent in the scan tree is a FRAME or GROUP (not COMPONENT_SET). Record name + parent type.
- componentSetIds: list of COMPONENT_SET node IDs for Phase 1C

**C. PER-COMPONENT-SET DATA (from scan_page + get_component_set_info):**

For each COMPONENT_SET, record:

1. **Identity**: name, id, page, variantCount
2. **Variant axes** (parse from variant child names in scan data):
   - Split each COMPONENT child name by ", " then by "=" to get axis:value pairs
   - Collect all unique axes and their value sets
   - Compute expectedVariants = product of all axis value counts
   - actualVariants = number of COMPONENT children
   - missingPct = 1 - (actual / expected), only if expected > 0
3. **Property definitions** (from get_component_set_info \u2192 componentPropertyDefinitions):
   - Count properties by type: BOOLEAN, TEXT, INSTANCE_SWAP, VARIANT
   - List each property: name, type
   - Flag: has icon child but no INSTANCE_SWAP? Has text child but no TEXT property?
4. **Internal structure** (from scan_page \u2014 inspect the FIRST variant's children at depth 2-3):
   - childTypeCounts: count of INSTANCE, FRAME, TEXT, RECTANGLE, VECTOR, ELLIPSE, GROUP among children
   - totalChildren: sum of all child nodes (recursive up to depth 3)
   - instanceCount: number of INSTANCE nodes found
   - instanceRatio: instanceCount / totalChildren (0 to 1)
5. **Auto-layout** (from scan_page \u2014 check the first variant):
   - rootHasAutoLayout: does the variant root have layoutMode set (HORIZONTAL or VERTICAL)?
   - childAutoLayoutPct: percentage of FRAME children that have layoutMode set
6. **Layer naming** (from scan_page \u2014 check all descendants of first variant):
   - defaultNameCount: children with names matching "Frame *", "Rectangle *", "Group *", "Ellipse *", "Vector *" (case-insensitive regex)
   - totalLayerCount: total descendant count
   - defaultNamePct: defaultNameCount / totalLayerCount
   - defaultNameExamples: up to 5 example names
7. **Nesting depth** (from scan_page):
   - maxDepth: deepest nesting level within the variant (the scan gives depth 3 from the component set level, so depth 2 from the variant level \u2014 note actual depth may be deeper)
8. **Documentation**:
   - hasDescription: does the component set or variant have a non-empty description? (from get_component_set_info)

---

## Phase 2 \u2014 Audit Rules

### T1: Library Health

| # | Rule | Scoring |
|---|------|---------|
| R1 | **Token Alias Chain** | Score = 100 - (unaliased% x 100). Unaliased% = unaliasedVariables / totalVariables. |
| R2 | **Style-Variable Binding** | Score = 100 - (unbound% x 100). Unbound% = unboundPaintStyles / totalPaintStyles. |
| R3 | **Component Set Structure** | Score = 100 if 0 ghosts. Deduct 10 pts per ghost, min 0. |
| R4 | **Deprecated Cleanup** | Score = 100 if 0 deprecated on active pages. Deduct 15 per deprecated set, min 0. |
| R5 | **Naming Convention** | Determine the dominant convention (PascalCase/lowercase/dot-prefix). Score = dominantPct (the % of sets following the majority convention). |
| R6 | **No Duplicates** | Score = 100 if 0 duplicate set names. Deduct 20 per duplicate, min 0. |
| R7 | **Clean Hierarchy** | Score = 100 if 0 empty pages and 0 orphaned layers. Deduct 10 per issue, min 0. |

### T2: Component Architecture

For each component set, score these individually then average across all sets:

| # | Rule | Per-Component Scoring |
|---|------|----------------------|
| R8 | **Sub-component Decomposition** | If totalChildren < 5: score = 100 (simple component, flat is fine). If totalChildren >= 5: score = min(100, instanceRatio x 200). So ratio 0.5+ = 100, ratio 0 = 0. |
| R9 | **Property Definitions** | Start at 100. Deduct 25 if component has icon-like children (INSTANCE or VECTOR) but no INSTANCE_SWAP property. Deduct 25 if component has TEXT children but no TEXT property. Deduct 15 if component has toggleable elements but no BOOLEAN property. |
| R10 | **Variant Matrix Completeness** | Score = (actualVariants / expectedVariants) x 100. Cap at 100. If expectedVariants = 0, score = 100. |
| R11 | **Axis Naming Consistency** | Cross-system check. For each common axis name (Size, State, Style/Variant/Type), collect values across ALL component sets. Score = average consistency ratio per axis (% of sets using the most common value set). |
| R12 | **Auto-Layout Coverage** | Score = 100 if rootHasAutoLayout. Score = 0 if not. |
| R13 | **Internal Layer Naming** | Score = 100 - (defaultNamePct x 100). |
| R14 | **Nesting Depth** | Score = 100 if depth 2-4. Score = 70 if depth 1 or 5. Score = 40 if depth 0 or 6+. |
| R15 | **Documentation** | Score = 100 if hasDescription. Score = 0 if not. |

### Category Scores

- **T1 Library Health** = average of R1-R7 scores
- **T2 Component Architecture** = average of R8-R15 scores (each Rx is itself averaged across all component sets)
- **Overall** = (T1 x 0.4) + (T2 x 0.6)

### Grade Scale

| Grade | Range | Meaning |
|-------|-------|---------|
| A | 90-100 | Excellent |
| B | 75-89 | Good, minor improvements |
| C | 60-74 | Fair, notable gaps |
| D | 40-59 | Poor, significant rework |
| F | 0-39 | Critical issues |

---

## Phase 3 \u2014 HTML Report

Generate a self-contained HTML file. Save to: **audits/audit-YYYY-MM-DD.html** (today's date).
If a file with that name already exists, append a sequence number: audit-YYYY-MM-DD-2.html.
Create the audits/ directory if it does not exist.

The HTML file must be fully self-contained \u2014 all CSS inline in a <style> tag, no external dependencies.

### CSS Variables and Palette

Use these CSS custom properties:

:root {
  --bg: #f8fafc;
  --surface: #ffffff;
  --text-primary: #1e293b;
  --text-secondary: #64748b;
  --text-muted: #94a3b8;
  --border: #e2e8f0;
  --border-light: #f1f5f9;
  --critical: #dc2626;
  --critical-bg: #fef2f2;
  --critical-border: #fecaca;
  --warning: #f59e0b;
  --warning-bg: #fffbeb;
  --warning-border: #fde68a;
  --info: #3b82f6;
  --info-bg: #eff6ff;
  --info-border: #bfdbfe;
  --pass: #10b981;
  --pass-bg: #ecfdf5;
  --pass-border: #a7f3d0;
  --grade-a: #10b981;
  --grade-b: #3b82f6;
  --grade-c: #f59e0b;
  --grade-d: #f97316;
  --grade-f: #dc2626;
}

### Design Rules

- Font: system-ui, -apple-system, sans-serif. Monospace for data: ui-monospace, monospace.
- Max-width: 1100px, centered with auto margins, 32px padding.
- Cards: white bg, 1px solid var(--border), 8px radius, padding 20px-24px.
- Tables: full width, text-align left, alternating row colors (#f8fafc for even rows), 1px border-bottom on rows. Sticky thead with white bg.
- Score bars: 160px wide, 8px tall, rounded-full, grey background (#e2e8f0), colored fill proportional to score. Green (>=75), yellow (>=50), red (<50).
- Severity badges: inline-block, padding 2px 8px, border-radius 9999px, font-size 11px, font-weight 600, uppercase, letter-spacing 0.05em.
  - CRITICAL: bg var(--critical-bg), color var(--critical), border 1px solid var(--critical-border)
  - WARNING: bg var(--warning-bg), color var(--warning), border 1px solid var(--warning-border)
  - INFO: bg var(--info-bg), color var(--info), border 1px solid var(--info-border)
  - PASS: bg var(--pass-bg), color var(--pass), border 1px solid var(--pass-border)
- Grade circle: 80px x 80px, border-radius 50%, font-size 36px, font-weight 800, white text, background color from grade scale (--grade-a through --grade-f).
- Section headings: font-size 20px, font-weight 700, color var(--text-primary), margin-top 48px, margin-bottom 16px, with a small colored left border (4px, border-radius 2px).
- Collapsible details: use <details><summary> for per-component breakdowns so the report stays scannable.
- Print-friendly: @media print \u2014 remove shadows, use border-only cards, break-inside: avoid on cards.

### Report Sections (in order)

**1. HEADER**
- File name as h1
- Subtitle: "Design System Audit Report"
- Metadata row: date, page count, total component sets, total variants
- Grade circle (overall grade letter + numeric score below it)
- Two category score cards side by side: "Library Health" (T1 avg) and "Component Architecture" (T2 avg), each with its own score bar

**2. EXECUTIVE SUMMARY**
- Collect the top 8 most impactful findings across all rules, ordered by severity (critical > warning > info)
- Each finding: severity badge, one-line title, one-line description
- Severity assignment: score < 50 = CRITICAL, score 50-74 = WARNING, score >= 75 and has issues = INFO, score >= 90 with no issues = PASS (don't list PASS items here)

**3. SCORE BREAKDOWN**
- Two sub-sections: "Library Health" and "Component Architecture"
- Each rule shown as a row: rule number badge, rule name, score bar, numeric score
- Rules scoring < 50 get a red highlight row background

**4. T1: LIBRARY HEALTH DETAILS**
${r==="component-architecture"?"(Skip this section \u2014 T1 not in scope)":`
4a. Token Coverage: total variables, unaliased count, unaliased % \u2014 list unaliased variable names grouped by prefix
4b. Style Binding: total paint styles, unbound count, unbound % \u2014 list unbound style names grouped by prefix
4c. Component Census: table with columns Page | Sets | Variants | Ghosts \u2014 totals row
4d. Ghost Components: list each ghost with its name, parent type, and page
4e. Naming: show the dominant convention, list components that don't follow it
4f. Deprecated: list any deprecated sets still on active pages
4g. Duplicates: list any duplicate component set names`}

**5. T2: COMPONENT ARCHITECTURE DETAILS**
${r==="library-health"?"(Skip this section \u2014 T2 not in scope)":`
5a. System-wide summary table: all component sets with columns:
    Component | Props (B/T/I) | Variants (actual/expected) | Instance Ratio | Auto-Layout | Naming | Depth | Docs | Score
    Sort by score ascending (worst first). Color-code the score column.

5b. Per-component details (inside <details> tags so they're collapsible):
    For each component set (sorted worst-score first):
    - Component name as summary
    - Property definitions: table of property name, type, and notes
    - Variant axes: list each axis with its values
    - Variant completeness: expected vs actual, missing %
    - Decomposition: child type breakdown (INSTANCE: N, FRAME: N, TEXT: N, etc.), instance ratio
    - Auto-layout: root has auto-layout? child auto-layout coverage
    - Layer naming: default name count, examples
    - Depth: measured value
    - Documentation: description present/absent, description text if present
    - Specific findings/recommendations for this component`}

**6. CROSS-SYSTEM CONSISTENCY** (T2 scope only)
${r==="library-health"?"(Skip this section)":`
- For each common axis (Size, State, Style/Variant/Type):
  - Table showing all component sets that have this axis and their values
  - Highlight rows where values deviate from the majority`}

**7. RECOMMENDATIONS**
- Numbered list of prioritized action items (most impactful first)
- Each item: priority badge (P1/P2/P3), title, description, list of affected components
- P1 = critical (score < 50), P2 = warning (50-74), P3 = info (75+)

**8. FOOTER**
- "Generated by Figma MCP Bridge Audit" + timestamp
- Total MCP calls made (track this during data collection)

---

## Phase 4 \u2014 Output

1. Write the complete HTML to the audits/ directory using the Write tool
2. Tell the user: the file path, the overall grade, the T1 and T2 category scores, the top 3 findings, and the worst-scoring component
3. Suggest: "Open the HTML file in a browser for the full interactive report"`}}]}})}var jN=Number(process.env.FIGMA_BRIDGE_PORT)||3055;async function LN(){let t=new da(jN);t.start();let e=new Hi({name:"outreach-figma-mcp-bridge",version:"1.0.0"},{instructions:`CONNECTION GATE \u2014 Required before calling any Figma tool:

This MCP server connects to Figma via a WebSocket bridge. Both the server AND
the Figma plugin MUST be running before you call any Figma tool.

WHEN THE GATE APPLIES:
  Only when you are about to call a Figma tool (build, read, inspect, modify).
  Planning, discussion, spec drafting, code editing, and non-Figma work do NOT
  require the gate. You can freely discuss and plan without a Figma connection.

BEFORE YOUR FIRST FIGMA TOOL CALL in a conversation:
  1. Call verify_workspace_setup to confirm workspace rules are installed.
     - If SETUP INCOMPLETE: STOP. Tell the user to run the setup script.
  2. Call check_health to confirm the connection is live.
     - If CONNECTION HEALTHY: proceed with Figma tools.
     - If ANY problem: STOP. Tell the user what is wrong. Call
       wait_for_connection to block until fixed. Only proceed after
       it returns CONNECTION READY.
     - If timeout: tell user, repeat fix steps, wait for "check again".

RULES:
  - Gate runs ONCE per conversation, the first time a Figma tool is needed.
  - If the gate fails, you can still plan/discuss \u2014 just no Figma tool calls.
  - Only gate-related tools allowed before it passes: verify_workspace_setup,
    check_health, wait_for_connection.
  - If a tool fails mid-conversation with a connection error, re-check health.

MULTI-EDITOR SUPPORT:
  - Multiple editors (Cursor, VS Code, etc.) can control Figma simultaneously.
  - Each editor auto-binds to a unique port in the range 3055-3060 (up to 6).
  - The Figma plugin connects to ALL active editors and routes commands by ID.
  - check_health shows which port this editor is bound to.`});Gv(e,t),Wv(e);let r=new Wi;await e.connect(r);let n=()=>{t.stop(),process.exit(0)};process.on("SIGINT",n),process.on("SIGTERM",n),process.on("exit",()=>{t.removePortFile()})}LN().catch(t=>{process.stderr.write(`Fatal error: ${t}
`),process.exit(1)});
