#!/usr/bin/env node
// Outreach Figma MCP Bridge â€” bundled server
"use strict";var Lv=Object.create;var ua=Object.defineProperty;var Fv=Object.getOwnPropertyDescriptor;var qv=Object.getOwnPropertyNames;var Uv=Object.getPrototypeOf,Vv=Object.prototype.hasOwnProperty;var k=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),la=(t,e)=>{for(var r in e)ua(t,r,{get:e[r],enumerable:!0})},Bv=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of qv(e))!Vv.call(t,o)&&o!==r&&ua(t,o,{get:()=>e[o],enumerable:!(n=Fv(e,o))||n.enumerable});return t};var Ht=(t,e,r)=>(r=t!=null?Lv(Uv(t)):{},Bv(e||!t||!t.__esModule?ua(r,"default",{value:t,enumerable:!0}):r,t));var _o=k(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.regexpCode=ee.getEsmExportName=ee.getProperty=ee.safeStringify=ee.stringify=ee.strConcat=ee.addCodeArg=ee.str=ee._=ee.nil=ee._Code=ee.Name=ee.IDENTIFIER=ee._CodeOrName=void 0;var go=class{};ee._CodeOrName=go;ee.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var Zr=class extends go{constructor(e){if(super(),!ee.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}};ee.Name=Zr;var nt=class extends go{constructor(e){super(),this._items=typeof e=="string"?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let e=this._items[0];return e===""||e==='""'}get str(){var e;return(e=this._str)!==null&&e!==void 0?e:this._str=this._items.reduce((r,n)=>`${r}${n}`,"")}get names(){var e;return(e=this._names)!==null&&e!==void 0?e:this._names=this._items.reduce((r,n)=>(n instanceof Zr&&(r[n.str]=(r[n.str]||0)+1),r),{})}};ee._Code=nt;ee.nil=new nt("");function ph(t,...e){let r=[t[0]],n=0;for(;n<e.length;)Wu(r,e[n]),r.push(t[++n]);return new nt(r)}ee._=ph;var Gu=new nt("+");function mh(t,...e){let r=[yo(t[0])],n=0;for(;n<e.length;)r.push(Gu),Wu(r,e[n]),r.push(Gu,yo(t[++n]));return BS(r),new nt(r)}ee.str=mh;function Wu(t,e){e instanceof nt?t.push(...e._items):e instanceof Zr?t.push(e):t.push(WS(e))}ee.addCodeArg=Wu;function BS(t){let e=1;for(;e<t.length-1;){if(t[e]===Gu){let r=HS(t[e-1],t[e+1]);if(r!==void 0){t.splice(e-1,3,r);continue}t[e++]="+"}e++}}function HS(t,e){if(e==='""')return t;if(t==='""')return e;if(typeof t=="string")return e instanceof Zr||t[t.length-1]!=='"'?void 0:typeof e!="string"?`${t.slice(0,-1)}${e}"`:e[0]==='"'?t.slice(0,-1)+e.slice(1):void 0;if(typeof e=="string"&&e[0]==='"'&&!(t instanceof Zr))return`"${t}${e.slice(1)}`}function GS(t,e){return e.emptyStr()?t:t.emptyStr()?e:mh`${t}${e}`}ee.strConcat=GS;function WS(t){return typeof t=="number"||typeof t=="boolean"||t===null?t:yo(Array.isArray(t)?t.join(","):t)}function JS(t){return new nt(yo(t))}ee.stringify=JS;function yo(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}ee.safeStringify=yo;function KS(t){return typeof t=="string"&&ee.IDENTIFIER.test(t)?new nt(`.${t}`):ph`[${t}]`}ee.getProperty=KS;function XS(t){if(typeof t=="string"&&ee.IDENTIFIER.test(t))return new nt(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)}ee.getEsmExportName=XS;function YS(t){return new nt(t.toString())}ee.regexpCode=YS});var Xu=k(Be=>{"use strict";Object.defineProperty(Be,"__esModule",{value:!0});Be.ValueScope=Be.ValueScopeName=Be.Scope=Be.varKinds=Be.UsedValueState=void 0;var Ve=_o(),Ju=class extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}},ti;(function(t){t[t.Started=0]="Started",t[t.Completed=1]="Completed"})(ti||(Be.UsedValueState=ti={}));Be.varKinds={const:new Ve.Name("const"),let:new Ve.Name("let"),var:new Ve.Name("var")};var ri=class{constructor({prefixes:e,parent:r}={}){this._names={},this._prefixes=e,this._parent=r}toName(e){return e instanceof Ve.Name?e:this.name(e)}name(e){return new Ve.Name(this._newName(e))}_newName(e){let r=this._names[e]||this._nameGroup(e);return`${e}${r.index++}`}_nameGroup(e){var r,n;if(!((n=(r=this._parent)===null||r===void 0?void 0:r._prefixes)===null||n===void 0)&&n.has(e)||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}};Be.Scope=ri;var ni=class extends Ve.Name{constructor(e,r){super(r),this.prefix=e}setValue(e,{property:r,itemIndex:n}){this.value=e,this.scopePath=(0,Ve._)`.${new Ve.Name(r)}[${n}]`}};Be.ValueScopeName=ni;var QS=(0,Ve._)`\n`,Ku=class extends ri{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?QS:Ve.nil}}get(){return this._scope}name(e){return new ni(e,this._newName(e))}value(e,r){var n;if(r.ref===void 0)throw new Error("CodeGen: ref must be passed in value");let o=this.toName(e),{prefix:s}=o,i=(n=r.key)!==null&&n!==void 0?n:r.ref,a=this._values[s];if(a){let l=a.get(i);if(l)return l}else a=this._values[s]=new Map;a.set(i,o);let c=this._scope[s]||(this._scope[s]=[]),u=c.length;return c[u]=r.ref,o.setValue(r,{property:s,itemIndex:u}),o}getValue(e,r){let n=this._values[e];if(n)return n.get(r)}scopeRefs(e,r=this._values){return this._reduceValues(r,n=>{if(n.scopePath===void 0)throw new Error(`CodeGen: name "${n}" has no value`);return(0,Ve._)`${e}${n.scopePath}`})}scopeCode(e=this._values,r,n){return this._reduceValues(e,o=>{if(o.value===void 0)throw new Error(`CodeGen: name "${o}" has no value`);return o.value.code},r,n)}_reduceValues(e,r,n={},o){let s=Ve.nil;for(let i in e){let a=e[i];if(!a)continue;let c=n[i]=n[i]||new Map;a.forEach(u=>{if(c.has(u))return;c.set(u,ti.Started);let l=r(u);if(l){let d=this.opts.es5?Be.varKinds.var:Be.varKinds.const;s=(0,Ve._)`${s}${d} ${u} = ${l};${this.opts._n}`}else if(l=o?.(u))s=(0,Ve._)`${s}${l}${this.opts._n}`;else throw new Ju(u);c.set(u,ti.Completed)})}return s}};Be.ValueScope=Ku});var B=k(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.or=H.and=H.not=H.CodeGen=H.operators=H.varKinds=H.ValueScopeName=H.ValueScope=H.Scope=H.Name=H.regexpCode=H.stringify=H.getProperty=H.nil=H.strConcat=H.str=H._=void 0;var Y=_o(),mt=Xu(),nr=_o();Object.defineProperty(H,"_",{enumerable:!0,get:function(){return nr._}});Object.defineProperty(H,"str",{enumerable:!0,get:function(){return nr.str}});Object.defineProperty(H,"strConcat",{enumerable:!0,get:function(){return nr.strConcat}});Object.defineProperty(H,"nil",{enumerable:!0,get:function(){return nr.nil}});Object.defineProperty(H,"getProperty",{enumerable:!0,get:function(){return nr.getProperty}});Object.defineProperty(H,"stringify",{enumerable:!0,get:function(){return nr.stringify}});Object.defineProperty(H,"regexpCode",{enumerable:!0,get:function(){return nr.regexpCode}});Object.defineProperty(H,"Name",{enumerable:!0,get:function(){return nr.Name}});var ai=Xu();Object.defineProperty(H,"Scope",{enumerable:!0,get:function(){return ai.Scope}});Object.defineProperty(H,"ValueScope",{enumerable:!0,get:function(){return ai.ValueScope}});Object.defineProperty(H,"ValueScopeName",{enumerable:!0,get:function(){return ai.ValueScopeName}});Object.defineProperty(H,"varKinds",{enumerable:!0,get:function(){return ai.varKinds}});H.operators={GT:new Y._Code(">"),GTE:new Y._Code(">="),LT:new Y._Code("<"),LTE:new Y._Code("<="),EQ:new Y._Code("==="),NEQ:new Y._Code("!=="),NOT:new Y._Code("!"),OR:new Y._Code("||"),AND:new Y._Code("&&"),ADD:new Y._Code("+")};var jt=class{optimizeNodes(){return this}optimizeNames(e,r){return this}},Yu=class extends jt{constructor(e,r,n){super(),this.varKind=e,this.name=r,this.rhs=n}render({es5:e,_n:r}){let n=e?mt.varKinds.var:this.varKind,o=this.rhs===void 0?"":` = ${this.rhs}`;return`${n} ${this.name}${o};`+r}optimizeNames(e,r){if(e[this.name.str])return this.rhs&&(this.rhs=vn(this.rhs,e,r)),this}get names(){return this.rhs instanceof Y._CodeOrName?this.rhs.names:{}}},oi=class extends jt{constructor(e,r,n){super(),this.lhs=e,this.rhs=r,this.sideEffects=n}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof Y.Name&&!e[this.lhs.str]&&!this.sideEffects))return this.rhs=vn(this.rhs,e,r),this}get names(){let e=this.lhs instanceof Y.Name?{}:{...this.lhs.names};return ii(e,this.rhs)}},Qu=class extends oi{constructor(e,r,n,o){super(e,n,o),this.op=r}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}},el=class extends jt{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}},tl=class extends jt{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}},rl=class extends jt{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}},nl=class extends jt{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,r){return this.code=vn(this.code,e,r),this}get names(){return this.code instanceof Y._CodeOrName?this.code.names:{}}},vo=class extends jt{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((r,n)=>r+n.render(e),"")}optimizeNodes(){let{nodes:e}=this,r=e.length;for(;r--;){let n=e[r].optimizeNodes();Array.isArray(n)?e.splice(r,1,...n):n?e[r]=n:e.splice(r,1)}return e.length>0?this:void 0}optimizeNames(e,r){let{nodes:n}=this,o=n.length;for(;o--;){let s=n[o];s.optimizeNames(e,r)||(e$(e,s.names),n.splice(o,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((e,r)=>qr(e,r.names),{})}},Dt=class extends vo{render(e){return"{"+e._n+super.render(e)+"}"+e._n}},ol=class extends vo{},_n=class extends Dt{};_n.kind="else";var Lr=class t extends Dt{constructor(e,r){super(r),this.condition=e}render(e){let r=`if(${this.condition})`+super.render(e);return this.else&&(r+="else "+this.else.render(e)),r}optimizeNodes(){super.optimizeNodes();let e=this.condition;if(e===!0)return this.nodes;let r=this.else;if(r){let n=r.optimizeNodes();r=this.else=Array.isArray(n)?new _n(n):n}if(r)return e===!1?r instanceof t?r:r.nodes:this.nodes.length?this:new t(hh(e),r instanceof t?[r]:r.nodes);if(!(e===!1||!this.nodes.length))return this}optimizeNames(e,r){var n;if(this.else=(n=this.else)===null||n===void 0?void 0:n.optimizeNames(e,r),!!(super.optimizeNames(e,r)||this.else))return this.condition=vn(this.condition,e,r),this}get names(){let e=super.names;return ii(e,this.condition),this.else&&qr(e,this.else.names),e}};Lr.kind="if";var Fr=class extends Dt{};Fr.kind="for";var sl=class extends Fr{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iteration=vn(this.iteration,e,r),this}get names(){return qr(super.names,this.iteration.names)}},il=class extends Fr{constructor(e,r,n,o){super(),this.varKind=e,this.name=r,this.from=n,this.to=o}render(e){let r=e.es5?mt.varKinds.var:this.varKind,{name:n,from:o,to:s}=this;return`for(${r} ${n}=${o}; ${n}<${s}; ${n}++)`+super.render(e)}get names(){let e=ii(super.names,this.from);return ii(e,this.to)}},si=class extends Fr{constructor(e,r,n,o){super(),this.loop=e,this.varKind=r,this.name=n,this.iterable=o}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iterable=vn(this.iterable,e,r),this}get names(){return qr(super.names,this.iterable.names)}},bo=class extends Dt{constructor(e,r,n){super(),this.name=e,this.args=r,this.async=n}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}};bo.kind="func";var xo=class extends vo{render(e){return"return "+super.render(e)}};xo.kind="return";var al=class extends Dt{render(e){let r="try"+super.render(e);return this.catch&&(r+=this.catch.render(e)),this.finally&&(r+=this.finally.render(e)),r}optimizeNodes(){var e,r;return super.optimizeNodes(),(e=this.catch)===null||e===void 0||e.optimizeNodes(),(r=this.finally)===null||r===void 0||r.optimizeNodes(),this}optimizeNames(e,r){var n,o;return super.optimizeNames(e,r),(n=this.catch)===null||n===void 0||n.optimizeNames(e,r),(o=this.finally)===null||o===void 0||o.optimizeNames(e,r),this}get names(){let e=super.names;return this.catch&&qr(e,this.catch.names),this.finally&&qr(e,this.finally.names),e}},wo=class extends Dt{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}};wo.kind="catch";var So=class extends Dt{render(e){return"finally"+super.render(e)}};So.kind="finally";var cl=class{constructor(e,r={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...r,_n:r.lines?`
`:""},this._extScope=e,this._scope=new mt.Scope({parent:e}),this._nodes=[new ol]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,r){let n=this._extScope.value(e,r);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(e,r){return this._extScope.getValue(e,r)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,r,n,o){let s=this._scope.toName(r);return n!==void 0&&o&&(this._constants[s.str]=n),this._leafNode(new Yu(e,s,n)),s}const(e,r,n){return this._def(mt.varKinds.const,e,r,n)}let(e,r,n){return this._def(mt.varKinds.let,e,r,n)}var(e,r,n){return this._def(mt.varKinds.var,e,r,n)}assign(e,r,n){return this._leafNode(new oi(e,r,n))}add(e,r){return this._leafNode(new Qu(e,H.operators.ADD,r))}code(e){return typeof e=="function"?e():e!==Y.nil&&this._leafNode(new nl(e)),this}object(...e){let r=["{"];for(let[n,o]of e)r.length>1&&r.push(","),r.push(n),(n!==o||this.opts.es5)&&(r.push(":"),(0,Y.addCodeArg)(r,o));return r.push("}"),new Y._Code(r)}if(e,r,n){if(this._blockNode(new Lr(e)),r&&n)this.code(r).else().code(n).endIf();else if(r)this.code(r).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new Lr(e))}else(){return this._elseNode(new _n)}endIf(){return this._endBlockNode(Lr,_n)}_for(e,r){return this._blockNode(e),r&&this.code(r).endFor(),this}for(e,r){return this._for(new sl(e),r)}forRange(e,r,n,o,s=this.opts.es5?mt.varKinds.var:mt.varKinds.let){let i=this._scope.toName(e);return this._for(new il(s,i,r,n),()=>o(i))}forOf(e,r,n,o=mt.varKinds.const){let s=this._scope.toName(e);if(this.opts.es5){let i=r instanceof Y.Name?r:this.var("_arr",r);return this.forRange("_i",0,(0,Y._)`${i}.length`,a=>{this.var(s,(0,Y._)`${i}[${a}]`),n(s)})}return this._for(new si("of",o,s,r),()=>n(s))}forIn(e,r,n,o=this.opts.es5?mt.varKinds.var:mt.varKinds.const){if(this.opts.ownProperties)return this.forOf(e,(0,Y._)`Object.keys(${r})`,n);let s=this._scope.toName(e);return this._for(new si("in",o,s,r),()=>n(s))}endFor(){return this._endBlockNode(Fr)}label(e){return this._leafNode(new el(e))}break(e){return this._leafNode(new tl(e))}return(e){let r=new xo;if(this._blockNode(r),this.code(e),r.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(xo)}try(e,r,n){if(!r&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');let o=new al;if(this._blockNode(o),this.code(e),r){let s=this.name("e");this._currNode=o.catch=new wo(s),r(s)}return n&&(this._currNode=o.finally=new So,this.code(n)),this._endBlockNode(wo,So)}throw(e){return this._leafNode(new rl(e))}block(e,r){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(r),this}endBlock(e){let r=this._blockStarts.pop();if(r===void 0)throw new Error("CodeGen: not in self-balancing block");let n=this._nodes.length-r;if(n<0||e!==void 0&&n!==e)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${e} expected`);return this._nodes.length=r,this}func(e,r=Y.nil,n,o){return this._blockNode(new bo(e,r,n)),o&&this.code(o).endFunc(),this}endFunc(){return this._endBlockNode(bo)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,r){let n=this._currNode;if(n instanceof e||r&&n instanceof r)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${r?`${e.kind}/${r.kind}`:e.kind}"`)}_elseNode(e){let r=this._currNode;if(!(r instanceof Lr))throw new Error('CodeGen: "else" without "if"');return this._currNode=r.else=e,this}get _root(){return this._nodes[0]}get _currNode(){let e=this._nodes;return e[e.length-1]}set _currNode(e){let r=this._nodes;r[r.length-1]=e}};H.CodeGen=cl;function qr(t,e){for(let r in e)t[r]=(t[r]||0)+(e[r]||0);return t}function ii(t,e){return e instanceof Y._CodeOrName?qr(t,e.names):t}function vn(t,e,r){if(t instanceof Y.Name)return n(t);if(!o(t))return t;return new Y._Code(t._items.reduce((s,i)=>(i instanceof Y.Name&&(i=n(i)),i instanceof Y._Code?s.push(...i._items):s.push(i),s),[]));function n(s){let i=r[s.str];return i===void 0||e[s.str]!==1?s:(delete e[s.str],i)}function o(s){return s instanceof Y._Code&&s._items.some(i=>i instanceof Y.Name&&e[i.str]===1&&r[i.str]!==void 0)}}function e$(t,e){for(let r in e)t[r]=(t[r]||0)-(e[r]||0)}function hh(t){return typeof t=="boolean"||typeof t=="number"||t===null?!t:(0,Y._)`!${ul(t)}`}H.not=hh;var t$=gh(H.operators.AND);function r$(...t){return t.reduce(t$)}H.and=r$;var n$=gh(H.operators.OR);function o$(...t){return t.reduce(n$)}H.or=o$;function gh(t){return(e,r)=>e===Y.nil?r:r===Y.nil?e:(0,Y._)`${ul(e)} ${t} ${ul(r)}`}function ul(t){return t instanceof Y.Name?t:(0,Y._)`(${t})`}});var te=k(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.checkStrictMode=G.getErrorPath=G.Type=G.useFunc=G.setEvaluated=G.evaluatedPropsToName=G.mergeEvaluated=G.eachItem=G.unescapeJsonPointer=G.escapeJsonPointer=G.escapeFragment=G.unescapeFragment=G.schemaRefOrVal=G.schemaHasRulesButRef=G.schemaHasRules=G.checkUnknownRules=G.alwaysValidSchema=G.toHash=void 0;var se=B(),s$=_o();function i$(t){let e={};for(let r of t)e[r]=!0;return e}G.toHash=i$;function a$(t,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:(vh(t,e),!bh(e,t.self.RULES.all))}G.alwaysValidSchema=a$;function vh(t,e=t.schema){let{opts:r,self:n}=t;if(!r.strictSchema||typeof e=="boolean")return;let o=n.RULES.keywords;for(let s in e)o[s]||Sh(t,`unknown keyword: "${s}"`)}G.checkUnknownRules=vh;function bh(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(e[r])return!0;return!1}G.schemaHasRules=bh;function c$(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(r!=="$ref"&&e.all[r])return!0;return!1}G.schemaHasRulesButRef=c$;function u$({topSchemaRef:t,schemaPath:e},r,n,o){if(!o){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,se._)`${r}`}return(0,se._)`${t}${e}${(0,se.getProperty)(n)}`}G.schemaRefOrVal=u$;function l$(t){return xh(decodeURIComponent(t))}G.unescapeFragment=l$;function d$(t){return encodeURIComponent(dl(t))}G.escapeFragment=d$;function dl(t){return typeof t=="number"?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}G.escapeJsonPointer=dl;function xh(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}G.unescapeJsonPointer=xh;function f$(t,e){if(Array.isArray(t))for(let r of t)e(r);else e(t)}G.eachItem=f$;function yh({mergeNames:t,mergeToName:e,mergeValues:r,resultToName:n}){return(o,s,i,a)=>{let c=i===void 0?s:i instanceof se.Name?(s instanceof se.Name?t(o,s,i):e(o,s,i),i):s instanceof se.Name?(e(o,i,s),s):r(s,i);return a===se.Name&&!(c instanceof se.Name)?n(o,c):c}}G.mergeEvaluated={props:yh({mergeNames:(t,e,r)=>t.if((0,se._)`${r} !== true && ${e} !== undefined`,()=>{t.if((0,se._)`${e} === true`,()=>t.assign(r,!0),()=>t.assign(r,(0,se._)`${r} || {}`).code((0,se._)`Object.assign(${r}, ${e})`))}),mergeToName:(t,e,r)=>t.if((0,se._)`${r} !== true`,()=>{e===!0?t.assign(r,!0):(t.assign(r,(0,se._)`${r} || {}`),fl(t,r,e))}),mergeValues:(t,e)=>t===!0?!0:{...t,...e},resultToName:wh}),items:yh({mergeNames:(t,e,r)=>t.if((0,se._)`${r} !== true && ${e} !== undefined`,()=>t.assign(r,(0,se._)`${e} === true ? true : ${r} > ${e} ? ${r} : ${e}`)),mergeToName:(t,e,r)=>t.if((0,se._)`${r} !== true`,()=>t.assign(r,e===!0?!0:(0,se._)`${r} > ${e} ? ${r} : ${e}`)),mergeValues:(t,e)=>t===!0?!0:Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})};function wh(t,e){if(e===!0)return t.var("props",!0);let r=t.var("props",(0,se._)`{}`);return e!==void 0&&fl(t,r,e),r}G.evaluatedPropsToName=wh;function fl(t,e,r){Object.keys(r).forEach(n=>t.assign((0,se._)`${e}${(0,se.getProperty)(n)}`,!0))}G.setEvaluated=fl;var _h={};function p$(t,e){return t.scopeValue("func",{ref:e,code:_h[e.code]||(_h[e.code]=new s$._Code(e.code))})}G.useFunc=p$;var ll;(function(t){t[t.Num=0]="Num",t[t.Str=1]="Str"})(ll||(G.Type=ll={}));function m$(t,e,r){if(t instanceof se.Name){let n=e===ll.Num;return r?n?(0,se._)`"[" + ${t} + "]"`:(0,se._)`"['" + ${t} + "']"`:n?(0,se._)`"/" + ${t}`:(0,se._)`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,se.getProperty)(t).toString():"/"+dl(t)}G.getErrorPath=m$;function Sh(t,e,r=t.opts.strictSchema){if(r){if(e=`strict mode: ${e}`,r===!0)throw new Error(e);t.self.logger.warn(e)}}G.checkStrictMode=Sh});var Zt=k(pl=>{"use strict";Object.defineProperty(pl,"__esModule",{value:!0});var Oe=B(),h$={data:new Oe.Name("data"),valCxt:new Oe.Name("valCxt"),instancePath:new Oe.Name("instancePath"),parentData:new Oe.Name("parentData"),parentDataProperty:new Oe.Name("parentDataProperty"),rootData:new Oe.Name("rootData"),dynamicAnchors:new Oe.Name("dynamicAnchors"),vErrors:new Oe.Name("vErrors"),errors:new Oe.Name("errors"),this:new Oe.Name("this"),self:new Oe.Name("self"),scope:new Oe.Name("scope"),json:new Oe.Name("json"),jsonPos:new Oe.Name("jsonPos"),jsonLen:new Oe.Name("jsonLen"),jsonPart:new Oe.Name("jsonPart")};pl.default=h$});var $o=k(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.extendErrors=Ce.resetErrorsCount=Ce.reportExtraError=Ce.reportError=Ce.keyword$DataError=Ce.keywordError=void 0;var Q=B(),ci=te(),De=Zt();Ce.keywordError={message:({keyword:t})=>(0,Q.str)`must pass "${t}" keyword validation`};Ce.keyword$DataError={message:({keyword:t,schemaType:e})=>e?(0,Q.str)`"${t}" keyword must be ${e} ($data)`:(0,Q.str)`"${t}" keyword is invalid ($data)`};function g$(t,e=Ce.keywordError,r,n){let{it:o}=t,{gen:s,compositeRule:i,allErrors:a}=o,c=Th(t,e,r);n??(i||a)?$h(s,c):kh(o,(0,Q._)`[${c}]`)}Ce.reportError=g$;function y$(t,e=Ce.keywordError,r){let{it:n}=t,{gen:o,compositeRule:s,allErrors:i}=n,a=Th(t,e,r);$h(o,a),s||i||kh(n,De.default.vErrors)}Ce.reportExtraError=y$;function _$(t,e){t.assign(De.default.errors,e),t.if((0,Q._)`${De.default.vErrors} !== null`,()=>t.if(e,()=>t.assign((0,Q._)`${De.default.vErrors}.length`,e),()=>t.assign(De.default.vErrors,null)))}Ce.resetErrorsCount=_$;function v$({gen:t,keyword:e,schemaValue:r,data:n,errsCount:o,it:s}){if(o===void 0)throw new Error("ajv implementation error");let i=t.name("err");t.forRange("i",o,De.default.errors,a=>{t.const(i,(0,Q._)`${De.default.vErrors}[${a}]`),t.if((0,Q._)`${i}.instancePath === undefined`,()=>t.assign((0,Q._)`${i}.instancePath`,(0,Q.strConcat)(De.default.instancePath,s.errorPath))),t.assign((0,Q._)`${i}.schemaPath`,(0,Q.str)`${s.errSchemaPath}/${e}`),s.opts.verbose&&(t.assign((0,Q._)`${i}.schema`,r),t.assign((0,Q._)`${i}.data`,n))})}Ce.extendErrors=v$;function $h(t,e){let r=t.const("err",e);t.if((0,Q._)`${De.default.vErrors} === null`,()=>t.assign(De.default.vErrors,(0,Q._)`[${r}]`),(0,Q._)`${De.default.vErrors}.push(${r})`),t.code((0,Q._)`${De.default.errors}++`)}function kh(t,e){let{gen:r,validateName:n,schemaEnv:o}=t;o.$async?r.throw((0,Q._)`new ${t.ValidationError}(${e})`):(r.assign((0,Q._)`${n}.errors`,e),r.return(!1))}var Ur={keyword:new Q.Name("keyword"),schemaPath:new Q.Name("schemaPath"),params:new Q.Name("params"),propertyName:new Q.Name("propertyName"),message:new Q.Name("message"),schema:new Q.Name("schema"),parentSchema:new Q.Name("parentSchema")};function Th(t,e,r){let{createErrors:n}=t.it;return n===!1?(0,Q._)`{}`:b$(t,e,r)}function b$(t,e,r={}){let{gen:n,it:o}=t,s=[x$(o,r),w$(t,r)];return S$(t,e,s),n.object(...s)}function x$({errorPath:t},{instancePath:e}){let r=e?(0,Q.str)`${t}${(0,ci.getErrorPath)(e,ci.Type.Str)}`:t;return[De.default.instancePath,(0,Q.strConcat)(De.default.instancePath,r)]}function w$({keyword:t,it:{errSchemaPath:e}},{schemaPath:r,parentSchema:n}){let o=n?e:(0,Q.str)`${e}/${t}`;return r&&(o=(0,Q.str)`${o}${(0,ci.getErrorPath)(r,ci.Type.Str)}`),[Ur.schemaPath,o]}function S$(t,{params:e,message:r},n){let{keyword:o,data:s,schemaValue:i,it:a}=t,{opts:c,propertyName:u,topSchemaRef:l,schemaPath:d}=a;n.push([Ur.keyword,o],[Ur.params,typeof e=="function"?e(t):e||(0,Q._)`{}`]),c.messages&&n.push([Ur.message,typeof r=="function"?r(t):r]),c.verbose&&n.push([Ur.schema,i],[Ur.parentSchema,(0,Q._)`${l}${d}`],[De.default.data,s]),u&&n.push([Ur.propertyName,u])}});var Ih=k(bn=>{"use strict";Object.defineProperty(bn,"__esModule",{value:!0});bn.boolOrEmptySchema=bn.topBoolOrEmptySchema=void 0;var $$=$o(),k$=B(),T$=Zt(),E$={message:"boolean schema is false"};function I$(t){let{gen:e,schema:r,validateName:n}=t;r===!1?Eh(t,!1):typeof r=="object"&&r.$async===!0?e.return(T$.default.data):(e.assign((0,k$._)`${n}.errors`,null),e.return(!0))}bn.topBoolOrEmptySchema=I$;function z$(t,e){let{gen:r,schema:n}=t;n===!1?(r.var(e,!1),Eh(t)):r.var(e,!0)}bn.boolOrEmptySchema=z$;function Eh(t,e){let{gen:r,data:n}=t,o={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,$$.reportError)(o,E$,void 0,e)}});var ml=k(xn=>{"use strict";Object.defineProperty(xn,"__esModule",{value:!0});xn.getRules=xn.isJSONType=void 0;var P$=["string","number","integer","boolean","null","object","array"],R$=new Set(P$);function N$(t){return typeof t=="string"&&R$.has(t)}xn.isJSONType=N$;function O$(){let t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}xn.getRules=O$});var hl=k(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});or.shouldUseRule=or.shouldUseGroup=or.schemaHasRulesForType=void 0;function C$({schema:t,self:e},r){let n=e.RULES.types[r];return n&&n!==!0&&zh(t,n)}or.schemaHasRulesForType=C$;function zh(t,e){return e.rules.some(r=>Ph(t,r))}or.shouldUseGroup=zh;function Ph(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(n=>t[n]!==void 0))}or.shouldUseRule=Ph});var ko=k(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.reportTypeError=Ae.checkDataTypes=Ae.checkDataType=Ae.coerceAndCheckDataType=Ae.getJSONTypes=Ae.getSchemaTypes=Ae.DataType=void 0;var A$=ml(),M$=hl(),j$=$o(),U=B(),Rh=te(),wn;(function(t){t[t.Correct=0]="Correct",t[t.Wrong=1]="Wrong"})(wn||(Ae.DataType=wn={}));function D$(t){let e=Nh(t.type);if(e.includes("null")){if(t.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&t.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');t.nullable===!0&&e.push("null")}return e}Ae.getSchemaTypes=D$;function Nh(t){let e=Array.isArray(t)?t:t?[t]:[];if(e.every(A$.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}Ae.getJSONTypes=Nh;function Z$(t,e){let{gen:r,data:n,opts:o}=t,s=L$(e,o.coerceTypes),i=e.length>0&&!(s.length===0&&e.length===1&&(0,M$.schemaHasRulesForType)(t,e[0]));if(i){let a=yl(e,n,o.strictNumbers,wn.Wrong);r.if(a,()=>{s.length?F$(t,e,s):_l(t)})}return i}Ae.coerceAndCheckDataType=Z$;var Oh=new Set(["string","number","integer","boolean","null"]);function L$(t,e){return e?t.filter(r=>Oh.has(r)||e==="array"&&r==="array"):[]}function F$(t,e,r){let{gen:n,data:o,opts:s}=t,i=n.let("dataType",(0,U._)`typeof ${o}`),a=n.let("coerced",(0,U._)`undefined`);s.coerceTypes==="array"&&n.if((0,U._)`${i} == 'object' && Array.isArray(${o}) && ${o}.length == 1`,()=>n.assign(o,(0,U._)`${o}[0]`).assign(i,(0,U._)`typeof ${o}`).if(yl(e,o,s.strictNumbers),()=>n.assign(a,o))),n.if((0,U._)`${a} !== undefined`);for(let u of r)(Oh.has(u)||u==="array"&&s.coerceTypes==="array")&&c(u);n.else(),_l(t),n.endIf(),n.if((0,U._)`${a} !== undefined`,()=>{n.assign(o,a),q$(t,a)});function c(u){switch(u){case"string":n.elseIf((0,U._)`${i} == "number" || ${i} == "boolean"`).assign(a,(0,U._)`"" + ${o}`).elseIf((0,U._)`${o} === null`).assign(a,(0,U._)`""`);return;case"number":n.elseIf((0,U._)`${i} == "boolean" || ${o} === null
              || (${i} == "string" && ${o} && ${o} == +${o})`).assign(a,(0,U._)`+${o}`);return;case"integer":n.elseIf((0,U._)`${i} === "boolean" || ${o} === null
              || (${i} === "string" && ${o} && ${o} == +${o} && !(${o} % 1))`).assign(a,(0,U._)`+${o}`);return;case"boolean":n.elseIf((0,U._)`${o} === "false" || ${o} === 0 || ${o} === null`).assign(a,!1).elseIf((0,U._)`${o} === "true" || ${o} === 1`).assign(a,!0);return;case"null":n.elseIf((0,U._)`${o} === "" || ${o} === 0 || ${o} === false`),n.assign(a,null);return;case"array":n.elseIf((0,U._)`${i} === "string" || ${i} === "number"
              || ${i} === "boolean" || ${o} === null`).assign(a,(0,U._)`[${o}]`)}}}function q$({gen:t,parentData:e,parentDataProperty:r},n){t.if((0,U._)`${e} !== undefined`,()=>t.assign((0,U._)`${e}[${r}]`,n))}function gl(t,e,r,n=wn.Correct){let o=n===wn.Correct?U.operators.EQ:U.operators.NEQ,s;switch(t){case"null":return(0,U._)`${e} ${o} null`;case"array":s=(0,U._)`Array.isArray(${e})`;break;case"object":s=(0,U._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":s=i((0,U._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":s=i();break;default:return(0,U._)`typeof ${e} ${o} ${t}`}return n===wn.Correct?s:(0,U.not)(s);function i(a=U.nil){return(0,U.and)((0,U._)`typeof ${e} == "number"`,a,r?(0,U._)`isFinite(${e})`:U.nil)}}Ae.checkDataType=gl;function yl(t,e,r,n){if(t.length===1)return gl(t[0],e,r,n);let o,s=(0,Rh.toHash)(t);if(s.array&&s.object){let i=(0,U._)`typeof ${e} != "object"`;o=s.null?i:(0,U._)`!${e} || ${i}`,delete s.null,delete s.array,delete s.object}else o=U.nil;s.number&&delete s.integer;for(let i in s)o=(0,U.and)(o,gl(i,e,r,n));return o}Ae.checkDataTypes=yl;var U$={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>typeof t=="string"?(0,U._)`{type: ${t}}`:(0,U._)`{type: ${e}}`};function _l(t){let e=V$(t);(0,j$.reportError)(e,U$)}Ae.reportTypeError=_l;function V$(t){let{gen:e,data:r,schema:n}=t,o=(0,Rh.schemaRefOrVal)(t,n,"type");return{gen:e,keyword:"type",data:r,schema:n.type,schemaCode:o,schemaValue:o,parentSchema:n,params:{},it:t}}});var Ah=k(ui=>{"use strict";Object.defineProperty(ui,"__esModule",{value:!0});ui.assignDefaults=void 0;var Sn=B(),B$=te();function H$(t,e){let{properties:r,items:n}=t.schema;if(e==="object"&&r)for(let o in r)Ch(t,o,r[o].default);else e==="array"&&Array.isArray(n)&&n.forEach((o,s)=>Ch(t,s,o.default))}ui.assignDefaults=H$;function Ch(t,e,r){let{gen:n,compositeRule:o,data:s,opts:i}=t;if(r===void 0)return;let a=(0,Sn._)`${s}${(0,Sn.getProperty)(e)}`;if(o){(0,B$.checkStrictMode)(t,`default is ignored for: ${a}`);return}let c=(0,Sn._)`${a} === undefined`;i.useDefaults==="empty"&&(c=(0,Sn._)`${c} || ${a} === null || ${a} === ""`),n.if(c,(0,Sn._)`${a} = ${(0,Sn.stringify)(r)}`)}});var ot=k(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.validateUnion=oe.validateArray=oe.usePattern=oe.callValidateCode=oe.schemaProperties=oe.allSchemaProperties=oe.noPropertyInData=oe.propertyInData=oe.isOwnProperty=oe.hasPropFunc=oe.reportMissingProp=oe.checkMissingProp=oe.checkReportMissingProp=void 0;var ue=B(),vl=te(),sr=Zt(),G$=te();function W$(t,e){let{gen:r,data:n,it:o}=t;r.if(xl(r,n,e,o.opts.ownProperties),()=>{t.setParams({missingProperty:(0,ue._)`${e}`},!0),t.error()})}oe.checkReportMissingProp=W$;function J$({gen:t,data:e,it:{opts:r}},n,o){return(0,ue.or)(...n.map(s=>(0,ue.and)(xl(t,e,s,r.ownProperties),(0,ue._)`${o} = ${s}`)))}oe.checkMissingProp=J$;function K$(t,e){t.setParams({missingProperty:e},!0),t.error()}oe.reportMissingProp=K$;function Mh(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,ue._)`Object.prototype.hasOwnProperty`})}oe.hasPropFunc=Mh;function bl(t,e,r){return(0,ue._)`${Mh(t)}.call(${e}, ${r})`}oe.isOwnProperty=bl;function X$(t,e,r,n){let o=(0,ue._)`${e}${(0,ue.getProperty)(r)} !== undefined`;return n?(0,ue._)`${o} && ${bl(t,e,r)}`:o}oe.propertyInData=X$;function xl(t,e,r,n){let o=(0,ue._)`${e}${(0,ue.getProperty)(r)} === undefined`;return n?(0,ue.or)(o,(0,ue.not)(bl(t,e,r))):o}oe.noPropertyInData=xl;function jh(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}oe.allSchemaProperties=jh;function Y$(t,e){return jh(e).filter(r=>!(0,vl.alwaysValidSchema)(t,e[r]))}oe.schemaProperties=Y$;function Q$({schemaCode:t,data:e,it:{gen:r,topSchemaRef:n,schemaPath:o,errorPath:s},it:i},a,c,u){let l=u?(0,ue._)`${t}, ${e}, ${n}${o}`:e,d=[[sr.default.instancePath,(0,ue.strConcat)(sr.default.instancePath,s)],[sr.default.parentData,i.parentData],[sr.default.parentDataProperty,i.parentDataProperty],[sr.default.rootData,sr.default.rootData]];i.opts.dynamicRef&&d.push([sr.default.dynamicAnchors,sr.default.dynamicAnchors]);let g=(0,ue._)`${l}, ${r.object(...d)}`;return c!==ue.nil?(0,ue._)`${a}.call(${c}, ${g})`:(0,ue._)`${a}(${g})`}oe.callValidateCode=Q$;var ek=(0,ue._)`new RegExp`;function tk({gen:t,it:{opts:e}},r){let n=e.unicodeRegExp?"u":"",{regExp:o}=e.code,s=o(r,n);return t.scopeValue("pattern",{key:s.toString(),ref:s,code:(0,ue._)`${o.code==="new RegExp"?ek:(0,G$.useFunc)(t,o)}(${r}, ${n})`})}oe.usePattern=tk;function rk(t){let{gen:e,data:r,keyword:n,it:o}=t,s=e.name("valid");if(o.allErrors){let a=e.let("valid",!0);return i(()=>e.assign(a,!1)),a}return e.var(s,!0),i(()=>e.break()),s;function i(a){let c=e.const("len",(0,ue._)`${r}.length`);e.forRange("i",0,c,u=>{t.subschema({keyword:n,dataProp:u,dataPropType:vl.Type.Num},s),e.if((0,ue.not)(s),a)})}}oe.validateArray=rk;function nk(t){let{gen:e,schema:r,keyword:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(c=>(0,vl.alwaysValidSchema)(o,c))&&!o.opts.unevaluated)return;let i=e.let("valid",!1),a=e.name("_valid");e.block(()=>r.forEach((c,u)=>{let l=t.subschema({keyword:n,schemaProp:u,compositeRule:!0},a);e.assign(i,(0,ue._)`${i} || ${a}`),t.mergeValidEvaluated(l,a)||e.if((0,ue.not)(i))})),t.result(i,()=>t.reset(),()=>t.error(!0))}oe.validateUnion=nk});var Lh=k($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.validateKeywordUsage=$t.validSchemaType=$t.funcKeywordCode=$t.macroKeywordCode=void 0;var Ze=B(),Vr=Zt(),ok=ot(),sk=$o();function ik(t,e){let{gen:r,keyword:n,schema:o,parentSchema:s,it:i}=t,a=e.macro.call(i.self,o,s,i),c=Zh(r,n,a);i.opts.validateSchema!==!1&&i.self.validateSchema(a,!0);let u=r.name("valid");t.subschema({schema:a,schemaPath:Ze.nil,errSchemaPath:`${i.errSchemaPath}/${n}`,topSchemaRef:c,compositeRule:!0},u),t.pass(u,()=>t.error(!0))}$t.macroKeywordCode=ik;function ak(t,e){var r;let{gen:n,keyword:o,schema:s,parentSchema:i,$data:a,it:c}=t;uk(c,e);let u=!a&&e.compile?e.compile.call(c.self,s,i,c):e.validate,l=Zh(n,o,u),d=n.let("valid");t.block$data(d,g),t.ok((r=e.valid)!==null&&r!==void 0?r:d);function g(){if(e.errors===!1)f(),e.modifying&&Dh(t),y(()=>t.error());else{let b=e.async?h():p();e.modifying&&Dh(t),y(()=>ck(t,b))}}function h(){let b=n.let("ruleErrs",null);return n.try(()=>f((0,Ze._)`await `),x=>n.assign(d,!1).if((0,Ze._)`${x} instanceof ${c.ValidationError}`,()=>n.assign(b,(0,Ze._)`${x}.errors`),()=>n.throw(x))),b}function p(){let b=(0,Ze._)`${l}.errors`;return n.assign(b,null),f(Ze.nil),b}function f(b=e.async?(0,Ze._)`await `:Ze.nil){let x=c.opts.passContext?Vr.default.this:Vr.default.self,S=!("compile"in e&&!a||e.schema===!1);n.assign(d,(0,Ze._)`${b}${(0,ok.callValidateCode)(t,l,x,S)}`,e.modifying)}function y(b){var x;n.if((0,Ze.not)((x=e.valid)!==null&&x!==void 0?x:d),b)}}$t.funcKeywordCode=ak;function Dh(t){let{gen:e,data:r,it:n}=t;e.if(n.parentData,()=>e.assign(r,(0,Ze._)`${n.parentData}[${n.parentDataProperty}]`))}function ck(t,e){let{gen:r}=t;r.if((0,Ze._)`Array.isArray(${e})`,()=>{r.assign(Vr.default.vErrors,(0,Ze._)`${Vr.default.vErrors} === null ? ${e} : ${Vr.default.vErrors}.concat(${e})`).assign(Vr.default.errors,(0,Ze._)`${Vr.default.vErrors}.length`),(0,sk.extendErrors)(t)},()=>t.error())}function uk({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function Zh(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,Ze.stringify)(r)})}function lk(t,e,r=!1){return!e.length||e.some(n=>n==="array"?Array.isArray(t):n==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==n||r&&typeof t>"u")}$t.validSchemaType=lk;function dk({schema:t,opts:e,self:r,errSchemaPath:n},o,s){if(Array.isArray(o.keyword)?!o.keyword.includes(s):o.keyword!==s)throw new Error("ajv implementation error");let i=o.dependencies;if(i?.some(a=>!Object.prototype.hasOwnProperty.call(t,a)))throw new Error(`parent schema must have dependencies of ${s}: ${i.join(",")}`);if(o.validateSchema&&!o.validateSchema(t[s])){let c=`keyword "${s}" value is invalid at path "${n}": `+r.errorsText(o.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(c);else throw new Error(c)}}$t.validateKeywordUsage=dk});var qh=k(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0});ir.extendSubschemaMode=ir.extendSubschemaData=ir.getSubschema=void 0;var kt=B(),Fh=te();function fk(t,{keyword:e,schemaProp:r,schema:n,schemaPath:o,errSchemaPath:s,topSchemaRef:i}){if(e!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){let a=t.schema[e];return r===void 0?{schema:a,schemaPath:(0,kt._)`${t.schemaPath}${(0,kt.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:a[r],schemaPath:(0,kt._)`${t.schemaPath}${(0,kt.getProperty)(e)}${(0,kt.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,Fh.escapeFragment)(r)}`}}if(n!==void 0){if(o===void 0||s===void 0||i===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:o,topSchemaRef:i,errSchemaPath:s}}throw new Error('either "keyword" or "schema" must be passed')}ir.getSubschema=fk;function pk(t,e,{dataProp:r,dataPropType:n,data:o,dataTypes:s,propertyName:i}){if(o!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');let{gen:a}=e;if(r!==void 0){let{errorPath:u,dataPathArr:l,opts:d}=e,g=a.let("data",(0,kt._)`${e.data}${(0,kt.getProperty)(r)}`,!0);c(g),t.errorPath=(0,kt.str)`${u}${(0,Fh.getErrorPath)(r,n,d.jsPropertySyntax)}`,t.parentDataProperty=(0,kt._)`${r}`,t.dataPathArr=[...l,t.parentDataProperty]}if(o!==void 0){let u=o instanceof kt.Name?o:a.let("data",o,!0);c(u),i!==void 0&&(t.propertyName=i)}s&&(t.dataTypes=s);function c(u){t.data=u,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,u]}}ir.extendSubschemaData=pk;function mk(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:n,createErrors:o,allErrors:s}){n!==void 0&&(t.compositeRule=n),o!==void 0&&(t.createErrors=o),s!==void 0&&(t.allErrors=s),t.jtdDiscriminator=e,t.jtdMetadata=r}ir.extendSubschemaMode=mk});var wl=k((VA,Uh)=>{"use strict";Uh.exports=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,o,s;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(o=n;o--!==0;)if(!t(e[o],r[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(r).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(r,s[o]))return!1;for(o=n;o--!==0;){var i=s[o];if(!t(e[i],r[i]))return!1}return!0}return e!==e&&r!==r}});var Bh=k((BA,Vh)=>{"use strict";var ar=Vh.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var n=typeof r=="function"?r:r.pre||function(){},o=r.post||function(){};li(e,n,o,t,"",t)};ar.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};ar.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};ar.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};ar.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function li(t,e,r,n,o,s,i,a,c,u){if(n&&typeof n=="object"&&!Array.isArray(n)){e(n,o,s,i,a,c,u);for(var l in n){var d=n[l];if(Array.isArray(d)){if(l in ar.arrayKeywords)for(var g=0;g<d.length;g++)li(t,e,r,d[g],o+"/"+l+"/"+g,s,o,l,n,g)}else if(l in ar.propsKeywords){if(d&&typeof d=="object")for(var h in d)li(t,e,r,d[h],o+"/"+l+"/"+hk(h),s,o,l,n,h)}else(l in ar.keywords||t.allKeys&&!(l in ar.skipKeywords))&&li(t,e,r,d,o+"/"+l,s,o,l,n)}r(n,o,s,i,a,c,u)}}function hk(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}});var To=k(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});He.getSchemaRefs=He.resolveUrl=He.normalizeId=He._getFullPath=He.getFullPath=He.inlineRef=void 0;var gk=te(),yk=wl(),_k=Bh(),vk=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function bk(t,e=!0){return typeof t=="boolean"?!0:e===!0?!Sl(t):e?Hh(t)<=e:!1}He.inlineRef=bk;var xk=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function Sl(t){for(let e in t){if(xk.has(e))return!0;let r=t[e];if(Array.isArray(r)&&r.some(Sl)||typeof r=="object"&&Sl(r))return!0}return!1}function Hh(t){let e=0;for(let r in t){if(r==="$ref")return 1/0;if(e++,!vk.has(r)&&(typeof t[r]=="object"&&(0,gk.eachItem)(t[r],n=>e+=Hh(n)),e===1/0))return 1/0}return e}function Gh(t,e="",r){r!==!1&&(e=$n(e));let n=t.parse(e);return Wh(t,n)}He.getFullPath=Gh;function Wh(t,e){return t.serialize(e).split("#")[0]+"#"}He._getFullPath=Wh;var wk=/#\/?$/;function $n(t){return t?t.replace(wk,""):""}He.normalizeId=$n;function Sk(t,e,r){return r=$n(r),t.resolve(e,r)}He.resolveUrl=Sk;var $k=/^[a-z_][-a-z0-9._]*$/i;function kk(t,e){if(typeof t=="boolean")return{};let{schemaId:r,uriResolver:n}=this.opts,o=$n(t[r]||e),s={"":o},i=Gh(n,o,!1),a={},c=new Set;return _k(t,{allKeys:!0},(d,g,h,p)=>{if(p===void 0)return;let f=i+g,y=s[p];typeof d[r]=="string"&&(y=b.call(this,d[r])),x.call(this,d.$anchor),x.call(this,d.$dynamicAnchor),s[g]=y;function b(S){let z=this.opts.uriResolver.resolve;if(S=$n(y?z(y,S):S),c.has(S))throw l(S);c.add(S);let A=this.refs[S];return typeof A=="string"&&(A=this.refs[A]),typeof A=="object"?u(d,A.schema,S):S!==$n(f)&&(S[0]==="#"?(u(d,a[S],S),a[S]=d):this.refs[S]=f),S}function x(S){if(typeof S=="string"){if(!$k.test(S))throw new Error(`invalid anchor "${S}"`);b.call(this,`#${S}`)}}}),a;function u(d,g,h){if(g!==void 0&&!yk(d,g))throw l(h)}function l(d){return new Error(`reference "${d}" resolves to more than one schema`)}}He.getSchemaRefs=kk});var zo=k(cr=>{"use strict";Object.defineProperty(cr,"__esModule",{value:!0});cr.getData=cr.KeywordCxt=cr.validateFunctionCode=void 0;var Qh=Ih(),Jh=ko(),kl=hl(),di=ko(),Tk=Ah(),Io=Lh(),$l=qh(),C=B(),F=Zt(),Ek=To(),Lt=te(),Eo=$o();function Ik(t){if(rg(t)&&(ng(t),tg(t))){Rk(t);return}eg(t,()=>(0,Qh.topBoolOrEmptySchema)(t))}cr.validateFunctionCode=Ik;function eg({gen:t,validateName:e,schema:r,schemaEnv:n,opts:o},s){o.code.es5?t.func(e,(0,C._)`${F.default.data}, ${F.default.valCxt}`,n.$async,()=>{t.code((0,C._)`"use strict"; ${Kh(r,o)}`),Pk(t,o),t.code(s)}):t.func(e,(0,C._)`${F.default.data}, ${zk(o)}`,n.$async,()=>t.code(Kh(r,o)).code(s))}function zk(t){return(0,C._)`{${F.default.instancePath}="", ${F.default.parentData}, ${F.default.parentDataProperty}, ${F.default.rootData}=${F.default.data}${t.dynamicRef?(0,C._)`, ${F.default.dynamicAnchors}={}`:C.nil}}={}`}function Pk(t,e){t.if(F.default.valCxt,()=>{t.var(F.default.instancePath,(0,C._)`${F.default.valCxt}.${F.default.instancePath}`),t.var(F.default.parentData,(0,C._)`${F.default.valCxt}.${F.default.parentData}`),t.var(F.default.parentDataProperty,(0,C._)`${F.default.valCxt}.${F.default.parentDataProperty}`),t.var(F.default.rootData,(0,C._)`${F.default.valCxt}.${F.default.rootData}`),e.dynamicRef&&t.var(F.default.dynamicAnchors,(0,C._)`${F.default.valCxt}.${F.default.dynamicAnchors}`)},()=>{t.var(F.default.instancePath,(0,C._)`""`),t.var(F.default.parentData,(0,C._)`undefined`),t.var(F.default.parentDataProperty,(0,C._)`undefined`),t.var(F.default.rootData,F.default.data),e.dynamicRef&&t.var(F.default.dynamicAnchors,(0,C._)`{}`)})}function Rk(t){let{schema:e,opts:r,gen:n}=t;eg(t,()=>{r.$comment&&e.$comment&&sg(t),Mk(t),n.let(F.default.vErrors,null),n.let(F.default.errors,0),r.unevaluated&&Nk(t),og(t),Zk(t)})}function Nk(t){let{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,C._)`${r}.evaluated`),e.if((0,C._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,C._)`${t.evaluated}.props`,(0,C._)`undefined`)),e.if((0,C._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,C._)`${t.evaluated}.items`,(0,C._)`undefined`))}function Kh(t,e){let r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,C._)`/*# sourceURL=${r} */`:C.nil}function Ok(t,e){if(rg(t)&&(ng(t),tg(t))){Ck(t,e);return}(0,Qh.boolOrEmptySchema)(t,e)}function tg({schema:t,self:e}){if(typeof t=="boolean")return!t;for(let r in t)if(e.RULES.all[r])return!0;return!1}function rg(t){return typeof t.schema!="boolean"}function Ck(t,e){let{schema:r,gen:n,opts:o}=t;o.$comment&&r.$comment&&sg(t),jk(t),Dk(t);let s=n.const("_errs",F.default.errors);og(t,s),n.var(e,(0,C._)`${s} === ${F.default.errors}`)}function ng(t){(0,Lt.checkUnknownRules)(t),Ak(t)}function og(t,e){if(t.opts.jtd)return Xh(t,[],!1,e);let r=(0,Jh.getSchemaTypes)(t.schema),n=(0,Jh.coerceAndCheckDataType)(t,r);Xh(t,r,!n,e)}function Ak(t){let{schema:e,errSchemaPath:r,opts:n,self:o}=t;e.$ref&&n.ignoreKeywordsWithRef&&(0,Lt.schemaHasRulesButRef)(e,o.RULES)&&o.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function Mk(t){let{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,Lt.checkStrictMode)(t,"default is ignored in the schema root")}function jk(t){let e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,Ek.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function Dk(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function sg({gen:t,schemaEnv:e,schema:r,errSchemaPath:n,opts:o}){let s=r.$comment;if(o.$comment===!0)t.code((0,C._)`${F.default.self}.logger.log(${s})`);else if(typeof o.$comment=="function"){let i=(0,C.str)`${n}/$comment`,a=t.scopeValue("root",{ref:e.root});t.code((0,C._)`${F.default.self}.opts.$comment(${s}, ${i}, ${a}.schema)`)}}function Zk(t){let{gen:e,schemaEnv:r,validateName:n,ValidationError:o,opts:s}=t;r.$async?e.if((0,C._)`${F.default.errors} === 0`,()=>e.return(F.default.data),()=>e.throw((0,C._)`new ${o}(${F.default.vErrors})`)):(e.assign((0,C._)`${n}.errors`,F.default.vErrors),s.unevaluated&&Lk(t),e.return((0,C._)`${F.default.errors} === 0`))}function Lk({gen:t,evaluated:e,props:r,items:n}){r instanceof C.Name&&t.assign((0,C._)`${e}.props`,r),n instanceof C.Name&&t.assign((0,C._)`${e}.items`,n)}function Xh(t,e,r,n){let{gen:o,schema:s,data:i,allErrors:a,opts:c,self:u}=t,{RULES:l}=u;if(s.$ref&&(c.ignoreKeywordsWithRef||!(0,Lt.schemaHasRulesButRef)(s,l))){o.block(()=>ag(t,"$ref",l.all.$ref.definition));return}c.jtd||Fk(t,e),o.block(()=>{for(let g of l.rules)d(g);d(l.post)});function d(g){(0,kl.shouldUseGroup)(s,g)&&(g.type?(o.if((0,di.checkDataType)(g.type,i,c.strictNumbers)),Yh(t,g),e.length===1&&e[0]===g.type&&r&&(o.else(),(0,di.reportTypeError)(t)),o.endIf()):Yh(t,g),a||o.if((0,C._)`${F.default.errors} === ${n||0}`))}}function Yh(t,e){let{gen:r,schema:n,opts:{useDefaults:o}}=t;o&&(0,Tk.assignDefaults)(t,e.type),r.block(()=>{for(let s of e.rules)(0,kl.shouldUseRule)(n,s)&&ag(t,s.keyword,s.definition,e.type)})}function Fk(t,e){t.schemaEnv.meta||!t.opts.strictTypes||(qk(t,e),t.opts.allowUnionTypes||Uk(t,e),Vk(t,t.dataTypes))}function qk(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{ig(t.dataTypes,r)||Tl(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),Hk(t,e)}}function Uk(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&Tl(t,"use allowUnionTypes to allow union type keyword")}function Vk(t,e){let r=t.self.RULES.all;for(let n in r){let o=r[n];if(typeof o=="object"&&(0,kl.shouldUseRule)(t.schema,o)){let{type:s}=o.definition;s.length&&!s.some(i=>Bk(e,i))&&Tl(t,`missing type "${s.join(",")}" for keyword "${n}"`)}}}function Bk(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function ig(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function Hk(t,e){let r=[];for(let n of t.dataTypes)ig(e,n)?r.push(n):e.includes("integer")&&n==="number"&&r.push("integer");t.dataTypes=r}function Tl(t,e){let r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,Lt.checkStrictMode)(t,e,t.opts.strictTypes)}var fi=class{constructor(e,r,n){if((0,Io.validateKeywordUsage)(e,r,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Lt.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",cg(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,Io.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",F.default.errors))}result(e,r,n){this.failResult((0,C.not)(e),r,n)}failResult(e,r,n){this.gen.if(e),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,C.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);let{schemaCode:r}=this;this.fail((0,C._)`${r} !== undefined && (${(0,C.or)(this.invalid$data(),e)})`)}error(e,r,n){if(r){this.setParams(r),this._error(e,n),this.setParams({});return}this._error(e,n)}_error(e,r){(e?Eo.reportExtraError:Eo.reportError)(this,this.def.error,r)}$dataError(){(0,Eo.reportError)(this,this.def.$dataError||Eo.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,Eo.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,n=C.nil){this.gen.block(()=>{this.check$data(e,n),r()})}check$data(e=C.nil,r=C.nil){if(!this.$data)return;let{gen:n,schemaCode:o,schemaType:s,def:i}=this;n.if((0,C.or)((0,C._)`${o} === undefined`,r)),e!==C.nil&&n.assign(e,!0),(s.length||i.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==C.nil&&n.assign(e,!1)),n.else()}invalid$data(){let{gen:e,schemaCode:r,schemaType:n,def:o,it:s}=this;return(0,C.or)(i(),a());function i(){if(n.length){if(!(r instanceof C.Name))throw new Error("ajv implementation error");let c=Array.isArray(n)?n:[n];return(0,C._)`${(0,di.checkDataTypes)(c,r,s.opts.strictNumbers,di.DataType.Wrong)}`}return C.nil}function a(){if(o.validateSchema){let c=e.scopeValue("validate$data",{ref:o.validateSchema});return(0,C._)`!${c}(${r})`}return C.nil}}subschema(e,r){let n=(0,$l.getSubschema)(this.it,e);(0,$l.extendSubschemaData)(n,this.it,e),(0,$l.extendSubschemaMode)(n,e);let o={...this.it,...n,items:void 0,props:void 0};return Ok(o,r),o}mergeEvaluated(e,r){let{it:n,gen:o}=this;n.opts.unevaluated&&(n.props!==!0&&e.props!==void 0&&(n.props=Lt.mergeEvaluated.props(o,e.props,n.props,r)),n.items!==!0&&e.items!==void 0&&(n.items=Lt.mergeEvaluated.items(o,e.items,n.items,r)))}mergeValidEvaluated(e,r){let{it:n,gen:o}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return o.if(r,()=>this.mergeEvaluated(e,C.Name)),!0}};cr.KeywordCxt=fi;function ag(t,e,r,n){let o=new fi(t,r,e);"code"in r?r.code(o,n):o.$data&&r.validate?(0,Io.funcKeywordCode)(o,r):"macro"in r?(0,Io.macroKeywordCode)(o,r):(r.compile||r.validate)&&(0,Io.funcKeywordCode)(o,r)}var Gk=/^\/(?:[^~]|~0|~1)*$/,Wk=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function cg(t,{dataLevel:e,dataNames:r,dataPathArr:n}){let o,s;if(t==="")return F.default.rootData;if(t[0]==="/"){if(!Gk.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);o=t,s=F.default.rootData}else{let u=Wk.exec(t);if(!u)throw new Error(`Invalid JSON-pointer: ${t}`);let l=+u[1];if(o=u[2],o==="#"){if(l>=e)throw new Error(c("property/index",l));return n[e-l]}if(l>e)throw new Error(c("data",l));if(s=r[e-l],!o)return s}let i=s,a=o.split("/");for(let u of a)u&&(s=(0,C._)`${s}${(0,C.getProperty)((0,Lt.unescapeJsonPointer)(u))}`,i=(0,C._)`${i} && ${s}`);return i;function c(u,l){return`Cannot access ${u} ${l} levels up, current level is ${e}`}}cr.getData=cg});var pi=k(Il=>{"use strict";Object.defineProperty(Il,"__esModule",{value:!0});var El=class extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}};Il.default=El});var Po=k(Rl=>{"use strict";Object.defineProperty(Rl,"__esModule",{value:!0});var zl=To(),Pl=class extends Error{constructor(e,r,n,o){super(o||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,zl.resolveUrl)(e,r,n),this.missingSchema=(0,zl.normalizeId)((0,zl.getFullPath)(e,this.missingRef))}};Rl.default=Pl});var hi=k(st=>{"use strict";Object.defineProperty(st,"__esModule",{value:!0});st.resolveSchema=st.getCompilingSchema=st.resolveRef=st.compileSchema=st.SchemaEnv=void 0;var ht=B(),Jk=pi(),Br=Zt(),gt=To(),ug=te(),Kk=zo(),kn=class{constructor(e){var r;this.refs={},this.dynamicAnchors={};let n;typeof e.schema=="object"&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,gt.normalizeId)(n?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=n?.$async,this.refs={}}};st.SchemaEnv=kn;function Ol(t){let e=lg.call(this,t);if(e)return e;let r=(0,gt.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:n,lines:o}=this.opts.code,{ownProperties:s}=this.opts,i=new ht.CodeGen(this.scope,{es5:n,lines:o,ownProperties:s}),a;t.$async&&(a=i.scopeValue("Error",{ref:Jk.default,code:(0,ht._)`require("ajv/dist/runtime/validation_error").default`}));let c=i.scopeName("validate");t.validateName=c;let u={gen:i,allErrors:this.opts.allErrors,data:Br.default.data,parentData:Br.default.parentData,parentDataProperty:Br.default.parentDataProperty,dataNames:[Br.default.data],dataPathArr:[ht.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:i.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,ht.stringify)(t.schema)}:{ref:t.schema}),validateName:c,ValidationError:a,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:ht.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,ht._)`""`,opts:this.opts,self:this},l;try{this._compilations.add(t),(0,Kk.validateFunctionCode)(u),i.optimize(this.opts.code.optimize);let d=i.toString();l=`${i.scopeRefs(Br.default.scope)}return ${d}`,this.opts.code.process&&(l=this.opts.code.process(l,t));let h=new Function(`${Br.default.self}`,`${Br.default.scope}`,l)(this,this.scope.get());if(this.scope.value(c,{ref:h}),h.errors=null,h.schema=t.schema,h.schemaEnv=t,t.$async&&(h.$async=!0),this.opts.code.source===!0&&(h.source={validateName:c,validateCode:d,scopeValues:i._values}),this.opts.unevaluated){let{props:p,items:f}=u;h.evaluated={props:p instanceof ht.Name?void 0:p,items:f instanceof ht.Name?void 0:f,dynamicProps:p instanceof ht.Name,dynamicItems:f instanceof ht.Name},h.source&&(h.source.evaluated=(0,ht.stringify)(h.evaluated))}return t.validate=h,t}catch(d){throw delete t.validate,delete t.validateName,l&&this.logger.error("Error compiling schema, function code:",l),d}finally{this._compilations.delete(t)}}st.compileSchema=Ol;function Xk(t,e,r){var n;r=(0,gt.resolveUrl)(this.opts.uriResolver,e,r);let o=t.refs[r];if(o)return o;let s=eT.call(this,t,r);if(s===void 0){let i=(n=t.localRefs)===null||n===void 0?void 0:n[r],{schemaId:a}=this.opts;i&&(s=new kn({schema:i,schemaId:a,root:t,baseId:e}))}if(s!==void 0)return t.refs[r]=Yk.call(this,s)}st.resolveRef=Xk;function Yk(t){return(0,gt.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:Ol.call(this,t)}function lg(t){for(let e of this._compilations)if(Qk(e,t))return e}st.getCompilingSchema=lg;function Qk(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function eT(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||mi.call(this,t,e)}function mi(t,e){let r=this.opts.uriResolver.parse(e),n=(0,gt._getFullPath)(this.opts.uriResolver,r),o=(0,gt.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&n===o)return Nl.call(this,r,t);let s=(0,gt.normalizeId)(n),i=this.refs[s]||this.schemas[s];if(typeof i=="string"){let a=mi.call(this,t,i);return typeof a?.schema!="object"?void 0:Nl.call(this,r,a)}if(typeof i?.schema=="object"){if(i.validate||Ol.call(this,i),s===(0,gt.normalizeId)(e)){let{schema:a}=i,{schemaId:c}=this.opts,u=a[c];return u&&(o=(0,gt.resolveUrl)(this.opts.uriResolver,o,u)),new kn({schema:a,schemaId:c,root:t,baseId:o})}return Nl.call(this,r,i)}}st.resolveSchema=mi;var tT=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function Nl(t,{baseId:e,schema:r,root:n}){var o;if(((o=t.fragment)===null||o===void 0?void 0:o[0])!=="/")return;for(let a of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;let c=r[(0,ug.unescapeFragment)(a)];if(c===void 0)return;r=c;let u=typeof r=="object"&&r[this.opts.schemaId];!tT.has(a)&&u&&(e=(0,gt.resolveUrl)(this.opts.uriResolver,e,u))}let s;if(typeof r!="boolean"&&r.$ref&&!(0,ug.schemaHasRulesButRef)(r,this.RULES)){let a=(0,gt.resolveUrl)(this.opts.uriResolver,e,r.$ref);s=mi.call(this,n,a)}let{schemaId:i}=this.opts;if(s=s||new kn({schema:r,schemaId:i,root:n,baseId:e}),s.schema!==s.root.schema)return s}});var dg=k((XA,rT)=>{rT.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var Al=k((YA,hg)=>{"use strict";var nT=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),pg=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function Cl(t){let e="",r=0,n=0;for(n=0;n<t.length;n++)if(r=t[n].charCodeAt(0),r!==48){if(!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n];break}for(n+=1;n<t.length;n++){if(r=t[n].charCodeAt(0),!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[n]}return e}var oT=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function fg(t){return t.length=0,!0}function sT(t,e,r){if(t.length){let n=Cl(t);if(n!=="")e.push(n);else return r.error=!0,!1;t.length=0}return!0}function iT(t){let e=0,r={error:!1,address:"",zone:""},n=[],o=[],s=!1,i=!1,a=sT;for(let c=0;c<t.length;c++){let u=t[c];if(!(u==="["||u==="]"))if(u===":"){if(s===!0&&(i=!0),!a(o,n,r))break;if(++e>7){r.error=!0;break}c>0&&t[c-1]===":"&&(s=!0),n.push(":");continue}else if(u==="%"){if(!a(o,n,r))break;a=fg}else{o.push(u);continue}}return o.length&&(a===fg?r.zone=o.join(""):i?n.push(o.join("")):n.push(Cl(o))),r.address=n.join(""),r}function mg(t){if(aT(t,":")<2)return{host:t,isIPV6:!1};let e=iT(t);if(e.error)return{host:t,isIPV6:!1};{let r=e.address,n=e.address;return e.zone&&(r+="%"+e.zone,n+="%25"+e.zone),{host:r,isIPV6:!0,escapedHost:n}}}function aT(t,e){let r=0;for(let n=0;n<t.length;n++)t[n]===e&&r++;return r}function cT(t){let e=t,r=[],n=-1,o=0;for(;o=e.length;){if(o===1){if(e===".")break;if(e==="/"){r.push("/");break}else{r.push(e);break}}else if(o===2){if(e[0]==="."){if(e[1]===".")break;if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&(e[1]==="."||e[1]==="/")){r.push("/");break}}else if(o===3&&e==="/.."){r.length!==0&&r.pop(),r.push("/");break}if(e[0]==="."){if(e[1]==="."){if(e[2]==="/"){e=e.slice(3);continue}}else if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&e[1]==="."){if(e[2]==="/"){e=e.slice(2);continue}else if(e[2]==="."&&e[3]==="/"){e=e.slice(3),r.length!==0&&r.pop();continue}}if((n=e.indexOf("/",1))===-1){r.push(e);break}else r.push(e.slice(0,n)),e=e.slice(n)}return r.join("")}function uT(t,e){let r=e!==!0?escape:unescape;return t.scheme!==void 0&&(t.scheme=r(t.scheme)),t.userinfo!==void 0&&(t.userinfo=r(t.userinfo)),t.host!==void 0&&(t.host=r(t.host)),t.path!==void 0&&(t.path=r(t.path)),t.query!==void 0&&(t.query=r(t.query)),t.fragment!==void 0&&(t.fragment=r(t.fragment)),t}function lT(t){let e=[];if(t.userinfo!==void 0&&(e.push(t.userinfo),e.push("@")),t.host!==void 0){let r=unescape(t.host);if(!pg(r)){let n=mg(r);n.isIPV6===!0?r=`[${n.escapedHost}]`:r=t.host}e.push(r)}return(typeof t.port=="number"||typeof t.port=="string")&&(e.push(":"),e.push(String(t.port))),e.length?e.join(""):void 0}hg.exports={nonSimpleDomain:oT,recomposeAuthority:lT,normalizeComponentEncoding:uT,removeDotSegments:cT,isIPv4:pg,isUUID:nT,normalizeIPv6:mg,stringArrayToHexStripped:Cl}});var bg=k((QA,vg)=>{"use strict";var{isUUID:dT}=Al(),fT=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,pT=["http","https","ws","wss","urn","urn:uuid"];function mT(t){return pT.indexOf(t)!==-1}function Ml(t){return t.secure===!0?!0:t.secure===!1?!1:t.scheme?t.scheme.length===3&&(t.scheme[0]==="w"||t.scheme[0]==="W")&&(t.scheme[1]==="s"||t.scheme[1]==="S")&&(t.scheme[2]==="s"||t.scheme[2]==="S"):!1}function gg(t){return t.host||(t.error=t.error||"HTTP URIs must have a host."),t}function yg(t){let e=String(t.scheme).toLowerCase()==="https";return(t.port===(e?443:80)||t.port==="")&&(t.port=void 0),t.path||(t.path="/"),t}function hT(t){return t.secure=Ml(t),t.resourceName=(t.path||"/")+(t.query?"?"+t.query:""),t.path=void 0,t.query=void 0,t}function gT(t){if((t.port===(Ml(t)?443:80)||t.port==="")&&(t.port=void 0),typeof t.secure=="boolean"&&(t.scheme=t.secure?"wss":"ws",t.secure=void 0),t.resourceName){let[e,r]=t.resourceName.split("?");t.path=e&&e!=="/"?e:void 0,t.query=r,t.resourceName=void 0}return t.fragment=void 0,t}function yT(t,e){if(!t.path)return t.error="URN can not be parsed",t;let r=t.path.match(fT);if(r){let n=e.scheme||t.scheme||"urn";t.nid=r[1].toLowerCase(),t.nss=r[2];let o=`${n}:${e.nid||t.nid}`,s=jl(o);t.path=void 0,s&&(t=s.parse(t,e))}else t.error=t.error||"URN can not be parsed.";return t}function _T(t,e){if(t.nid===void 0)throw new Error("URN without nid cannot be serialized");let r=e.scheme||t.scheme||"urn",n=t.nid.toLowerCase(),o=`${r}:${e.nid||n}`,s=jl(o);s&&(t=s.serialize(t,e));let i=t,a=t.nss;return i.path=`${n||e.nid}:${a}`,e.skipEscape=!0,i}function vT(t,e){let r=t;return r.uuid=r.nss,r.nss=void 0,!e.tolerant&&(!r.uuid||!dT(r.uuid))&&(r.error=r.error||"UUID is not valid."),r}function bT(t){let e=t;return e.nss=(t.uuid||"").toLowerCase(),e}var _g={scheme:"http",domainHost:!0,parse:gg,serialize:yg},xT={scheme:"https",domainHost:_g.domainHost,parse:gg,serialize:yg},gi={scheme:"ws",domainHost:!0,parse:hT,serialize:gT},wT={scheme:"wss",domainHost:gi.domainHost,parse:gi.parse,serialize:gi.serialize},ST={scheme:"urn",parse:yT,serialize:_T,skipNormalize:!0},$T={scheme:"urn:uuid",parse:vT,serialize:bT,skipNormalize:!0},yi={http:_g,https:xT,ws:gi,wss:wT,urn:ST,"urn:uuid":$T};Object.setPrototypeOf(yi,null);function jl(t){return t&&(yi[t]||yi[t.toLowerCase()])||void 0}vg.exports={wsIsSecure:Ml,SCHEMES:yi,isValidSchemeName:mT,getSchemeHandler:jl}});var Sg=k((eM,vi)=>{"use strict";var{normalizeIPv6:kT,removeDotSegments:Ro,recomposeAuthority:TT,normalizeComponentEncoding:_i,isIPv4:ET,nonSimpleDomain:IT}=Al(),{SCHEMES:zT,getSchemeHandler:xg}=bg();function PT(t,e){return typeof t=="string"?t=Tt(Ft(t,e),e):typeof t=="object"&&(t=Ft(Tt(t,e),e)),t}function RT(t,e,r){let n=r?Object.assign({scheme:"null"},r):{scheme:"null"},o=wg(Ft(t,n),Ft(e,n),n,!0);return n.skipEscape=!0,Tt(o,n)}function wg(t,e,r,n){let o={};return n||(t=Ft(Tt(t,r),r),e=Ft(Tt(e,r),r)),r=r||{},!r.tolerant&&e.scheme?(o.scheme=e.scheme,o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=Ro(e.path||""),o.query=e.query):(e.userinfo!==void 0||e.host!==void 0||e.port!==void 0?(o.userinfo=e.userinfo,o.host=e.host,o.port=e.port,o.path=Ro(e.path||""),o.query=e.query):(e.path?(e.path[0]==="/"?o.path=Ro(e.path):((t.userinfo!==void 0||t.host!==void 0||t.port!==void 0)&&!t.path?o.path="/"+e.path:t.path?o.path=t.path.slice(0,t.path.lastIndexOf("/")+1)+e.path:o.path=e.path,o.path=Ro(o.path)),o.query=e.query):(o.path=t.path,e.query!==void 0?o.query=e.query:o.query=t.query),o.userinfo=t.userinfo,o.host=t.host,o.port=t.port),o.scheme=t.scheme),o.fragment=e.fragment,o}function NT(t,e,r){return typeof t=="string"?(t=unescape(t),t=Tt(_i(Ft(t,r),!0),{...r,skipEscape:!0})):typeof t=="object"&&(t=Tt(_i(t,!0),{...r,skipEscape:!0})),typeof e=="string"?(e=unescape(e),e=Tt(_i(Ft(e,r),!0),{...r,skipEscape:!0})):typeof e=="object"&&(e=Tt(_i(e,!0),{...r,skipEscape:!0})),t.toLowerCase()===e.toLowerCase()}function Tt(t,e){let r={host:t.host,scheme:t.scheme,userinfo:t.userinfo,port:t.port,path:t.path,query:t.query,nid:t.nid,nss:t.nss,uuid:t.uuid,fragment:t.fragment,reference:t.reference,resourceName:t.resourceName,secure:t.secure,error:""},n=Object.assign({},e),o=[],s=xg(n.scheme||r.scheme);s&&s.serialize&&s.serialize(r,n),r.path!==void 0&&(n.skipEscape?r.path=unescape(r.path):(r.path=escape(r.path),r.scheme!==void 0&&(r.path=r.path.split("%3A").join(":")))),n.reference!=="suffix"&&r.scheme&&o.push(r.scheme,":");let i=TT(r);if(i!==void 0&&(n.reference!=="suffix"&&o.push("//"),o.push(i),r.path&&r.path[0]!=="/"&&o.push("/")),r.path!==void 0){let a=r.path;!n.absolutePath&&(!s||!s.absolutePath)&&(a=Ro(a)),i===void 0&&a[0]==="/"&&a[1]==="/"&&(a="/%2F"+a.slice(2)),o.push(a)}return r.query!==void 0&&o.push("?",r.query),r.fragment!==void 0&&o.push("#",r.fragment),o.join("")}var OT=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function Ft(t,e){let r=Object.assign({},e),n={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},o=!1;r.reference==="suffix"&&(r.scheme?t=r.scheme+":"+t:t="//"+t);let s=t.match(OT);if(s){if(n.scheme=s[1],n.userinfo=s[3],n.host=s[4],n.port=parseInt(s[5],10),n.path=s[6]||"",n.query=s[7],n.fragment=s[8],isNaN(n.port)&&(n.port=s[5]),n.host)if(ET(n.host)===!1){let c=kT(n.host);n.host=c.host.toLowerCase(),o=c.isIPV6}else o=!0;n.scheme===void 0&&n.userinfo===void 0&&n.host===void 0&&n.port===void 0&&n.query===void 0&&!n.path?n.reference="same-document":n.scheme===void 0?n.reference="relative":n.fragment===void 0?n.reference="absolute":n.reference="uri",r.reference&&r.reference!=="suffix"&&r.reference!==n.reference&&(n.error=n.error||"URI is not a "+r.reference+" reference.");let i=xg(r.scheme||n.scheme);if(!r.unicodeSupport&&(!i||!i.unicodeSupport)&&n.host&&(r.domainHost||i&&i.domainHost)&&o===!1&&IT(n.host))try{n.host=URL.domainToASCII(n.host.toLowerCase())}catch(a){n.error=n.error||"Host's domain name can not be converted to ASCII: "+a}(!i||i&&!i.skipNormalize)&&(t.indexOf("%")!==-1&&(n.scheme!==void 0&&(n.scheme=unescape(n.scheme)),n.host!==void 0&&(n.host=unescape(n.host))),n.path&&(n.path=escape(unescape(n.path))),n.fragment&&(n.fragment=encodeURI(decodeURIComponent(n.fragment)))),i&&i.parse&&i.parse(n,r)}else n.error=n.error||"URI can not be parsed.";return n}var Dl={SCHEMES:zT,normalize:PT,resolve:RT,resolveComponent:wg,equal:NT,serialize:Tt,parse:Ft};vi.exports=Dl;vi.exports.default=Dl;vi.exports.fastUri=Dl});var kg=k(Zl=>{"use strict";Object.defineProperty(Zl,"__esModule",{value:!0});var $g=Sg();$g.code='require("ajv/dist/runtime/uri").default';Zl.default=$g});var Og=k(Ie=>{"use strict";Object.defineProperty(Ie,"__esModule",{value:!0});Ie.CodeGen=Ie.Name=Ie.nil=Ie.stringify=Ie.str=Ie._=Ie.KeywordCxt=void 0;var CT=zo();Object.defineProperty(Ie,"KeywordCxt",{enumerable:!0,get:function(){return CT.KeywordCxt}});var Tn=B();Object.defineProperty(Ie,"_",{enumerable:!0,get:function(){return Tn._}});Object.defineProperty(Ie,"str",{enumerable:!0,get:function(){return Tn.str}});Object.defineProperty(Ie,"stringify",{enumerable:!0,get:function(){return Tn.stringify}});Object.defineProperty(Ie,"nil",{enumerable:!0,get:function(){return Tn.nil}});Object.defineProperty(Ie,"Name",{enumerable:!0,get:function(){return Tn.Name}});Object.defineProperty(Ie,"CodeGen",{enumerable:!0,get:function(){return Tn.CodeGen}});var AT=pi(),Pg=Po(),MT=ml(),No=hi(),jT=B(),Oo=To(),bi=ko(),Fl=te(),Tg=dg(),DT=kg(),Rg=(t,e)=>new RegExp(t,e);Rg.code="new RegExp";var ZT=["removeAdditional","useDefaults","coerceTypes"],LT=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),FT={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},qT={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},Eg=200;function UT(t){var e,r,n,o,s,i,a,c,u,l,d,g,h,p,f,y,b,x,S,z,A,be,Re,Rt,mr;let hr=t.strict,ca=(e=t.code)===null||e===void 0?void 0:e.optimize,yf=ca===!0||ca===void 0?1:ca||0,_f=(n=(r=t.code)===null||r===void 0?void 0:r.regExp)!==null&&n!==void 0?n:Rg,Zv=(o=t.uriResolver)!==null&&o!==void 0?o:DT.default;return{strictSchema:(i=(s=t.strictSchema)!==null&&s!==void 0?s:hr)!==null&&i!==void 0?i:!0,strictNumbers:(c=(a=t.strictNumbers)!==null&&a!==void 0?a:hr)!==null&&c!==void 0?c:!0,strictTypes:(l=(u=t.strictTypes)!==null&&u!==void 0?u:hr)!==null&&l!==void 0?l:"log",strictTuples:(g=(d=t.strictTuples)!==null&&d!==void 0?d:hr)!==null&&g!==void 0?g:"log",strictRequired:(p=(h=t.strictRequired)!==null&&h!==void 0?h:hr)!==null&&p!==void 0?p:!1,code:t.code?{...t.code,optimize:yf,regExp:_f}:{optimize:yf,regExp:_f},loopRequired:(f=t.loopRequired)!==null&&f!==void 0?f:Eg,loopEnum:(y=t.loopEnum)!==null&&y!==void 0?y:Eg,meta:(b=t.meta)!==null&&b!==void 0?b:!0,messages:(x=t.messages)!==null&&x!==void 0?x:!0,inlineRefs:(S=t.inlineRefs)!==null&&S!==void 0?S:!0,schemaId:(z=t.schemaId)!==null&&z!==void 0?z:"$id",addUsedSchema:(A=t.addUsedSchema)!==null&&A!==void 0?A:!0,validateSchema:(be=t.validateSchema)!==null&&be!==void 0?be:!0,validateFormats:(Re=t.validateFormats)!==null&&Re!==void 0?Re:!0,unicodeRegExp:(Rt=t.unicodeRegExp)!==null&&Rt!==void 0?Rt:!0,int32range:(mr=t.int32range)!==null&&mr!==void 0?mr:!0,uriResolver:Zv}}var Co=class{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...UT(e)};let{es5:r,lines:n}=this.opts.code;this.scope=new jT.ValueScope({scope:{},prefixes:LT,es5:r,lines:n}),this.logger=JT(e.logger);let o=e.validateFormats;e.validateFormats=!1,this.RULES=(0,MT.getRules)(),Ig.call(this,FT,e,"NOT SUPPORTED"),Ig.call(this,qT,e,"DEPRECATED","warn"),this._metaOpts=GT.call(this),e.formats&&BT.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&HT.call(this,e.keywords),typeof e.meta=="object"&&this.addMetaSchema(e.meta),VT.call(this),e.validateFormats=o}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:e,meta:r,schemaId:n}=this.opts,o=Tg;n==="id"&&(o={...Tg},o.id=o.$id,delete o.$id),r&&e&&this.addMetaSchema(o,o[n],!1)}defaultMeta(){let{meta:e,schemaId:r}=this.opts;return this.opts.defaultMeta=typeof e=="object"?e[r]||e:void 0}validate(e,r){let n;if(typeof e=="string"){if(n=this.getSchema(e),!n)throw new Error(`no schema with key or ref "${e}"`)}else n=this.compile(e);let o=n(r);return"$async"in n||(this.errors=n.errors),o}compile(e,r){let n=this._addSchema(e,r);return n.validate||this._compileSchemaEnv(n)}compileAsync(e,r){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");let{loadSchema:n}=this.opts;return o.call(this,e,r);async function o(l,d){await s.call(this,l.$schema);let g=this._addSchema(l,d);return g.validate||i.call(this,g)}async function s(l){l&&!this.getSchema(l)&&await o.call(this,{$ref:l},!0)}async function i(l){try{return this._compileSchemaEnv(l)}catch(d){if(!(d instanceof Pg.default))throw d;return a.call(this,d),await c.call(this,d.missingSchema),i.call(this,l)}}function a({missingSchema:l,missingRef:d}){if(this.refs[l])throw new Error(`AnySchema ${l} is loaded but ${d} cannot be resolved`)}async function c(l){let d=await u.call(this,l);this.refs[l]||await s.call(this,d.$schema),this.refs[l]||this.addSchema(d,l,r)}async function u(l){let d=this._loading[l];if(d)return d;try{return await(this._loading[l]=n(l))}finally{delete this._loading[l]}}}addSchema(e,r,n,o=this.opts.validateSchema){if(Array.isArray(e)){for(let i of e)this.addSchema(i,void 0,n,o);return this}let s;if(typeof e=="object"){let{schemaId:i}=this.opts;if(s=e[i],s!==void 0&&typeof s!="string")throw new Error(`schema ${i} must be string`)}return r=(0,Oo.normalizeId)(r||s),this._checkUnique(r),this.schemas[r]=this._addSchema(e,n,r,o,!0),this}addMetaSchema(e,r,n=this.opts.validateSchema){return this.addSchema(e,r,!0,n),this}validateSchema(e,r){if(typeof e=="boolean")return!0;let n;if(n=e.$schema,n!==void 0&&typeof n!="string")throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let o=this.validate(n,e);if(!o&&r){let s="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(s);else throw new Error(s)}return o}getSchema(e){let r;for(;typeof(r=zg.call(this,e))=="string";)e=r;if(r===void 0){let{schemaId:n}=this.opts,o=new No.SchemaEnv({schema:{},schemaId:n});if(r=No.resolveSchema.call(this,o,e),!r)return;this.refs[e]=r}return r.validate||this._compileSchemaEnv(r)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let r=zg.call(this,e);return typeof r=="object"&&this._cache.delete(r.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{let r=e;this._cache.delete(r);let n=e[this.opts.schemaId];return n&&(n=(0,Oo.normalizeId)(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(let r of e)this.addKeyword(r);return this}addKeyword(e,r){let n;if(typeof e=="string")n=e,typeof r=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),r.keyword=n);else if(typeof e=="object"&&r===void 0){if(r=e,n=r.keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(XT.call(this,n,r),!r)return(0,Fl.eachItem)(n,s=>Ll.call(this,s)),this;QT.call(this,r);let o={...r,type:(0,bi.getJSONTypes)(r.type),schemaType:(0,bi.getJSONTypes)(r.schemaType)};return(0,Fl.eachItem)(n,o.type.length===0?s=>Ll.call(this,s,o):s=>o.type.forEach(i=>Ll.call(this,s,o,i))),this}getKeyword(e){let r=this.RULES.all[e];return typeof r=="object"?r.definition:!!r}removeKeyword(e){let{RULES:r}=this;delete r.keywords[e],delete r.all[e];for(let n of r.rules){let o=n.rules.findIndex(s=>s.keyword===e);o>=0&&n.rules.splice(o,1)}return this}addFormat(e,r){return typeof r=="string"&&(r=new RegExp(r)),this.formats[e]=r,this}errorsText(e=this.errors,{separator:r=", ",dataVar:n="data"}={}){return!e||e.length===0?"No errors":e.map(o=>`${n}${o.instancePath} ${o.message}`).reduce((o,s)=>o+r+s)}$dataMetaSchema(e,r){let n=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(let o of r){let s=o.split("/").slice(1),i=e;for(let a of s)i=i[a];for(let a in n){let c=n[a];if(typeof c!="object")continue;let{$data:u}=c.definition,l=i[a];u&&l&&(i[a]=Ng(l))}}return e}_removeAllSchemas(e,r){for(let n in e){let o=e[n];(!r||r.test(n))&&(typeof o=="string"?delete e[n]:o&&!o.meta&&(this._cache.delete(o.schema),delete e[n]))}}_addSchema(e,r,n,o=this.opts.validateSchema,s=this.opts.addUsedSchema){let i,{schemaId:a}=this.opts;if(typeof e=="object")i=e[a];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof e!="boolean")throw new Error("schema must be object or boolean")}let c=this._cache.get(e);if(c!==void 0)return c;n=(0,Oo.normalizeId)(i||n);let u=Oo.getSchemaRefs.call(this,e,n);return c=new No.SchemaEnv({schema:e,schemaId:a,meta:r,baseId:n,localRefs:u}),this._cache.set(c.schema,c),s&&!n.startsWith("#")&&(n&&this._checkUnique(n),this.refs[n]=c),o&&this.validateSchema(e,!0),c}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):No.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){let r=this.opts;this.opts=this._metaOpts;try{No.compileSchema.call(this,e)}finally{this.opts=r}}};Co.ValidationError=AT.default;Co.MissingRefError=Pg.default;Ie.default=Co;function Ig(t,e,r,n="error"){for(let o in t){let s=o;s in e&&this.logger[n](`${r}: option ${o}. ${t[s]}`)}}function zg(t){return t=(0,Oo.normalizeId)(t),this.schemas[t]||this.refs[t]}function VT(){let t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(let e in t)this.addSchema(t[e],e)}function BT(){for(let t in this.opts.formats){let e=this.opts.formats[t];e&&this.addFormat(t,e)}}function HT(t){if(Array.isArray(t)){this.addVocabulary(t);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let e in t){let r=t[e];r.keyword||(r.keyword=e),this.addKeyword(r)}}function GT(){let t={...this.opts};for(let e of ZT)delete t[e];return t}var WT={log(){},warn(){},error(){}};function JT(t){if(t===!1)return WT;if(t===void 0)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}var KT=/^[a-z_$][a-z0-9_$:-]*$/i;function XT(t,e){let{RULES:r}=this;if((0,Fl.eachItem)(t,n=>{if(r.keywords[n])throw new Error(`Keyword ${n} is already defined`);if(!KT.test(n))throw new Error(`Keyword ${n} has invalid name`)}),!!e&&e.$data&&!("code"in e||"validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function Ll(t,e,r){var n;let o=e?.post;if(r&&o)throw new Error('keyword with "post" flag cannot have "type"');let{RULES:s}=this,i=o?s.post:s.rules.find(({type:c})=>c===r);if(i||(i={type:r,rules:[]},s.rules.push(i)),s.keywords[t]=!0,!e)return;let a={keyword:t,definition:{...e,type:(0,bi.getJSONTypes)(e.type),schemaType:(0,bi.getJSONTypes)(e.schemaType)}};e.before?YT.call(this,i,a,e.before):i.rules.push(a),s.all[t]=a,(n=e.implements)===null||n===void 0||n.forEach(c=>this.addKeyword(c))}function YT(t,e,r){let n=t.rules.findIndex(o=>o.keyword===r);n>=0?t.rules.splice(n,0,e):(t.rules.push(e),this.logger.warn(`rule ${r} is not defined`))}function QT(t){let{metaSchema:e}=t;e!==void 0&&(t.$data&&this.opts.$data&&(e=Ng(e)),t.validateSchema=this.compile(e,!0))}var eE={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function Ng(t){return{anyOf:[t,eE]}}});var Cg=k(ql=>{"use strict";Object.defineProperty(ql,"__esModule",{value:!0});var tE={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};ql.default=tE});var Dg=k(Hr=>{"use strict";Object.defineProperty(Hr,"__esModule",{value:!0});Hr.callRef=Hr.getValidate=void 0;var rE=Po(),Ag=ot(),Ge=B(),En=Zt(),Mg=hi(),xi=te(),nE={keyword:"$ref",schemaType:"string",code(t){let{gen:e,schema:r,it:n}=t,{baseId:o,schemaEnv:s,validateName:i,opts:a,self:c}=n,{root:u}=s;if((r==="#"||r==="#/")&&o===u.baseId)return d();let l=Mg.resolveRef.call(c,u,o,r);if(l===void 0)throw new rE.default(n.opts.uriResolver,o,r);if(l instanceof Mg.SchemaEnv)return g(l);return h(l);function d(){if(s===u)return wi(t,i,s,s.$async);let p=e.scopeValue("root",{ref:u});return wi(t,(0,Ge._)`${p}.validate`,u,u.$async)}function g(p){let f=jg(t,p);wi(t,f,p,p.$async)}function h(p){let f=e.scopeValue("schema",a.code.source===!0?{ref:p,code:(0,Ge.stringify)(p)}:{ref:p}),y=e.name("valid"),b=t.subschema({schema:p,dataTypes:[],schemaPath:Ge.nil,topSchemaRef:f,errSchemaPath:r},y);t.mergeEvaluated(b),t.ok(y)}}};function jg(t,e){let{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,Ge._)`${r.scopeValue("wrapper",{ref:e})}.validate`}Hr.getValidate=jg;function wi(t,e,r,n){let{gen:o,it:s}=t,{allErrors:i,schemaEnv:a,opts:c}=s,u=c.passContext?En.default.this:Ge.nil;n?l():d();function l(){if(!a.$async)throw new Error("async schema referenced by sync schema");let p=o.let("valid");o.try(()=>{o.code((0,Ge._)`await ${(0,Ag.callValidateCode)(t,e,u)}`),h(e),i||o.assign(p,!0)},f=>{o.if((0,Ge._)`!(${f} instanceof ${s.ValidationError})`,()=>o.throw(f)),g(f),i||o.assign(p,!1)}),t.ok(p)}function d(){t.result((0,Ag.callValidateCode)(t,e,u),()=>h(e),()=>g(e))}function g(p){let f=(0,Ge._)`${p}.errors`;o.assign(En.default.vErrors,(0,Ge._)`${En.default.vErrors} === null ? ${f} : ${En.default.vErrors}.concat(${f})`),o.assign(En.default.errors,(0,Ge._)`${En.default.vErrors}.length`)}function h(p){var f;if(!s.opts.unevaluated)return;let y=(f=r?.validate)===null||f===void 0?void 0:f.evaluated;if(s.props!==!0)if(y&&!y.dynamicProps)y.props!==void 0&&(s.props=xi.mergeEvaluated.props(o,y.props,s.props));else{let b=o.var("props",(0,Ge._)`${p}.evaluated.props`);s.props=xi.mergeEvaluated.props(o,b,s.props,Ge.Name)}if(s.items!==!0)if(y&&!y.dynamicItems)y.items!==void 0&&(s.items=xi.mergeEvaluated.items(o,y.items,s.items));else{let b=o.var("items",(0,Ge._)`${p}.evaluated.items`);s.items=xi.mergeEvaluated.items(o,b,s.items,Ge.Name)}}}Hr.callRef=wi;Hr.default=nE});var Zg=k(Ul=>{"use strict";Object.defineProperty(Ul,"__esModule",{value:!0});var oE=Cg(),sE=Dg(),iE=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",oE.default,sE.default];Ul.default=iE});var Lg=k(Vl=>{"use strict";Object.defineProperty(Vl,"__esModule",{value:!0});var Si=B(),ur=Si.operators,$i={maximum:{okStr:"<=",ok:ur.LTE,fail:ur.GT},minimum:{okStr:">=",ok:ur.GTE,fail:ur.LT},exclusiveMaximum:{okStr:"<",ok:ur.LT,fail:ur.GTE},exclusiveMinimum:{okStr:">",ok:ur.GT,fail:ur.LTE}},aE={message:({keyword:t,schemaCode:e})=>(0,Si.str)`must be ${$i[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,Si._)`{comparison: ${$i[t].okStr}, limit: ${e}}`},cE={keyword:Object.keys($i),type:"number",schemaType:"number",$data:!0,error:aE,code(t){let{keyword:e,data:r,schemaCode:n}=t;t.fail$data((0,Si._)`${r} ${$i[e].fail} ${n} || isNaN(${r})`)}};Vl.default=cE});var Fg=k(Bl=>{"use strict";Object.defineProperty(Bl,"__esModule",{value:!0});var Ao=B(),uE={message:({schemaCode:t})=>(0,Ao.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,Ao._)`{multipleOf: ${t}}`},lE={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:uE,code(t){let{gen:e,data:r,schemaCode:n,it:o}=t,s=o.opts.multipleOfPrecision,i=e.let("res"),a=s?(0,Ao._)`Math.abs(Math.round(${i}) - ${i}) > 1e-${s}`:(0,Ao._)`${i} !== parseInt(${i})`;t.fail$data((0,Ao._)`(${n} === 0 || (${i} = ${r}/${n}, ${a}))`)}};Bl.default=lE});var Ug=k(Hl=>{"use strict";Object.defineProperty(Hl,"__esModule",{value:!0});function qg(t){let e=t.length,r=0,n=0,o;for(;n<e;)r++,o=t.charCodeAt(n++),o>=55296&&o<=56319&&n<e&&(o=t.charCodeAt(n),(o&64512)===56320&&n++);return r}Hl.default=qg;qg.code='require("ajv/dist/runtime/ucs2length").default'});var Vg=k(Gl=>{"use strict";Object.defineProperty(Gl,"__esModule",{value:!0});var Gr=B(),dE=te(),fE=Ug(),pE={message({keyword:t,schemaCode:e}){let r=t==="maxLength"?"more":"fewer";return(0,Gr.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,Gr._)`{limit: ${t}}`},mE={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:pE,code(t){let{keyword:e,data:r,schemaCode:n,it:o}=t,s=e==="maxLength"?Gr.operators.GT:Gr.operators.LT,i=o.opts.unicode===!1?(0,Gr._)`${r}.length`:(0,Gr._)`${(0,dE.useFunc)(t.gen,fE.default)}(${r})`;t.fail$data((0,Gr._)`${i} ${s} ${n}`)}};Gl.default=mE});var Bg=k(Wl=>{"use strict";Object.defineProperty(Wl,"__esModule",{value:!0});var hE=ot(),ki=B(),gE={message:({schemaCode:t})=>(0,ki.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,ki._)`{pattern: ${t}}`},yE={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:gE,code(t){let{data:e,$data:r,schema:n,schemaCode:o,it:s}=t,i=s.opts.unicodeRegExp?"u":"",a=r?(0,ki._)`(new RegExp(${o}, ${i}))`:(0,hE.usePattern)(t,n);t.fail$data((0,ki._)`!${a}.test(${e})`)}};Wl.default=yE});var Hg=k(Jl=>{"use strict";Object.defineProperty(Jl,"__esModule",{value:!0});var Mo=B(),_E={message({keyword:t,schemaCode:e}){let r=t==="maxProperties"?"more":"fewer";return(0,Mo.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,Mo._)`{limit: ${t}}`},vE={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:_E,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxProperties"?Mo.operators.GT:Mo.operators.LT;t.fail$data((0,Mo._)`Object.keys(${r}).length ${o} ${n}`)}};Jl.default=vE});var Gg=k(Kl=>{"use strict";Object.defineProperty(Kl,"__esModule",{value:!0});var jo=ot(),Do=B(),bE=te(),xE={message:({params:{missingProperty:t}})=>(0,Do.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,Do._)`{missingProperty: ${t}}`},wE={keyword:"required",type:"object",schemaType:"array",$data:!0,error:xE,code(t){let{gen:e,schema:r,schemaCode:n,data:o,$data:s,it:i}=t,{opts:a}=i;if(!s&&r.length===0)return;let c=r.length>=a.loopRequired;if(i.allErrors?u():l(),a.strictRequired){let h=t.parentSchema.properties,{definedProperties:p}=t.it;for(let f of r)if(h?.[f]===void 0&&!p.has(f)){let y=i.schemaEnv.baseId+i.errSchemaPath,b=`required property "${f}" is not defined at "${y}" (strictRequired)`;(0,bE.checkStrictMode)(i,b,i.opts.strictRequired)}}function u(){if(c||s)t.block$data(Do.nil,d);else for(let h of r)(0,jo.checkReportMissingProp)(t,h)}function l(){let h=e.let("missing");if(c||s){let p=e.let("valid",!0);t.block$data(p,()=>g(h,p)),t.ok(p)}else e.if((0,jo.checkMissingProp)(t,r,h)),(0,jo.reportMissingProp)(t,h),e.else()}function d(){e.forOf("prop",n,h=>{t.setParams({missingProperty:h}),e.if((0,jo.noPropertyInData)(e,o,h,a.ownProperties),()=>t.error())})}function g(h,p){t.setParams({missingProperty:h}),e.forOf(h,n,()=>{e.assign(p,(0,jo.propertyInData)(e,o,h,a.ownProperties)),e.if((0,Do.not)(p),()=>{t.error(),e.break()})},Do.nil)}}};Kl.default=wE});var Wg=k(Xl=>{"use strict";Object.defineProperty(Xl,"__esModule",{value:!0});var Zo=B(),SE={message({keyword:t,schemaCode:e}){let r=t==="maxItems"?"more":"fewer";return(0,Zo.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,Zo._)`{limit: ${t}}`},$E={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:SE,code(t){let{keyword:e,data:r,schemaCode:n}=t,o=e==="maxItems"?Zo.operators.GT:Zo.operators.LT;t.fail$data((0,Zo._)`${r}.length ${o} ${n}`)}};Xl.default=$E});var Ti=k(Yl=>{"use strict";Object.defineProperty(Yl,"__esModule",{value:!0});var Jg=wl();Jg.code='require("ajv/dist/runtime/equal").default';Yl.default=Jg});var Kg=k(ed=>{"use strict";Object.defineProperty(ed,"__esModule",{value:!0});var Ql=ko(),ze=B(),kE=te(),TE=Ti(),EE={message:({params:{i:t,j:e}})=>(0,ze.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,ze._)`{i: ${t}, j: ${e}}`},IE={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:EE,code(t){let{gen:e,data:r,$data:n,schema:o,parentSchema:s,schemaCode:i,it:a}=t;if(!n&&!o)return;let c=e.let("valid"),u=s.items?(0,Ql.getSchemaTypes)(s.items):[];t.block$data(c,l,(0,ze._)`${i} === false`),t.ok(c);function l(){let p=e.let("i",(0,ze._)`${r}.length`),f=e.let("j");t.setParams({i:p,j:f}),e.assign(c,!0),e.if((0,ze._)`${p} > 1`,()=>(d()?g:h)(p,f))}function d(){return u.length>0&&!u.some(p=>p==="object"||p==="array")}function g(p,f){let y=e.name("item"),b=(0,Ql.checkDataTypes)(u,y,a.opts.strictNumbers,Ql.DataType.Wrong),x=e.const("indices",(0,ze._)`{}`);e.for((0,ze._)`;${p}--;`,()=>{e.let(y,(0,ze._)`${r}[${p}]`),e.if(b,(0,ze._)`continue`),u.length>1&&e.if((0,ze._)`typeof ${y} == "string"`,(0,ze._)`${y} += "_"`),e.if((0,ze._)`typeof ${x}[${y}] == "number"`,()=>{e.assign(f,(0,ze._)`${x}[${y}]`),t.error(),e.assign(c,!1).break()}).code((0,ze._)`${x}[${y}] = ${p}`)})}function h(p,f){let y=(0,kE.useFunc)(e,TE.default),b=e.name("outer");e.label(b).for((0,ze._)`;${p}--;`,()=>e.for((0,ze._)`${f} = ${p}; ${f}--;`,()=>e.if((0,ze._)`${y}(${r}[${p}], ${r}[${f}])`,()=>{t.error(),e.assign(c,!1).break(b)})))}}};ed.default=IE});var Xg=k(rd=>{"use strict";Object.defineProperty(rd,"__esModule",{value:!0});var td=B(),zE=te(),PE=Ti(),RE={message:"must be equal to constant",params:({schemaCode:t})=>(0,td._)`{allowedValue: ${t}}`},NE={keyword:"const",$data:!0,error:RE,code(t){let{gen:e,data:r,$data:n,schemaCode:o,schema:s}=t;n||s&&typeof s=="object"?t.fail$data((0,td._)`!${(0,zE.useFunc)(e,PE.default)}(${r}, ${o})`):t.fail((0,td._)`${s} !== ${r}`)}};rd.default=NE});var Yg=k(nd=>{"use strict";Object.defineProperty(nd,"__esModule",{value:!0});var Lo=B(),OE=te(),CE=Ti(),AE={message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,Lo._)`{allowedValues: ${t}}`},ME={keyword:"enum",schemaType:"array",$data:!0,error:AE,code(t){let{gen:e,data:r,$data:n,schema:o,schemaCode:s,it:i}=t;if(!n&&o.length===0)throw new Error("enum must have non-empty array");let a=o.length>=i.opts.loopEnum,c,u=()=>c??(c=(0,OE.useFunc)(e,CE.default)),l;if(a||n)l=e.let("valid"),t.block$data(l,d);else{if(!Array.isArray(o))throw new Error("ajv implementation error");let h=e.const("vSchema",s);l=(0,Lo.or)(...o.map((p,f)=>g(h,f)))}t.pass(l);function d(){e.assign(l,!1),e.forOf("v",s,h=>e.if((0,Lo._)`${u()}(${r}, ${h})`,()=>e.assign(l,!0).break()))}function g(h,p){let f=o[p];return typeof f=="object"&&f!==null?(0,Lo._)`${u()}(${r}, ${h}[${p}])`:(0,Lo._)`${r} === ${f}`}}};nd.default=ME});var Qg=k(od=>{"use strict";Object.defineProperty(od,"__esModule",{value:!0});var jE=Lg(),DE=Fg(),ZE=Vg(),LE=Bg(),FE=Hg(),qE=Gg(),UE=Wg(),VE=Kg(),BE=Xg(),HE=Yg(),GE=[jE.default,DE.default,ZE.default,LE.default,FE.default,qE.default,UE.default,VE.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},BE.default,HE.default];od.default=GE});var id=k(Fo=>{"use strict";Object.defineProperty(Fo,"__esModule",{value:!0});Fo.validateAdditionalItems=void 0;var Wr=B(),sd=te(),WE={message:({params:{len:t}})=>(0,Wr.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,Wr._)`{limit: ${t}}`},JE={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:WE,code(t){let{parentSchema:e,it:r}=t,{items:n}=e;if(!Array.isArray(n)){(0,sd.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}ey(t,n)}};function ey(t,e){let{gen:r,schema:n,data:o,keyword:s,it:i}=t;i.items=!0;let a=r.const("len",(0,Wr._)`${o}.length`);if(n===!1)t.setParams({len:e.length}),t.pass((0,Wr._)`${a} <= ${e.length}`);else if(typeof n=="object"&&!(0,sd.alwaysValidSchema)(i,n)){let u=r.var("valid",(0,Wr._)`${a} <= ${e.length}`);r.if((0,Wr.not)(u),()=>c(u)),t.ok(u)}function c(u){r.forRange("i",e.length,a,l=>{t.subschema({keyword:s,dataProp:l,dataPropType:sd.Type.Num},u),i.allErrors||r.if((0,Wr.not)(u),()=>r.break())})}}Fo.validateAdditionalItems=ey;Fo.default=JE});var ad=k(qo=>{"use strict";Object.defineProperty(qo,"__esModule",{value:!0});qo.validateTuple=void 0;var ty=B(),Ei=te(),KE=ot(),XE={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){let{schema:e,it:r}=t;if(Array.isArray(e))return ry(t,"additionalItems",e);r.items=!0,!(0,Ei.alwaysValidSchema)(r,e)&&t.ok((0,KE.validateArray)(t))}};function ry(t,e,r=t.schema){let{gen:n,parentSchema:o,data:s,keyword:i,it:a}=t;l(o),a.opts.unevaluated&&r.length&&a.items!==!0&&(a.items=Ei.mergeEvaluated.items(n,r.length,a.items));let c=n.name("valid"),u=n.const("len",(0,ty._)`${s}.length`);r.forEach((d,g)=>{(0,Ei.alwaysValidSchema)(a,d)||(n.if((0,ty._)`${u} > ${g}`,()=>t.subschema({keyword:i,schemaProp:g,dataProp:g},c)),t.ok(c))});function l(d){let{opts:g,errSchemaPath:h}=a,p=r.length,f=p===d.minItems&&(p===d.maxItems||d[e]===!1);if(g.strictTuples&&!f){let y=`"${i}" is ${p}-tuple, but minItems or maxItems/${e} are not specified or different at path "${h}"`;(0,Ei.checkStrictMode)(a,y,g.strictTuples)}}}qo.validateTuple=ry;qo.default=XE});var ny=k(cd=>{"use strict";Object.defineProperty(cd,"__esModule",{value:!0});var YE=ad(),QE={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,YE.validateTuple)(t,"items")};cd.default=QE});var sy=k(ud=>{"use strict";Object.defineProperty(ud,"__esModule",{value:!0});var oy=B(),eI=te(),tI=ot(),rI=id(),nI={message:({params:{len:t}})=>(0,oy.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,oy._)`{limit: ${t}}`},oI={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:nI,code(t){let{schema:e,parentSchema:r,it:n}=t,{prefixItems:o}=r;n.items=!0,!(0,eI.alwaysValidSchema)(n,e)&&(o?(0,rI.validateAdditionalItems)(t,o):t.ok((0,tI.validateArray)(t)))}};ud.default=oI});var iy=k(ld=>{"use strict";Object.defineProperty(ld,"__esModule",{value:!0});var it=B(),Ii=te(),sI={message:({params:{min:t,max:e}})=>e===void 0?(0,it.str)`must contain at least ${t} valid item(s)`:(0,it.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,it._)`{minContains: ${t}}`:(0,it._)`{minContains: ${t}, maxContains: ${e}}`},iI={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:sI,code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:s}=t,i,a,{minContains:c,maxContains:u}=n;s.opts.next?(i=c===void 0?1:c,a=u):i=1;let l=e.const("len",(0,it._)`${o}.length`);if(t.setParams({min:i,max:a}),a===void 0&&i===0){(0,Ii.checkStrictMode)(s,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&i>a){(0,Ii.checkStrictMode)(s,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,Ii.alwaysValidSchema)(s,r)){let f=(0,it._)`${l} >= ${i}`;a!==void 0&&(f=(0,it._)`${f} && ${l} <= ${a}`),t.pass(f);return}s.items=!0;let d=e.name("valid");a===void 0&&i===1?h(d,()=>e.if(d,()=>e.break())):i===0?(e.let(d,!0),a!==void 0&&e.if((0,it._)`${o}.length > 0`,g)):(e.let(d,!1),g()),t.result(d,()=>t.reset());function g(){let f=e.name("_valid"),y=e.let("count",0);h(f,()=>e.if(f,()=>p(y)))}function h(f,y){e.forRange("i",0,l,b=>{t.subschema({keyword:"contains",dataProp:b,dataPropType:Ii.Type.Num,compositeRule:!0},f),y()})}function p(f){e.code((0,it._)`${f}++`),a===void 0?e.if((0,it._)`${f} >= ${i}`,()=>e.assign(d,!0).break()):(e.if((0,it._)`${f} > ${a}`,()=>e.assign(d,!1).break()),i===1?e.assign(d,!0):e.if((0,it._)`${f} >= ${i}`,()=>e.assign(d,!0)))}}};ld.default=iI});var uy=k(Et=>{"use strict";Object.defineProperty(Et,"__esModule",{value:!0});Et.validateSchemaDeps=Et.validatePropertyDeps=Et.error=void 0;var dd=B(),aI=te(),Uo=ot();Et.error={message:({params:{property:t,depsCount:e,deps:r}})=>{let n=e===1?"property":"properties";return(0,dd.str)`must have ${n} ${r} when property ${t} is present`},params:({params:{property:t,depsCount:e,deps:r,missingProperty:n}})=>(0,dd._)`{property: ${t},
    missingProperty: ${n},
    depsCount: ${e},
    deps: ${r}}`};var cI={keyword:"dependencies",type:"object",schemaType:"object",error:Et.error,code(t){let[e,r]=uI(t);ay(t,e),cy(t,r)}};function uI({schema:t}){let e={},r={};for(let n in t){if(n==="__proto__")continue;let o=Array.isArray(t[n])?e:r;o[n]=t[n]}return[e,r]}function ay(t,e=t.schema){let{gen:r,data:n,it:o}=t;if(Object.keys(e).length===0)return;let s=r.let("missing");for(let i in e){let a=e[i];if(a.length===0)continue;let c=(0,Uo.propertyInData)(r,n,i,o.opts.ownProperties);t.setParams({property:i,depsCount:a.length,deps:a.join(", ")}),o.allErrors?r.if(c,()=>{for(let u of a)(0,Uo.checkReportMissingProp)(t,u)}):(r.if((0,dd._)`${c} && (${(0,Uo.checkMissingProp)(t,a,s)})`),(0,Uo.reportMissingProp)(t,s),r.else())}}Et.validatePropertyDeps=ay;function cy(t,e=t.schema){let{gen:r,data:n,keyword:o,it:s}=t,i=r.name("valid");for(let a in e)(0,aI.alwaysValidSchema)(s,e[a])||(r.if((0,Uo.propertyInData)(r,n,a,s.opts.ownProperties),()=>{let c=t.subschema({keyword:o,schemaProp:a},i);t.mergeValidEvaluated(c,i)},()=>r.var(i,!0)),t.ok(i))}Et.validateSchemaDeps=cy;Et.default=cI});var dy=k(fd=>{"use strict";Object.defineProperty(fd,"__esModule",{value:!0});var ly=B(),lI=te(),dI={message:"property name must be valid",params:({params:t})=>(0,ly._)`{propertyName: ${t.propertyName}}`},fI={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:dI,code(t){let{gen:e,schema:r,data:n,it:o}=t;if((0,lI.alwaysValidSchema)(o,r))return;let s=e.name("valid");e.forIn("key",n,i=>{t.setParams({propertyName:i}),t.subschema({keyword:"propertyNames",data:i,dataTypes:["string"],propertyName:i,compositeRule:!0},s),e.if((0,ly.not)(s),()=>{t.error(!0),o.allErrors||e.break()})}),t.ok(s)}};fd.default=fI});var md=k(pd=>{"use strict";Object.defineProperty(pd,"__esModule",{value:!0});var zi=ot(),yt=B(),pI=Zt(),Pi=te(),mI={message:"must NOT have additional properties",params:({params:t})=>(0,yt._)`{additionalProperty: ${t.additionalProperty}}`},hI={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:mI,code(t){let{gen:e,schema:r,parentSchema:n,data:o,errsCount:s,it:i}=t;if(!s)throw new Error("ajv implementation error");let{allErrors:a,opts:c}=i;if(i.props=!0,c.removeAdditional!=="all"&&(0,Pi.alwaysValidSchema)(i,r))return;let u=(0,zi.allSchemaProperties)(n.properties),l=(0,zi.allSchemaProperties)(n.patternProperties);d(),t.ok((0,yt._)`${s} === ${pI.default.errors}`);function d(){e.forIn("key",o,y=>{!u.length&&!l.length?p(y):e.if(g(y),()=>p(y))})}function g(y){let b;if(u.length>8){let x=(0,Pi.schemaRefOrVal)(i,n.properties,"properties");b=(0,zi.isOwnProperty)(e,x,y)}else u.length?b=(0,yt.or)(...u.map(x=>(0,yt._)`${y} === ${x}`)):b=yt.nil;return l.length&&(b=(0,yt.or)(b,...l.map(x=>(0,yt._)`${(0,zi.usePattern)(t,x)}.test(${y})`))),(0,yt.not)(b)}function h(y){e.code((0,yt._)`delete ${o}[${y}]`)}function p(y){if(c.removeAdditional==="all"||c.removeAdditional&&r===!1){h(y);return}if(r===!1){t.setParams({additionalProperty:y}),t.error(),a||e.break();return}if(typeof r=="object"&&!(0,Pi.alwaysValidSchema)(i,r)){let b=e.name("valid");c.removeAdditional==="failing"?(f(y,b,!1),e.if((0,yt.not)(b),()=>{t.reset(),h(y)})):(f(y,b),a||e.if((0,yt.not)(b),()=>e.break()))}}function f(y,b,x){let S={keyword:"additionalProperties",dataProp:y,dataPropType:Pi.Type.Str};x===!1&&Object.assign(S,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(S,b)}}};pd.default=hI});var my=k(gd=>{"use strict";Object.defineProperty(gd,"__esModule",{value:!0});var gI=zo(),fy=ot(),hd=te(),py=md(),yI={keyword:"properties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,parentSchema:n,data:o,it:s}=t;s.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&py.default.code(new gI.KeywordCxt(s,py.default,"additionalProperties"));let i=(0,fy.allSchemaProperties)(r);for(let d of i)s.definedProperties.add(d);s.opts.unevaluated&&i.length&&s.props!==!0&&(s.props=hd.mergeEvaluated.props(e,(0,hd.toHash)(i),s.props));let a=i.filter(d=>!(0,hd.alwaysValidSchema)(s,r[d]));if(a.length===0)return;let c=e.name("valid");for(let d of a)u(d)?l(d):(e.if((0,fy.propertyInData)(e,o,d,s.opts.ownProperties)),l(d),s.allErrors||e.else().var(c,!0),e.endIf()),t.it.definedProperties.add(d),t.ok(c);function u(d){return s.opts.useDefaults&&!s.compositeRule&&r[d].default!==void 0}function l(d){t.subschema({keyword:"properties",schemaProp:d,dataProp:d},c)}}};gd.default=yI});var _y=k(yd=>{"use strict";Object.defineProperty(yd,"__esModule",{value:!0});var hy=ot(),Ri=B(),gy=te(),yy=te(),_I={keyword:"patternProperties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,data:n,parentSchema:o,it:s}=t,{opts:i}=s,a=(0,hy.allSchemaProperties)(r),c=a.filter(f=>(0,gy.alwaysValidSchema)(s,r[f]));if(a.length===0||c.length===a.length&&(!s.opts.unevaluated||s.props===!0))return;let u=i.strictSchema&&!i.allowMatchingProperties&&o.properties,l=e.name("valid");s.props!==!0&&!(s.props instanceof Ri.Name)&&(s.props=(0,yy.evaluatedPropsToName)(e,s.props));let{props:d}=s;g();function g(){for(let f of a)u&&h(f),s.allErrors?p(f):(e.var(l,!0),p(f),e.if(l))}function h(f){for(let y in u)new RegExp(f).test(y)&&(0,gy.checkStrictMode)(s,`property ${y} matches pattern ${f} (use allowMatchingProperties)`)}function p(f){e.forIn("key",n,y=>{e.if((0,Ri._)`${(0,hy.usePattern)(t,f)}.test(${y})`,()=>{let b=c.includes(f);b||t.subschema({keyword:"patternProperties",schemaProp:f,dataProp:y,dataPropType:yy.Type.Str},l),s.opts.unevaluated&&d!==!0?e.assign((0,Ri._)`${d}[${y}]`,!0):!b&&!s.allErrors&&e.if((0,Ri.not)(l),()=>e.break())})})}}};yd.default=_I});var vy=k(_d=>{"use strict";Object.defineProperty(_d,"__esModule",{value:!0});var vI=te(),bI={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){let{gen:e,schema:r,it:n}=t;if((0,vI.alwaysValidSchema)(n,r)){t.fail();return}let o=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),t.failResult(o,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};_d.default=bI});var by=k(vd=>{"use strict";Object.defineProperty(vd,"__esModule",{value:!0});var xI=ot(),wI={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:xI.validateUnion,error:{message:"must match a schema in anyOf"}};vd.default=wI});var xy=k(bd=>{"use strict";Object.defineProperty(bd,"__esModule",{value:!0});var Ni=B(),SI=te(),$I={message:"must match exactly one schema in oneOf",params:({params:t})=>(0,Ni._)`{passingSchemas: ${t.passing}}`},kI={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:$I,code(t){let{gen:e,schema:r,parentSchema:n,it:o}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(o.opts.discriminator&&n.discriminator)return;let s=r,i=e.let("valid",!1),a=e.let("passing",null),c=e.name("_valid");t.setParams({passing:a}),e.block(u),t.result(i,()=>t.reset(),()=>t.error(!0));function u(){s.forEach((l,d)=>{let g;(0,SI.alwaysValidSchema)(o,l)?e.var(c,!0):g=t.subschema({keyword:"oneOf",schemaProp:d,compositeRule:!0},c),d>0&&e.if((0,Ni._)`${c} && ${i}`).assign(i,!1).assign(a,(0,Ni._)`[${a}, ${d}]`).else(),e.if(c,()=>{e.assign(i,!0),e.assign(a,d),g&&t.mergeEvaluated(g,Ni.Name)})})}}};bd.default=kI});var wy=k(xd=>{"use strict";Object.defineProperty(xd,"__esModule",{value:!0});var TI=te(),EI={keyword:"allOf",schemaType:"array",code(t){let{gen:e,schema:r,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");let o=e.name("valid");r.forEach((s,i)=>{if((0,TI.alwaysValidSchema)(n,s))return;let a=t.subschema({keyword:"allOf",schemaProp:i},o);t.ok(o),t.mergeEvaluated(a)})}};xd.default=EI});var ky=k(wd=>{"use strict";Object.defineProperty(wd,"__esModule",{value:!0});var Oi=B(),$y=te(),II={message:({params:t})=>(0,Oi.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,Oi._)`{failingKeyword: ${t.ifClause}}`},zI={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:II,code(t){let{gen:e,parentSchema:r,it:n}=t;r.then===void 0&&r.else===void 0&&(0,$y.checkStrictMode)(n,'"if" without "then" and "else" is ignored');let o=Sy(n,"then"),s=Sy(n,"else");if(!o&&!s)return;let i=e.let("valid",!0),a=e.name("_valid");if(c(),t.reset(),o&&s){let l=e.let("ifClause");t.setParams({ifClause:l}),e.if(a,u("then",l),u("else",l))}else o?e.if(a,u("then")):e.if((0,Oi.not)(a),u("else"));t.pass(i,()=>t.error(!0));function c(){let l=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);t.mergeEvaluated(l)}function u(l,d){return()=>{let g=t.subschema({keyword:l},a);e.assign(i,a),t.mergeValidEvaluated(g,i),d?e.assign(d,(0,Oi._)`${l}`):t.setParams({ifClause:l})}}}};function Sy(t,e){let r=t.schema[e];return r!==void 0&&!(0,$y.alwaysValidSchema)(t,r)}wd.default=zI});var Ty=k(Sd=>{"use strict";Object.defineProperty(Sd,"__esModule",{value:!0});var PI=te(),RI={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,PI.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};Sd.default=RI});var Ey=k($d=>{"use strict";Object.defineProperty($d,"__esModule",{value:!0});var NI=id(),OI=ny(),CI=ad(),AI=sy(),MI=iy(),jI=uy(),DI=dy(),ZI=md(),LI=my(),FI=_y(),qI=vy(),UI=by(),VI=xy(),BI=wy(),HI=ky(),GI=Ty();function WI(t=!1){let e=[qI.default,UI.default,VI.default,BI.default,HI.default,GI.default,DI.default,ZI.default,jI.default,LI.default,FI.default];return t?e.push(OI.default,AI.default):e.push(NI.default,CI.default),e.push(MI.default),e}$d.default=WI});var Iy=k(kd=>{"use strict";Object.defineProperty(kd,"__esModule",{value:!0});var _e=B(),JI={message:({schemaCode:t})=>(0,_e.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,_e._)`{format: ${t}}`},KI={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:JI,code(t,e){let{gen:r,data:n,$data:o,schema:s,schemaCode:i,it:a}=t,{opts:c,errSchemaPath:u,schemaEnv:l,self:d}=a;if(!c.validateFormats)return;o?g():h();function g(){let p=r.scopeValue("formats",{ref:d.formats,code:c.code.formats}),f=r.const("fDef",(0,_e._)`${p}[${i}]`),y=r.let("fType"),b=r.let("format");r.if((0,_e._)`typeof ${f} == "object" && !(${f} instanceof RegExp)`,()=>r.assign(y,(0,_e._)`${f}.type || "string"`).assign(b,(0,_e._)`${f}.validate`),()=>r.assign(y,(0,_e._)`"string"`).assign(b,f)),t.fail$data((0,_e.or)(x(),S()));function x(){return c.strictSchema===!1?_e.nil:(0,_e._)`${i} && !${b}`}function S(){let z=l.$async?(0,_e._)`(${f}.async ? await ${b}(${n}) : ${b}(${n}))`:(0,_e._)`${b}(${n})`,A=(0,_e._)`(typeof ${b} == "function" ? ${z} : ${b}.test(${n}))`;return(0,_e._)`${b} && ${b} !== true && ${y} === ${e} && !${A}`}}function h(){let p=d.formats[s];if(!p){x();return}if(p===!0)return;let[f,y,b]=S(p);f===e&&t.pass(z());function x(){if(c.strictSchema===!1){d.logger.warn(A());return}throw new Error(A());function A(){return`unknown format "${s}" ignored in schema at path "${u}"`}}function S(A){let be=A instanceof RegExp?(0,_e.regexpCode)(A):c.code.formats?(0,_e._)`${c.code.formats}${(0,_e.getProperty)(s)}`:void 0,Re=r.scopeValue("formats",{key:s,ref:A,code:be});return typeof A=="object"&&!(A instanceof RegExp)?[A.type||"string",A.validate,(0,_e._)`${Re}.validate`]:["string",A,Re]}function z(){if(typeof p=="object"&&!(p instanceof RegExp)&&p.async){if(!l.$async)throw new Error("async format in sync schema");return(0,_e._)`await ${b}(${n})`}return typeof y=="function"?(0,_e._)`${b}(${n})`:(0,_e._)`${b}.test(${n})`}}}};kd.default=KI});var zy=k(Td=>{"use strict";Object.defineProperty(Td,"__esModule",{value:!0});var XI=Iy(),YI=[XI.default];Td.default=YI});var Py=k(In=>{"use strict";Object.defineProperty(In,"__esModule",{value:!0});In.contentVocabulary=In.metadataVocabulary=void 0;In.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];In.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var Ny=k(Ed=>{"use strict";Object.defineProperty(Ed,"__esModule",{value:!0});var QI=Zg(),ez=Qg(),tz=Ey(),rz=zy(),Ry=Py(),nz=[QI.default,ez.default,(0,tz.default)(),rz.default,Ry.metadataVocabulary,Ry.contentVocabulary];Ed.default=nz});var Cy=k(Ci=>{"use strict";Object.defineProperty(Ci,"__esModule",{value:!0});Ci.DiscrError=void 0;var Oy;(function(t){t.Tag="tag",t.Mapping="mapping"})(Oy||(Ci.DiscrError=Oy={}))});var My=k(zd=>{"use strict";Object.defineProperty(zd,"__esModule",{value:!0});var zn=B(),Id=Cy(),Ay=hi(),oz=Po(),sz=te(),iz={message:({params:{discrError:t,tagName:e}})=>t===Id.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,zn._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},az={keyword:"discriminator",type:"object",schemaType:"object",error:iz,code(t){let{gen:e,data:r,schema:n,parentSchema:o,it:s}=t,{oneOf:i}=o;if(!s.opts.discriminator)throw new Error("discriminator: requires discriminator option");let a=n.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!i)throw new Error("discriminator: requires oneOf keyword");let c=e.let("valid",!1),u=e.const("tag",(0,zn._)`${r}${(0,zn.getProperty)(a)}`);e.if((0,zn._)`typeof ${u} == "string"`,()=>l(),()=>t.error(!1,{discrError:Id.DiscrError.Tag,tag:u,tagName:a})),t.ok(c);function l(){let h=g();e.if(!1);for(let p in h)e.elseIf((0,zn._)`${u} === ${p}`),e.assign(c,d(h[p]));e.else(),t.error(!1,{discrError:Id.DiscrError.Mapping,tag:u,tagName:a}),e.endIf()}function d(h){let p=e.name("valid"),f=t.subschema({keyword:"oneOf",schemaProp:h},p);return t.mergeEvaluated(f,zn.Name),p}function g(){var h;let p={},f=b(o),y=!0;for(let z=0;z<i.length;z++){let A=i[z];if(A?.$ref&&!(0,sz.schemaHasRulesButRef)(A,s.self.RULES)){let Re=A.$ref;if(A=Ay.resolveRef.call(s.self,s.schemaEnv.root,s.baseId,Re),A instanceof Ay.SchemaEnv&&(A=A.schema),A===void 0)throw new oz.default(s.opts.uriResolver,s.baseId,Re)}let be=(h=A?.properties)===null||h===void 0?void 0:h[a];if(typeof be!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);y=y&&(f||b(A)),x(be,z)}if(!y)throw new Error(`discriminator: "${a}" must be required`);return p;function b({required:z}){return Array.isArray(z)&&z.includes(a)}function x(z,A){if(z.const)S(z.const,A);else if(z.enum)for(let be of z.enum)S(be,A);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function S(z,A){if(typeof z!="string"||z in p)throw new Error(`discriminator: "${a}" values must be unique strings`);p[z]=A}}}};zd.default=az});var jy=k((qM,cz)=>{cz.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var Rd=k((le,Pd)=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.MissingRefError=le.ValidationError=le.CodeGen=le.Name=le.nil=le.stringify=le.str=le._=le.KeywordCxt=le.Ajv=void 0;var uz=Og(),lz=Ny(),dz=My(),Dy=jy(),fz=["/properties"],Ai="http://json-schema.org/draft-07/schema",Pn=class extends uz.default{_addVocabularies(){super._addVocabularies(),lz.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(dz.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let e=this.opts.$data?this.$dataMetaSchema(Dy,fz):Dy;this.addMetaSchema(e,Ai,!1),this.refs["http://json-schema.org/schema"]=Ai}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(Ai)?Ai:void 0)}};le.Ajv=Pn;Pd.exports=le=Pn;Pd.exports.Ajv=Pn;Object.defineProperty(le,"__esModule",{value:!0});le.default=Pn;var pz=zo();Object.defineProperty(le,"KeywordCxt",{enumerable:!0,get:function(){return pz.KeywordCxt}});var Rn=B();Object.defineProperty(le,"_",{enumerable:!0,get:function(){return Rn._}});Object.defineProperty(le,"str",{enumerable:!0,get:function(){return Rn.str}});Object.defineProperty(le,"stringify",{enumerable:!0,get:function(){return Rn.stringify}});Object.defineProperty(le,"nil",{enumerable:!0,get:function(){return Rn.nil}});Object.defineProperty(le,"Name",{enumerable:!0,get:function(){return Rn.Name}});Object.defineProperty(le,"CodeGen",{enumerable:!0,get:function(){return Rn.CodeGen}});var mz=pi();Object.defineProperty(le,"ValidationError",{enumerable:!0,get:function(){return mz.default}});var hz=Po();Object.defineProperty(le,"MissingRefError",{enumerable:!0,get:function(){return hz.default}})});var Hy=k(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.formatNames=zt.fastFormats=zt.fullFormats=void 0;function It(t,e){return{validate:t,compare:e}}zt.fullFormats={date:It(qy,Ad),time:It(Od(!0),Md),"date-time":It(Zy(!0),Vy),"iso-time":It(Od(),Uy),"iso-date-time":It(Zy(),By),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:xz,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:Iz,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:wz,int32:{type:"number",validate:kz},int64:{type:"number",validate:Tz},float:{type:"number",validate:Fy},double:{type:"number",validate:Fy},password:!0,binary:!0};zt.fastFormats={...zt.fullFormats,date:It(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,Ad),time:It(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,Md),"date-time":It(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,Vy),"iso-time":It(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,Uy),"iso-date-time":It(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,By),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i};zt.formatNames=Object.keys(zt.fullFormats);function gz(t){return t%4===0&&(t%100!==0||t%400===0)}var yz=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,_z=[0,31,28,31,30,31,30,31,31,30,31,30,31];function qy(t){let e=yz.exec(t);if(!e)return!1;let r=+e[1],n=+e[2],o=+e[3];return n>=1&&n<=12&&o>=1&&o<=(n===2&&gz(r)?29:_z[n])}function Ad(t,e){if(t&&e)return t>e?1:t<e?-1:0}var Nd=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function Od(t){return function(r){let n=Nd.exec(r);if(!n)return!1;let o=+n[1],s=+n[2],i=+n[3],a=n[4],c=n[5]==="-"?-1:1,u=+(n[6]||0),l=+(n[7]||0);if(u>23||l>59||t&&!a)return!1;if(o<=23&&s<=59&&i<60)return!0;let d=s-l*c,g=o-u*c-(d<0?1:0);return(g===23||g===-1)&&(d===59||d===-1)&&i<61}}function Md(t,e){if(!(t&&e))return;let r=new Date("2020-01-01T"+t).valueOf(),n=new Date("2020-01-01T"+e).valueOf();if(r&&n)return r-n}function Uy(t,e){if(!(t&&e))return;let r=Nd.exec(t),n=Nd.exec(e);if(r&&n)return t=r[1]+r[2]+r[3],e=n[1]+n[2]+n[3],t>e?1:t<e?-1:0}var Cd=/t|\s/i;function Zy(t){let e=Od(t);return function(n){let o=n.split(Cd);return o.length===2&&qy(o[0])&&e(o[1])}}function Vy(t,e){if(!(t&&e))return;let r=new Date(t).valueOf(),n=new Date(e).valueOf();if(r&&n)return r-n}function By(t,e){if(!(t&&e))return;let[r,n]=t.split(Cd),[o,s]=e.split(Cd),i=Ad(r,o);if(i!==void 0)return i||Md(n,s)}var vz=/\/|:/,bz=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function xz(t){return vz.test(t)&&bz.test(t)}var Ly=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function wz(t){return Ly.lastIndex=0,Ly.test(t)}var Sz=-(2**31),$z=2**31-1;function kz(t){return Number.isInteger(t)&&t<=$z&&t>=Sz}function Tz(t){return Number.isInteger(t)}function Fy(){return!0}var Ez=/[^\\]\\Z/;function Iz(t){if(Ez.test(t))return!1;try{return new RegExp(t),!0}catch{return!1}}});var Gy=k(Nn=>{"use strict";Object.defineProperty(Nn,"__esModule",{value:!0});Nn.formatLimitDefinition=void 0;var zz=Rd(),_t=B(),lr=_t.operators,Mi={formatMaximum:{okStr:"<=",ok:lr.LTE,fail:lr.GT},formatMinimum:{okStr:">=",ok:lr.GTE,fail:lr.LT},formatExclusiveMaximum:{okStr:"<",ok:lr.LT,fail:lr.GTE},formatExclusiveMinimum:{okStr:">",ok:lr.GT,fail:lr.LTE}},Pz={message:({keyword:t,schemaCode:e})=>(0,_t.str)`should be ${Mi[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,_t._)`{comparison: ${Mi[t].okStr}, limit: ${e}}`};Nn.formatLimitDefinition={keyword:Object.keys(Mi),type:"string",schemaType:"string",$data:!0,error:Pz,code(t){let{gen:e,data:r,schemaCode:n,keyword:o,it:s}=t,{opts:i,self:a}=s;if(!i.validateFormats)return;let c=new zz.KeywordCxt(s,a.RULES.all.format.definition,"format");c.$data?u():l();function u(){let g=e.scopeValue("formats",{ref:a.formats,code:i.code.formats}),h=e.const("fmt",(0,_t._)`${g}[${c.schemaCode}]`);t.fail$data((0,_t.or)((0,_t._)`typeof ${h} != "object"`,(0,_t._)`${h} instanceof RegExp`,(0,_t._)`typeof ${h}.compare != "function"`,d(h)))}function l(){let g=c.schema,h=a.formats[g];if(!h||h===!0)return;if(typeof h!="object"||h instanceof RegExp||typeof h.compare!="function")throw new Error(`"${o}": format "${g}" does not define "compare" function`);let p=e.scopeValue("formats",{key:g,ref:h,code:i.code.formats?(0,_t._)`${i.code.formats}${(0,_t.getProperty)(g)}`:void 0});t.fail$data(d(p))}function d(g){return(0,_t._)`${g}.compare(${r}, ${n}) ${Mi[o].fail} 0`}},dependencies:["format"]};var Rz=t=>(t.addKeyword(Nn.formatLimitDefinition),t);Nn.default=Rz});var Xy=k((Vo,Ky)=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0});var On=Hy(),Nz=Gy(),jd=B(),Wy=new jd.Name("fullFormats"),Oz=new jd.Name("fastFormats"),Dd=(t,e={keywords:!0})=>{if(Array.isArray(e))return Jy(t,e,On.fullFormats,Wy),t;let[r,n]=e.mode==="fast"?[On.fastFormats,Oz]:[On.fullFormats,Wy],o=e.formats||On.formatNames;return Jy(t,o,r,n),e.keywords&&(0,Nz.default)(t),t};Dd.get=(t,e="full")=>{let n=(e==="fast"?On.fastFormats:On.fullFormats)[t];if(!n)throw new Error(`Unknown format "${t}"`);return n};function Jy(t,e,r,n){var o,s;(o=(s=t.opts.code).formats)!==null&&o!==void 0||(s.formats=(0,jd._)`require("ajv-formats/dist/formats").${n}`);for(let i of e)t.addFormat(i,r[i])}Ky.exports=Vo=Dd;Object.defineProperty(Vo,"__esModule",{value:!0});Vo.default=Dd});var qt=k((wj,d_)=>{"use strict";var u_=["nodebuffer","arraybuffer","fragments"],l_=typeof Blob<"u";l_&&u_.push("blob");d_.exports={BINARY_TYPES:u_,CLOSE_TIMEOUT:3e4,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:l_,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var Ho=k((Sj,Vi)=>{"use strict";var{EMPTY_BUFFER:qz}=qt(),Ud=Buffer[Symbol.species];function Uz(t,e){if(t.length===0)return qz;if(t.length===1)return t[0];let r=Buffer.allocUnsafe(e),n=0;for(let o=0;o<t.length;o++){let s=t[o];r.set(s,n),n+=s.length}return n<e?new Ud(r.buffer,r.byteOffset,n):r}function f_(t,e,r,n,o){for(let s=0;s<o;s++)r[n+s]=t[s]^e[s&3]}function p_(t,e){for(let r=0;r<t.length;r++)t[r]^=e[r&3]}function Vz(t){return t.length===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}function Vd(t){if(Vd.readOnly=!0,Buffer.isBuffer(t))return t;let e;return t instanceof ArrayBuffer?e=new Ud(t):ArrayBuffer.isView(t)?e=new Ud(t.buffer,t.byteOffset,t.byteLength):(e=Buffer.from(t),Vd.readOnly=!1),e}Vi.exports={concat:Uz,mask:f_,toArrayBuffer:Vz,toBuffer:Vd,unmask:p_};if(!process.env.WS_NO_BUFFER_UTIL)try{let t=require("bufferutil");Vi.exports.mask=function(e,r,n,o,s){s<48?f_(e,r,n,o,s):t.mask(e,r,n,o,s)},Vi.exports.unmask=function(e,r){e.length<32?p_(e,r):t.unmask(e,r)}}catch{}});var g_=k(($j,h_)=>{"use strict";var m_=Symbol("kDone"),Bd=Symbol("kRun"),Hd=class{constructor(e){this[m_]=()=>{this.pending--,this[Bd]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[Bd]()}[Bd](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[m_])}}};h_.exports=Hd});var Wo=k((kj,b_)=>{"use strict";var Go=require("zlib"),y_=Ho(),Bz=g_(),{kStatusCode:__}=qt(),Hz=Buffer[Symbol.species],Gz=Buffer.from([0,0,255,255]),Hi=Symbol("permessage-deflate"),Ut=Symbol("total-length"),Cn=Symbol("callback"),fr=Symbol("buffers"),An=Symbol("error"),Bi,Gd=class{constructor(e,r,n){if(this._maxPayload=n|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!Bi){let o=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Bi=new Bz(o)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[Cn];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let r=this._options,n=e.find(o=>!(r.serverNoContextTakeover===!1&&o.server_no_context_takeover||o.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>o.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!o.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(n.server_no_context_takeover=!0),r.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(n.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?n.client_max_window_bits=r.clientMaxWindowBits:(n.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(e){let r=e[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(e){return e.forEach(r=>{Object.keys(r).forEach(n=>{let o=r[n];if(o.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(o=o[0],n==="client_max_window_bits"){if(o!==!0){let s=+o;if(!Number.isInteger(s)||s<8||s>15)throw new TypeError(`Invalid value for parameter "${n}": ${o}`);o=s}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${o}`)}else if(n==="server_max_window_bits"){let s=+o;if(!Number.isInteger(s)||s<8||s>15)throw new TypeError(`Invalid value for parameter "${n}": ${o}`);o=s}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(o!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${o}`)}else throw new Error(`Unknown parameter "${n}"`);r[n]=o})}),e}decompress(e,r,n){Bi.add(o=>{this._decompress(e,r,(s,i)=>{o(),n(s,i)})})}compress(e,r,n){Bi.add(o=>{this._compress(e,r,(s,i)=>{o(),n(s,i)})})}_decompress(e,r,n){let o=this._isServer?"client":"server";if(!this._inflate){let s=`${o}_max_window_bits`,i=typeof this.params[s]!="number"?Go.Z_DEFAULT_WINDOWBITS:this.params[s];this._inflate=Go.createInflateRaw({...this._options.zlibInflateOptions,windowBits:i}),this._inflate[Hi]=this,this._inflate[Ut]=0,this._inflate[fr]=[],this._inflate.on("error",Jz),this._inflate.on("data",v_)}this._inflate[Cn]=n,this._inflate.write(e),r&&this._inflate.write(Gz),this._inflate.flush(()=>{let s=this._inflate[An];if(s){this._inflate.close(),this._inflate=null,n(s);return}let i=y_.concat(this._inflate[fr],this._inflate[Ut]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[Ut]=0,this._inflate[fr]=[],r&&this.params[`${o}_no_context_takeover`]&&this._inflate.reset()),n(null,i)})}_compress(e,r,n){let o=this._isServer?"server":"client";if(!this._deflate){let s=`${o}_max_window_bits`,i=typeof this.params[s]!="number"?Go.Z_DEFAULT_WINDOWBITS:this.params[s];this._deflate=Go.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:i}),this._deflate[Ut]=0,this._deflate[fr]=[],this._deflate.on("data",Wz)}this._deflate[Cn]=n,this._deflate.write(e),this._deflate.flush(Go.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let s=y_.concat(this._deflate[fr],this._deflate[Ut]);r&&(s=new Hz(s.buffer,s.byteOffset,s.length-4)),this._deflate[Cn]=null,this._deflate[Ut]=0,this._deflate[fr]=[],r&&this.params[`${o}_no_context_takeover`]&&this._deflate.reset(),n(null,s)})}};b_.exports=Gd;function Wz(t){this[fr].push(t),this[Ut]+=t.length}function v_(t){if(this[Ut]+=t.length,this[Hi]._maxPayload<1||this[Ut]<=this[Hi]._maxPayload){this[fr].push(t);return}this[An]=new RangeError("Max payload size exceeded"),this[An].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[An][__]=1009,this.removeListener("data",v_),this.reset()}function Jz(t){if(this[Hi]._inflate=null,this[An]){this[Cn](this[An]);return}t[__]=1007,this[Cn](t)}});var Mn=k((Tj,Gi)=>{"use strict";var{isUtf8:x_}=require("buffer"),{hasBlob:Kz}=qt(),Xz=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Yz(t){return t>=1e3&&t<=1014&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999}function Wd(t){let e=t.length,r=0;for(;r<e;)if(!(t[r]&128))r++;else if((t[r]&224)===192){if(r+1===e||(t[r+1]&192)!==128||(t[r]&254)===192)return!1;r+=2}else if((t[r]&240)===224){if(r+2>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||t[r]===224&&(t[r+1]&224)===128||t[r]===237&&(t[r+1]&224)===160)return!1;r+=3}else if((t[r]&248)===240){if(r+3>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||(t[r+3]&192)!==128||t[r]===240&&(t[r+1]&240)===128||t[r]===244&&t[r+1]>143||t[r]>244)return!1;r+=4}else return!1;return!0}function Qz(t){return Kz&&typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&(t[Symbol.toStringTag]==="Blob"||t[Symbol.toStringTag]==="File")}Gi.exports={isBlob:Qz,isValidStatusCode:Yz,isValidUTF8:Wd,tokenChars:Xz};if(x_)Gi.exports.isValidUTF8=function(t){return t.length<24?Wd(t):x_(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=require("utf-8-validate");Gi.exports.isValidUTF8=function(e){return e.length<32?Wd(e):t(e)}}catch{}});var Qd=k((Ej,I_)=>{"use strict";var{Writable:eP}=require("stream"),w_=Wo(),{BINARY_TYPES:tP,EMPTY_BUFFER:S_,kStatusCode:rP,kWebSocket:nP}=qt(),{concat:Jd,toArrayBuffer:oP,unmask:sP}=Ho(),{isValidStatusCode:iP,isValidUTF8:$_}=Mn(),Wi=Buffer[Symbol.species],at=0,k_=1,T_=2,E_=3,Kd=4,Xd=5,Ji=6,Yd=class extends eP{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||tP[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[nP]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=at}_write(e,r,n){if(this._opcode===8&&this._state==at)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=new Wi(n.buffer,n.byteOffset+e,n.length-e),new Wi(n.buffer,n.byteOffset,e)}let r=Buffer.allocUnsafe(e);do{let n=this._buffers[0],o=r.length-e;e>=n.length?r.set(this._buffers.shift(),o):(r.set(new Uint8Array(n.buffer,n.byteOffset,e),o),this._buffers[0]=new Wi(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0);return r}startLoop(e){this._loop=!0;do switch(this._state){case at:this.getInfo(e);break;case k_:this.getPayloadLength16(e);break;case T_:this.getPayloadLength64(e);break;case E_:this.getMask();break;case Kd:this.getData(e);break;case Xd:case Ji:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let r=this.consume(2);if(r[0]&48){let o=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(o);return}let n=(r[0]&64)===64;if(n&&!this._extensions[w_.extensionName]){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(this._fin=(r[0]&128)===128,this._opcode=r[0]&15,this._payloadLength=r[1]&127,this._opcode===0){if(n){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(!this._fragmented){let o=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}this._compressed=n}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let o=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(o);return}if(n){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let o=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(o);return}}else{let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(r[1]&128)===128,this._isServer){if(!this._masked){let o=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(o);return}}else if(this._masked){let o=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(o);return}this._payloadLength===126?this._state=k_:this._payloadLength===127?this._state=T_:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let r=this.consume(8),n=r.readUInt32BE(0);if(n>Math.pow(2,21)-1){let o=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(o);return}this._payloadLength=n*Math.pow(2,32)+r.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let r=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(r);return}this._masked?this._state=E_:this._state=Kd}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Kd}getData(e){let r=S_;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&sP(r,this._mask)}if(this._opcode>7){this.controlMessage(r,e);return}if(this._compressed){this._state=Xd,this.decompress(r,e);return}r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage(e)}decompress(e,r){this._extensions[w_.extensionName].decompress(e,this._fin,(o,s)=>{if(o)return r(o);if(s.length){if(this._messageLength+=s.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let i=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");r(i);return}this._fragments.push(s)}this.dataMessage(r),this._state===at&&this.startLoop(r)})}dataMessage(e){if(!this._fin){this._state=at;return}let r=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let o;this._binaryType==="nodebuffer"?o=Jd(n,r):this._binaryType==="arraybuffer"?o=oP(Jd(n,r)):this._binaryType==="blob"?o=new Blob(n):o=n,this._allowSynchronousEvents?(this.emit("message",o,!0),this._state=at):(this._state=Ji,setImmediate(()=>{this.emit("message",o,!0),this._state=at,this.startLoop(e)}))}else{let o=Jd(n,r);if(!this._skipUTF8Validation&&!$_(o)){let s=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(s);return}this._state===Xd||this._allowSynchronousEvents?(this.emit("message",o,!1),this._state=at):(this._state=Ji,setImmediate(()=>{this.emit("message",o,!1),this._state=at,this.startLoop(e)}))}}controlMessage(e,r){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,S_),this.end();else{let n=e.readUInt16BE(0);if(!iP(n)){let s=this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");r(s);return}let o=new Wi(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!$_(o)){let s=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");r(s);return}this._loop=!1,this.emit("conclude",n,o),this.end()}this._state=at;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=at):(this._state=Ji,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=at,this.startLoop(r)}))}createError(e,r,n,o,s){this._loop=!1,this._errored=!0;let i=new e(n?`Invalid WebSocket frame: ${r}`:r);return Error.captureStackTrace(i,this.createError),i.code=s,i[rP]=o,i}};I_.exports=Yd});var rf=k((zj,R_)=>{"use strict";var{Duplex:Ij}=require("stream"),{randomFillSync:aP}=require("crypto"),z_=Wo(),{EMPTY_BUFFER:cP,kWebSocket:uP,NOOP:lP}=qt(),{isBlob:jn,isValidStatusCode:dP}=Mn(),{mask:P_,toBuffer:Jr}=Ho(),ct=Symbol("kByteLength"),fP=Buffer.alloc(4),Ki=8*1024,Kr,Dn=Ki,vt=0,pP=1,mP=2,ef=class t{constructor(e,r,n){this._extensions=r||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=vt,this.onerror=lP,this[uP]=void 0}static frame(e,r){let n,o=!1,s=2,i=!1;r.mask&&(n=r.maskBuffer||fP,r.generateMask?r.generateMask(n):(Dn===Ki&&(Kr===void 0&&(Kr=Buffer.alloc(Ki)),aP(Kr,0,Ki),Dn=0),n[0]=Kr[Dn++],n[1]=Kr[Dn++],n[2]=Kr[Dn++],n[3]=Kr[Dn++]),i=(n[0]|n[1]|n[2]|n[3])===0,s=6);let a;typeof e=="string"?(!r.mask||i)&&r[ct]!==void 0?a=r[ct]:(e=Buffer.from(e),a=e.length):(a=e.length,o=r.mask&&r.readOnly&&!i);let c=a;a>=65536?(s+=8,c=127):a>125&&(s+=2,c=126);let u=Buffer.allocUnsafe(o?a+s:s);return u[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(u[0]|=64),u[1]=c,c===126?u.writeUInt16BE(a,2):c===127&&(u[2]=u[3]=0,u.writeUIntBE(a,4,6)),r.mask?(u[1]|=128,u[s-4]=n[0],u[s-3]=n[1],u[s-2]=n[2],u[s-1]=n[3],i?[u,e]:o?(P_(e,n,u,s,a),[u]):(P_(e,n,e,0,a),[u,e])):[u,e]}close(e,r,n,o){let s;if(e===void 0)s=cP;else{if(typeof e!="number"||!dP(e))throw new TypeError("First argument must be a valid error code number");if(r===void 0||!r.length)s=Buffer.allocUnsafe(2),s.writeUInt16BE(e,0);else{let a=Buffer.byteLength(r);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");s=Buffer.allocUnsafe(2+a),s.writeUInt16BE(e,0),typeof r=="string"?s.write(r,2):s.set(r,2)}}let i={[ct]:s.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==vt?this.enqueue([this.dispatch,s,!1,i,o]):this.sendFrame(t.frame(s,i),o)}ping(e,r,n){let o,s;if(typeof e=="string"?(o=Buffer.byteLength(e),s=!1):jn(e)?(o=e.size,s=!1):(e=Jr(e),o=e.length,s=Jr.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let i={[ct]:o,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:9,readOnly:s,rsv1:!1};jn(e)?this._state!==vt?this.enqueue([this.getBlobData,e,!1,i,n]):this.getBlobData(e,!1,i,n):this._state!==vt?this.enqueue([this.dispatch,e,!1,i,n]):this.sendFrame(t.frame(e,i),n)}pong(e,r,n){let o,s;if(typeof e=="string"?(o=Buffer.byteLength(e),s=!1):jn(e)?(o=e.size,s=!1):(e=Jr(e),o=e.length,s=Jr.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let i={[ct]:o,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:10,readOnly:s,rsv1:!1};jn(e)?this._state!==vt?this.enqueue([this.getBlobData,e,!1,i,n]):this.getBlobData(e,!1,i,n):this._state!==vt?this.enqueue([this.dispatch,e,!1,i,n]):this.sendFrame(t.frame(e,i),n)}send(e,r,n){let o=this._extensions[z_.extensionName],s=r.binary?2:1,i=r.compress,a,c;typeof e=="string"?(a=Buffer.byteLength(e),c=!1):jn(e)?(a=e.size,c=!1):(e=Jr(e),a=e.length,c=Jr.readOnly),this._firstFragment?(this._firstFragment=!1,i&&o&&o.params[o._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(i=a>=o._threshold),this._compress=i):(i=!1,s=0),r.fin&&(this._firstFragment=!0);let u={[ct]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:s,readOnly:c,rsv1:i};jn(e)?this._state!==vt?this.enqueue([this.getBlobData,e,this._compress,u,n]):this.getBlobData(e,this._compress,u,n):this._state!==vt?this.enqueue([this.dispatch,e,this._compress,u,n]):this.dispatch(e,this._compress,u,n)}getBlobData(e,r,n,o){this._bufferedBytes+=n[ct],this._state=mP,e.arrayBuffer().then(s=>{if(this._socket.destroyed){let a=new Error("The socket was closed while the blob was being read");process.nextTick(tf,this,a,o);return}this._bufferedBytes-=n[ct];let i=Jr(s);r?this.dispatch(i,r,n,o):(this._state=vt,this.sendFrame(t.frame(i,n),o),this.dequeue())}).catch(s=>{process.nextTick(hP,this,s,o)})}dispatch(e,r,n,o){if(!r){this.sendFrame(t.frame(e,n),o);return}let s=this._extensions[z_.extensionName];this._bufferedBytes+=n[ct],this._state=pP,s.compress(e,n.fin,(i,a)=>{if(this._socket.destroyed){let c=new Error("The socket was closed while data was being compressed");tf(this,c,o);return}this._bufferedBytes-=n[ct],this._state=vt,n.readOnly=!1,this.sendFrame(t.frame(a,n),o),this.dequeue()})}dequeue(){for(;this._state===vt&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][ct],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][ct],this._queue.push(e)}sendFrame(e,r){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],r),this._socket.uncork()):this._socket.write(e[0],r)}};R_.exports=ef;function tf(t,e,r){typeof r=="function"&&r(e);for(let n=0;n<t._queue.length;n++){let o=t._queue[n],s=o[o.length-1];typeof s=="function"&&s(e)}}function hP(t,e,r){tf(t,e,r),t.onerror(e)}});var L_=k((Pj,Z_)=>{"use strict";var{kForOnEventAttribute:Jo,kListener:nf}=qt(),N_=Symbol("kCode"),O_=Symbol("kData"),C_=Symbol("kError"),A_=Symbol("kMessage"),M_=Symbol("kReason"),Zn=Symbol("kTarget"),j_=Symbol("kType"),D_=Symbol("kWasClean"),Vt=class{constructor(e){this[Zn]=null,this[j_]=e}get target(){return this[Zn]}get type(){return this[j_]}};Object.defineProperty(Vt.prototype,"target",{enumerable:!0});Object.defineProperty(Vt.prototype,"type",{enumerable:!0});var Xr=class extends Vt{constructor(e,r={}){super(e),this[N_]=r.code===void 0?0:r.code,this[M_]=r.reason===void 0?"":r.reason,this[D_]=r.wasClean===void 0?!1:r.wasClean}get code(){return this[N_]}get reason(){return this[M_]}get wasClean(){return this[D_]}};Object.defineProperty(Xr.prototype,"code",{enumerable:!0});Object.defineProperty(Xr.prototype,"reason",{enumerable:!0});Object.defineProperty(Xr.prototype,"wasClean",{enumerable:!0});var Ln=class extends Vt{constructor(e,r={}){super(e),this[C_]=r.error===void 0?null:r.error,this[A_]=r.message===void 0?"":r.message}get error(){return this[C_]}get message(){return this[A_]}};Object.defineProperty(Ln.prototype,"error",{enumerable:!0});Object.defineProperty(Ln.prototype,"message",{enumerable:!0});var Ko=class extends Vt{constructor(e,r={}){super(e),this[O_]=r.data===void 0?null:r.data}get data(){return this[O_]}};Object.defineProperty(Ko.prototype,"data",{enumerable:!0});var gP={addEventListener(t,e,r={}){for(let o of this.listeners(t))if(!r[Jo]&&o[nf]===e&&!o[Jo])return;let n;if(t==="message")n=function(s,i){let a=new Ko("message",{data:i?s:s.toString()});a[Zn]=this,Xi(e,this,a)};else if(t==="close")n=function(s,i){let a=new Xr("close",{code:s,reason:i.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[Zn]=this,Xi(e,this,a)};else if(t==="error")n=function(s){let i=new Ln("error",{error:s,message:s.message});i[Zn]=this,Xi(e,this,i)};else if(t==="open")n=function(){let s=new Vt("open");s[Zn]=this,Xi(e,this,s)};else return;n[Jo]=!!r[Jo],n[nf]=e,r.once?this.once(t,n):this.on(t,n)},removeEventListener(t,e){for(let r of this.listeners(t))if(r[nf]===e&&!r[Jo]){this.removeListener(t,r);break}}};Z_.exports={CloseEvent:Xr,ErrorEvent:Ln,Event:Vt,EventTarget:gP,MessageEvent:Ko};function Xi(t,e,r){typeof t=="object"&&t.handleEvent?t.handleEvent.call(t,r):t.call(e,r)}});var of=k((Rj,F_)=>{"use strict";var{tokenChars:Xo}=Mn();function Pt(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}function yP(t){let e=Object.create(null),r=Object.create(null),n=!1,o=!1,s=!1,i,a,c=-1,u=-1,l=-1,d=0;for(;d<t.length;d++)if(u=t.charCodeAt(d),i===void 0)if(l===-1&&Xo[u]===1)c===-1&&(c=d);else if(d!==0&&(u===32||u===9))l===-1&&c!==-1&&(l=d);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);l===-1&&(l=d);let h=t.slice(c,l);u===44?(Pt(e,h,r),r=Object.create(null)):i=h,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${d}`);else if(a===void 0)if(l===-1&&Xo[u]===1)c===-1&&(c=d);else if(u===32||u===9)l===-1&&c!==-1&&(l=d);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);l===-1&&(l=d),Pt(r,t.slice(c,l),!0),u===44&&(Pt(e,i,r),r=Object.create(null),i=void 0),c=l=-1}else if(u===61&&c!==-1&&l===-1)a=t.slice(c,d),c=l=-1;else throw new SyntaxError(`Unexpected character at index ${d}`);else if(o){if(Xo[u]!==1)throw new SyntaxError(`Unexpected character at index ${d}`);c===-1?c=d:n||(n=!0),o=!1}else if(s)if(Xo[u]===1)c===-1&&(c=d);else if(u===34&&c!==-1)s=!1,l=d;else if(u===92)o=!0;else throw new SyntaxError(`Unexpected character at index ${d}`);else if(u===34&&t.charCodeAt(d-1)===61)s=!0;else if(l===-1&&Xo[u]===1)c===-1&&(c=d);else if(c!==-1&&(u===32||u===9))l===-1&&(l=d);else if(u===59||u===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${d}`);l===-1&&(l=d);let h=t.slice(c,l);n&&(h=h.replace(/\\/g,""),n=!1),Pt(r,a,h),u===44&&(Pt(e,i,r),r=Object.create(null),i=void 0),a=void 0,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${d}`);if(c===-1||s||u===32||u===9)throw new SyntaxError("Unexpected end of input");l===-1&&(l=d);let g=t.slice(c,l);return i===void 0?Pt(e,g,r):(a===void 0?Pt(r,g,!0):n?Pt(r,a,g.replace(/\\/g,"")):Pt(r,a,g),Pt(e,i,r)),e}function _P(t){return Object.keys(t).map(e=>{let r=t[e];return Array.isArray(r)||(r=[r]),r.map(n=>[e].concat(Object.keys(n).map(o=>{let s=n[o];return Array.isArray(s)||(s=[s]),s.map(i=>i===!0?o:`${o}=${i}`).join("; ")})).join("; ")).join(", ")}).join(", ")}F_.exports={format:_P,parse:yP}});var ta=k((Cj,Q_)=>{"use strict";var vP=require("events"),bP=require("https"),xP=require("http"),V_=require("net"),wP=require("tls"),{randomBytes:SP,createHash:$P}=require("crypto"),{Duplex:Nj,Readable:Oj}=require("stream"),{URL:sf}=require("url"),pr=Wo(),kP=Qd(),TP=rf(),{isBlob:EP}=Mn(),{BINARY_TYPES:q_,CLOSE_TIMEOUT:IP,EMPTY_BUFFER:Yi,GUID:zP,kForOnEventAttribute:af,kListener:PP,kStatusCode:RP,kWebSocket:we,NOOP:B_}=qt(),{EventTarget:{addEventListener:NP,removeEventListener:OP}}=L_(),{format:CP,parse:AP}=of(),{toBuffer:MP}=Ho(),H_=Symbol("kAborted"),cf=[8,13],Bt=["CONNECTING","OPEN","CLOSING","CLOSED"],jP=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,he=class t extends vP{constructor(e,r,n){super(),this._binaryType=q_[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Yi,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=t.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,r===void 0?r=[]:Array.isArray(r)||(typeof r=="object"&&r!==null?(n=r,r=[]):r=[r]),G_(this,e,r,n)):(this._autoPong=n.autoPong,this._closeTimeout=n.closeTimeout,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){q_.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,r,n){let o=new kP({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation}),s=new TP(e,this._extensions,n.generateMask);this._receiver=o,this._sender=s,this._socket=e,o[we]=this,s[we]=this,e[we]=this,o.on("conclude",LP),o.on("drain",FP),o.on("error",qP),o.on("message",UP),o.on("ping",VP),o.on("pong",BP),s.onerror=HP,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),r.length>0&&e.unshift(r),e.on("close",K_),e.on("data",ea),e.on("end",X_),e.on("error",Y_),this._readyState=t.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[pr.extensionName]&&this._extensions[pr.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,r){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){Xe(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===t.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=t.CLOSING,this._sender.close(e,r,!this._isServer,n=>{n||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),J_(this)}}pause(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){uf(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.ping(e||Yi,r,n)}pong(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){uf(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.pong(e||Yi,r,n)}resume(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(n=r,r={}),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){uf(this,e,n);return}let o={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[pr.extensionName]||(o.compress=!1),this._sender.send(e||Yi,o,n)}terminate(){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){Xe(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=t.CLOSING,this._socket.destroy())}}};Object.defineProperty(he,"CONNECTING",{enumerable:!0,value:Bt.indexOf("CONNECTING")});Object.defineProperty(he.prototype,"CONNECTING",{enumerable:!0,value:Bt.indexOf("CONNECTING")});Object.defineProperty(he,"OPEN",{enumerable:!0,value:Bt.indexOf("OPEN")});Object.defineProperty(he.prototype,"OPEN",{enumerable:!0,value:Bt.indexOf("OPEN")});Object.defineProperty(he,"CLOSING",{enumerable:!0,value:Bt.indexOf("CLOSING")});Object.defineProperty(he.prototype,"CLOSING",{enumerable:!0,value:Bt.indexOf("CLOSING")});Object.defineProperty(he,"CLOSED",{enumerable:!0,value:Bt.indexOf("CLOSED")});Object.defineProperty(he.prototype,"CLOSED",{enumerable:!0,value:Bt.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(t=>{Object.defineProperty(he.prototype,t,{enumerable:!0})});["open","error","close","message"].forEach(t=>{Object.defineProperty(he.prototype,`on${t}`,{enumerable:!0,get(){for(let e of this.listeners(t))if(e[af])return e[PP];return null},set(e){for(let r of this.listeners(t))if(r[af]){this.removeListener(t,r);break}typeof e=="function"&&this.addEventListener(t,e,{[af]:!0})}})});he.prototype.addEventListener=NP;he.prototype.removeEventListener=OP;Q_.exports=he;function G_(t,e,r,n){let o={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:IP,protocolVersion:cf[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=o.autoPong,t._closeTimeout=o.closeTimeout,!cf.includes(o.protocolVersion))throw new RangeError(`Unsupported protocol version: ${o.protocolVersion} (supported versions: ${cf.join(", ")})`);let s;if(e instanceof sf)s=e;else try{s=new sf(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}s.protocol==="http:"?s.protocol="ws:":s.protocol==="https:"&&(s.protocol="wss:"),t._url=s.href;let i=s.protocol==="wss:",a=s.protocol==="ws+unix:",c;if(s.protocol!=="ws:"&&!i&&!a?c=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`:a&&!s.pathname?c="The URL's pathname is empty":s.hash&&(c="The URL contains a fragment identifier"),c){let f=new SyntaxError(c);if(t._redirects===0)throw f;Qi(t,f);return}let u=i?443:80,l=SP(16).toString("base64"),d=i?bP.request:xP.request,g=new Set,h;if(o.createConnection=o.createConnection||(i?ZP:DP),o.defaultPort=o.defaultPort||u,o.port=s.port||u,o.host=s.hostname.startsWith("[")?s.hostname.slice(1,-1):s.hostname,o.headers={...o.headers,"Sec-WebSocket-Version":o.protocolVersion,"Sec-WebSocket-Key":l,Connection:"Upgrade",Upgrade:"websocket"},o.path=s.pathname+s.search,o.timeout=o.handshakeTimeout,o.perMessageDeflate&&(h=new pr(o.perMessageDeflate!==!0?o.perMessageDeflate:{},!1,o.maxPayload),o.headers["Sec-WebSocket-Extensions"]=CP({[pr.extensionName]:h.offer()})),r.length){for(let f of r){if(typeof f!="string"||!jP.test(f)||g.has(f))throw new SyntaxError("An invalid or duplicated subprotocol was specified");g.add(f)}o.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(o.origin&&(o.protocolVersion<13?o.headers["Sec-WebSocket-Origin"]=o.origin:o.headers.Origin=o.origin),(s.username||s.password)&&(o.auth=`${s.username}:${s.password}`),a){let f=o.path.split(":");o.socketPath=f[0],o.path=f[1]}let p;if(o.followRedirects){if(t._redirects===0){t._originalIpc=a,t._originalSecure=i,t._originalHostOrSocketPath=a?o.socketPath:s.host;let f=n&&n.headers;if(n={...n,headers:{}},f)for(let[y,b]of Object.entries(f))n.headers[y.toLowerCase()]=b}else if(t.listenerCount("redirect")===0){let f=a?t._originalIpc?o.socketPath===t._originalHostOrSocketPath:!1:t._originalIpc?!1:s.host===t._originalHostOrSocketPath;(!f||t._originalSecure&&!i)&&(delete o.headers.authorization,delete o.headers.cookie,f||delete o.headers.host,o.auth=void 0)}o.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(o.auth).toString("base64")),p=t._req=d(o),t._redirects&&t.emit("redirect",t.url,p)}else p=t._req=d(o);o.timeout&&p.on("timeout",()=>{Xe(t,p,"Opening handshake has timed out")}),p.on("error",f=>{p===null||p[H_]||(p=t._req=null,Qi(t,f))}),p.on("response",f=>{let y=f.headers.location,b=f.statusCode;if(y&&o.followRedirects&&b>=300&&b<400){if(++t._redirects>o.maxRedirects){Xe(t,p,"Maximum redirects exceeded");return}p.abort();let x;try{x=new sf(y,e)}catch{let z=new SyntaxError(`Invalid URL: ${y}`);Qi(t,z);return}G_(t,x,r,n)}else t.emit("unexpected-response",p,f)||Xe(t,p,`Unexpected server response: ${f.statusCode}`)}),p.on("upgrade",(f,y,b)=>{if(t.emit("upgrade",f),t.readyState!==he.CONNECTING)return;p=t._req=null;let x=f.headers.upgrade;if(x===void 0||x.toLowerCase()!=="websocket"){Xe(t,y,"Invalid Upgrade header");return}let S=$P("sha1").update(l+zP).digest("base64");if(f.headers["sec-websocket-accept"]!==S){Xe(t,y,"Invalid Sec-WebSocket-Accept header");return}let z=f.headers["sec-websocket-protocol"],A;if(z!==void 0?g.size?g.has(z)||(A="Server sent an invalid subprotocol"):A="Server sent a subprotocol but none was requested":g.size&&(A="Server sent no subprotocol"),A){Xe(t,y,A);return}z&&(t._protocol=z);let be=f.headers["sec-websocket-extensions"];if(be!==void 0){if(!h){Xe(t,y,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let Re;try{Re=AP(be)}catch{Xe(t,y,"Invalid Sec-WebSocket-Extensions header");return}let Rt=Object.keys(Re);if(Rt.length!==1||Rt[0]!==pr.extensionName){Xe(t,y,"Server indicated an extension that was not requested");return}try{h.accept(Re[pr.extensionName])}catch{Xe(t,y,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[pr.extensionName]=h}t.setSocket(y,b,{allowSynchronousEvents:o.allowSynchronousEvents,generateMask:o.generateMask,maxPayload:o.maxPayload,skipUTF8Validation:o.skipUTF8Validation})}),o.finishRequest?o.finishRequest(p,t):p.end()}function Qi(t,e){t._readyState=he.CLOSING,t._errorEmitted=!0,t.emit("error",e),t.emitClose()}function DP(t){return t.path=t.socketPath,V_.connect(t)}function ZP(t){return t.path=void 0,!t.servername&&t.servername!==""&&(t.servername=V_.isIP(t.host)?"":t.host),wP.connect(t)}function Xe(t,e,r){t._readyState=he.CLOSING;let n=new Error(r);Error.captureStackTrace(n,Xe),e.setHeader?(e[H_]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(Qi,t,n)):(e.destroy(n),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}function uf(t,e,r){if(e){let n=EP(e)?e.size:MP(e).length;t._socket?t._sender._bufferedBytes+=n:t._bufferedAmount+=n}if(r){let n=new Error(`WebSocket is not open: readyState ${t.readyState} (${Bt[t.readyState]})`);process.nextTick(r,n)}}function LP(t,e){let r=this[we];r._closeFrameReceived=!0,r._closeMessage=e,r._closeCode=t,r._socket[we]!==void 0&&(r._socket.removeListener("data",ea),process.nextTick(W_,r._socket),t===1005?r.close():r.close(t,e))}function FP(){let t=this[we];t.isPaused||t._socket.resume()}function qP(t){let e=this[we];e._socket[we]!==void 0&&(e._socket.removeListener("data",ea),process.nextTick(W_,e._socket),e.close(t[RP])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t))}function U_(){this[we].emitClose()}function UP(t,e){this[we].emit("message",t,e)}function VP(t){let e=this[we];e._autoPong&&e.pong(t,!this._isServer,B_),e.emit("ping",t)}function BP(t){this[we].emit("pong",t)}function W_(t){t.resume()}function HP(t){let e=this[we];e.readyState!==he.CLOSED&&(e.readyState===he.OPEN&&(e._readyState=he.CLOSING,J_(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t)))}function J_(t){t._closeTimer=setTimeout(t._socket.destroy.bind(t._socket),t._closeTimeout)}function K_(){let t=this[we];if(this.removeListener("close",K_),this.removeListener("data",ea),this.removeListener("end",X_),t._readyState=he.CLOSING,!this._readableState.endEmitted&&!t._closeFrameReceived&&!t._receiver._writableState.errorEmitted&&this._readableState.length!==0){let e=this.read(this._readableState.length);t._receiver.write(e)}t._receiver.end(),this[we]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",U_),t._receiver.on("finish",U_))}function ea(t){this[we]._receiver.write(t)||this.pause()}function X_(){let t=this[we];t._readyState=he.CLOSING,t._receiver.end(),this.end()}function Y_(){let t=this[we];this.removeListener("error",Y_),this.on("error",B_),t&&(t._readyState=he.CLOSING,this.destroy())}});var nv=k((Mj,rv)=>{"use strict";var Aj=ta(),{Duplex:GP}=require("stream");function ev(t){t.emit("close")}function WP(){!this.destroyed&&this._writableState.finished&&this.destroy()}function tv(t){this.removeListener("error",tv),this.destroy(),this.listenerCount("error")===0&&this.emit("error",t)}function JP(t,e){let r=!0,n=new GP({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return t.on("message",function(s,i){let a=!i&&n._readableState.objectMode?s.toString():s;n.push(a)||t.pause()}),t.once("error",function(s){n.destroyed||(r=!1,n.destroy(s))}),t.once("close",function(){n.destroyed||n.push(null)}),n._destroy=function(o,s){if(t.readyState===t.CLOSED){s(o),process.nextTick(ev,n);return}let i=!1;t.once("error",function(c){i=!0,s(c)}),t.once("close",function(){i||s(o),process.nextTick(ev,n)}),r&&t.terminate()},n._final=function(o){if(t.readyState===t.CONNECTING){t.once("open",function(){n._final(o)});return}t._socket!==null&&(t._socket._writableState.finished?(o(),n._readableState.endEmitted&&n.destroy()):(t._socket.once("finish",function(){o()}),t.close()))},n._read=function(){t.isPaused&&t.resume()},n._write=function(o,s,i){if(t.readyState===t.CONNECTING){t.once("open",function(){n._write(o,s,i)});return}t.send(o,i)},n.on("end",WP),n.on("error",tv),n}rv.exports=JP});var sv=k((jj,ov)=>{"use strict";var{tokenChars:KP}=Mn();function XP(t){let e=new Set,r=-1,n=-1,o=0;for(o;o<t.length;o++){let i=t.charCodeAt(o);if(n===-1&&KP[i]===1)r===-1&&(r=o);else if(o!==0&&(i===32||i===9))n===-1&&r!==-1&&(n=o);else if(i===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${o}`);n===-1&&(n=o);let a=t.slice(r,n);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),r=n=-1}else throw new SyntaxError(`Unexpected character at index ${o}`)}if(r===-1||n!==-1)throw new SyntaxError("Unexpected end of input");let s=t.slice(r,o);if(e.has(s))throw new SyntaxError(`The "${s}" subprotocol is duplicated`);return e.add(s),e}ov.exports={parse:XP}});var fv=k((Zj,dv)=>{"use strict";var YP=require("events"),ra=require("http"),{Duplex:Dj}=require("stream"),{createHash:QP}=require("crypto"),iv=of(),Yr=Wo(),eR=sv(),tR=ta(),{CLOSE_TIMEOUT:rR,GUID:nR,kWebSocket:oR}=qt(),sR=/^[+/0-9A-Za-z]{22}==$/,av=0,cv=1,lv=2,lf=class extends YP{constructor(e,r){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:rR,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:tR,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=ra.createServer((n,o)=>{let s=ra.STATUS_CODES[426];o.writeHead(426,{"Content-Length":s.length,"Content-Type":"text/plain"}),o.end(s)}),this._server.listen(e.port,e.host,e.backlog,r)):e.server&&(this._server=e.server),this._server){let n=this.emit.bind(this,"connection");this._removeListeners=iR(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(o,s,i)=>{this.handleUpgrade(o,s,i,n)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=av}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===lv){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(Yo,this);return}if(e&&this.once("close",e),this._state!==cv)if(this._state=cv,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Yo,this):process.nextTick(Yo,this);else{let r=this._server;this._removeListeners(),this._removeListeners=this._server=null,r.close(()=>{Yo(this)})}}shouldHandle(e){if(this.options.path){let r=e.url.indexOf("?");if((r!==-1?e.url.slice(0,r):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,r,n,o){r.on("error",uv);let s=e.headers["sec-websocket-key"],i=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){Qr(this,e,r,405,"Invalid HTTP method");return}if(i===void 0||i.toLowerCase()!=="websocket"){Qr(this,e,r,400,"Invalid Upgrade header");return}if(s===void 0||!sR.test(s)){Qr(this,e,r,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==13&&a!==8){Qr(this,e,r,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(e)){Qo(r,400);return}let c=e.headers["sec-websocket-protocol"],u=new Set;if(c!==void 0)try{u=eR.parse(c)}catch{Qr(this,e,r,400,"Invalid Sec-WebSocket-Protocol header");return}let l=e.headers["sec-websocket-extensions"],d={};if(this.options.perMessageDeflate&&l!==void 0){let g=new Yr(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let h=iv.parse(l);h[Yr.extensionName]&&(g.accept(h[Yr.extensionName]),d[Yr.extensionName]=g)}catch{Qr(this,e,r,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let g={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(g,(h,p,f,y)=>{if(!h)return Qo(r,p||401,f,y);this.completeUpgrade(d,s,u,e,r,n,o)});return}if(!this.options.verifyClient(g))return Qo(r,401)}this.completeUpgrade(d,s,u,e,r,n,o)}completeUpgrade(e,r,n,o,s,i,a){if(!s.readable||!s.writable)return s.destroy();if(s[oR])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>av)return Qo(s,503);let u=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${QP("sha1").update(r+nR).digest("base64")}`],l=new this.options.WebSocket(null,void 0,this.options);if(n.size){let d=this.options.handleProtocols?this.options.handleProtocols(n,o):n.values().next().value;d&&(u.push(`Sec-WebSocket-Protocol: ${d}`),l._protocol=d)}if(e[Yr.extensionName]){let d=e[Yr.extensionName].params,g=iv.format({[Yr.extensionName]:[d]});u.push(`Sec-WebSocket-Extensions: ${g}`),l._extensions=e}this.emit("headers",u,o),s.write(u.concat(`\r
`).join(`\r
`)),s.removeListener("error",uv),l.setSocket(s,i,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(l),l.on("close",()=>{this.clients.delete(l),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Yo,this)})),a(l,o)}};dv.exports=lf;function iR(t,e){for(let r of Object.keys(e))t.on(r,e[r]);return function(){for(let n of Object.keys(e))t.removeListener(n,e[n])}}function Yo(t){t._state=lv,t.emit("close")}function uv(){this.destroy()}function Qo(t,e,r,n){r=r||ra.STATUS_CODES[e],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...n},t.once("finish",t.destroy),t.end(`HTTP/1.1 ${e} ${ra.STATUS_CODES[e]}\r
`+Object.keys(n).map(o=>`${o}: ${n[o]}`).join(`\r
`)+`\r
\r
`+r)}function Qr(t,e,r,n,o,s){if(t.listenerCount("wsClientError")){let i=new Error(o);Error.captureStackTrace(i,Qr),t.emit("wsClientError",i,r,e)}else Qo(r,n,o,s)}});var m={};la(m,{BRAND:()=>yb,DIRTY:()=>gr,EMPTY_PATH:()=>Jv,INVALID:()=>D,NEVER:()=>ex,OK:()=>Ne,ParseStatus:()=>Se,Schema:()=>V,ZodAny:()=>Jt,ZodArray:()=>At,ZodBigInt:()=>_r,ZodBoolean:()=>vr,ZodBranded:()=>Un,ZodCatch:()=>Pr,ZodDate:()=>br,ZodDefault:()=>zr,ZodDiscriminatedUnion:()=>rs,ZodEffects:()=>Qe,ZodEnum:()=>Er,ZodError:()=>Le,ZodFirstPartyTypeKind:()=>$,ZodFunction:()=>os,ZodIntersection:()=>$r,ZodIssueCode:()=>w,ZodLazy:()=>kr,ZodLiteral:()=>Tr,ZodMap:()=>an,ZodNaN:()=>un,ZodNativeEnum:()=>Ir,ZodNever:()=>lt,ZodNull:()=>wr,ZodNullable:()=>wt,ZodNumber:()=>yr,ZodObject:()=>qe,ZodOptional:()=>Fe,ZodParsedType:()=>I,ZodPipeline:()=>Vn,ZodPromise:()=>Kt,ZodReadonly:()=>Rr,ZodRecord:()=>ns,ZodSchema:()=>V,ZodSet:()=>cn,ZodString:()=>Wt,ZodSymbol:()=>on,ZodTransformer:()=>Qe,ZodTuple:()=>xt,ZodType:()=>V,ZodUndefined:()=>xr,ZodUnion:()=>Sr,ZodUnknown:()=>Ct,ZodVoid:()=>sn,addIssueToContext:()=>T,any:()=>Tb,array:()=>Pb,bigint:()=>xb,boolean:()=>zf,coerce:()=>Qb,custom:()=>Tf,date:()=>wb,datetimeRegex:()=>$f,defaultErrorMap:()=>Nt,discriminatedUnion:()=>Ob,effect:()=>Bb,enum:()=>qb,function:()=>Zb,getErrorMap:()=>tn,getParsedType:()=>bt,instanceof:()=>vb,intersection:()=>Cb,isAborted:()=>es,isAsync:()=>rn,isDirty:()=>ts,isValid:()=>Gt,late:()=>_b,lazy:()=>Lb,literal:()=>Fb,makeIssue:()=>qn,map:()=>jb,nan:()=>bb,nativeEnum:()=>Ub,never:()=>Ib,null:()=>kb,nullable:()=>Gb,number:()=>If,object:()=>ma,objectUtil:()=>da,oboolean:()=>Yb,onumber:()=>Xb,optional:()=>Hb,ostring:()=>Kb,pipeline:()=>Jb,preprocess:()=>Wb,promise:()=>Vb,quotelessJson:()=>Hv,record:()=>Mb,set:()=>Db,setErrorMap:()=>Wv,strictObject:()=>Rb,string:()=>Ef,symbol:()=>Sb,transformer:()=>Bb,tuple:()=>Ab,undefined:()=>$b,union:()=>Nb,unknown:()=>Eb,util:()=>W,void:()=>zb});var W;(function(t){t.assertEqual=o=>{};function e(o){}t.assertIs=e;function r(o){throw new Error}t.assertNever=r,t.arrayToEnum=o=>{let s={};for(let i of o)s[i]=i;return s},t.getValidEnumValues=o=>{let s=t.objectKeys(o).filter(a=>typeof o[o[a]]!="number"),i={};for(let a of s)i[a]=o[a];return t.objectValues(i)},t.objectValues=o=>t.objectKeys(o).map(function(s){return o[s]}),t.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{let s=[];for(let i in o)Object.prototype.hasOwnProperty.call(o,i)&&s.push(i);return s},t.find=(o,s)=>{for(let i of o)if(s(i))return i},t.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&Number.isFinite(o)&&Math.floor(o)===o;function n(o,s=" | "){return o.map(i=>typeof i=="string"?`'${i}'`:i).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(o,s)=>typeof s=="bigint"?s.toString():s})(W||(W={}));var da;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(da||(da={}));var I=W.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),bt=t=>{switch(typeof t){case"undefined":return I.undefined;case"string":return I.string;case"number":return Number.isNaN(t)?I.nan:I.number;case"boolean":return I.boolean;case"function":return I.function;case"bigint":return I.bigint;case"symbol":return I.symbol;case"object":return Array.isArray(t)?I.array:t===null?I.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?I.promise:typeof Map<"u"&&t instanceof Map?I.map:typeof Set<"u"&&t instanceof Set?I.set:typeof Date<"u"&&t instanceof Date?I.date:I.object;default:return I.unknown}};var w=W.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Hv=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Le=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},o=s=>{for(let i of s.issues)if(i.code==="invalid_union")i.unionErrors.map(o);else if(i.code==="invalid_return_type")o(i.returnTypeError);else if(i.code==="invalid_arguments")o(i.argumentsError);else if(i.path.length===0)n._errors.push(r(i));else{let a=n,c=0;for(;c<i.path.length;){let u=i.path[c];c===i.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(i))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return o(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,W.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let o of this.issues)if(o.path.length>0){let s=o.path[0];r[s]=r[s]||[],r[s].push(e(o))}else n.push(e(o));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Le.create=t=>new Le(t);var Gv=(t,e)=>{let r;switch(t.code){case w.invalid_type:t.received===I.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case w.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,W.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:r=`Unrecognized key(s) in object: ${W.joinValues(t.keys,", ")}`;break;case w.invalid_union:r="Invalid input";break;case w.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${W.joinValues(t.options)}`;break;case w.invalid_enum_value:r=`Invalid enum value. Expected ${W.joinValues(t.options)}, received '${t.received}'`;break;case w.invalid_arguments:r="Invalid function arguments";break;case w.invalid_return_type:r="Invalid function return type";break;case w.invalid_date:r="Invalid date";break;case w.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:W.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case w.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case w.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case w.custom:r="Invalid input";break;case w.invalid_intersection_types:r="Intersection results could not be merged";break;case w.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case w.not_finite:r="Number must be finite";break;default:r=e.defaultError,W.assertNever(t)}return{message:r}},Nt=Gv;var vf=Nt;function Wv(t){vf=t}function tn(){return vf}var qn=t=>{let{data:e,path:r,errorMaps:n,issueData:o}=t,s=[...r,...o.path||[]],i={...o,path:s};if(o.message!==void 0)return{...o,path:s,message:o.message};let a="",c=n.filter(u=>!!u).slice().reverse();for(let u of c)a=u(i,{data:e,defaultError:a}).message;return{...o,path:s,message:a}},Jv=[];function T(t,e){let r=tn(),n=qn({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Nt?void 0:Nt].filter(o=>!!o)});t.common.issues.push(n)}var Se=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let o of r){if(o.status==="aborted")return D;o.status==="dirty"&&e.dirty(),n.push(o.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let o of r){let s=await o.key,i=await o.value;n.push({key:s,value:i})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let o of r){let{key:s,value:i}=o;if(s.status==="aborted"||i.status==="aborted")return D;s.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof i.value<"u"||o.alwaysSet)&&(n[s.value]=i.value)}return{status:e.value,value:n}}},D=Object.freeze({status:"aborted"}),gr=t=>({status:"dirty",value:t}),Ne=t=>({status:"valid",value:t}),es=t=>t.status==="aborted",ts=t=>t.status==="dirty",Gt=t=>t.status==="valid",rn=t=>typeof Promise<"u"&&t instanceof Promise;var R;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(R||(R={}));var Ye=class{constructor(e,r,n,o){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},bf=(t,e)=>{if(Gt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Le(t.common.issues);return this._error=r,this._error}}};function q(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:o}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:o}:{errorMap:(i,a)=>{let{message:c}=t;return i.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??n??a.defaultError}:i.code!=="invalid_type"?{message:a.defaultError}:{message:c??r??a.defaultError}},description:o}}var V=class{get description(){return this._def.description}_getType(e){return bt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:bt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Se,ctx:{common:e.parent.common,data:e.data,parsedType:bt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(rn(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){let n={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:bt(e)},o=this._parseSync({data:e,path:n.path,parent:n});return bf(n,o)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:bt(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:r});return Gt(n)?{value:n.value}:{issues:r.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(n=>Gt(n)?{value:n.value}:{issues:r.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:bt(e)},o=this._parse({data:e,path:n.path,parent:n}),s=await(rn(o)?o:Promise.resolve(o));return bf(n,s)}refine(e,r){let n=o=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(o):r;return this._refinement((o,s)=>{let i=e(o),a=()=>s.addIssue({code:w.custom,...n(o)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(a(),!1)):i?!0:(a(),!1)})}refinement(e,r){return this._refinement((n,o)=>e(n)?!0:(o.addIssue(typeof r=="function"?r(n,o):r),!1))}_refinement(e){return new Qe({schema:this,typeName:$.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Fe.create(this,this._def)}nullable(){return wt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return At.create(this)}promise(){return Kt.create(this,this._def)}or(e){return Sr.create([this,e],this._def)}and(e){return $r.create(this,e,this._def)}transform(e){return new Qe({...q(this._def),schema:this,typeName:$.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new zr({...q(this._def),innerType:this,defaultValue:r,typeName:$.ZodDefault})}brand(){return new Un({typeName:$.ZodBranded,type:this,...q(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Pr({...q(this._def),innerType:this,catchValue:r,typeName:$.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Vn.create(this,e)}readonly(){return Rr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Kv=/^c[^\s-]{8,}$/i,Xv=/^[0-9a-z]+$/,Yv=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Qv=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,eb=/^[a-z0-9_-]{21}$/i,tb=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,rb=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,nb=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,ob="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",fa,sb=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ib=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ab=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,cb=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ub=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,lb=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,wf="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",db=new RegExp(`^${wf}$`);function Sf(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function fb(t){return new RegExp(`^${Sf(t)}$`)}function $f(t){let e=`${wf}T${Sf(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function pb(t,e){return!!((e==="v4"||!e)&&sb.test(t)||(e==="v6"||!e)&&ab.test(t))}function mb(t,e){if(!tb.test(t))return!1;try{let[r]=t.split(".");if(!r)return!1;let n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),o=JSON.parse(atob(n));return!(typeof o!="object"||o===null||"typ"in o&&o?.typ!=="JWT"||!o.alg||e&&o.alg!==e)}catch{return!1}}function hb(t,e){return!!((e==="v4"||!e)&&ib.test(t)||(e==="v6"||!e)&&cb.test(t))}var Wt=class t extends V{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==I.string){let s=this._getOrReturnCtx(e);return T(s,{code:w.invalid_type,expected:I.string,received:s.parsedType}),D}let n=new Se,o;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(o=this._getOrReturnCtx(e,o),T(o,{code:w.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(o=this._getOrReturnCtx(e,o),T(o,{code:w.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let i=e.data.length>s.value,a=e.data.length<s.value;(i||a)&&(o=this._getOrReturnCtx(e,o),i?T(o,{code:w.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&T(o,{code:w.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")nb.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"email",code:w.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")fa||(fa=new RegExp(ob,"u")),fa.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"emoji",code:w.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")Qv.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"uuid",code:w.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")eb.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"nanoid",code:w.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")Kv.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"cuid",code:w.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")Xv.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"cuid2",code:w.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")Yv.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"ulid",code:w.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{o=this._getOrReturnCtx(e,o),T(o,{validation:"url",code:w.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"regex",code:w.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(o=this._getOrReturnCtx(e,o),T(o,{code:w.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(o=this._getOrReturnCtx(e,o),T(o,{code:w.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(o=this._getOrReturnCtx(e,o),T(o,{code:w.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?$f(s).test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{code:w.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?db.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{code:w.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?fb(s).test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{code:w.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?rb.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"duration",code:w.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?pb(e.data,s.version)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"ip",code:w.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?mb(e.data,s.alg)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"jwt",code:w.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?hb(e.data,s.version)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"cidr",code:w.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?ub.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"base64",code:w.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?lb.test(e.data)||(o=this._getOrReturnCtx(e,o),T(o,{validation:"base64url",code:w.invalid_string,message:s.message}),n.dirty()):W.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(o=>e.test(o),{validation:r,code:w.invalid_string,...R.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...R.errToObj(e)})}url(e){return this._addCheck({kind:"url",...R.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...R.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...R.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...R.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...R.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...R.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...R.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...R.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...R.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...R.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...R.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...R.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...R.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...R.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...R.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...R.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...R.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...R.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...R.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...R.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...R.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...R.errToObj(r)})}nonempty(e){return this.min(1,R.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Wt.create=t=>new Wt({checks:[],typeName:$.ZodString,coerce:t?.coerce??!1,...q(t)});function gb(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,o=r>n?r:n,s=Number.parseInt(t.toFixed(o).replace(".","")),i=Number.parseInt(e.toFixed(o).replace(".",""));return s%i/10**o}var yr=class t extends V{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==I.number){let s=this._getOrReturnCtx(e);return T(s,{code:w.invalid_type,expected:I.number,received:s.parsedType}),D}let n,o=new Se;for(let s of this._def.checks)s.kind==="int"?W.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),T(n,{code:w.invalid_type,expected:"integer",received:"float",message:s.message}),o.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),T(n,{code:w.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),T(n,{code:w.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="multipleOf"?gb(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),T(n,{code:w.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),T(n,{code:w.not_finite,message:s.message}),o.dirty()):W.assertNever(s);return{status:o.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,R.toString(r))}gt(e,r){return this.setLimit("min",e,!1,R.toString(r))}lte(e,r){return this.setLimit("max",e,!0,R.toString(r))}lt(e,r){return this.setLimit("max",e,!1,R.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:R.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:R.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:R.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:R.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:R.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:R.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&W.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};yr.create=t=>new yr({checks:[],typeName:$.ZodNumber,coerce:t?.coerce||!1,...q(t)});var _r=class t extends V{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==I.bigint)return this._getInvalidInput(e);let n,o=new Se;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),T(n,{code:w.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),T(n,{code:w.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),T(n,{code:w.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):W.assertNever(s);return{status:o.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return T(r,{code:w.invalid_type,expected:I.bigint,received:r.parsedType}),D}gte(e,r){return this.setLimit("min",e,!0,R.toString(r))}gt(e,r){return this.setLimit("min",e,!1,R.toString(r))}lte(e,r){return this.setLimit("max",e,!0,R.toString(r))}lt(e,r){return this.setLimit("max",e,!1,R.toString(r))}setLimit(e,r,n,o){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:R.toString(o)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:R.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};_r.create=t=>new _r({checks:[],typeName:$.ZodBigInt,coerce:t?.coerce??!1,...q(t)});var vr=class extends V{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==I.boolean){let n=this._getOrReturnCtx(e);return T(n,{code:w.invalid_type,expected:I.boolean,received:n.parsedType}),D}return Ne(e.data)}};vr.create=t=>new vr({typeName:$.ZodBoolean,coerce:t?.coerce||!1,...q(t)});var br=class t extends V{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==I.date){let s=this._getOrReturnCtx(e);return T(s,{code:w.invalid_type,expected:I.date,received:s.parsedType}),D}if(Number.isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return T(s,{code:w.invalid_date}),D}let n=new Se,o;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(o=this._getOrReturnCtx(e,o),T(o,{code:w.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(o=this._getOrReturnCtx(e,o),T(o,{code:w.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):W.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:R.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:R.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};br.create=t=>new br({checks:[],coerce:t?.coerce||!1,typeName:$.ZodDate,...q(t)});var on=class extends V{_parse(e){if(this._getType(e)!==I.symbol){let n=this._getOrReturnCtx(e);return T(n,{code:w.invalid_type,expected:I.symbol,received:n.parsedType}),D}return Ne(e.data)}};on.create=t=>new on({typeName:$.ZodSymbol,...q(t)});var xr=class extends V{_parse(e){if(this._getType(e)!==I.undefined){let n=this._getOrReturnCtx(e);return T(n,{code:w.invalid_type,expected:I.undefined,received:n.parsedType}),D}return Ne(e.data)}};xr.create=t=>new xr({typeName:$.ZodUndefined,...q(t)});var wr=class extends V{_parse(e){if(this._getType(e)!==I.null){let n=this._getOrReturnCtx(e);return T(n,{code:w.invalid_type,expected:I.null,received:n.parsedType}),D}return Ne(e.data)}};wr.create=t=>new wr({typeName:$.ZodNull,...q(t)});var Jt=class extends V{constructor(){super(...arguments),this._any=!0}_parse(e){return Ne(e.data)}};Jt.create=t=>new Jt({typeName:$.ZodAny,...q(t)});var Ct=class extends V{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ne(e.data)}};Ct.create=t=>new Ct({typeName:$.ZodUnknown,...q(t)});var lt=class extends V{_parse(e){let r=this._getOrReturnCtx(e);return T(r,{code:w.invalid_type,expected:I.never,received:r.parsedType}),D}};lt.create=t=>new lt({typeName:$.ZodNever,...q(t)});var sn=class extends V{_parse(e){if(this._getType(e)!==I.undefined){let n=this._getOrReturnCtx(e);return T(n,{code:w.invalid_type,expected:I.void,received:n.parsedType}),D}return Ne(e.data)}};sn.create=t=>new sn({typeName:$.ZodVoid,...q(t)});var At=class t extends V{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),o=this._def;if(r.parsedType!==I.array)return T(r,{code:w.invalid_type,expected:I.array,received:r.parsedType}),D;if(o.exactLength!==null){let i=r.data.length>o.exactLength.value,a=r.data.length<o.exactLength.value;(i||a)&&(T(r,{code:i?w.too_big:w.too_small,minimum:a?o.exactLength.value:void 0,maximum:i?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),n.dirty())}if(o.minLength!==null&&r.data.length<o.minLength.value&&(T(r,{code:w.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),n.dirty()),o.maxLength!==null&&r.data.length>o.maxLength.value&&(T(r,{code:w.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((i,a)=>o.type._parseAsync(new Ye(r,i,r.path,a)))).then(i=>Se.mergeArray(n,i));let s=[...r.data].map((i,a)=>o.type._parseSync(new Ye(r,i,r.path,a)));return Se.mergeArray(n,s)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:R.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:R.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:R.toString(r)}})}nonempty(e){return this.min(1,e)}};At.create=(t,e)=>new At({type:t,minLength:null,maxLength:null,exactLength:null,typeName:$.ZodArray,...q(e)});function nn(t){if(t instanceof qe){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=Fe.create(nn(n))}return new qe({...t._def,shape:()=>e})}else return t instanceof At?new At({...t._def,type:nn(t.element)}):t instanceof Fe?Fe.create(nn(t.unwrap())):t instanceof wt?wt.create(nn(t.unwrap())):t instanceof xt?xt.create(t.items.map(e=>nn(e))):t}var qe=class t extends V{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=W.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==I.object){let u=this._getOrReturnCtx(e);return T(u,{code:w.invalid_type,expected:I.object,received:u.parsedType}),D}let{status:n,ctx:o}=this._processInputParams(e),{shape:s,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof lt&&this._def.unknownKeys==="strip"))for(let u in o.data)i.includes(u)||a.push(u);let c=[];for(let u of i){let l=s[u],d=o.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new Ye(o,d,o.path,u)),alwaysSet:u in o.data})}if(this._def.catchall instanceof lt){let u=this._def.unknownKeys;if(u==="passthrough")for(let l of a)c.push({key:{status:"valid",value:l},value:{status:"valid",value:o.data[l]}});else if(u==="strict")a.length>0&&(T(o,{code:w.unrecognized_keys,keys:a}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let l of a){let d=o.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new Ye(o,d,o.path,l)),alwaysSet:l in o.data})}}return o.common.async?Promise.resolve().then(async()=>{let u=[];for(let l of c){let d=await l.key,g=await l.value;u.push({key:d,value:g,alwaysSet:l.alwaysSet})}return u}).then(u=>Se.mergeObjectSync(n,u)):Se.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return R.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{let o=this._def.errorMap?.(r,n).message??n.defaultError;return r.code==="unrecognized_keys"?{message:R.errToObj(e).message??o}:{message:o}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:$.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};for(let n of W.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}omit(e){let r={};for(let n of W.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}deepPartial(){return nn(this)}partial(e){let r={};for(let n of W.objectKeys(this.shape)){let o=this.shape[n];e&&!e[n]?r[n]=o:r[n]=o.optional()}return new t({...this._def,shape:()=>r})}required(e){let r={};for(let n of W.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof Fe;)s=s._def.innerType;r[n]=s}return new t({...this._def,shape:()=>r})}keyof(){return kf(W.objectKeys(this.shape))}};qe.create=(t,e)=>new qe({shape:()=>t,unknownKeys:"strip",catchall:lt.create(),typeName:$.ZodObject,...q(e)});qe.strictCreate=(t,e)=>new qe({shape:()=>t,unknownKeys:"strict",catchall:lt.create(),typeName:$.ZodObject,...q(e)});qe.lazycreate=(t,e)=>new qe({shape:t,unknownKeys:"strip",catchall:lt.create(),typeName:$.ZodObject,...q(e)});var Sr=class extends V{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function o(s){for(let a of s)if(a.result.status==="valid")return a.result;for(let a of s)if(a.result.status==="dirty")return r.common.issues.push(...a.ctx.common.issues),a.result;let i=s.map(a=>new Le(a.ctx.common.issues));return T(r,{code:w.invalid_union,unionErrors:i}),D}if(r.common.async)return Promise.all(n.map(async s=>{let i={...r,common:{...r.common,issues:[]},parent:null};return{result:await s._parseAsync({data:r.data,path:r.path,parent:i}),ctx:i}})).then(o);{let s,i=[];for(let c of n){let u={...r,common:{...r.common,issues:[]},parent:null},l=c._parseSync({data:r.data,path:r.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!s&&(s={result:l,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(s)return r.common.issues.push(...s.ctx.common.issues),s.result;let a=i.map(c=>new Le(c));return T(r,{code:w.invalid_union,unionErrors:a}),D}}get options(){return this._def.options}};Sr.create=(t,e)=>new Sr({options:t,typeName:$.ZodUnion,...q(e)});var Ot=t=>t instanceof kr?Ot(t.schema):t instanceof Qe?Ot(t.innerType()):t instanceof Tr?[t.value]:t instanceof Er?t.options:t instanceof Ir?W.objectValues(t.enum):t instanceof zr?Ot(t._def.innerType):t instanceof xr?[void 0]:t instanceof wr?[null]:t instanceof Fe?[void 0,...Ot(t.unwrap())]:t instanceof wt?[null,...Ot(t.unwrap())]:t instanceof Un||t instanceof Rr?Ot(t.unwrap()):t instanceof Pr?Ot(t._def.innerType):[],rs=class t extends V{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==I.object)return T(r,{code:w.invalid_type,expected:I.object,received:r.parsedType}),D;let n=this.discriminator,o=r.data[n],s=this.optionsMap.get(o);return s?r.common.async?s._parseAsync({data:r.data,path:r.path,parent:r}):s._parseSync({data:r.data,path:r.path,parent:r}):(T(r,{code:w.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),D)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let o=new Map;for(let s of r){let i=Ot(s.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of i){if(o.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);o.set(a,s)}}return new t({typeName:$.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:o,...q(n)})}};function pa(t,e){let r=bt(t),n=bt(e);if(t===e)return{valid:!0,data:t};if(r===I.object&&n===I.object){let o=W.objectKeys(e),s=W.objectKeys(t).filter(a=>o.indexOf(a)!==-1),i={...t,...e};for(let a of s){let c=pa(t[a],e[a]);if(!c.valid)return{valid:!1};i[a]=c.data}return{valid:!0,data:i}}else if(r===I.array&&n===I.array){if(t.length!==e.length)return{valid:!1};let o=[];for(let s=0;s<t.length;s++){let i=t[s],a=e[s],c=pa(i,a);if(!c.valid)return{valid:!1};o.push(c.data)}return{valid:!0,data:o}}else return r===I.date&&n===I.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var $r=class extends V{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=(s,i)=>{if(es(s)||es(i))return D;let a=pa(s.value,i.value);return a.valid?((ts(s)||ts(i))&&r.dirty(),{status:r.value,value:a.data}):(T(n,{code:w.invalid_intersection_types}),D)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,i])=>o(s,i)):o(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};$r.create=(t,e,r)=>new $r({left:t,right:e,typeName:$.ZodIntersection,...q(r)});var xt=class t extends V{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==I.array)return T(n,{code:w.invalid_type,expected:I.array,received:n.parsedType}),D;if(n.data.length<this._def.items.length)return T(n,{code:w.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),D;!this._def.rest&&n.data.length>this._def.items.length&&(T(n,{code:w.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let s=[...n.data].map((i,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new Ye(n,i,n.path,a)):null}).filter(i=>!!i);return n.common.async?Promise.all(s).then(i=>Se.mergeArray(r,i)):Se.mergeArray(r,s)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};xt.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new xt({items:t,typeName:$.ZodTuple,rest:null,...q(e)})};var ns=class t extends V{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==I.object)return T(n,{code:w.invalid_type,expected:I.object,received:n.parsedType}),D;let o=[],s=this._def.keyType,i=this._def.valueType;for(let a in n.data)o.push({key:s._parse(new Ye(n,a,n.path,a)),value:i._parse(new Ye(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?Se.mergeObjectAsync(r,o):Se.mergeObjectSync(r,o)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof V?new t({keyType:e,valueType:r,typeName:$.ZodRecord,...q(n)}):new t({keyType:Wt.create(),valueType:e,typeName:$.ZodRecord,...q(r)})}},an=class extends V{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==I.map)return T(n,{code:w.invalid_type,expected:I.map,received:n.parsedType}),D;let o=this._def.keyType,s=this._def.valueType,i=[...n.data.entries()].map(([a,c],u)=>({key:o._parse(new Ye(n,a,n.path,[u,"key"])),value:s._parse(new Ye(n,c,n.path,[u,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of i){let u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return D;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}})}else{let a=new Map;for(let c of i){let u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return D;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}}}};an.create=(t,e,r)=>new an({valueType:e,keyType:t,typeName:$.ZodMap,...q(r)});var cn=class t extends V{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==I.set)return T(n,{code:w.invalid_type,expected:I.set,received:n.parsedType}),D;let o=this._def;o.minSize!==null&&n.data.size<o.minSize.value&&(T(n,{code:w.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),r.dirty()),o.maxSize!==null&&n.data.size>o.maxSize.value&&(T(n,{code:w.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),r.dirty());let s=this._def.valueType;function i(c){let u=new Set;for(let l of c){if(l.status==="aborted")return D;l.status==="dirty"&&r.dirty(),u.add(l.value)}return{status:r.value,value:u}}let a=[...n.data.values()].map((c,u)=>s._parse(new Ye(n,c,n.path,u)));return n.common.async?Promise.all(a).then(c=>i(c)):i(a)}min(e,r){return new t({...this._def,minSize:{value:e,message:R.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:R.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};cn.create=(t,e)=>new cn({valueType:t,minSize:null,maxSize:null,typeName:$.ZodSet,...q(e)});var os=class t extends V{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==I.function)return T(r,{code:w.invalid_type,expected:I.function,received:r.parsedType}),D;function n(a,c){return qn({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,tn(),Nt].filter(u=>!!u),issueData:{code:w.invalid_arguments,argumentsError:c}})}function o(a,c){return qn({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,tn(),Nt].filter(u=>!!u),issueData:{code:w.invalid_return_type,returnTypeError:c}})}let s={errorMap:r.common.contextualErrorMap},i=r.data;if(this._def.returns instanceof Kt){let a=this;return Ne(async function(...c){let u=new Le([]),l=await a._def.args.parseAsync(c,s).catch(h=>{throw u.addIssue(n(c,h)),u}),d=await Reflect.apply(i,this,l);return await a._def.returns._def.type.parseAsync(d,s).catch(h=>{throw u.addIssue(o(d,h)),u})})}else{let a=this;return Ne(function(...c){let u=a._def.args.safeParse(c,s);if(!u.success)throw new Le([n(c,u.error)]);let l=Reflect.apply(i,this,u.data),d=a._def.returns.safeParse(l,s);if(!d.success)throw new Le([o(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:xt.create(e).rest(Ct.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||xt.create([]).rest(Ct.create()),returns:r||Ct.create(),typeName:$.ZodFunction,...q(n)})}},kr=class extends V{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};kr.create=(t,e)=>new kr({getter:t,typeName:$.ZodLazy,...q(e)});var Tr=class extends V{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return T(r,{received:r.data,code:w.invalid_literal,expected:this._def.value}),D}return{status:"valid",value:e.data}}get value(){return this._def.value}};Tr.create=(t,e)=>new Tr({value:t,typeName:$.ZodLiteral,...q(e)});function kf(t,e){return new Er({values:t,typeName:$.ZodEnum,...q(e)})}var Er=class t extends V{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return T(r,{expected:W.joinValues(n),received:r.parsedType,code:w.invalid_type}),D}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return T(r,{received:r.data,code:w.invalid_enum_value,options:n}),D}return Ne(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};Er.create=kf;var Ir=class extends V{_parse(e){let r=W.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==I.string&&n.parsedType!==I.number){let o=W.objectValues(r);return T(n,{expected:W.joinValues(o),received:n.parsedType,code:w.invalid_type}),D}if(this._cache||(this._cache=new Set(W.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let o=W.objectValues(r);return T(n,{received:n.data,code:w.invalid_enum_value,options:o}),D}return Ne(e.data)}get enum(){return this._def.values}};Ir.create=(t,e)=>new Ir({values:t,typeName:$.ZodNativeEnum,...q(e)});var Kt=class extends V{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==I.promise&&r.common.async===!1)return T(r,{code:w.invalid_type,expected:I.promise,received:r.parsedType}),D;let n=r.parsedType===I.promise?r.data:Promise.resolve(r.data);return Ne(n.then(o=>this._def.type.parseAsync(o,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Kt.create=(t,e)=>new Kt({type:t,typeName:$.ZodPromise,...q(e)});var Qe=class extends V{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===$.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),o=this._def.effect||null,s={addIssue:i=>{T(n,i),i.fatal?r.abort():r.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),o.type==="preprocess"){let i=o.transform(n.data,s);if(n.common.async)return Promise.resolve(i).then(async a=>{if(r.value==="aborted")return D;let c=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return c.status==="aborted"?D:c.status==="dirty"?gr(c.value):r.value==="dirty"?gr(c.value):c});{if(r.value==="aborted")return D;let a=this._def.schema._parseSync({data:i,path:n.path,parent:n});return a.status==="aborted"?D:a.status==="dirty"?gr(a.value):r.value==="dirty"?gr(a.value):a}}if(o.type==="refinement"){let i=a=>{let c=o.refinement(a,s);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?D:(a.status==="dirty"&&r.dirty(),i(a.value),{status:r.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?D:(a.status==="dirty"&&r.dirty(),i(a.value).then(()=>({status:r.value,value:a.value}))))}if(o.type==="transform")if(n.common.async===!1){let i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Gt(i))return D;let a=o.transform(i.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>Gt(i)?Promise.resolve(o.transform(i.value,s)).then(a=>({status:r.value,value:a})):D);W.assertNever(o)}};Qe.create=(t,e,r)=>new Qe({schema:t,typeName:$.ZodEffects,effect:e,...q(r)});Qe.createWithPreprocess=(t,e,r)=>new Qe({schema:e,effect:{type:"preprocess",transform:t},typeName:$.ZodEffects,...q(r)});var Fe=class extends V{_parse(e){return this._getType(e)===I.undefined?Ne(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Fe.create=(t,e)=>new Fe({innerType:t,typeName:$.ZodOptional,...q(e)});var wt=class extends V{_parse(e){return this._getType(e)===I.null?Ne(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};wt.create=(t,e)=>new wt({innerType:t,typeName:$.ZodNullable,...q(e)});var zr=class extends V{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===I.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};zr.create=(t,e)=>new zr({innerType:t,typeName:$.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...q(e)});var Pr=class extends V{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},o=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return rn(o)?o.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Le(n.common.issues)},input:n.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new Le(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Pr.create=(t,e)=>new Pr({innerType:t,typeName:$.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...q(e)});var un=class extends V{_parse(e){if(this._getType(e)!==I.nan){let n=this._getOrReturnCtx(e);return T(n,{code:w.invalid_type,expected:I.nan,received:n.parsedType}),D}return{status:"valid",value:e.data}}};un.create=t=>new un({typeName:$.ZodNaN,...q(t)});var yb=Symbol("zod_brand"),Un=class extends V{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},Vn=class t extends V{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?D:s.status==="dirty"?(r.dirty(),gr(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{let o=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?D:o.status==="dirty"?(r.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:$.ZodPipeline})}},Rr=class extends V{_parse(e){let r=this._def.innerType._parse(e),n=o=>(Gt(o)&&(o.value=Object.freeze(o.value)),o);return rn(r)?r.then(o=>n(o)):n(r)}unwrap(){return this._def.innerType}};Rr.create=(t,e)=>new Rr({innerType:t,typeName:$.ZodReadonly,...q(e)});function xf(t,e){let r=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function Tf(t,e={},r){return t?Jt.create().superRefine((n,o)=>{let s=t(n);if(s instanceof Promise)return s.then(i=>{if(!i){let a=xf(e,n),c=a.fatal??r??!0;o.addIssue({code:"custom",...a,fatal:c})}});if(!s){let i=xf(e,n),a=i.fatal??r??!0;o.addIssue({code:"custom",...i,fatal:a})}}):Jt.create()}var _b={object:qe.lazycreate},$;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})($||($={}));var vb=(t,e={message:`Input not instance of ${t.name}`})=>Tf(r=>r instanceof t,e),Ef=Wt.create,If=yr.create,bb=un.create,xb=_r.create,zf=vr.create,wb=br.create,Sb=on.create,$b=xr.create,kb=wr.create,Tb=Jt.create,Eb=Ct.create,Ib=lt.create,zb=sn.create,Pb=At.create,ma=qe.create,Rb=qe.strictCreate,Nb=Sr.create,Ob=rs.create,Cb=$r.create,Ab=xt.create,Mb=ns.create,jb=an.create,Db=cn.create,Zb=os.create,Lb=kr.create,Fb=Tr.create,qb=Er.create,Ub=Ir.create,Vb=Kt.create,Bb=Qe.create,Hb=Fe.create,Gb=wt.create,Wb=Qe.createWithPreprocess,Jb=Vn.create,Kb=()=>Ef().optional(),Xb=()=>If().optional(),Yb=()=>zf().optional(),Qb={string:t=>Wt.create({...t,coerce:!0}),number:t=>yr.create({...t,coerce:!0}),boolean:t=>vr.create({...t,coerce:!0}),bigint:t=>_r.create({...t,coerce:!0}),date:t=>br.create({...t,coerce:!0})};var ex=D;var tx=Object.freeze({status:"aborted"});function v(t,e,r){function n(a,c){var u;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(u=a._zod).traits??(u.traits=new Set),a._zod.traits.add(t),e(a,c);for(let l in i.prototype)l in a||Object.defineProperty(a,l,{value:i.prototype[l].bind(a)});a._zod.constr=i,a._zod.def=c}let o=r?.Parent??Object;class s extends o{}Object.defineProperty(s,"name",{value:t});function i(a){var c;let u=r?.Parent?new s:this;n(u,a),(c=u._zod).deferred??(c.deferred=[]);for(let l of u._zod.deferred)l();return u}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(t)}),Object.defineProperty(i,"name",{value:t}),i}var rx=Symbol("zod_brand"),Mt=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},ss={};function We(t){return t&&Object.assign(ss,t),ss}var J={};la(J,{BIGINT_FORMAT_RANGES:()=>Rf,Class:()=>ga,NUMBER_FORMAT_RANGES:()=>Sa,aborted:()=>Or,allowsEval:()=>ba,assert:()=>ax,assertEqual:()=>nx,assertIs:()=>sx,assertNever:()=>ix,assertNotEqual:()=>ox,assignProp:()=>va,cached:()=>Gn,captureStackTrace:()=>as,cleanEnum:()=>bx,cleanRegex:()=>Jn,clone:()=>Je,createTransparentProxy:()=>px,defineLazy:()=>ie,esc:()=>Nr,escapeRegex:()=>Xt,extend:()=>gx,finalizeIssue:()=>dt,floatSafeRemainder:()=>_a,getElementAtPath:()=>cx,getEnumValues:()=>Hn,getLengthableOrigin:()=>Kn,getParsedType:()=>fx,getSizableOrigin:()=>Nf,isObject:()=>ln,isPlainObject:()=>dn,issue:()=>$a,joinValues:()=>is,jsonStringifyReplacer:()=>ya,merge:()=>yx,normalizeParams:()=>Z,nullish:()=>Wn,numKeys:()=>dx,omit:()=>hx,optionalKeys:()=>wa,partial:()=>_x,pick:()=>mx,prefixIssues:()=>St,primitiveTypes:()=>Pf,promiseAllObject:()=>ux,propertyKeyTypes:()=>xa,randomString:()=>lx,required:()=>vx,stringifyPrimitive:()=>cs,unwrapMessage:()=>Bn});function nx(t){return t}function ox(t){return t}function sx(t){}function ix(t){throw new Error}function ax(t){}function Hn(t){let e=Object.values(t).filter(n=>typeof n=="number");return Object.entries(t).filter(([n,o])=>e.indexOf(+n)===-1).map(([n,o])=>o)}function is(t,e="|"){return t.map(r=>cs(r)).join(e)}function ya(t,e){return typeof e=="bigint"?e.toString():e}function Gn(t){return{get value(){{let r=t();return Object.defineProperty(this,"value",{value:r}),r}throw new Error("cached value already set")}}}function Wn(t){return t==null}function Jn(t){let e=t.startsWith("^")?1:0,r=t.endsWith("$")?t.length-1:t.length;return t.slice(e,r)}function _a(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,o=r>n?r:n,s=Number.parseInt(t.toFixed(o).replace(".","")),i=Number.parseInt(e.toFixed(o).replace(".",""));return s%i/10**o}function ie(t,e,r){Object.defineProperty(t,e,{get(){{let o=r();return t[e]=o,o}throw new Error("cached value already set")},set(o){Object.defineProperty(t,e,{value:o})},configurable:!0})}function va(t,e,r){Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}function cx(t,e){return e?e.reduce((r,n)=>r?.[n],t):t}function ux(t){let e=Object.keys(t),r=e.map(n=>t[n]);return Promise.all(r).then(n=>{let o={};for(let s=0;s<e.length;s++)o[e[s]]=n[s];return o})}function lx(t=10){let e="abcdefghijklmnopqrstuvwxyz",r="";for(let n=0;n<t;n++)r+=e[Math.floor(Math.random()*e.length)];return r}function Nr(t){return JSON.stringify(t)}var as=Error.captureStackTrace?Error.captureStackTrace:(...t)=>{};function ln(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}var ba=Gn(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let t=Function;return new t(""),!0}catch{return!1}});function dn(t){if(ln(t)===!1)return!1;let e=t.constructor;if(e===void 0)return!0;let r=e.prototype;return!(ln(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function dx(t){let e=0;for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}var fx=t=>{let e=typeof t;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(t)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(t)?"array":t===null?"null":t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?"promise":typeof Map<"u"&&t instanceof Map?"map":typeof Set<"u"&&t instanceof Set?"set":typeof Date<"u"&&t instanceof Date?"date":typeof File<"u"&&t instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${e}`)}},xa=new Set(["string","number","symbol"]),Pf=new Set(["string","number","bigint","boolean","symbol","undefined"]);function Xt(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Je(t,e,r){let n=new t._zod.constr(e??t._zod.def);return(!e||r?.parent)&&(n._zod.parent=t),n}function Z(t){let e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function px(t){let e;return new Proxy({},{get(r,n,o){return e??(e=t()),Reflect.get(e,n,o)},set(r,n,o,s){return e??(e=t()),Reflect.set(e,n,o,s)},has(r,n){return e??(e=t()),Reflect.has(e,n)},deleteProperty(r,n){return e??(e=t()),Reflect.deleteProperty(e,n)},ownKeys(r){return e??(e=t()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(r,n){return e??(e=t()),Reflect.getOwnPropertyDescriptor(e,n)},defineProperty(r,n,o){return e??(e=t()),Reflect.defineProperty(e,n,o)}})}function cs(t){return typeof t=="bigint"?t.toString()+"n":typeof t=="string"?`"${t}"`:`${t}`}function wa(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}var Sa={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},Rf={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function mx(t,e){let r={},n=t._zod.def;for(let o in e){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&(r[o]=n.shape[o])}return Je(t,{...t._zod.def,shape:r,checks:[]})}function hx(t,e){let r={...t._zod.def.shape},n=t._zod.def;for(let o in e){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&delete r[o]}return Je(t,{...t._zod.def,shape:r,checks:[]})}function gx(t,e){if(!dn(e))throw new Error("Invalid input to extend: expected a plain object");let r={...t._zod.def,get shape(){let n={...t._zod.def.shape,...e};return va(this,"shape",n),n},checks:[]};return Je(t,r)}function yx(t,e){return Je(t,{...t._zod.def,get shape(){let r={...t._zod.def.shape,...e._zod.def.shape};return va(this,"shape",r),r},catchall:e._zod.def.catchall,checks:[]})}function _x(t,e,r){let n=e._zod.def.shape,o={...n};if(r)for(let s in r){if(!(s in n))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=t?new t({type:"optional",innerType:n[s]}):n[s])}else for(let s in n)o[s]=t?new t({type:"optional",innerType:n[s]}):n[s];return Je(e,{...e._zod.def,shape:o,checks:[]})}function vx(t,e,r){let n=e._zod.def.shape,o={...n};if(r)for(let s in r){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=new t({type:"nonoptional",innerType:n[s]}))}else for(let s in n)o[s]=new t({type:"nonoptional",innerType:n[s]});return Je(e,{...e._zod.def,shape:o,checks:[]})}function Or(t,e=0){for(let r=e;r<t.issues.length;r++)if(t.issues[r]?.continue!==!0)return!0;return!1}function St(t,e){return e.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(t),r})}function Bn(t){return typeof t=="string"?t:t?.message}function dt(t,e,r){let n={...t,path:t.path??[]};if(!t.message){let o=Bn(t.inst?._zod.def?.error?.(t))??Bn(e?.error?.(t))??Bn(r.customError?.(t))??Bn(r.localeError?.(t))??"Invalid input";n.message=o}return delete n.inst,delete n.continue,e?.reportInput||delete n.input,n}function Nf(t){return t instanceof Set?"set":t instanceof Map?"map":t instanceof File?"file":"unknown"}function Kn(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function $a(...t){let[e,r,n]=t;return typeof e=="string"?{message:e,code:"custom",input:r,inst:n}:{...e}}function bx(t){return Object.entries(t).filter(([e,r])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}var ga=class{constructor(...e){}};var Of=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),Object.defineProperty(t,"message",{get(){return JSON.stringify(e,ya,2)},enumerable:!0}),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},us=v("$ZodError",Of),Xn=v("$ZodError",Of,{Parent:Error});function ka(t,e=r=>r.message){let r={},n=[];for(let o of t.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(e(o))):n.push(e(o));return{formErrors:n,fieldErrors:r}}function Ta(t,e){let r=e||function(s){return s.message},n={_errors:[]},o=s=>{for(let i of s.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(a=>o({issues:a}));else if(i.code==="invalid_key")o({issues:i.issues});else if(i.code==="invalid_element")o({issues:i.issues});else if(i.path.length===0)n._errors.push(r(i));else{let a=n,c=0;for(;c<i.path.length;){let u=i.path[c];c===i.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(i))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return o(t),n}var Ea=t=>(e,r,n,o)=>{let s=n?Object.assign(n,{async:!1}):{async:!1},i=e._zod.run({value:r,issues:[]},s);if(i instanceof Promise)throw new Mt;if(i.issues.length){let a=new(o?.Err??t)(i.issues.map(c=>dt(c,s,We())));throw as(a,o?.callee),a}return i.value},Ia=Ea(Xn),za=t=>async(e,r,n,o)=>{let s=n?Object.assign(n,{async:!0}):{async:!0},i=e._zod.run({value:r,issues:[]},s);if(i instanceof Promise&&(i=await i),i.issues.length){let a=new(o?.Err??t)(i.issues.map(c=>dt(c,s,We())));throw as(a,o?.callee),a}return i.value},Pa=za(Xn),Ra=t=>(e,r,n)=>{let o=n?{...n,async:!1}:{async:!1},s=e._zod.run({value:r,issues:[]},o);if(s instanceof Promise)throw new Mt;return s.issues.length?{success:!1,error:new(t??us)(s.issues.map(i=>dt(i,o,We())))}:{success:!0,data:s.value}},Cr=Ra(Xn),Na=t=>async(e,r,n)=>{let o=n?Object.assign(n,{async:!0}):{async:!0},s=e._zod.run({value:r,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new t(s.issues.map(i=>dt(i,o,We())))}:{success:!0,data:s.value}},Ar=Na(Xn);var Cf=/^[cC][^\s-]{8,}$/,Af=/^[0-9a-z]+$/,Mf=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,jf=/^[0-9a-vA-V]{20}$/,Df=/^[A-Za-z0-9]{27}$/,Zf=/^[a-zA-Z0-9_-]{21}$/,Lf=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/;var Ff=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Oa=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/;var qf=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;var wx="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Uf(){return new RegExp(wx,"u")}var Vf=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Bf=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,Hf=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Gf=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Wf=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Ca=/^[A-Za-z0-9_-]*$/,Jf=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/;var Kf=/^\+(?:[0-9]){6,14}[0-9]$/,Xf="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",Yf=new RegExp(`^${Xf}$`);function Qf(t){let e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function ep(t){return new RegExp(`^${Qf(t)}$`)}function tp(t){let e=Qf({precision:t.precision}),r=["Z"];t.local&&r.push(""),t.offset&&r.push("([+-]\\d{2}:\\d{2})");let n=`${e}(?:${r.join("|")})`;return new RegExp(`^${Xf}T(?:${n})$`)}var rp=t=>{let e=t?`[\\s\\S]{${t?.minimum??0},${t?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)};var np=/^\d+$/,op=/^-?\d+(?:\.\d+)?/i,sp=/true|false/i,ip=/null/i;var ap=/^[^A-Z]*$/,cp=/^[^a-z]*$/;var $e=v("$ZodCheck",(t,e)=>{var r;t._zod??(t._zod={}),t._zod.def=e,(r=t._zod).onattach??(r.onattach=[])}),up={number:"number",bigint:"bigint",object:"date"},Aa=v("$ZodCheckLessThan",(t,e)=>{$e.init(t,e);let r=up[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,s=(e.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<s&&(e.inclusive?o.maximum=e.value:o.exclusiveMaximum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value<=e.value:n.value<e.value)||n.issues.push({origin:r,code:"too_big",maximum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),Ma=v("$ZodCheckGreaterThan",(t,e)=>{$e.init(t,e);let r=up[typeof e.value];t._zod.onattach.push(n=>{let o=n._zod.bag,s=(e.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>s&&(e.inclusive?o.minimum=e.value:o.exclusiveMinimum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value>=e.value:n.value>e.value)||n.issues.push({origin:r,code:"too_small",minimum:e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),lp=v("$ZodCheckMultipleOf",(t,e)=>{$e.init(t,e),t._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=e.value)}),t._zod.check=r=>{if(typeof r.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%e.value===BigInt(0):_a(r.value,e.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:e.value,input:r.value,inst:t,continue:!e.abort})}}),dp=v("$ZodCheckNumberFormat",(t,e)=>{$e.init(t,e),e.format=e.format||"float64";let r=e.format?.includes("int"),n=r?"int":"number",[o,s]=Sa[e.format];t._zod.onattach.push(i=>{let a=i._zod.bag;a.format=e.format,a.minimum=o,a.maximum=s,r&&(a.pattern=np)}),t._zod.check=i=>{let a=i.value;if(r){if(!Number.isInteger(a)){i.issues.push({expected:n,format:e.format,code:"invalid_type",input:a,inst:t});return}if(!Number.isSafeInteger(a)){a>0?i.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort}):i.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,continue:!e.abort});return}}a<o&&i.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:t,continue:!e.abort}),a>s&&i.issues.push({origin:"number",input:a,code:"too_big",maximum:s,inst:t})}});var fp=v("$ZodCheckMaxLength",(t,e)=>{var r;$e.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Wn(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<o&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{let o=n.value;if(o.length<=e.maximum)return;let i=Kn(o);n.issues.push({origin:i,code:"too_big",maximum:e.maximum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),pp=v("$ZodCheckMinLength",(t,e)=>{var r;$e.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Wn(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>o&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{let o=n.value;if(o.length>=e.minimum)return;let i=Kn(o);n.issues.push({origin:i,code:"too_small",minimum:e.minimum,inclusive:!0,input:o,inst:t,continue:!e.abort})}}),mp=v("$ZodCheckLengthEquals",(t,e)=>{var r;$e.init(t,e),(r=t._zod.def).when??(r.when=n=>{let o=n.value;return!Wn(o)&&o.length!==void 0}),t._zod.onattach.push(n=>{let o=n._zod.bag;o.minimum=e.length,o.maximum=e.length,o.length=e.length}),t._zod.check=n=>{let o=n.value,s=o.length;if(s===e.length)return;let i=Kn(o),a=s>e.length;n.issues.push({origin:i,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),Yn=v("$ZodCheckStringFormat",(t,e)=>{var r,n;$e.init(t,e),t._zod.onattach.push(o=>{let s=o._zod.bag;s.format=e.format,e.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(e.pattern))}),e.pattern?(r=t._zod).check??(r.check=o=>{e.pattern.lastIndex=0,!e.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:e.format,input:o.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(n=t._zod).check??(n.check=()=>{})}),hp=v("$ZodCheckRegex",(t,e)=>{Yn.init(t,e),t._zod.check=r=>{e.pattern.lastIndex=0,!e.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),gp=v("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=ap),Yn.init(t,e)}),yp=v("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=cp),Yn.init(t,e)}),_p=v("$ZodCheckIncludes",(t,e)=>{$e.init(t,e);let r=Xt(e.includes),n=new RegExp(typeof e.position=="number"?`^.{${e.position}}${r}`:r);e.pattern=n,t._zod.onattach.push(o=>{let s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),t._zod.check=o=>{o.value.includes(e.includes,e.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:o.value,inst:t,continue:!e.abort})}}),vp=v("$ZodCheckStartsWith",(t,e)=>{$e.init(t,e);let r=new RegExp(`^${Xt(e.prefix)}.*`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.startsWith(e.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:n.value,inst:t,continue:!e.abort})}}),bp=v("$ZodCheckEndsWith",(t,e)=>{$e.init(t,e);let r=new RegExp(`.*${Xt(e.suffix)}$`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=n=>{n.value.endsWith(e.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:n.value,inst:t,continue:!e.abort})}});var xp=v("$ZodCheckOverwrite",(t,e)=>{$e.init(t,e),t._zod.check=r=>{r.value=e.tx(r.value)}});var ds=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let n=e.split(`
`).filter(i=>i),o=Math.min(...n.map(i=>i.length-i.trimStart().length)),s=n.map(i=>i.slice(o)).map(i=>" ".repeat(this.indent*2)+i);for(let i of s)this.content.push(i)}compile(){let e=Function,r=this?.args,o=[...(this?.content??[""]).map(s=>`  ${s}`)];return new e(...r,o.join(`
`))}};var Sp={major:4,minor:0,patch:0};var ne=v("$ZodType",(t,e)=>{var r;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=Sp;let n=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&n.unshift(t);for(let o of n)for(let s of o._zod.onattach)s(t);if(n.length===0)(r=t._zod).deferred??(r.deferred=[]),t._zod.deferred?.push(()=>{t._zod.run=t._zod.parse});else{let o=(s,i,a)=>{let c=Or(s),u;for(let l of i){if(l._zod.def.when){if(!l._zod.def.when(s))continue}else if(c)continue;let d=s.issues.length,g=l._zod.check(s);if(g instanceof Promise&&a?.async===!1)throw new Mt;if(u||g instanceof Promise)u=(u??Promise.resolve()).then(async()=>{await g,s.issues.length!==d&&(c||(c=Or(s,d)))});else{if(s.issues.length===d)continue;c||(c=Or(s,d))}}return u?u.then(()=>s):s};t._zod.run=(s,i)=>{let a=t._zod.parse(s,i);if(a instanceof Promise){if(i.async===!1)throw new Mt;return a.then(c=>o(c,n,i))}return o(a,n,i)}}t["~standard"]={validate:o=>{try{let s=Cr(t,o);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return Ar(t,o).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}}),Qn=v("$ZodString",(t,e)=>{ne.init(t,e),t._zod.pattern=[...t?._zod.bag?.patterns??[]].pop()??rp(t._zod.bag),t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:t}),r}}),ae=v("$ZodStringFormat",(t,e)=>{Yn.init(t,e),Qn.init(t,e)}),Da=v("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=Ff),ae.init(t,e)}),Za=v("$ZodUUID",(t,e)=>{if(e.version){let n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(n===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=Oa(n))}else e.pattern??(e.pattern=Oa());ae.init(t,e)}),La=v("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=qf),ae.init(t,e)}),Fa=v("$ZodURL",(t,e)=>{ae.init(t,e),t._zod.check=r=>{try{let n=r.value,o=new URL(n),s=o.href;e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(o.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:Jf.source,input:r.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:r.value,inst:t,continue:!e.abort})),!n.endsWith("/")&&s.endsWith("/")?r.value=s.slice(0,-1):r.value=s;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:t,continue:!e.abort})}}}),qa=v("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=Uf()),ae.init(t,e)}),Ua=v("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=Zf),ae.init(t,e)}),Va=v("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=Cf),ae.init(t,e)}),Ba=v("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=Af),ae.init(t,e)}),Ha=v("$ZodULID",(t,e)=>{e.pattern??(e.pattern=Mf),ae.init(t,e)}),Ga=v("$ZodXID",(t,e)=>{e.pattern??(e.pattern=jf),ae.init(t,e)}),Wa=v("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=Df),ae.init(t,e)}),Op=v("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=tp(e)),ae.init(t,e)}),Cp=v("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=Yf),ae.init(t,e)}),Ap=v("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=ep(e)),ae.init(t,e)}),Mp=v("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=Lf),ae.init(t,e)}),Ja=v("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=Vf),ae.init(t,e),t._zod.onattach.push(r=>{let n=r._zod.bag;n.format="ipv4"})}),Ka=v("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=Bf),ae.init(t,e),t._zod.onattach.push(r=>{let n=r._zod.bag;n.format="ipv6"}),t._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:t,continue:!e.abort})}}}),Xa=v("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=Hf),ae.init(t,e)}),Ya=v("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=Gf),ae.init(t,e),t._zod.check=r=>{let[n,o]=r.value.split("/");try{if(!o)throw new Error;let s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${n}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:t,continue:!e.abort})}}});function jp(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}var Qa=v("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=Wf),ae.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),t._zod.check=r=>{jp(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:t,continue:!e.abort})}});function Sx(t){if(!Ca.test(t))return!1;let e=t.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=e.padEnd(Math.ceil(e.length/4)*4,"=");return jp(r)}var ec=v("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=Ca),ae.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),t._zod.check=r=>{Sx(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:t,continue:!e.abort})}}),tc=v("$ZodE164",(t,e)=>{e.pattern??(e.pattern=Kf),ae.init(t,e)});function $x(t,e=null){try{let r=t.split(".");if(r.length!==3)return!1;let[n]=r;if(!n)return!1;let o=JSON.parse(atob(n));return!("typ"in o&&o?.typ!=="JWT"||!o.alg||e&&(!("alg"in o)||o.alg!==e))}catch{return!1}}var rc=v("$ZodJWT",(t,e)=>{ae.init(t,e),t._zod.check=r=>{$x(r.value,e.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:t,continue:!e.abort})}});var ps=v("$ZodNumber",(t,e)=>{ne.init(t,e),t._zod.pattern=t._zod.bag.pattern??op,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=Number(r.value)}catch{}let o=r.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return r;let s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:o,inst:t,...s?{received:s}:{}}),r}}),nc=v("$ZodNumber",(t,e)=>{dp.init(t,e),ps.init(t,e)}),oc=v("$ZodBoolean",(t,e)=>{ne.init(t,e),t._zod.pattern=sp,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=!!r.value}catch{}let o=r.value;return typeof o=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:t}),r}});var sc=v("$ZodNull",(t,e)=>{ne.init(t,e),t._zod.pattern=ip,t._zod.values=new Set([null]),t._zod.parse=(r,n)=>{let o=r.value;return o===null||r.issues.push({expected:"null",code:"invalid_type",input:o,inst:t}),r}});var ic=v("$ZodUnknown",(t,e)=>{ne.init(t,e),t._zod.parse=r=>r}),ac=v("$ZodNever",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:t}),r)});function $p(t,e,r){t.issues.length&&e.issues.push(...St(r,t.issues)),e.value[r]=t.value}var cc=v("$ZodArray",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!Array.isArray(o))return r.issues.push({expected:"array",code:"invalid_type",input:o,inst:t}),r;r.value=Array(o.length);let s=[];for(let i=0;i<o.length;i++){let a=o[i],c=e.element._zod.run({value:a,issues:[]},n);c instanceof Promise?s.push(c.then(u=>$p(u,r,i))):$p(c,r,i)}return s.length?Promise.all(s).then(()=>r):r}});function fs(t,e,r){t.issues.length&&e.issues.push(...St(r,t.issues)),e.value[r]=t.value}function kp(t,e,r,n){t.issues.length?n[r]===void 0?r in n?e.value[r]=void 0:e.value[r]=t.value:e.issues.push(...St(r,t.issues)):t.value===void 0?r in n&&(e.value[r]=void 0):e.value[r]=t.value}var ms=v("$ZodObject",(t,e)=>{ne.init(t,e);let r=Gn(()=>{let d=Object.keys(e.shape);for(let h of d)if(!(e.shape[h]instanceof ne))throw new Error(`Invalid element at key "${h}": expected a Zod schema`);let g=wa(e.shape);return{shape:e.shape,keys:d,keySet:new Set(d),numKeys:d.length,optionalKeys:new Set(g)}});ie(t._zod,"propValues",()=>{let d=e.shape,g={};for(let h in d){let p=d[h]._zod;if(p.values){g[h]??(g[h]=new Set);for(let f of p.values)g[h].add(f)}}return g});let n=d=>{let g=new ds(["shape","payload","ctx"]),h=r.value,p=x=>{let S=Nr(x);return`shape[${S}]._zod.run({ value: input[${S}], issues: [] }, ctx)`};g.write("const input = payload.value;");let f=Object.create(null),y=0;for(let x of h.keys)f[x]=`key_${y++}`;g.write("const newResult = {}");for(let x of h.keys)if(h.optionalKeys.has(x)){let S=f[x];g.write(`const ${S} = ${p(x)};`);let z=Nr(x);g.write(`
        if (${S}.issues.length) {
          if (input[${z}] === undefined) {
            if (${z} in input) {
              newResult[${z}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${S}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${z}, ...iss.path] : [${z}],
              }))
            );
          }
        } else if (${S}.value === undefined) {
          if (${z} in input) newResult[${z}] = undefined;
        } else {
          newResult[${z}] = ${S}.value;
        }
        `)}else{let S=f[x];g.write(`const ${S} = ${p(x)};`),g.write(`
          if (${S}.issues.length) payload.issues = payload.issues.concat(${S}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Nr(x)}, ...iss.path] : [${Nr(x)}]
          })));`),g.write(`newResult[${Nr(x)}] = ${S}.value`)}g.write("payload.value = newResult;"),g.write("return payload;");let b=g.compile();return(x,S)=>b(d,x,S)},o,s=ln,i=!ss.jitless,c=i&&ba.value,u=e.catchall,l;t._zod.parse=(d,g)=>{l??(l=r.value);let h=d.value;if(!s(h))return d.issues.push({expected:"object",code:"invalid_type",input:h,inst:t}),d;let p=[];if(i&&c&&g?.async===!1&&g.jitless!==!0)o||(o=n(e.shape)),d=o(d,g);else{d.value={};let S=l.shape;for(let z of l.keys){let A=S[z],be=A._zod.run({value:h[z],issues:[]},g),Re=A._zod.optin==="optional"&&A._zod.optout==="optional";be instanceof Promise?p.push(be.then(Rt=>Re?kp(Rt,d,z,h):fs(Rt,d,z))):Re?kp(be,d,z,h):fs(be,d,z)}}if(!u)return p.length?Promise.all(p).then(()=>d):d;let f=[],y=l.keySet,b=u._zod,x=b.def.type;for(let S of Object.keys(h)){if(y.has(S))continue;if(x==="never"){f.push(S);continue}let z=b.run({value:h[S],issues:[]},g);z instanceof Promise?p.push(z.then(A=>fs(A,d,S))):fs(z,d,S)}return f.length&&d.issues.push({code:"unrecognized_keys",keys:f,input:h,inst:t}),p.length?Promise.all(p).then(()=>d):d}});function Tp(t,e,r,n){for(let o of t)if(o.issues.length===0)return e.value=o.value,e;return e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(o=>o.issues.map(s=>dt(s,n,We())))}),e}var hs=v("$ZodUnion",(t,e)=>{ne.init(t,e),ie(t._zod,"optin",()=>e.options.some(r=>r._zod.optin==="optional")?"optional":void 0),ie(t._zod,"optout",()=>e.options.some(r=>r._zod.optout==="optional")?"optional":void 0),ie(t._zod,"values",()=>{if(e.options.every(r=>r._zod.values))return new Set(e.options.flatMap(r=>Array.from(r._zod.values)))}),ie(t._zod,"pattern",()=>{if(e.options.every(r=>r._zod.pattern)){let r=e.options.map(n=>n._zod.pattern);return new RegExp(`^(${r.map(n=>Jn(n.source)).join("|")})$`)}}),t._zod.parse=(r,n)=>{let o=!1,s=[];for(let i of e.options){let a=i._zod.run({value:r.value,issues:[]},n);if(a instanceof Promise)s.push(a),o=!0;else{if(a.issues.length===0)return a;s.push(a)}}return o?Promise.all(s).then(i=>Tp(i,r,t,n)):Tp(s,r,t,n)}}),uc=v("$ZodDiscriminatedUnion",(t,e)=>{hs.init(t,e);let r=t._zod.parse;ie(t._zod,"propValues",()=>{let o={};for(let s of e.options){let i=s._zod.propValues;if(!i||Object.keys(i).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(let[a,c]of Object.entries(i)){o[a]||(o[a]=new Set);for(let u of c)o[a].add(u)}}return o});let n=Gn(()=>{let o=e.options,s=new Map;for(let i of o){let a=i._zod.propValues[e.discriminator];if(!a||a.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(i)}"`);for(let c of a){if(s.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);s.set(c,i)}}return s});t._zod.parse=(o,s)=>{let i=o.value;if(!ln(i))return o.issues.push({code:"invalid_type",expected:"object",input:i,inst:t}),o;let a=n.value.get(i?.[e.discriminator]);return a?a._zod.run(o,s):e.unionFallback?r(o,s):(o.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:i,path:[e.discriminator],inst:t}),o)}}),lc=v("$ZodIntersection",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=r.value,s=e.left._zod.run({value:o,issues:[]},n),i=e.right._zod.run({value:o,issues:[]},n);return s instanceof Promise||i instanceof Promise?Promise.all([s,i]).then(([c,u])=>Ep(r,c,u)):Ep(r,s,i)}});function ja(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(dn(t)&&dn(e)){let r=Object.keys(e),n=Object.keys(t).filter(s=>r.indexOf(s)!==-1),o={...t,...e};for(let s of n){let i=ja(t[s],e[s]);if(!i.valid)return{valid:!1,mergeErrorPath:[s,...i.mergeErrorPath]};o[s]=i.data}return{valid:!0,data:o}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};let r=[];for(let n=0;n<t.length;n++){let o=t[n],s=e[n],i=ja(o,s);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};r.push(i.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function Ep(t,e,r){if(e.issues.length&&t.issues.push(...e.issues),r.issues.length&&t.issues.push(...r.issues),Or(t))return t;let n=ja(e.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return t.value=n.data,t}var dc=v("$ZodRecord",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=r.value;if(!dn(o))return r.issues.push({expected:"record",code:"invalid_type",input:o,inst:t}),r;let s=[];if(e.keyType._zod.values){let i=e.keyType._zod.values;r.value={};for(let c of i)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){let u=e.valueType._zod.run({value:o[c],issues:[]},n);u instanceof Promise?s.push(u.then(l=>{l.issues.length&&r.issues.push(...St(c,l.issues)),r.value[c]=l.value})):(u.issues.length&&r.issues.push(...St(c,u.issues)),r.value[c]=u.value)}let a;for(let c in o)i.has(c)||(a=a??[],a.push(c));a&&a.length>0&&r.issues.push({code:"unrecognized_keys",input:o,inst:t,keys:a})}else{r.value={};for(let i of Reflect.ownKeys(o)){if(i==="__proto__")continue;let a=e.keyType._zod.run({value:i,issues:[]},n);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){r.issues.push({origin:"record",code:"invalid_key",issues:a.issues.map(u=>dt(u,n,We())),input:i,path:[i],inst:t}),r.value[a.value]=a.value;continue}let c=e.valueType._zod.run({value:o[i],issues:[]},n);c instanceof Promise?s.push(c.then(u=>{u.issues.length&&r.issues.push(...St(i,u.issues)),r.value[a.value]=u.value})):(c.issues.length&&r.issues.push(...St(i,c.issues)),r.value[a.value]=c.value)}}return s.length?Promise.all(s).then(()=>r):r}});var fc=v("$ZodEnum",(t,e)=>{ne.init(t,e);let r=Hn(e.entries);t._zod.values=new Set(r),t._zod.pattern=new RegExp(`^(${r.filter(n=>xa.has(typeof n)).map(n=>typeof n=="string"?Xt(n):n.toString()).join("|")})$`),t._zod.parse=(n,o)=>{let s=n.value;return t._zod.values.has(s)||n.issues.push({code:"invalid_value",values:r,input:s,inst:t}),n}}),pc=v("$ZodLiteral",(t,e)=>{ne.init(t,e),t._zod.values=new Set(e.values),t._zod.pattern=new RegExp(`^(${e.values.map(r=>typeof r=="string"?Xt(r):r?r.toString():String(r)).join("|")})$`),t._zod.parse=(r,n)=>{let o=r.value;return t._zod.values.has(o)||r.issues.push({code:"invalid_value",values:e.values,input:o,inst:t}),r}});var mc=v("$ZodTransform",(t,e)=>{ne.init(t,e),t._zod.parse=(r,n)=>{let o=e.transform(r.value,r);if(n.async)return(o instanceof Promise?o:Promise.resolve(o)).then(i=>(r.value=i,r));if(o instanceof Promise)throw new Mt;return r.value=o,r}}),hc=v("$ZodOptional",(t,e)=>{ne.init(t,e),t._zod.optin="optional",t._zod.optout="optional",ie(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),ie(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${Jn(r.source)})?$`):void 0}),t._zod.parse=(r,n)=>e.innerType._zod.optin==="optional"?e.innerType._zod.run(r,n):r.value===void 0?r:e.innerType._zod.run(r,n)}),gc=v("$ZodNullable",(t,e)=>{ne.init(t,e),ie(t._zod,"optin",()=>e.innerType._zod.optin),ie(t._zod,"optout",()=>e.innerType._zod.optout),ie(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${Jn(r.source)}|null)$`):void 0}),ie(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(r,n)=>r.value===null?r:e.innerType._zod.run(r,n)}),yc=v("$ZodDefault",(t,e)=>{ne.init(t,e),t._zod.optin="optional",ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(r.value===void 0)return r.value=e.defaultValue,r;let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>Ip(s,e)):Ip(o,e)}});function Ip(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}var _c=v("$ZodPrefault",(t,e)=>{ne.init(t,e),t._zod.optin="optional",ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>(r.value===void 0&&(r.value=e.defaultValue),e.innerType._zod.run(r,n))}),vc=v("$ZodNonOptional",(t,e)=>{ne.init(t,e),ie(t._zod,"values",()=>{let r=e.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>zp(s,t)):zp(o,t)}});function zp(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}var bc=v("$ZodCatch",(t,e)=>{ne.init(t,e),t._zod.optin="optional",ie(t._zod,"optout",()=>e.innerType._zod.optout),ie(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>(r.value=s.value,s.issues.length&&(r.value=e.catchValue({...r,error:{issues:s.issues.map(i=>dt(i,n,We()))},input:r.value}),r.issues=[]),r)):(r.value=o.value,o.issues.length&&(r.value=e.catchValue({...r,error:{issues:o.issues.map(s=>dt(s,n,We()))},input:r.value}),r.issues=[]),r)}});var xc=v("$ZodPipe",(t,e)=>{ne.init(t,e),ie(t._zod,"values",()=>e.in._zod.values),ie(t._zod,"optin",()=>e.in._zod.optin),ie(t._zod,"optout",()=>e.out._zod.optout),t._zod.parse=(r,n)=>{let o=e.in._zod.run(r,n);return o instanceof Promise?o.then(s=>Pp(s,e,n)):Pp(o,e,n)}});function Pp(t,e,r){return Or(t)?t:e.out._zod.run({value:t.value,issues:t.issues},r)}var wc=v("$ZodReadonly",(t,e)=>{ne.init(t,e),ie(t._zod,"propValues",()=>e.innerType._zod.propValues),ie(t._zod,"values",()=>e.innerType._zod.values),ie(t._zod,"optin",()=>e.innerType._zod.optin),ie(t._zod,"optout",()=>e.innerType._zod.optout),t._zod.parse=(r,n)=>{let o=e.innerType._zod.run(r,n);return o instanceof Promise?o.then(Rp):Rp(o)}});function Rp(t){return t.value=Object.freeze(t.value),t}var Sc=v("$ZodCustom",(t,e)=>{$e.init(t,e),ne.init(t,e),t._zod.parse=(r,n)=>r,t._zod.check=r=>{let n=r.value,o=e.fn(n);if(o instanceof Promise)return o.then(s=>Np(s,r,n,t));Np(o,r,n,t)}});function Np(t,e,r,n){if(!t){let o={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(o.params=n._zod.def.params),e.issues.push($a(o))}}var kx=t=>{let e=typeof t;switch(e){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return e},Tx=()=>{let t={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}};function e(n){return t[n]??null}let r={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return n=>{switch(n.code){case"invalid_type":return`Invalid input: expected ${n.expected}, received ${kx(n.input)}`;case"invalid_value":return n.values.length===1?`Invalid input: expected ${cs(n.values[0])}`:`Invalid option: expected one of ${is(n.values,"|")}`;case"too_big":{let o=n.inclusive?"<=":"<",s=e(n.origin);return s?`Too big: expected ${n.origin??"value"} to have ${o}${n.maximum.toString()} ${s.unit??"elements"}`:`Too big: expected ${n.origin??"value"} to be ${o}${n.maximum.toString()}`}case"too_small":{let o=n.inclusive?">=":">",s=e(n.origin);return s?`Too small: expected ${n.origin} to have ${o}${n.minimum.toString()} ${s.unit}`:`Too small: expected ${n.origin} to be ${o}${n.minimum.toString()}`}case"invalid_format":{let o=n;return o.format==="starts_with"?`Invalid string: must start with "${o.prefix}"`:o.format==="ends_with"?`Invalid string: must end with "${o.suffix}"`:o.format==="includes"?`Invalid string: must include "${o.includes}"`:o.format==="regex"?`Invalid string: must match pattern ${o.pattern}`:`Invalid ${r[o.format]??n.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${n.divisor}`;case"unrecognized_keys":return`Unrecognized key${n.keys.length>1?"s":""}: ${is(n.keys,", ")}`;case"invalid_key":return`Invalid key in ${n.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${n.origin}`;default:return"Invalid input"}}};function Dp(){return{localeError:Tx()}}var Ex=Symbol("ZodOutput"),Ix=Symbol("ZodInput"),eo=class{constructor(){this._map=new Map,this._idmap=new Map}add(e,...r){let n=r[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let r=this._map.get(e);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(e),this}get(e){let r=e._zod.parent;if(r){let n={...this.get(r)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}};function Zp(){return new eo}var Yt=Zp();function $c(t,e){return new t({type:"string",...Z(e)})}function kc(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...Z(e)})}function gs(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...Z(e)})}function Tc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...Z(e)})}function Ec(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...Z(e)})}function Ic(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...Z(e)})}function zc(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...Z(e)})}function Pc(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...Z(e)})}function Rc(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...Z(e)})}function Nc(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...Z(e)})}function Oc(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...Z(e)})}function Cc(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...Z(e)})}function Ac(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...Z(e)})}function Mc(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...Z(e)})}function jc(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...Z(e)})}function Dc(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...Z(e)})}function Zc(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...Z(e)})}function Lc(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...Z(e)})}function Fc(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...Z(e)})}function qc(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...Z(e)})}function Uc(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...Z(e)})}function Vc(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...Z(e)})}function Bc(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...Z(e)})}function Lp(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...Z(e)})}function Fp(t,e){return new t({type:"string",format:"date",check:"string_format",...Z(e)})}function qp(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...Z(e)})}function Up(t,e){return new t({type:"string",format:"duration",check:"string_format",...Z(e)})}function Hc(t,e){return new t({type:"number",checks:[],...Z(e)})}function Gc(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...Z(e)})}function Wc(t,e){return new t({type:"boolean",...Z(e)})}function Jc(t,e){return new t({type:"null",...Z(e)})}function Kc(t){return new t({type:"unknown"})}function Xc(t,e){return new t({type:"never",...Z(e)})}function ys(t,e){return new Aa({check:"less_than",...Z(e),value:t,inclusive:!1})}function to(t,e){return new Aa({check:"less_than",...Z(e),value:t,inclusive:!0})}function _s(t,e){return new Ma({check:"greater_than",...Z(e),value:t,inclusive:!1})}function ro(t,e){return new Ma({check:"greater_than",...Z(e),value:t,inclusive:!0})}function vs(t,e){return new lp({check:"multiple_of",...Z(e),value:t})}function bs(t,e){return new fp({check:"max_length",...Z(e),maximum:t})}function fn(t,e){return new pp({check:"min_length",...Z(e),minimum:t})}function xs(t,e){return new mp({check:"length_equals",...Z(e),length:t})}function Yc(t,e){return new hp({check:"string_format",format:"regex",...Z(e),pattern:t})}function Qc(t){return new gp({check:"string_format",format:"lowercase",...Z(t)})}function eu(t){return new yp({check:"string_format",format:"uppercase",...Z(t)})}function tu(t,e){return new _p({check:"string_format",format:"includes",...Z(e),includes:t})}function ru(t,e){return new vp({check:"string_format",format:"starts_with",...Z(e),prefix:t})}function nu(t,e){return new bp({check:"string_format",format:"ends_with",...Z(e),suffix:t})}function Mr(t){return new xp({check:"overwrite",tx:t})}function ou(t){return Mr(e=>e.normalize(t))}function su(){return Mr(t=>t.trim())}function iu(){return Mr(t=>t.toLowerCase())}function au(){return Mr(t=>t.toUpperCase())}function Vp(t,e,r){return new t({type:"array",element:e,...Z(r)})}function cu(t,e,r){let n=Z(r);return n.abort??(n.abort=!0),new t({type:"custom",check:"custom",fn:e,...n})}function uu(t,e,r){return new t({type:"custom",check:"custom",fn:e,...Z(r)})}var ws=class{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??Yt,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,r={path:[],schemaPath:[]}){var n;let o=e._zod.def,s={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},i=this.seen.get(e);if(i)return i.count++,r.schemaPath.includes(e)&&(i.cycle=r.path),i.schema;let a={schema:{},count:1,cycle:void 0,path:r.path};this.seen.set(e,a);let c=e._zod.toJSONSchema?.();if(c)a.schema=c;else{let d={...r,schemaPath:[...r.schemaPath,e],path:r.path},g=e._zod.parent;if(g)a.ref=g,this.process(g,d),this.seen.get(g).isParent=!0;else{let h=a.schema;switch(o.type){case"string":{let p=h;p.type="string";let{minimum:f,maximum:y,format:b,patterns:x,contentEncoding:S}=e._zod.bag;if(typeof f=="number"&&(p.minLength=f),typeof y=="number"&&(p.maxLength=y),b&&(p.format=s[b]??b,p.format===""&&delete p.format),S&&(p.contentEncoding=S),x&&x.size>0){let z=[...x];z.length===1?p.pattern=z[0].source:z.length>1&&(a.schema.allOf=[...z.map(A=>({...this.target==="draft-7"?{type:"string"}:{},pattern:A.source}))])}break}case"number":{let p=h,{minimum:f,maximum:y,format:b,multipleOf:x,exclusiveMaximum:S,exclusiveMinimum:z}=e._zod.bag;typeof b=="string"&&b.includes("int")?p.type="integer":p.type="number",typeof z=="number"&&(p.exclusiveMinimum=z),typeof f=="number"&&(p.minimum=f,typeof z=="number"&&(z>=f?delete p.minimum:delete p.exclusiveMinimum)),typeof S=="number"&&(p.exclusiveMaximum=S),typeof y=="number"&&(p.maximum=y,typeof S=="number"&&(S<=y?delete p.maximum:delete p.exclusiveMaximum)),typeof x=="number"&&(p.multipleOf=x);break}case"boolean":{let p=h;p.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{h.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{h.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{let p=h,{minimum:f,maximum:y}=e._zod.bag;typeof f=="number"&&(p.minItems=f),typeof y=="number"&&(p.maxItems=y),p.type="array",p.items=this.process(o.element,{...d,path:[...d.path,"items"]});break}case"object":{let p=h;p.type="object",p.properties={};let f=o.shape;for(let x in f)p.properties[x]=this.process(f[x],{...d,path:[...d.path,"properties",x]});let y=new Set(Object.keys(f)),b=new Set([...y].filter(x=>{let S=o.shape[x]._zod;return this.io==="input"?S.optin===void 0:S.optout===void 0}));b.size>0&&(p.required=Array.from(b)),o.catchall?._zod.def.type==="never"?p.additionalProperties=!1:o.catchall?o.catchall&&(p.additionalProperties=this.process(o.catchall,{...d,path:[...d.path,"additionalProperties"]})):this.io==="output"&&(p.additionalProperties=!1);break}case"union":{let p=h;p.anyOf=o.options.map((f,y)=>this.process(f,{...d,path:[...d.path,"anyOf",y]}));break}case"intersection":{let p=h,f=this.process(o.left,{...d,path:[...d.path,"allOf",0]}),y=this.process(o.right,{...d,path:[...d.path,"allOf",1]}),b=S=>"allOf"in S&&Object.keys(S).length===1,x=[...b(f)?f.allOf:[f],...b(y)?y.allOf:[y]];p.allOf=x;break}case"tuple":{let p=h;p.type="array";let f=o.items.map((x,S)=>this.process(x,{...d,path:[...d.path,"prefixItems",S]}));if(this.target==="draft-2020-12"?p.prefixItems=f:p.items=f,o.rest){let x=this.process(o.rest,{...d,path:[...d.path,"items"]});this.target==="draft-2020-12"?p.items=x:p.additionalItems=x}o.rest&&(p.items=this.process(o.rest,{...d,path:[...d.path,"items"]}));let{minimum:y,maximum:b}=e._zod.bag;typeof y=="number"&&(p.minItems=y),typeof b=="number"&&(p.maxItems=b);break}case"record":{let p=h;p.type="object",p.propertyNames=this.process(o.keyType,{...d,path:[...d.path,"propertyNames"]}),p.additionalProperties=this.process(o.valueType,{...d,path:[...d.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{let p=h,f=Hn(o.entries);f.every(y=>typeof y=="number")&&(p.type="number"),f.every(y=>typeof y=="string")&&(p.type="string"),p.enum=f;break}case"literal":{let p=h,f=[];for(let y of o.values)if(y===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof y=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");f.push(Number(y))}else f.push(y);if(f.length!==0)if(f.length===1){let y=f[0];p.type=y===null?"null":typeof y,p.const=y}else f.every(y=>typeof y=="number")&&(p.type="number"),f.every(y=>typeof y=="string")&&(p.type="string"),f.every(y=>typeof y=="boolean")&&(p.type="string"),f.every(y=>y===null)&&(p.type="null"),p.enum=f;break}case"file":{let p=h,f={type:"string",format:"binary",contentEncoding:"binary"},{minimum:y,maximum:b,mime:x}=e._zod.bag;y!==void 0&&(f.minLength=y),b!==void 0&&(f.maxLength=b),x?x.length===1?(f.contentMediaType=x[0],Object.assign(p,f)):p.anyOf=x.map(S=>({...f,contentMediaType:S})):Object.assign(p,f);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{let p=this.process(o.innerType,d);h.anyOf=[p,{type:"null"}];break}case"nonoptional":{this.process(o.innerType,d),a.ref=o.innerType;break}case"success":{let p=h;p.type="boolean";break}case"default":{this.process(o.innerType,d),a.ref=o.innerType,h.default=JSON.parse(JSON.stringify(o.defaultValue));break}case"prefault":{this.process(o.innerType,d),a.ref=o.innerType,this.io==="input"&&(h._prefault=JSON.parse(JSON.stringify(o.defaultValue)));break}case"catch":{this.process(o.innerType,d),a.ref=o.innerType;let p;try{p=o.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}h.default=p;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{let p=h,f=e._zod.pattern;if(!f)throw new Error("Pattern not found in template literal");p.type="string",p.pattern=f.source;break}case"pipe":{let p=this.io==="input"?o.in._zod.def.type==="transform"?o.out:o.in:o.out;this.process(p,d),a.ref=p;break}case"readonly":{this.process(o.innerType,d),a.ref=o.innerType,h.readOnly=!0;break}case"promise":{this.process(o.innerType,d),a.ref=o.innerType;break}case"optional":{this.process(o.innerType,d),a.ref=o.innerType;break}case"lazy":{let p=e._zod.innerType;this.process(p,d),a.ref=p;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}default:}}}let u=this.metadataRegistry.get(e);return u&&Object.assign(a.schema,u),this.io==="input"&&ve(e)&&(delete a.schema.examples,delete a.schema.default),this.io==="input"&&a.schema._prefault&&((n=a.schema).default??(n.default=a.schema._prefault)),delete a.schema._prefault,this.seen.get(e).schema}emit(e,r){let n={cycles:r?.cycles??"ref",reused:r?.reused??"inline",external:r?.external??void 0},o=this.seen.get(e);if(!o)throw new Error("Unprocessed schema. This is a bug in Zod.");let s=l=>{let d=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){let f=n.external.registry.get(l[0])?.id,y=n.external.uri??(x=>x);if(f)return{ref:y(f)};let b=l[1].defId??l[1].schema.id??`schema${this.counter++}`;return l[1].defId=b,{defId:b,ref:`${y("__shared")}#/${d}/${b}`}}if(l[1]===o)return{ref:"#"};let h=`#/${d}/`,p=l[1].schema.id??`__schema${this.counter++}`;return{defId:p,ref:h+p}},i=l=>{if(l[1].schema.$ref)return;let d=l[1],{ref:g,defId:h}=s(l);d.def={...d.schema},h&&(d.defId=h);let p=d.schema;for(let f in p)delete p[f];p.$ref=g};if(n.cycles==="throw")for(let l of this.seen.entries()){let d=l[1];if(d.cycle)throw new Error(`Cycle detected: #/${d.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let l of this.seen.entries()){let d=l[1];if(e===l[0]){i(l);continue}if(n.external){let h=n.external.registry.get(l[0])?.id;if(e!==l[0]&&h){i(l);continue}}if(this.metadataRegistry.get(l[0])?.id){i(l);continue}if(d.cycle){i(l);continue}if(d.count>1&&n.reused==="ref"){i(l);continue}}let a=(l,d)=>{let g=this.seen.get(l),h=g.def??g.schema,p={...h};if(g.ref===null)return;let f=g.ref;if(g.ref=null,f){a(f,d);let y=this.seen.get(f).schema;y.$ref&&d.target==="draft-7"?(h.allOf=h.allOf??[],h.allOf.push(y)):(Object.assign(h,y),Object.assign(h,p))}g.isParent||this.override({zodSchema:l,jsonSchema:h,path:g.path??[]})};for(let l of[...this.seen.entries()].reverse())a(l[0],{target:this.target});let c={};if(this.target==="draft-2020-12"?c.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?c.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),n.external?.uri){let l=n.external.registry.get(e)?.id;if(!l)throw new Error("Schema is missing an `id` property");c.$id=n.external.uri(l)}Object.assign(c,o.def);let u=n.external?.defs??{};for(let l of this.seen.entries()){let d=l[1];d.def&&d.defId&&(u[d.defId]=d.def)}n.external||Object.keys(u).length>0&&(this.target==="draft-2020-12"?c.$defs=u:c.definitions=u);try{return JSON.parse(JSON.stringify(c))}catch{throw new Error("Error converting schema to JSON.")}}};function lu(t,e){if(t instanceof eo){let n=new ws(e),o={};for(let a of t._idmap.entries()){let[c,u]=a;n.process(u)}let s={},i={registry:t,uri:e?.uri,defs:o};for(let a of t._idmap.entries()){let[c,u]=a;s[c]=n.emit(u,{...e,external:i})}if(Object.keys(o).length>0){let a=n.target==="draft-2020-12"?"$defs":"definitions";s.__shared={[a]:o}}return{schemas:s}}let r=new ws(e);return r.process(t),r.emit(t,e)}function ve(t,e){let r=e??{seen:new Set};if(r.seen.has(t))return!1;r.seen.add(t);let o=t._zod.def;switch(o.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return ve(o.element,r);case"object":{for(let s in o.shape)if(ve(o.shape[s],r))return!0;return!1}case"union":{for(let s of o.options)if(ve(s,r))return!0;return!1}case"intersection":return ve(o.left,r)||ve(o.right,r);case"tuple":{for(let s of o.items)if(ve(s,r))return!0;return!!(o.rest&&ve(o.rest,r))}case"record":return ve(o.keyType,r)||ve(o.valueType,r);case"map":return ve(o.keyType,r)||ve(o.valueType,r);case"set":return ve(o.valueType,r);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return ve(o.innerType,r);case"lazy":return ve(o.getter(),r);case"default":return ve(o.innerType,r);case"prefault":return ve(o.innerType,r);case"custom":return!1;case"transform":return!0;case"pipe":return ve(o.in,r)||ve(o.out,r);case"success":return!1;case"catch":return!1;default:}throw new Error(`Unknown schema type: ${o.type}`)}var u0=v("ZodMiniType",(t,e)=>{if(!t._zod)throw new Error("Uninitialized schema in ZodMiniType.");ne.init(t,e),t.def=e,t.parse=(r,n)=>Ia(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>Cr(t,r,n),t.parseAsync=async(r,n)=>Pa(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>Ar(t,r,n),t.check=(...r)=>t.clone({...e,checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),t.clone=(r,n)=>Je(t,r,n),t.brand=()=>t,t.register=(r,n)=>(r.add(t,n),t)});var l0=v("ZodMiniObject",(t,e)=>{ms.init(t,e),u0.init(t,e),J.defineLazy(t,"shape",()=>e.shape)});function du(t,e){let r={type:"object",get shape(){return J.assignProp(this,"shape",{...t}),this.shape},...J.normalizeParams(e)};return new l0(r)}function et(t){return!!t._zod}function Dr(t){let e=Object.values(t);if(e.length===0)return du({});let r=e.every(et),n=e.every(o=>!et(o));if(r)return du(t);if(n)return ma(t);throw new Error("Mixed Zod versions detected in object shape.")}function Qt(t,e){return et(t)?Cr(t,e):t.safeParse(e)}async function Ss(t,e){return et(t)?await Ar(t,e):await t.safeParseAsync(e)}function er(t){if(!t)return;let e;if(et(t)?e=t._zod?.def?.shape:e=t.shape,!!e){if(typeof e=="function")try{return e()}catch{return}return e}}function pn(t){if(t){if(typeof t=="object"){let e=t,r=t;if(!e._def&&!r._zod){let n=Object.values(t);if(n.length>0&&n.every(o=>typeof o=="object"&&o!==null&&(o._def!==void 0||o._zod!==void 0||typeof o.parse=="function")))return Dr(t)}}if(et(t)){let r=t._zod?.def;if(r&&(r.type==="object"||r.shape!==void 0))return t}else if(t.shape!==void 0)return t}}function $s(t){if(t&&typeof t=="object"){if("message"in t&&typeof t.message=="string")return t.message;if("issues"in t&&Array.isArray(t.issues)&&t.issues.length>0){let e=t.issues[0];if(e&&typeof e=="object"&&"message"in e)return String(e.message)}try{return JSON.stringify(t)}catch{return String(t)}}return String(t)}function Hp(t){return t.description}function Gp(t){if(et(t))return t._zod?.def?.type==="optional";let e=t;return typeof t.isOptional=="function"?t.isOptional():e._def?.typeName==="ZodOptional"}function ks(t){if(et(t)){let s=t._zod?.def;if(s){if(s.value!==void 0)return s.value;if(Array.isArray(s.values)&&s.values.length>0)return s.values[0]}}let r=t._def;if(r){if(r.value!==void 0)return r.value;if(Array.isArray(r.values)&&r.values.length>0)return r.values[0]}let n=t.value;if(n!==void 0)return n}var no={};la(no,{ZodISODate:()=>Jp,ZodISODateTime:()=>Wp,ZodISODuration:()=>Xp,ZodISOTime:()=>Kp,date:()=>pu,datetime:()=>fu,duration:()=>hu,time:()=>mu});var Wp=v("ZodISODateTime",(t,e)=>{Op.init(t,e),de.init(t,e)});function fu(t){return Lp(Wp,t)}var Jp=v("ZodISODate",(t,e)=>{Cp.init(t,e),de.init(t,e)});function pu(t){return Fp(Jp,t)}var Kp=v("ZodISOTime",(t,e)=>{Ap.init(t,e),de.init(t,e)});function mu(t){return qp(Kp,t)}var Xp=v("ZodISODuration",(t,e)=>{Mp.init(t,e),de.init(t,e)});function hu(t){return Up(Xp,t)}var Yp=(t,e)=>{us.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:r=>Ta(t,r)},flatten:{value:r=>ka(t,r)},addIssue:{value:r=>t.issues.push(r)},addIssues:{value:r=>t.issues.push(...r)},isEmpty:{get(){return t.issues.length===0}}})},oO=v("ZodError",Yp),oo=v("ZodError",Yp,{Parent:Error});var Qp=Ea(oo),em=za(oo),tm=Ra(oo),rm=Na(oo);var ye=v("ZodType",(t,e)=>(ne.init(t,e),t.def=e,Object.defineProperty(t,"_def",{value:e}),t.check=(...r)=>t.clone({...e,checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),t.clone=(r,n)=>Je(t,r,n),t.brand=()=>t,t.register=(r,n)=>(r.add(t,n),t),t.parse=(r,n)=>Qp(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>tm(t,r,n),t.parseAsync=async(r,n)=>em(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>rm(t,r,n),t.spa=t.safeParseAsync,t.refine=(r,n)=>t.check(aw(r,n)),t.superRefine=r=>t.check(cw(r)),t.overwrite=r=>t.check(Mr(r)),t.optional=()=>ge(t),t.nullable=()=>sm(t),t.nullish=()=>ge(sm(t)),t.nonoptional=r=>ew(t,r),t.array=()=>K(t),t.or=r=>ce([t,r]),t.and=r=>Es(t,r),t.transform=r=>yu(t,lm(r)),t.default=r=>X0(t,r),t.prefault=r=>Q0(t,r),t.catch=r=>rw(t,r),t.pipe=r=>yu(t,r),t.readonly=()=>sw(t),t.describe=r=>{let n=t.clone();return Yt.add(n,{description:r}),n},Object.defineProperty(t,"description",{get(){return Yt.get(t)?.description},configurable:!0}),t.meta=(...r)=>{if(r.length===0)return Yt.get(t);let n=t.clone();return Yt.add(n,r[0]),n},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t)),im=v("_ZodString",(t,e)=>{Qn.init(t,e),ye.init(t,e);let r=t._zod.bag;t.format=r.format??null,t.minLength=r.minimum??null,t.maxLength=r.maximum??null,t.regex=(...n)=>t.check(Yc(...n)),t.includes=(...n)=>t.check(tu(...n)),t.startsWith=(...n)=>t.check(ru(...n)),t.endsWith=(...n)=>t.check(nu(...n)),t.min=(...n)=>t.check(fn(...n)),t.max=(...n)=>t.check(bs(...n)),t.length=(...n)=>t.check(xs(...n)),t.nonempty=(...n)=>t.check(fn(1,...n)),t.lowercase=n=>t.check(Qc(n)),t.uppercase=n=>t.check(eu(n)),t.trim=()=>t.check(su()),t.normalize=(...n)=>t.check(ou(...n)),t.toLowerCase=()=>t.check(iu()),t.toUpperCase=()=>t.check(au())}),v0=v("ZodString",(t,e)=>{Qn.init(t,e),im.init(t,e),t.email=r=>t.check(kc(b0,r)),t.url=r=>t.check(Pc(x0,r)),t.jwt=r=>t.check(Bc(M0,r)),t.emoji=r=>t.check(Rc(w0,r)),t.guid=r=>t.check(gs(nm,r)),t.uuid=r=>t.check(Tc(Ts,r)),t.uuidv4=r=>t.check(Ec(Ts,r)),t.uuidv6=r=>t.check(Ic(Ts,r)),t.uuidv7=r=>t.check(zc(Ts,r)),t.nanoid=r=>t.check(Nc(S0,r)),t.guid=r=>t.check(gs(nm,r)),t.cuid=r=>t.check(Oc($0,r)),t.cuid2=r=>t.check(Cc(k0,r)),t.ulid=r=>t.check(Ac(T0,r)),t.base64=r=>t.check(qc(O0,r)),t.base64url=r=>t.check(Uc(C0,r)),t.xid=r=>t.check(Mc(E0,r)),t.ksuid=r=>t.check(jc(I0,r)),t.ipv4=r=>t.check(Dc(z0,r)),t.ipv6=r=>t.check(Zc(P0,r)),t.cidrv4=r=>t.check(Lc(R0,r)),t.cidrv6=r=>t.check(Fc(N0,r)),t.e164=r=>t.check(Vc(A0,r)),t.datetime=r=>t.check(fu(r)),t.date=r=>t.check(pu(r)),t.time=r=>t.check(mu(r)),t.duration=r=>t.check(hu(r))});function _(t){return $c(v0,t)}var de=v("ZodStringFormat",(t,e)=>{ae.init(t,e),im.init(t,e)}),b0=v("ZodEmail",(t,e)=>{La.init(t,e),de.init(t,e)});var nm=v("ZodGUID",(t,e)=>{Da.init(t,e),de.init(t,e)});var Ts=v("ZodUUID",(t,e)=>{Za.init(t,e),de.init(t,e)});var x0=v("ZodURL",(t,e)=>{Fa.init(t,e),de.init(t,e)});var w0=v("ZodEmoji",(t,e)=>{qa.init(t,e),de.init(t,e)});var S0=v("ZodNanoID",(t,e)=>{Ua.init(t,e),de.init(t,e)});var $0=v("ZodCUID",(t,e)=>{Va.init(t,e),de.init(t,e)});var k0=v("ZodCUID2",(t,e)=>{Ba.init(t,e),de.init(t,e)});var T0=v("ZodULID",(t,e)=>{Ha.init(t,e),de.init(t,e)});var E0=v("ZodXID",(t,e)=>{Ga.init(t,e),de.init(t,e)});var I0=v("ZodKSUID",(t,e)=>{Wa.init(t,e),de.init(t,e)});var z0=v("ZodIPv4",(t,e)=>{Ja.init(t,e),de.init(t,e)});var P0=v("ZodIPv6",(t,e)=>{Ka.init(t,e),de.init(t,e)});var R0=v("ZodCIDRv4",(t,e)=>{Xa.init(t,e),de.init(t,e)});var N0=v("ZodCIDRv6",(t,e)=>{Ya.init(t,e),de.init(t,e)});var O0=v("ZodBase64",(t,e)=>{Qa.init(t,e),de.init(t,e)});var C0=v("ZodBase64URL",(t,e)=>{ec.init(t,e),de.init(t,e)});var A0=v("ZodE164",(t,e)=>{tc.init(t,e),de.init(t,e)});var M0=v("ZodJWT",(t,e)=>{rc.init(t,e),de.init(t,e)});var am=v("ZodNumber",(t,e)=>{ps.init(t,e),ye.init(t,e),t.gt=(n,o)=>t.check(_s(n,o)),t.gte=(n,o)=>t.check(ro(n,o)),t.min=(n,o)=>t.check(ro(n,o)),t.lt=(n,o)=>t.check(ys(n,o)),t.lte=(n,o)=>t.check(to(n,o)),t.max=(n,o)=>t.check(to(n,o)),t.int=n=>t.check(om(n)),t.safe=n=>t.check(om(n)),t.positive=n=>t.check(_s(0,n)),t.nonnegative=n=>t.check(ro(0,n)),t.negative=n=>t.check(ys(0,n)),t.nonpositive=n=>t.check(to(0,n)),t.multipleOf=(n,o)=>t.check(vs(n,o)),t.step=(n,o)=>t.check(vs(n,o)),t.finite=()=>t;let r=t._zod.bag;t.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),t.isFinite=!0,t.format=r.format??null});function re(t){return Hc(am,t)}var j0=v("ZodNumberFormat",(t,e)=>{nc.init(t,e),am.init(t,e)});function om(t){return Gc(j0,t)}var D0=v("ZodBoolean",(t,e)=>{oc.init(t,e),ye.init(t,e)});function xe(t){return Wc(D0,t)}var Z0=v("ZodNull",(t,e)=>{sc.init(t,e),ye.init(t,e)});function _u(t){return Jc(Z0,t)}var L0=v("ZodUnknown",(t,e)=>{ic.init(t,e),ye.init(t,e)});function fe(){return Kc(L0)}var F0=v("ZodNever",(t,e)=>{ac.init(t,e),ye.init(t,e)});function q0(t){return Xc(F0,t)}var U0=v("ZodArray",(t,e)=>{cc.init(t,e),ye.init(t,e),t.element=e.element,t.min=(r,n)=>t.check(fn(r,n)),t.nonempty=r=>t.check(fn(1,r)),t.max=(r,n)=>t.check(bs(r,n)),t.length=(r,n)=>t.check(xs(r,n)),t.unwrap=()=>t.element});function K(t,e){return Vp(U0,t,e)}var cm=v("ZodObject",(t,e)=>{ms.init(t,e),ye.init(t,e),J.defineLazy(t,"shape",()=>e.shape),t.keyof=()=>Ue(Object.keys(t._zod.def.shape)),t.catchall=r=>t.clone({...t._zod.def,catchall:r}),t.passthrough=()=>t.clone({...t._zod.def,catchall:fe()}),t.loose=()=>t.clone({...t._zod.def,catchall:fe()}),t.strict=()=>t.clone({...t._zod.def,catchall:q0()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=r=>J.extend(t,r),t.merge=r=>J.merge(t,r),t.pick=r=>J.pick(t,r),t.omit=r=>J.omit(t,r),t.partial=(...r)=>J.partial(dm,t,r[0]),t.required=(...r)=>J.required(fm,t,r[0])});function P(t,e){let r={type:"object",get shape(){return J.assignProp(this,"shape",{...t}),this.shape},...J.normalizeParams(e)};return new cm(r)}function Me(t,e){return new cm({type:"object",get shape(){return J.assignProp(this,"shape",{...t}),this.shape},catchall:fe(),...J.normalizeParams(e)})}var um=v("ZodUnion",(t,e)=>{hs.init(t,e),ye.init(t,e),t.options=e.options});function ce(t,e){return new um({type:"union",options:t,...J.normalizeParams(e)})}var V0=v("ZodDiscriminatedUnion",(t,e)=>{um.init(t,e),uc.init(t,e)});function vu(t,e,r){return new V0({type:"union",options:e,discriminator:t,...J.normalizeParams(r)})}var B0=v("ZodIntersection",(t,e)=>{lc.init(t,e),ye.init(t,e)});function Es(t,e){return new B0({type:"intersection",left:t,right:e})}var H0=v("ZodRecord",(t,e)=>{dc.init(t,e),ye.init(t,e),t.keyType=e.keyType,t.valueType=e.valueType});function pe(t,e,r){return new H0({type:"record",keyType:t,valueType:e,...J.normalizeParams(r)})}var gu=v("ZodEnum",(t,e)=>{fc.init(t,e),ye.init(t,e),t.enum=e.entries,t.options=Object.values(e.entries);let r=new Set(Object.keys(e.entries));t.extract=(n,o)=>{let s={};for(let i of n)if(r.has(i))s[i]=e.entries[i];else throw new Error(`Key ${i} not found in enum`);return new gu({...e,checks:[],...J.normalizeParams(o),entries:s})},t.exclude=(n,o)=>{let s={...e.entries};for(let i of n)if(r.has(i))delete s[i];else throw new Error(`Key ${i} not found in enum`);return new gu({...e,checks:[],...J.normalizeParams(o),entries:s})}});function Ue(t,e){let r=Array.isArray(t)?Object.fromEntries(t.map(n=>[n,n])):t;return new gu({type:"enum",entries:r,...J.normalizeParams(e)})}var G0=v("ZodLiteral",(t,e)=>{pc.init(t,e),ye.init(t,e),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function O(t,e){return new G0({type:"literal",values:Array.isArray(t)?t:[t],...J.normalizeParams(e)})}var W0=v("ZodTransform",(t,e)=>{mc.init(t,e),ye.init(t,e),t._zod.parse=(r,n)=>{r.addIssue=s=>{if(typeof s=="string")r.issues.push(J.issue(s,r.value,e));else{let i=s;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=t),i.continue??(i.continue=!0),r.issues.push(J.issue(i))}};let o=e.transform(r.value,r);return o instanceof Promise?o.then(s=>(r.value=s,r)):(r.value=o,r)}});function lm(t){return new W0({type:"transform",transform:t})}var dm=v("ZodOptional",(t,e)=>{hc.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType});function ge(t){return new dm({type:"optional",innerType:t})}var J0=v("ZodNullable",(t,e)=>{gc.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType});function sm(t){return new J0({type:"nullable",innerType:t})}var K0=v("ZodDefault",(t,e)=>{yc.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function X0(t,e){return new K0({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}var Y0=v("ZodPrefault",(t,e)=>{_c.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType});function Q0(t,e){return new Y0({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}var fm=v("ZodNonOptional",(t,e)=>{vc.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType});function ew(t,e){return new fm({type:"nonoptional",innerType:t,...J.normalizeParams(e)})}var tw=v("ZodCatch",(t,e)=>{bc.init(t,e),ye.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function rw(t,e){return new tw({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}var nw=v("ZodPipe",(t,e)=>{xc.init(t,e),ye.init(t,e),t.in=e.in,t.out=e.out});function yu(t,e){return new nw({type:"pipe",in:t,out:e})}var ow=v("ZodReadonly",(t,e)=>{wc.init(t,e),ye.init(t,e)});function sw(t){return new ow({type:"readonly",innerType:t})}var pm=v("ZodCustom",(t,e)=>{Sc.init(t,e),ye.init(t,e)});function iw(t){let e=new $e({check:"custom"});return e._zod.check=t,e}function mm(t,e){return cu(pm,t??(()=>!0),e)}function aw(t,e={}){return uu(pm,t,e)}function cw(t){let e=iw(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(J.issue(n,r.value,e._zod.def));else{let o=n;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=e),o.continue??(o.continue=!e._zod.def.abort),r.issues.push(J.issue(o))}},t(r.value,r)));return e}function bu(t,e){return yu(lm(t),e)}We(Dp());var wu="2025-11-25";var hm=[wu,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],tr="io.modelcontextprotocol/related-task",zs="2.0",ke=mm(t=>t!==null&&(typeof t=="object"||typeof t=="function")),gm=ce([_(),re().int()]),ym=_(),_O=Me({ttl:ce([re(),_u()]).optional(),pollInterval:re().optional()}),uw=P({ttl:re().optional()}),lw=P({taskId:_()}),Su=Me({progressToken:gm.optional(),[tr]:lw.optional()}),Ke=P({_meta:Su.optional()}),so=Ke.extend({task:uw.optional()}),_m=t=>so.safeParse(t).success,Te=P({method:_(),params:Ke.loose().optional()}),tt=P({_meta:Su.optional()}),rt=P({method:_(),params:tt.loose().optional()}),Ee=Me({_meta:Su.optional()}),Ps=ce([_(),re().int()]),vm=P({jsonrpc:O(zs),id:Ps,...Te.shape}).strict(),$u=t=>vm.safeParse(t).success,bm=P({jsonrpc:O(zs),...rt.shape}).strict(),xm=t=>bm.safeParse(t).success,ku=P({jsonrpc:O(zs),id:Ps,result:Ee}).strict(),io=t=>ku.safeParse(t).success;var M;(function(t){t[t.ConnectionClosed=-32e3]="ConnectionClosed",t[t.RequestTimeout=-32001]="RequestTimeout",t[t.ParseError=-32700]="ParseError",t[t.InvalidRequest=-32600]="InvalidRequest",t[t.MethodNotFound=-32601]="MethodNotFound",t[t.InvalidParams=-32602]="InvalidParams",t[t.InternalError=-32603]="InternalError",t[t.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(M||(M={}));var Tu=P({jsonrpc:O(zs),id:Ps.optional(),error:P({code:re().int(),message:_(),data:fe().optional()})}).strict();var wm=t=>Tu.safeParse(t).success;var Sm=ce([vm,bm,ku,Tu]),vO=ce([ku,Tu]),Rs=Ee.strict(),dw=tt.extend({requestId:Ps.optional(),reason:_().optional()}),Ns=rt.extend({method:O("notifications/cancelled"),params:dw}),fw=P({src:_(),mimeType:_().optional(),sizes:K(_()).optional(),theme:Ue(["light","dark"]).optional()}),ao=P({icons:K(fw).optional()}),mn=P({name:_(),title:_().optional()}),$m=mn.extend({...mn.shape,...ao.shape,version:_(),websiteUrl:_().optional(),description:_().optional()}),pw=Es(P({applyDefaults:xe().optional()}),pe(_(),fe())),mw=bu(t=>t&&typeof t=="object"&&!Array.isArray(t)&&Object.keys(t).length===0?{form:{}}:t,Es(P({form:pw.optional(),url:ke.optional()}),pe(_(),fe()).optional())),hw=Me({list:ke.optional(),cancel:ke.optional(),requests:Me({sampling:Me({createMessage:ke.optional()}).optional(),elicitation:Me({create:ke.optional()}).optional()}).optional()}),gw=Me({list:ke.optional(),cancel:ke.optional(),requests:Me({tools:Me({call:ke.optional()}).optional()}).optional()}),yw=P({experimental:pe(_(),ke).optional(),sampling:P({context:ke.optional(),tools:ke.optional()}).optional(),elicitation:mw.optional(),roots:P({listChanged:xe().optional()}).optional(),tasks:hw.optional()}),_w=Ke.extend({protocolVersion:_(),capabilities:yw,clientInfo:$m}),Eu=Te.extend({method:O("initialize"),params:_w});var vw=P({experimental:pe(_(),ke).optional(),logging:ke.optional(),completions:ke.optional(),prompts:P({listChanged:xe().optional()}).optional(),resources:P({subscribe:xe().optional(),listChanged:xe().optional()}).optional(),tools:P({listChanged:xe().optional()}).optional(),tasks:gw.optional()}),bw=Ee.extend({protocolVersion:_(),capabilities:vw,serverInfo:$m,instructions:_().optional()}),Iu=rt.extend({method:O("notifications/initialized"),params:tt.optional()});var Os=Te.extend({method:O("ping"),params:Ke.optional()}),xw=P({progress:re(),total:ge(re()),message:ge(_())}),ww=P({...tt.shape,...xw.shape,progressToken:gm}),Cs=rt.extend({method:O("notifications/progress"),params:ww}),Sw=Ke.extend({cursor:ym.optional()}),co=Te.extend({params:Sw.optional()}),uo=Ee.extend({nextCursor:ym.optional()}),$w=Ue(["working","input_required","completed","failed","cancelled"]),lo=P({taskId:_(),status:$w,ttl:ce([re(),_u()]),createdAt:_(),lastUpdatedAt:_(),pollInterval:ge(re()),statusMessage:ge(_())}),hn=Ee.extend({task:lo}),kw=tt.merge(lo),fo=rt.extend({method:O("notifications/tasks/status"),params:kw}),As=Te.extend({method:O("tasks/get"),params:Ke.extend({taskId:_()})}),Ms=Ee.merge(lo),js=Te.extend({method:O("tasks/result"),params:Ke.extend({taskId:_()})}),bO=Ee.loose(),Ds=co.extend({method:O("tasks/list")}),Zs=uo.extend({tasks:K(lo)}),Ls=Te.extend({method:O("tasks/cancel"),params:Ke.extend({taskId:_()})}),km=Ee.merge(lo),Tm=P({uri:_(),mimeType:ge(_()),_meta:pe(_(),fe()).optional()}),Em=Tm.extend({text:_()}),zu=_().refine(t=>{try{return atob(t),!0}catch{return!1}},{message:"Invalid Base64 string"}),Im=Tm.extend({blob:zu}),po=Ue(["user","assistant"]),gn=P({audience:K(po).optional(),priority:re().min(0).max(1).optional(),lastModified:no.datetime({offset:!0}).optional()}),zm=P({...mn.shape,...ao.shape,uri:_(),description:ge(_()),mimeType:ge(_()),annotations:gn.optional(),_meta:ge(Me({}))}),Tw=P({...mn.shape,...ao.shape,uriTemplate:_(),description:ge(_()),mimeType:ge(_()),annotations:gn.optional(),_meta:ge(Me({}))}),Fs=co.extend({method:O("resources/list")}),Ew=uo.extend({resources:K(zm)}),qs=co.extend({method:O("resources/templates/list")}),Iw=uo.extend({resourceTemplates:K(Tw)}),Pu=Ke.extend({uri:_()}),zw=Pu,Us=Te.extend({method:O("resources/read"),params:zw}),Pw=Ee.extend({contents:K(ce([Em,Im]))}),Rw=rt.extend({method:O("notifications/resources/list_changed"),params:tt.optional()}),Nw=Pu,Ow=Te.extend({method:O("resources/subscribe"),params:Nw}),Cw=Pu,Aw=Te.extend({method:O("resources/unsubscribe"),params:Cw}),Mw=tt.extend({uri:_()}),jw=rt.extend({method:O("notifications/resources/updated"),params:Mw}),Dw=P({name:_(),description:ge(_()),required:ge(xe())}),Zw=P({...mn.shape,...ao.shape,description:ge(_()),arguments:ge(K(Dw)),_meta:ge(Me({}))}),Vs=co.extend({method:O("prompts/list")}),Lw=uo.extend({prompts:K(Zw)}),Fw=Ke.extend({name:_(),arguments:pe(_(),_()).optional()}),Bs=Te.extend({method:O("prompts/get"),params:Fw}),Ru=P({type:O("text"),text:_(),annotations:gn.optional(),_meta:pe(_(),fe()).optional()}),Nu=P({type:O("image"),data:zu,mimeType:_(),annotations:gn.optional(),_meta:pe(_(),fe()).optional()}),Ou=P({type:O("audio"),data:zu,mimeType:_(),annotations:gn.optional(),_meta:pe(_(),fe()).optional()}),qw=P({type:O("tool_use"),name:_(),id:_(),input:pe(_(),fe()),_meta:pe(_(),fe()).optional()}),Uw=P({type:O("resource"),resource:ce([Em,Im]),annotations:gn.optional(),_meta:pe(_(),fe()).optional()}),Vw=zm.extend({type:O("resource_link")}),Cu=ce([Ru,Nu,Ou,Vw,Uw]),Bw=P({role:po,content:Cu}),Hw=Ee.extend({description:_().optional(),messages:K(Bw)}),Gw=rt.extend({method:O("notifications/prompts/list_changed"),params:tt.optional()}),Ww=P({title:_().optional(),readOnlyHint:xe().optional(),destructiveHint:xe().optional(),idempotentHint:xe().optional(),openWorldHint:xe().optional()}),Jw=P({taskSupport:Ue(["required","optional","forbidden"]).optional()}),Pm=P({...mn.shape,...ao.shape,description:_().optional(),inputSchema:P({type:O("object"),properties:pe(_(),ke).optional(),required:K(_()).optional()}).catchall(fe()),outputSchema:P({type:O("object"),properties:pe(_(),ke).optional(),required:K(_()).optional()}).catchall(fe()).optional(),annotations:Ww.optional(),execution:Jw.optional(),_meta:pe(_(),fe()).optional()}),Hs=co.extend({method:O("tools/list")}),Kw=uo.extend({tools:K(Pm)}),Gs=Ee.extend({content:K(Cu).default([]),structuredContent:pe(_(),fe()).optional(),isError:xe().optional()}),xO=Gs.or(Ee.extend({toolResult:fe()})),Xw=so.extend({name:_(),arguments:pe(_(),fe()).optional()}),yn=Te.extend({method:O("tools/call"),params:Xw}),Yw=rt.extend({method:O("notifications/tools/list_changed"),params:tt.optional()}),wO=P({autoRefresh:xe().default(!0),debounceMs:re().int().nonnegative().default(300)}),mo=Ue(["debug","info","notice","warning","error","critical","alert","emergency"]),Qw=Ke.extend({level:mo}),Au=Te.extend({method:O("logging/setLevel"),params:Qw}),eS=tt.extend({level:mo,logger:_().optional(),data:fe()}),tS=rt.extend({method:O("notifications/message"),params:eS}),rS=P({name:_().optional()}),nS=P({hints:K(rS).optional(),costPriority:re().min(0).max(1).optional(),speedPriority:re().min(0).max(1).optional(),intelligencePriority:re().min(0).max(1).optional()}),oS=P({mode:Ue(["auto","required","none"]).optional()}),sS=P({type:O("tool_result"),toolUseId:_().describe("The unique identifier for the corresponding tool call."),content:K(Cu).default([]),structuredContent:P({}).loose().optional(),isError:xe().optional(),_meta:pe(_(),fe()).optional()}),iS=vu("type",[Ru,Nu,Ou]),Is=vu("type",[Ru,Nu,Ou,qw,sS]),aS=P({role:po,content:ce([Is,K(Is)]),_meta:pe(_(),fe()).optional()}),cS=so.extend({messages:K(aS),modelPreferences:nS.optional(),systemPrompt:_().optional(),includeContext:Ue(["none","thisServer","allServers"]).optional(),temperature:re().optional(),maxTokens:re().int(),stopSequences:K(_()).optional(),metadata:ke.optional(),tools:K(Pm).optional(),toolChoice:oS.optional()}),uS=Te.extend({method:O("sampling/createMessage"),params:cS}),Mu=Ee.extend({model:_(),stopReason:ge(Ue(["endTurn","stopSequence","maxTokens"]).or(_())),role:po,content:iS}),ju=Ee.extend({model:_(),stopReason:ge(Ue(["endTurn","stopSequence","maxTokens","toolUse"]).or(_())),role:po,content:ce([Is,K(Is)])}),lS=P({type:O("boolean"),title:_().optional(),description:_().optional(),default:xe().optional()}),dS=P({type:O("string"),title:_().optional(),description:_().optional(),minLength:re().optional(),maxLength:re().optional(),format:Ue(["email","uri","date","date-time"]).optional(),default:_().optional()}),fS=P({type:Ue(["number","integer"]),title:_().optional(),description:_().optional(),minimum:re().optional(),maximum:re().optional(),default:re().optional()}),pS=P({type:O("string"),title:_().optional(),description:_().optional(),enum:K(_()),default:_().optional()}),mS=P({type:O("string"),title:_().optional(),description:_().optional(),oneOf:K(P({const:_(),title:_()})),default:_().optional()}),hS=P({type:O("string"),title:_().optional(),description:_().optional(),enum:K(_()),enumNames:K(_()).optional(),default:_().optional()}),gS=ce([pS,mS]),yS=P({type:O("array"),title:_().optional(),description:_().optional(),minItems:re().optional(),maxItems:re().optional(),items:P({type:O("string"),enum:K(_())}),default:K(_()).optional()}),_S=P({type:O("array"),title:_().optional(),description:_().optional(),minItems:re().optional(),maxItems:re().optional(),items:P({anyOf:K(P({const:_(),title:_()}))}),default:K(_()).optional()}),vS=ce([yS,_S]),bS=ce([hS,gS,vS]),xS=ce([bS,lS,dS,fS]),wS=so.extend({mode:O("form").optional(),message:_(),requestedSchema:P({type:O("object"),properties:pe(_(),xS),required:K(_()).optional()})}),SS=so.extend({mode:O("url"),message:_(),elicitationId:_(),url:_().url()}),$S=ce([wS,SS]),kS=Te.extend({method:O("elicitation/create"),params:$S}),TS=tt.extend({elicitationId:_()}),ES=rt.extend({method:O("notifications/elicitation/complete"),params:TS}),Ws=Ee.extend({action:Ue(["accept","decline","cancel"]),content:bu(t=>t===null?void 0:t,pe(_(),ce([_(),re(),xe(),K(_())])).optional())}),IS=P({type:O("ref/resource"),uri:_()});var zS=P({type:O("ref/prompt"),name:_()}),PS=Ke.extend({ref:ce([zS,IS]),argument:P({name:_(),value:_()}),context:P({arguments:pe(_(),_()).optional()}).optional()}),Js=Te.extend({method:O("completion/complete"),params:PS});function Rm(t){if(t.params.ref.type!=="ref/prompt")throw new TypeError(`Expected CompleteRequestPrompt, but got ${t.params.ref.type}`)}function Nm(t){if(t.params.ref.type!=="ref/resource")throw new TypeError(`Expected CompleteRequestResourceTemplate, but got ${t.params.ref.type}`)}var RS=Ee.extend({completion:Me({values:K(_()).max(100),total:ge(re().int()),hasMore:ge(xe())})}),NS=P({uri:_().startsWith("file://"),name:_().optional(),_meta:pe(_(),fe()).optional()}),OS=Te.extend({method:O("roots/list"),params:Ke.optional()}),Du=Ee.extend({roots:K(NS)}),CS=rt.extend({method:O("notifications/roots/list_changed"),params:tt.optional()}),SO=ce([Os,Eu,Js,Au,Bs,Vs,Fs,qs,Us,Ow,Aw,yn,Hs,As,js,Ds,Ls]),$O=ce([Ns,Cs,Iu,CS,fo]),kO=ce([Rs,Mu,ju,Ws,Du,Ms,Zs,hn]),TO=ce([Os,uS,kS,OS,As,js,Ds,Ls]),EO=ce([Ns,Cs,tS,jw,Rw,Yw,Gw,fo,ES]),IO=ce([Rs,bw,RS,Hw,Lw,Ew,Iw,Pw,Gs,Kw,Ms,Zs,hn]),N=class t extends Error{constructor(e,r,n){super(`MCP error ${e}: ${r}`),this.code=e,this.data=n,this.name="McpError"}static fromError(e,r,n){if(e===M.UrlElicitationRequired&&n){let o=n;if(o.elicitations)return new xu(o.elicitations,r)}return new t(e,r,n)}},xu=class extends N{constructor(e,r=`URL elicitation${e.length>1?"s":""} required`){super(M.UrlElicitationRequired,r,{elicitations:e})}get elicitations(){return this.data?.elicitations??[]}};function rr(t){return t==="completed"||t==="failed"||t==="cancelled"}var Cm=Symbol("Let zodToJsonSchema decide on which parser to use");var Om={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Am=t=>typeof t=="string"?{...Om,name:t}:{...Om,...t};var Mm=t=>{let e=Am(t),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,o])=>[o._def,{def:o._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function Zu(t,e,r,n){n?.errorMessages&&r&&(t.errorMessage={...t.errorMessage,[e]:r})}function X(t,e,r,n,o){t[e]=r,Zu(t,e,n,o)}var Ks=(t,e)=>{let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);return[(t.length-r).toString(),...e.slice(r)].join("/")};function me(t){if(t.target!=="openAi")return{};let e=[...t.basePath,t.definitionPath,t.openAiAnyTypeName];return t.flags.hasReferencedOpenAiAnyType=!0,{$ref:t.$refStrategy==="relative"?Ks(e,t.currentPath):e.join("/")}}function jm(t,e){let r={type:"array"};return t.type?._def&&t.type?._def?.typeName!==$.ZodAny&&(r.items=L(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&X(r,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&X(r,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(X(r,"minItems",t.exactLength.value,t.exactLength.message,e),X(r,"maxItems",t.exactLength.value,t.exactLength.message,e)),r}function Dm(t,e){let r={type:"integer",format:"int64"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?X(r,"minimum",n.value,n.message,e):X(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),X(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?X(r,"maximum",n.value,n.message,e):X(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),X(r,"maximum",n.value,n.message,e));break;case"multipleOf":X(r,"multipleOf",n.value,n.message,e);break}return r}function Zm(){return{type:"boolean"}}function Xs(t,e){return L(t.type._def,e)}var Lm=(t,e)=>L(t.innerType._def,e);function Lu(t,e,r){let n=r??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((o,s)=>Lu(t,e,o))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return AS(t,e)}}var AS=(t,e)=>{let r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(let n of t.checks)switch(n.kind){case"min":X(r,"minimum",n.value,n.message,e);break;case"max":X(r,"maximum",n.value,n.message,e);break}return r};function Fm(t,e){return{...L(t.innerType._def,e),default:t.defaultValue()}}function qm(t,e){return e.effectStrategy==="input"?L(t.schema._def,e):me(e)}function Um(t){return{type:"string",enum:Array.from(t.values)}}var MS=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function Vm(t,e){let r=[L(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),L(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,o=[];return r.forEach(s=>{if(MS(s))o.push(...s.allOf),s.unevaluatedProperties===void 0&&(n=void 0);else{let i=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:a,...c}=s;i=c}else n=void 0;o.push(i)}}),o.length?{allOf:o,...n}:void 0}function Bm(t,e){let r=typeof t.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[t.value]}:{type:r==="bigint"?"integer":r,const:t.value}}var Fu,ft={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Fu===void 0&&(Fu=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Fu),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Ys(t,e){let r={type:"string"};if(t.checks)for(let n of t.checks)switch(n.kind){case"min":X(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e);break;case"max":X(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":pt(r,"email",n.message,e);break;case"format:idn-email":pt(r,"idn-email",n.message,e);break;case"pattern:zod":je(r,ft.email,n.message,e);break}break;case"url":pt(r,"uri",n.message,e);break;case"uuid":pt(r,"uuid",n.message,e);break;case"regex":je(r,n.regex,n.message,e);break;case"cuid":je(r,ft.cuid,n.message,e);break;case"cuid2":je(r,ft.cuid2,n.message,e);break;case"startsWith":je(r,RegExp(`^${qu(n.value,e)}`),n.message,e);break;case"endsWith":je(r,RegExp(`${qu(n.value,e)}$`),n.message,e);break;case"datetime":pt(r,"date-time",n.message,e);break;case"date":pt(r,"date",n.message,e);break;case"time":pt(r,"time",n.message,e);break;case"duration":pt(r,"duration",n.message,e);break;case"length":X(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e),X(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"includes":{je(r,RegExp(qu(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&pt(r,"ipv4",n.message,e),n.version!=="v4"&&pt(r,"ipv6",n.message,e);break}case"base64url":je(r,ft.base64url,n.message,e);break;case"jwt":je(r,ft.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&je(r,ft.ipv4Cidr,n.message,e),n.version!=="v4"&&je(r,ft.ipv6Cidr,n.message,e);break}case"emoji":je(r,ft.emoji(),n.message,e);break;case"ulid":{je(r,ft.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{pt(r,"binary",n.message,e);break}case"contentEncoding:base64":{X(r,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{je(r,ft.base64,n.message,e);break}}break}case"nanoid":je(r,ft.nanoid,n.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}function qu(t,e){return e.patternStrategy==="escape"?DS(t):t}var jS=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function DS(t){let e="";for(let r=0;r<t.length;r++)jS.has(t[r])||(e+="\\"),e+=t[r];return e}function pt(t,e,r,n){t.format||t.anyOf?.some(o=>o.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&n.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...r&&n.errorMessages&&{errorMessage:{format:r}}})):X(t,"format",e,r,n)}function je(t,e,r,n){t.pattern||t.allOf?.some(o=>o.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&n.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:Hm(e,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):X(t,"pattern",Hm(e,n),r,n)}function Hm(t,e){if(!e.applyRegexFlags||!t.flags)return t.source;let r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},n=r.i?t.source.toLowerCase():t.source,o="",s=!1,i=!1,a=!1;for(let c=0;c<n.length;c++){if(s){o+=n[c],s=!1;continue}if(r.i){if(i){if(n[c].match(/[a-z]/)){a?(o+=n[c],o+=`${n[c-2]}-${n[c]}`.toUpperCase(),a=!1):n[c+1]==="-"&&n[c+2]?.match(/[a-z]/)?(o+=n[c],a=!0):o+=`${n[c]}${n[c].toUpperCase()}`;continue}}else if(n[c].match(/[a-z]/)){o+=`[${n[c]}${n[c].toUpperCase()}]`;continue}}if(r.m){if(n[c]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(n[c]==="$"){o+=`($|(?=[\r
]))`;continue}}if(r.s&&n[c]==="."){o+=i?`${n[c]}\r
`:`[${n[c]}\r
]`;continue}o+=n[c],n[c]==="\\"?s=!0:i&&n[c]==="]"?i=!1:!i&&n[c]==="["&&(i=!0)}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return o}function Qs(t,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&t.keyType?._def.typeName===$.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((n,o)=>({...n,[o]:L(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",o]})??me(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let r={type:"object",additionalProperties:L(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return r;if(t.keyType?._def.typeName===$.ZodString&&t.keyType._def.checks?.length){let{type:n,...o}=Ys(t.keyType._def,e);return{...r,propertyNames:o}}else{if(t.keyType?._def.typeName===$.ZodEnum)return{...r,propertyNames:{enum:t.keyType._def.values}};if(t.keyType?._def.typeName===$.ZodBranded&&t.keyType._def.type._def.typeName===$.ZodString&&t.keyType._def.type._def.checks?.length){let{type:n,...o}=Xs(t.keyType._def,e);return{...r,propertyNames:o}}}return r}function Gm(t,e){if(e.mapStrategy==="record")return Qs(t,e);let r=L(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||me(e),n=L(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||me(e);return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function Wm(t){let e=t.values,n=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),o=Array.from(new Set(n.map(s=>typeof s)));return{type:o.length===1?o[0]==="string"?"string":"number":["string","number"],enum:n}}function Jm(t){return t.target==="openAi"?void 0:{not:me({...t,currentPath:[...t.currentPath,"not"]})}}function Km(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var ho={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Ym(t,e){if(e.target==="openApi3")return Xm(t,e);let r=t.options instanceof Map?Array.from(t.options.values()):t.options;if(r.every(n=>n._def.typeName in ho&&(!n._def.checks||!n._def.checks.length))){let n=r.reduce((o,s)=>{let i=ho[s._def.typeName];return i&&!o.includes(i)?[...o,i]:o},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=r.reduce((o,s)=>{let i=typeof s._def.value;switch(i){case"string":case"number":case"boolean":return[...o,i];case"bigint":return[...o,"integer"];case"object":if(s._def.value===null)return[...o,"null"];case"symbol":case"undefined":case"function":default:return o}},[]);if(n.length===r.length){let o=n.filter((s,i,a)=>a.indexOf(s)===i);return{type:o.length>1?o:o[0],enum:r.reduce((s,i)=>s.includes(i._def.value)?s:[...s,i._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,o)=>[...n,...o._def.values.filter(s=>!n.includes(s))],[])};return Xm(t,e)}var Xm=(t,e)=>{let r=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((n,o)=>L(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${o}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function Qm(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:ho[t.innerType._def.typeName],nullable:!0}:{type:[ho[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=L(t.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let r=L(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function eh(t,e){let r={type:"number"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"int":r.type="integer",Zu(r,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?X(r,"minimum",n.value,n.message,e):X(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),X(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?X(r,"maximum",n.value,n.message,e):X(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),X(r,"maximum",n.value,n.message,e));break;case"multipleOf":X(r,"multipleOf",n.value,n.message,e);break}return r}function th(t,e){let r=e.target==="openAi",n={type:"object",properties:{}},o=[],s=t.shape();for(let a in s){let c=s[a];if(c===void 0||c._def===void 0)continue;let u=LS(c);u&&r&&(c._def.typeName==="ZodOptional"&&(c=c._def.innerType),c.isNullable()||(c=c.nullable()),u=!1);let l=L(c._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});l!==void 0&&(n.properties[a]=l,u||o.push(a))}o.length&&(n.required=o);let i=ZS(t,e);return i!==void 0&&(n.additionalProperties=i),n}function ZS(t,e){if(t.catchall._def.typeName!=="ZodNever")return L(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function LS(t){try{return t.isOptional()}catch{return!0}}var rh=(t,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return L(t.innerType._def,e);let r=L(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:me(e)},r]}:me(e)};var nh=(t,e)=>{if(e.pipeStrategy==="input")return L(t.in._def,e);if(e.pipeStrategy==="output")return L(t.out._def,e);let r=L(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=L(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(o=>o!==void 0)}};function oh(t,e){return L(t.type._def,e)}function sh(t,e){let n={type:"array",uniqueItems:!0,items:L(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&X(n,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&X(n,"maxItems",t.maxSize.value,t.maxSize.message,e),n}function ih(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((r,n)=>L(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:L(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((r,n)=>L(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function ah(t){return{not:me(t)}}function ch(t){return me(t)}var uh=(t,e)=>L(t.innerType._def,e);var lh=(t,e,r)=>{switch(e){case $.ZodString:return Ys(t,r);case $.ZodNumber:return eh(t,r);case $.ZodObject:return th(t,r);case $.ZodBigInt:return Dm(t,r);case $.ZodBoolean:return Zm();case $.ZodDate:return Lu(t,r);case $.ZodUndefined:return ah(r);case $.ZodNull:return Km(r);case $.ZodArray:return jm(t,r);case $.ZodUnion:case $.ZodDiscriminatedUnion:return Ym(t,r);case $.ZodIntersection:return Vm(t,r);case $.ZodTuple:return ih(t,r);case $.ZodRecord:return Qs(t,r);case $.ZodLiteral:return Bm(t,r);case $.ZodEnum:return Um(t);case $.ZodNativeEnum:return Wm(t);case $.ZodNullable:return Qm(t,r);case $.ZodOptional:return rh(t,r);case $.ZodMap:return Gm(t,r);case $.ZodSet:return sh(t,r);case $.ZodLazy:return()=>t.getter()._def;case $.ZodPromise:return oh(t,r);case $.ZodNaN:case $.ZodNever:return Jm(r);case $.ZodEffects:return qm(t,r);case $.ZodAny:return me(r);case $.ZodUnknown:return ch(r);case $.ZodDefault:return Fm(t,r);case $.ZodBranded:return Xs(t,r);case $.ZodReadonly:return uh(t,r);case $.ZodCatch:return Lm(t,r);case $.ZodPipeline:return nh(t,r);case $.ZodFunction:case $.ZodVoid:case $.ZodSymbol:return;default:return(n=>{})(e)}};function L(t,e,r=!1){let n=e.seen.get(t);if(e.override){let a=e.override?.(t,e,n,r);if(a!==Cm)return a}if(n&&!r){let a=FS(n,e);if(a!==void 0)return a}let o={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,o);let s=lh(t,t.typeName,e),i=typeof s=="function"?L(s(),e):s;if(i&&qS(t,e,i),e.postProcess){let a=e.postProcess(i,t,e);return o.jsonSchema=i,a}return o.jsonSchema=i,i}var FS=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:Ks(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,n)=>e.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),me(e)):e.$refStrategy==="seen"?me(e):void 0}},qS=(t,e,r)=>(t.description&&(r.description=t.description,e.markdownDescription&&(r.markdownDescription=t.description)),r);var Uu=(t,e)=>{let r=Mm(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((c,[u,l])=>({...c,[u]:L(l._def,{...r,currentPath:[...r.basePath,r.definitionPath,u]},!0)??me(r)}),{}):void 0,o=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,s=L(t._def,o===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,o]},!1)??me(r),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i),r.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[r.openAiAnyTypeName]||(n[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:r.$refStrategy==="relative"?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));let a=o===void 0?n?{...s,[r.definitionPath]:n}:s:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,o].join("/"),[r.definitionPath]:{...n,[o]:s}};return r.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function US(t){return!t||t==="jsonSchema7"||t==="draft-7"?"draft-7":t==="jsonSchema2019-09"||t==="draft-2020-12"?"draft-2020-12":"draft-7"}function Vu(t,e){return et(t)?lu(t,{target:US(e?.target),io:e?.pipeStrategy??"input"}):Uu(t,{strictUnions:e?.strictUnions??!0,pipeStrategy:e?.pipeStrategy??"input"})}function Bu(t){let r=er(t)?.method;if(!r)throw new Error("Schema is missing a method literal");let n=ks(r);if(typeof n!="string")throw new Error("Schema method literal must be a string");return n}function Hu(t,e){let r=Qt(t,e);if(!r.success)throw r.error;return r.data}var VS=6e4,ei=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(Ns,r=>{this._oncancel(r)}),this.setNotificationHandler(Cs,r=>{this._onprogress(r)}),this.setRequestHandler(Os,r=>({})),this._taskStore=e?.taskStore,this._taskMessageQueue=e?.taskMessageQueue,this._taskStore&&(this.setRequestHandler(As,async(r,n)=>{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new N(M.InvalidParams,"Failed to retrieve task: Task not found");return{...o}}),this.setRequestHandler(js,async(r,n)=>{let o=async()=>{let s=r.params.taskId;if(this._taskMessageQueue){let a;for(;a=await this._taskMessageQueue.dequeue(s,n.sessionId);){if(a.type==="response"||a.type==="error"){let c=a.message,u=c.id,l=this._requestResolvers.get(u);if(l)if(this._requestResolvers.delete(u),a.type==="response")l(c);else{let d=c,g=new N(d.error.code,d.error.message,d.error.data);l(g)}else{let d=a.type==="response"?"Response":"Error";this._onerror(new Error(`${d} handler missing for request ${u}`))}continue}await this._transport?.send(a.message,{relatedRequestId:n.requestId})}}let i=await this._taskStore.getTask(s,n.sessionId);if(!i)throw new N(M.InvalidParams,`Task not found: ${s}`);if(!rr(i.status))return await this._waitForTaskUpdate(s,n.signal),await o();if(rr(i.status)){let a=await this._taskStore.getTaskResult(s,n.sessionId);return this._clearTaskQueue(s),{...a,_meta:{...a._meta,[tr]:{taskId:s}}}}return await o()};return await o()}),this.setRequestHandler(Ds,async(r,n)=>{try{let{tasks:o,nextCursor:s}=await this._taskStore.listTasks(r.params?.cursor,n.sessionId);return{tasks:o,nextCursor:s,_meta:{}}}catch(o){throw new N(M.InvalidParams,`Failed to list tasks: ${o instanceof Error?o.message:String(o)}`)}}),this.setRequestHandler(Ls,async(r,n)=>{try{let o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new N(M.InvalidParams,`Task not found: ${r.params.taskId}`);if(rr(o.status))throw new N(M.InvalidParams,`Cannot cancel task in terminal status: ${o.status}`);await this._taskStore.updateTaskStatus(r.params.taskId,"cancelled","Client cancelled task execution.",n.sessionId),this._clearTaskQueue(r.params.taskId);let s=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!s)throw new N(M.InvalidParams,`Task not found after cancellation: ${r.params.taskId}`);return{_meta:{},...s}}catch(o){throw o instanceof N?o:new N(M.InvalidRequest,`Failed to cancel task: ${o instanceof Error?o.message:String(o)}`)}}))}async _oncancel(e){if(!e.params.requestId)return;this._requestHandlerAbortControllers.get(e.params.requestId)?.abort(e.params.reason)}_setupTimeout(e,r,n,o,s=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(o,r),startTime:Date.now(),timeout:r,maxTotalTimeout:n,resetTimeoutOnProgress:s,onTimeout:o})}_resetTimeout(e){let r=this._timeoutInfo.get(e);if(!r)return!1;let n=Date.now()-r.startTime;if(r.maxTotalTimeout&&n>=r.maxTotalTimeout)throw this._timeoutInfo.delete(e),N.fromError(M.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:r.maxTotalTimeout,totalElapsed:n});return clearTimeout(r.timeoutId),r.timeoutId=setTimeout(r.onTimeout,r.timeout),!0}_cleanupTimeout(e){let r=this._timeoutInfo.get(e);r&&(clearTimeout(r.timeoutId),this._timeoutInfo.delete(e))}async connect(e){if(this._transport)throw new Error("Already connected to a transport. Call close() before connecting to a new transport, or use a separate Protocol instance per connection.");this._transport=e;let r=this.transport?.onclose;this._transport.onclose=()=>{r?.(),this._onclose()};let n=this.transport?.onerror;this._transport.onerror=s=>{n?.(s),this._onerror(s)};let o=this._transport?.onmessage;this._transport.onmessage=(s,i)=>{o?.(s,i),io(s)||wm(s)?this._onresponse(s):$u(s)?this._onrequest(s,i):xm(s)?this._onnotification(s):this._onerror(new Error(`Unknown message type: ${JSON.stringify(s)}`))},await this._transport.start()}_onclose(){let e=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();for(let n of this._requestHandlerAbortControllers.values())n.abort();this._requestHandlerAbortControllers.clear();let r=N.fromError(M.ConnectionClosed,"Connection closed");this._transport=void 0,this.onclose?.();for(let n of e.values())n(r)}_onerror(e){this.onerror?.(e)}_onnotification(e){let r=this._notificationHandlers.get(e.method)??this.fallbackNotificationHandler;r!==void 0&&Promise.resolve().then(()=>r(e)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(e,r){let n=this._requestHandlers.get(e.method)??this.fallbackRequestHandler,o=this._transport,s=e.params?._meta?.[tr]?.taskId;if(n===void 0){let l={jsonrpc:"2.0",id:e.id,error:{code:M.MethodNotFound,message:"Method not found"}};s&&this._taskMessageQueue?this._enqueueTaskMessage(s,{type:"error",message:l,timestamp:Date.now()},o?.sessionId).catch(d=>this._onerror(new Error(`Failed to enqueue error response: ${d}`))):o?.send(l).catch(d=>this._onerror(new Error(`Failed to send an error response: ${d}`)));return}let i=new AbortController;this._requestHandlerAbortControllers.set(e.id,i);let a=_m(e.params)?e.params.task:void 0,c=this._taskStore?this.requestTaskStore(e,o?.sessionId):void 0,u={signal:i.signal,sessionId:o?.sessionId,_meta:e.params?._meta,sendNotification:async l=>{if(i.signal.aborted)return;let d={relatedRequestId:e.id};s&&(d.relatedTask={taskId:s}),await this.notification(l,d)},sendRequest:async(l,d,g)=>{if(i.signal.aborted)throw new N(M.ConnectionClosed,"Request was cancelled");let h={...g,relatedRequestId:e.id};s&&!h.relatedTask&&(h.relatedTask={taskId:s});let p=h.relatedTask?.taskId??s;return p&&c&&await c.updateTaskStatus(p,"input_required"),await this.request(l,d,h)},authInfo:r?.authInfo,requestId:e.id,requestInfo:r?.requestInfo,taskId:s,taskStore:c,taskRequestedTtl:a?.ttl,closeSSEStream:r?.closeSSEStream,closeStandaloneSSEStream:r?.closeStandaloneSSEStream};Promise.resolve().then(()=>{a&&this.assertTaskHandlerCapability(e.method)}).then(()=>n(e,u)).then(async l=>{if(i.signal.aborted)return;let d={result:l,jsonrpc:"2.0",id:e.id};s&&this._taskMessageQueue?await this._enqueueTaskMessage(s,{type:"response",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)},async l=>{if(i.signal.aborted)return;let d={jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(l.code)?l.code:M.InternalError,message:l.message??"Internal error",...l.data!==void 0&&{data:l.data}}};s&&this._taskMessageQueue?await this._enqueueTaskMessage(s,{type:"error",message:d,timestamp:Date.now()},o?.sessionId):await o?.send(d)}).catch(l=>this._onerror(new Error(`Failed to send response: ${l}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){let{progressToken:r,...n}=e.params,o=Number(r),s=this._progressHandlers.get(o);if(!s){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}let i=this._responseHandlers.get(o),a=this._timeoutInfo.get(o);if(a&&i&&a.resetTimeoutOnProgress)try{this._resetTimeout(o)}catch(c){this._responseHandlers.delete(o),this._progressHandlers.delete(o),this._cleanupTimeout(o),i(c);return}s(n)}_onresponse(e){let r=Number(e.id),n=this._requestResolvers.get(r);if(n){if(this._requestResolvers.delete(r),io(e))n(e);else{let i=new N(e.error.code,e.error.message,e.error.data);n(i)}return}let o=this._responseHandlers.get(r);if(o===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}this._responseHandlers.delete(r),this._cleanupTimeout(r);let s=!1;if(io(e)&&e.result&&typeof e.result=="object"){let i=e.result;if(i.task&&typeof i.task=="object"){let a=i.task;typeof a.taskId=="string"&&(s=!0,this._taskProgressTokens.set(a.taskId,r))}}if(s||this._progressHandlers.delete(r),io(e))o(e);else{let i=N.fromError(e.error.code,e.error.message,e.error.data);o(i)}}get transport(){return this._transport}async close(){await this._transport?.close()}async*requestStream(e,r,n){let{task:o}=n??{};if(!o){try{yield{type:"result",result:await this.request(e,r,n)}}catch(i){yield{type:"error",error:i instanceof N?i:new N(M.InternalError,String(i))}}return}let s;try{let i=await this.request(e,hn,n);if(i.task)s=i.task.taskId,yield{type:"taskCreated",task:i.task};else throw new N(M.InternalError,"Task creation did not return a task");for(;;){let a=await this.getTask({taskId:s},n);if(yield{type:"taskStatus",task:a},rr(a.status)){a.status==="completed"?yield{type:"result",result:await this.getTaskResult({taskId:s},r,n)}:a.status==="failed"?yield{type:"error",error:new N(M.InternalError,`Task ${s} failed`)}:a.status==="cancelled"&&(yield{type:"error",error:new N(M.InternalError,`Task ${s} was cancelled`)});return}if(a.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:s},r,n)};return}let c=a.pollInterval??this._options?.defaultTaskPollInterval??1e3;await new Promise(u=>setTimeout(u,c)),n?.signal?.throwIfAborted()}}catch(i){yield{type:"error",error:i instanceof N?i:new N(M.InternalError,String(i))}}}request(e,r,n){let{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i,task:a,relatedTask:c}=n??{};return new Promise((u,l)=>{let d=x=>{l(x)};if(!this._transport){d(new Error("Not connected"));return}if(this._options?.enforceStrictCapabilities===!0)try{this.assertCapabilityForMethod(e.method),a&&this.assertTaskCapability(e.method)}catch(x){d(x);return}n?.signal?.throwIfAborted();let g=this._requestMessageId++,h={...e,jsonrpc:"2.0",id:g};n?.onprogress&&(this._progressHandlers.set(g,n.onprogress),h.params={...e.params,_meta:{...e.params?._meta||{},progressToken:g}}),a&&(h.params={...h.params,task:a}),c&&(h.params={...h.params,_meta:{...h.params?._meta||{},[tr]:c}});let p=x=>{this._responseHandlers.delete(g),this._progressHandlers.delete(g),this._cleanupTimeout(g),this._transport?.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:g,reason:String(x)}},{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i}).catch(z=>this._onerror(new Error(`Failed to send cancellation: ${z}`)));let S=x instanceof N?x:new N(M.RequestTimeout,String(x));l(S)};this._responseHandlers.set(g,x=>{if(!n?.signal?.aborted){if(x instanceof Error)return l(x);try{let S=Qt(r,x.result);S.success?u(S.data):l(S.error)}catch(S){l(S)}}}),n?.signal?.addEventListener("abort",()=>{p(n?.signal?.reason)});let f=n?.timeout??VS,y=()=>p(N.fromError(M.RequestTimeout,"Request timed out",{timeout:f}));this._setupTimeout(g,f,n?.maxTotalTimeout,y,n?.resetTimeoutOnProgress??!1);let b=c?.taskId;if(b){let x=S=>{let z=this._responseHandlers.get(g);z?z(S):this._onerror(new Error(`Response handler missing for side-channeled request ${g}`))};this._requestResolvers.set(g,x),this._enqueueTaskMessage(b,{type:"request",message:h,timestamp:Date.now()}).catch(S=>{this._cleanupTimeout(g),l(S)})}else this._transport.send(h,{relatedRequestId:o,resumptionToken:s,onresumptiontoken:i}).catch(x=>{this._cleanupTimeout(g),l(x)})})}async getTask(e,r){return this.request({method:"tasks/get",params:e},Ms,r)}async getTaskResult(e,r,n){return this.request({method:"tasks/result",params:e},r,n)}async listTasks(e,r){return this.request({method:"tasks/list",params:e},Zs,r)}async cancelTask(e,r){return this.request({method:"tasks/cancel",params:e},km,r)}async notification(e,r){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);let n=r?.relatedTask?.taskId;if(n){let a={...e,jsonrpc:"2.0",params:{...e.params,_meta:{...e.params?._meta||{},[tr]:r.relatedTask}}};await this._enqueueTaskMessage(n,{type:"notification",message:a,timestamp:Date.now()});return}if((this._options?.debouncedNotificationMethods??[]).includes(e.method)&&!e.params&&!r?.relatedRequestId&&!r?.relatedTask){if(this._pendingDebouncedNotifications.has(e.method))return;this._pendingDebouncedNotifications.add(e.method),Promise.resolve().then(()=>{if(this._pendingDebouncedNotifications.delete(e.method),!this._transport)return;let a={...e,jsonrpc:"2.0"};r?.relatedTask&&(a={...a,params:{...a.params,_meta:{...a.params?._meta||{},[tr]:r.relatedTask}}}),this._transport?.send(a,r).catch(c=>this._onerror(c))});return}let i={...e,jsonrpc:"2.0"};r?.relatedTask&&(i={...i,params:{...i.params,_meta:{...i.params?._meta||{},[tr]:r.relatedTask}}}),await this._transport.send(i,r)}setRequestHandler(e,r){let n=Bu(e);this.assertRequestHandlerCapability(n),this._requestHandlers.set(n,(o,s)=>{let i=Hu(e,o);return Promise.resolve(r(i,s))})}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,r){let n=Bu(e);this._notificationHandlers.set(n,o=>{let s=Hu(e,o);return Promise.resolve(r(s))})}removeNotificationHandler(e){this._notificationHandlers.delete(e)}_cleanupTaskProgressHandler(e){let r=this._taskProgressTokens.get(e);r!==void 0&&(this._progressHandlers.delete(r),this._taskProgressTokens.delete(e))}async _enqueueTaskMessage(e,r,n){if(!this._taskStore||!this._taskMessageQueue)throw new Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");let o=this._options?.maxTaskQueueSize;await this._taskMessageQueue.enqueue(e,r,n,o)}async _clearTaskQueue(e,r){if(this._taskMessageQueue){let n=await this._taskMessageQueue.dequeueAll(e,r);for(let o of n)if(o.type==="request"&&$u(o.message)){let s=o.message.id,i=this._requestResolvers.get(s);i?(i(new N(M.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(s)):this._onerror(new Error(`Resolver missing for request ${s} during task ${e} cleanup`))}}}async _waitForTaskUpdate(e,r){let n=this._options?.defaultTaskPollInterval??1e3;try{let o=await this._taskStore?.getTask(e);o?.pollInterval&&(n=o.pollInterval)}catch{}return new Promise((o,s)=>{if(r.aborted){s(new N(M.InvalidRequest,"Request cancelled"));return}let i=setTimeout(o,n);r.addEventListener("abort",()=>{clearTimeout(i),s(new N(M.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(e,r){let n=this._taskStore;if(!n)throw new Error("No task store configured");return{createTask:async o=>{if(!e)throw new Error("No request provided");return await n.createTask(o,e.id,{method:e.method,params:e.params},r)},getTask:async o=>{let s=await n.getTask(o,r);if(!s)throw new N(M.InvalidParams,"Failed to retrieve task: Task not found");return s},storeTaskResult:async(o,s,i)=>{await n.storeTaskResult(o,s,i,r);let a=await n.getTask(o,r);if(a){let c=fo.parse({method:"notifications/tasks/status",params:a});await this.notification(c),rr(a.status)&&this._cleanupTaskProgressHandler(o)}},getTaskResult:o=>n.getTaskResult(o,r),updateTaskStatus:async(o,s,i)=>{let a=await n.getTask(o,r);if(!a)throw new N(M.InvalidParams,`Task "${o}" not found - it may have been cleaned up`);if(rr(a.status))throw new N(M.InvalidParams,`Cannot update task "${o}" from terminal status "${a.status}" to "${s}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await n.updateTaskStatus(o,s,i,r);let c=await n.getTask(o,r);if(c){let u=fo.parse({method:"notifications/tasks/status",params:c});await this.notification(u),rr(c.status)&&this._cleanupTaskProgressHandler(o)}},listTasks:o=>n.listTasks(o,r)}}};function dh(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function fh(t,e){let r={...t};for(let n in e){let o=n,s=e[o];if(s===void 0)continue;let i=r[o];dh(i)&&dh(s)?r[o]={...i,...s}:r[o]=s}return r}var Yy=Ht(Rd(),1),Qy=Ht(Xy(),1);function Cz(){let t=new Yy.default({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return(0,Qy.default)(t),t}var ji=class{constructor(e){this._ajv=e??Cz()}getValidator(e){let r="$id"in e&&typeof e.$id=="string"?this._ajv.getSchema(e.$id)??this._ajv.compile(e):this._ajv.compile(e);return n=>r(n)?{valid:!0,data:n,errorMessage:void 0}:{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(r.errors)}}};var Di=class{constructor(e){this._server=e}requestStream(e,r,n){return this._server.requestStream(e,r,n)}async getTask(e,r){return this._server.getTask({taskId:e},r)}async getTaskResult(e,r,n){return this._server.getTaskResult({taskId:e},r,n)}async listTasks(e,r){return this._server.listTasks(e?{cursor:e}:void 0,r)}async cancelTask(e,r){return this._server.cancelTask({taskId:e},r)}};function e_(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"tools/call":if(!t.tools?.call)throw new Error(`${r} does not support task creation for tools/call (required for ${e})`);break;default:break}}function t_(t,e,r){if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"sampling/createMessage":if(!t.sampling?.createMessage)throw new Error(`${r} does not support task creation for sampling/createMessage (required for ${e})`);break;case"elicitation/create":if(!t.elicitation?.create)throw new Error(`${r} does not support task creation for elicitation/create (required for ${e})`);break;default:break}}var Zi=class extends ei{constructor(e,r){super(r),this._serverInfo=e,this._loggingLevels=new Map,this.LOG_LEVEL_SEVERITY=new Map(mo.options.map((n,o)=>[n,o])),this.isMessageIgnored=(n,o)=>{let s=this._loggingLevels.get(o);return s?this.LOG_LEVEL_SEVERITY.get(n)<this.LOG_LEVEL_SEVERITY.get(s):!1},this._capabilities=r?.capabilities??{},this._instructions=r?.instructions,this._jsonSchemaValidator=r?.jsonSchemaValidator??new ji,this.setRequestHandler(Eu,n=>this._oninitialize(n)),this.setNotificationHandler(Iu,()=>this.oninitialized?.()),this._capabilities.logging&&this.setRequestHandler(Au,async(n,o)=>{let s=o.sessionId||o.requestInfo?.headers["mcp-session-id"]||void 0,{level:i}=n.params,a=mo.safeParse(i);return a.success&&this._loggingLevels.set(s,a.data),{}})}get experimental(){return this._experimental||(this._experimental={tasks:new Di(this)}),this._experimental}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=fh(this._capabilities,e)}setRequestHandler(e,r){let o=er(e)?.method;if(!o)throw new Error("Schema is missing a method literal");let s;if(et(o)){let a=o;s=a._zod?.def?.value??a.value}else{let a=o;s=a._def?.value??a.value}if(typeof s!="string")throw new Error("Schema method literal must be a string");if(s==="tools/call"){let a=async(c,u)=>{let l=Qt(yn,c);if(!l.success){let p=l.error instanceof Error?l.error.message:String(l.error);throw new N(M.InvalidParams,`Invalid tools/call request: ${p}`)}let{params:d}=l.data,g=await Promise.resolve(r(c,u));if(d.task){let p=Qt(hn,g);if(!p.success){let f=p.error instanceof Error?p.error.message:String(p.error);throw new N(M.InvalidParams,`Invalid task creation result: ${f}`)}return p.data}let h=Qt(Gs,g);if(!h.success){let p=h.error instanceof Error?h.error.message:String(h.error);throw new N(M.InvalidParams,`Invalid tools/call result: ${p}`)}return h.data};return super.setRequestHandler(e,a)}return super.setRequestHandler(e,r)}assertCapabilityForMethod(e){switch(e){case"sampling/createMessage":if(!this._clientCapabilities?.sampling)throw new Error(`Client does not support sampling (required for ${e})`);break;case"elicitation/create":if(!this._clientCapabilities?.elicitation)throw new Error(`Client does not support elicitation (required for ${e})`);break;case"roots/list":if(!this._clientCapabilities?.roots)throw new Error(`Client does not support listing roots (required for ${e})`);break;case"ping":break}}assertNotificationCapability(e){switch(e){case"notifications/message":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw new Error(`Server does not support notifying about resources (required for ${e})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw new Error(`Server does not support notifying of tool list changes (required for ${e})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw new Error(`Server does not support notifying of prompt list changes (required for ${e})`);break;case"notifications/elicitation/complete":if(!this._clientCapabilities?.elicitation?.url)throw new Error(`Client does not support URL elicitation (required for ${e})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){if(this._capabilities)switch(e){case"completion/complete":if(!this._capabilities.completions)throw new Error(`Server does not support completions (required for ${e})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw new Error(`Server does not support resources (required for ${e})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw new Error(`Server does not support tools (required for ${e})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw new Error(`Server does not support tasks capability (required for ${e})`);break;case"ping":case"initialize":break}}assertTaskCapability(e){t_(this._clientCapabilities?.tasks?.requests,e,"Client")}assertTaskHandlerCapability(e){this._capabilities&&e_(this._capabilities.tasks?.requests,e,"Server")}async _oninitialize(e){let r=e.params.protocolVersion;return this._clientCapabilities=e.params.capabilities,this._clientVersion=e.params.clientInfo,{protocolVersion:hm.includes(r)?r:wu,capabilities:this.getCapabilities(),serverInfo:this._serverInfo,...this._instructions&&{instructions:this._instructions}}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},Rs)}async createMessage(e,r){if((e.tools||e.toolChoice)&&!this._clientCapabilities?.sampling?.tools)throw new Error("Client does not support sampling tools capability.");if(e.messages.length>0){let n=e.messages[e.messages.length-1],o=Array.isArray(n.content)?n.content:[n.content],s=o.some(u=>u.type==="tool_result"),i=e.messages.length>1?e.messages[e.messages.length-2]:void 0,a=i?Array.isArray(i.content)?i.content:[i.content]:[],c=a.some(u=>u.type==="tool_use");if(s){if(o.some(u=>u.type!=="tool_result"))throw new Error("The last message must contain only tool_result content if any is present");if(!c)throw new Error("tool_result blocks are not matching any tool_use from the previous message")}if(c){let u=new Set(a.filter(d=>d.type==="tool_use").map(d=>d.id)),l=new Set(o.filter(d=>d.type==="tool_result").map(d=>d.toolUseId));if(u.size!==l.size||![...u].every(d=>l.has(d)))throw new Error("ids of tool_result blocks and tool_use blocks from previous message do not match")}}return e.tools?this.request({method:"sampling/createMessage",params:e},ju,r):this.request({method:"sampling/createMessage",params:e},Mu,r)}async elicitInput(e,r){switch(e.mode??"form"){case"url":{if(!this._clientCapabilities?.elicitation?.url)throw new Error("Client does not support url elicitation.");let o=e;return this.request({method:"elicitation/create",params:o},Ws,r)}case"form":{if(!this._clientCapabilities?.elicitation?.form)throw new Error("Client does not support form elicitation.");let o=e.mode==="form"?e:{...e,mode:"form"},s=await this.request({method:"elicitation/create",params:o},Ws,r);if(s.action==="accept"&&s.content&&o.requestedSchema)try{let a=this._jsonSchemaValidator.getValidator(o.requestedSchema)(s.content);if(!a.valid)throw new N(M.InvalidParams,`Elicitation response content does not match requested schema: ${a.errorMessage}`)}catch(i){throw i instanceof N?i:new N(M.InternalError,`Error validating elicitation response: ${i instanceof Error?i.message:String(i)}`)}return s}}}createElicitationCompletionNotifier(e,r){if(!this._clientCapabilities?.elicitation?.url)throw new Error("Client does not support URL elicitation (required for notifications/elicitation/complete)");return()=>this.notification({method:"notifications/elicitation/complete",params:{elicitationId:e}},r)}async listRoots(e,r){return this.request({method:"roots/list",params:e},Du,r)}async sendLoggingMessage(e,r){if(this._capabilities.logging&&!this.isMessageIgnored(e.level,r))return this.notification({method:"notifications/message",params:e})}async sendResourceUpdated(e){return this.notification({method:"notifications/resources/updated",params:e})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}};var n_=Symbol.for("mcp.completable");function Zd(t){return!!t&&typeof t=="object"&&n_ in t}function o_(t){return t[n_]?.complete}var r_;(function(t){t.Completable="McpCompletable"})(r_||(r_={}));var Az=/^[A-Za-z0-9._-]{1,128}$/;function Mz(t){let e=[];if(t.length===0)return{isValid:!1,warnings:["Tool name cannot be empty"]};if(t.length>128)return{isValid:!1,warnings:[`Tool name exceeds maximum length of 128 characters (current: ${t.length})`]};if(t.includes(" ")&&e.push("Tool name contains spaces, which may cause parsing issues"),t.includes(",")&&e.push("Tool name contains commas, which may cause parsing issues"),(t.startsWith("-")||t.endsWith("-"))&&e.push("Tool name starts or ends with a dash, which may cause parsing issues in some contexts"),(t.startsWith(".")||t.endsWith("."))&&e.push("Tool name starts or ends with a dot, which may cause parsing issues in some contexts"),!Az.test(t)){let r=t.split("").filter(n=>!/[A-Za-z0-9._-]/.test(n)).filter((n,o,s)=>s.indexOf(n)===o);return e.push(`Tool name contains invalid characters: ${r.map(n=>`"${n}"`).join(", ")}`,"Allowed characters are: A-Z, a-z, 0-9, underscore (_), dash (-), and dot (.)"),{isValid:!1,warnings:e}}return{isValid:!0,warnings:e}}function jz(t,e){if(e.length>0){console.warn(`Tool name validation warning for "${t}":`);for(let r of e)console.warn(`  - ${r}`);console.warn("Tool registration will proceed, but this may cause compatibility issues."),console.warn("Consider updating the tool name to conform to the MCP tool naming standard."),console.warn("See SEP: Specify Format for Tool Names (https://github.com/modelcontextprotocol/modelcontextprotocol/issues/986) for more details.")}}function Ld(t){let e=Mz(t);return jz(t,e.warnings),e.isValid}var Li=class{constructor(e){this._mcpServer=e}registerToolTask(e,r,n){let o={taskSupport:"required",...r.execution};if(o.taskSupport==="forbidden")throw new Error(`Cannot register task-based tool '${e}' with taskSupport 'forbidden'. Use registerTool() instead.`);return this._mcpServer._createRegisteredTool(e,r.title,r.description,r.inputSchema,r.outputSchema,r.annotations,o,r._meta,n)}};var Fi=class{constructor(e,r){this._registeredResources={},this._registeredResourceTemplates={},this._registeredTools={},this._registeredPrompts={},this._toolHandlersInitialized=!1,this._completionHandlerInitialized=!1,this._resourceHandlersInitialized=!1,this._promptHandlersInitialized=!1,this.server=new Zi(e,r)}get experimental(){return this._experimental||(this._experimental={tasks:new Li(this)}),this._experimental}async connect(e){return await this.server.connect(e)}async close(){await this.server.close()}setToolRequestHandlers(){this._toolHandlersInitialized||(this.server.assertCanSetRequestHandler(dr(Hs)),this.server.assertCanSetRequestHandler(dr(yn)),this.server.registerCapabilities({tools:{listChanged:!0}}),this.server.setRequestHandler(Hs,()=>({tools:Object.entries(this._registeredTools).filter(([,e])=>e.enabled).map(([e,r])=>{let n={name:e,title:r.title,description:r.description,inputSchema:(()=>{let o=pn(r.inputSchema);return o?Vu(o,{strictUnions:!0,pipeStrategy:"input"}):Dz})(),annotations:r.annotations,execution:r.execution,_meta:r._meta};if(r.outputSchema){let o=pn(r.outputSchema);o&&(n.outputSchema=Vu(o,{strictUnions:!0,pipeStrategy:"output"}))}return n})})),this.server.setRequestHandler(yn,async(e,r)=>{try{let n=this._registeredTools[e.params.name];if(!n)throw new N(M.InvalidParams,`Tool ${e.params.name} not found`);if(!n.enabled)throw new N(M.InvalidParams,`Tool ${e.params.name} disabled`);let o=!!e.params.task,s=n.execution?.taskSupport,i="createTask"in n.handler;if((s==="required"||s==="optional")&&!i)throw new N(M.InternalError,`Tool ${e.params.name} has taskSupport '${s}' but was not registered with registerToolTask`);if(s==="required"&&!o)throw new N(M.MethodNotFound,`Tool ${e.params.name} requires task augmentation (taskSupport: 'required')`);if(s==="optional"&&!o&&i)return await this.handleAutomaticTaskPolling(n,e,r);let a=await this.validateToolInput(n,e.params.arguments,e.params.name),c=await this.executeToolHandler(n,a,r);return o||await this.validateToolOutput(n,c,e.params.name),c}catch(n){if(n instanceof N&&n.code===M.UrlElicitationRequired)throw n;return this.createToolError(n instanceof Error?n.message:String(n))}}),this._toolHandlersInitialized=!0)}createToolError(e){return{content:[{type:"text",text:e}],isError:!0}}async validateToolInput(e,r,n){if(!e.inputSchema)return;let s=pn(e.inputSchema)??e.inputSchema,i=await Ss(s,r);if(!i.success){let a="error"in i?i.error:"Unknown error",c=$s(a);throw new N(M.InvalidParams,`Input validation error: Invalid arguments for tool ${n}: ${c}`)}return i.data}async validateToolOutput(e,r,n){if(!e.outputSchema||!("content"in r)||r.isError)return;if(!r.structuredContent)throw new N(M.InvalidParams,`Output validation error: Tool ${n} has an output schema but no structured content was provided`);let o=pn(e.outputSchema),s=await Ss(o,r.structuredContent);if(!s.success){let i="error"in s?s.error:"Unknown error",a=$s(i);throw new N(M.InvalidParams,`Output validation error: Invalid structured content for tool ${n}: ${a}`)}}async executeToolHandler(e,r,n){let o=e.handler;if("createTask"in o){if(!n.taskStore)throw new Error("No task store provided.");let i={...n,taskStore:n.taskStore};if(e.inputSchema){let a=o;return await Promise.resolve(a.createTask(r,i))}else{let a=o;return await Promise.resolve(a.createTask(i))}}if(e.inputSchema){let i=o;return await Promise.resolve(i(r,n))}else{let i=o;return await Promise.resolve(i(n))}}async handleAutomaticTaskPolling(e,r,n){if(!n.taskStore)throw new Error("No task store provided for task-capable tool.");let o=await this.validateToolInput(e,r.params.arguments,r.params.name),s=e.handler,i={...n,taskStore:n.taskStore},a=o?await Promise.resolve(s.createTask(o,i)):await Promise.resolve(s.createTask(i)),c=a.task.taskId,u=a.task,l=u.pollInterval??5e3;for(;u.status!=="completed"&&u.status!=="failed"&&u.status!=="cancelled";){await new Promise(g=>setTimeout(g,l));let d=await n.taskStore.getTask(c);if(!d)throw new N(M.InternalError,`Task ${c} not found during polling`);u=d}return await n.taskStore.getTaskResult(c)}setCompletionRequestHandler(){this._completionHandlerInitialized||(this.server.assertCanSetRequestHandler(dr(Js)),this.server.registerCapabilities({completions:{}}),this.server.setRequestHandler(Js,async e=>{switch(e.params.ref.type){case"ref/prompt":return Rm(e),this.handlePromptCompletion(e,e.params.ref);case"ref/resource":return Nm(e),this.handleResourceCompletion(e,e.params.ref);default:throw new N(M.InvalidParams,`Invalid completion reference: ${e.params.ref}`)}}),this._completionHandlerInitialized=!0)}async handlePromptCompletion(e,r){let n=this._registeredPrompts[r.name];if(!n)throw new N(M.InvalidParams,`Prompt ${r.name} not found`);if(!n.enabled)throw new N(M.InvalidParams,`Prompt ${r.name} disabled`);if(!n.argsSchema)return Bo;let s=er(n.argsSchema)?.[e.params.argument.name];if(!Zd(s))return Bo;let i=o_(s);if(!i)return Bo;let a=await i(e.params.argument.value,e.params.context);return i_(a)}async handleResourceCompletion(e,r){let n=Object.values(this._registeredResourceTemplates).find(i=>i.resourceTemplate.uriTemplate.toString()===r.uri);if(!n){if(this._registeredResources[r.uri])return Bo;throw new N(M.InvalidParams,`Resource template ${e.params.ref.uri} not found`)}let o=n.resourceTemplate.completeCallback(e.params.argument.name);if(!o)return Bo;let s=await o(e.params.argument.value,e.params.context);return i_(s)}setResourceRequestHandlers(){this._resourceHandlersInitialized||(this.server.assertCanSetRequestHandler(dr(Fs)),this.server.assertCanSetRequestHandler(dr(qs)),this.server.assertCanSetRequestHandler(dr(Us)),this.server.registerCapabilities({resources:{listChanged:!0}}),this.server.setRequestHandler(Fs,async(e,r)=>{let n=Object.entries(this._registeredResources).filter(([s,i])=>i.enabled).map(([s,i])=>({uri:s,name:i.name,...i.metadata})),o=[];for(let s of Object.values(this._registeredResourceTemplates)){if(!s.resourceTemplate.listCallback)continue;let i=await s.resourceTemplate.listCallback(r);for(let a of i.resources)o.push({...s.metadata,...a})}return{resources:[...n,...o]}}),this.server.setRequestHandler(qs,async()=>({resourceTemplates:Object.entries(this._registeredResourceTemplates).map(([r,n])=>({name:r,uriTemplate:n.resourceTemplate.uriTemplate.toString(),...n.metadata}))})),this.server.setRequestHandler(Us,async(e,r)=>{let n=new URL(e.params.uri),o=this._registeredResources[n.toString()];if(o){if(!o.enabled)throw new N(M.InvalidParams,`Resource ${n} disabled`);return o.readCallback(n,r)}for(let s of Object.values(this._registeredResourceTemplates)){let i=s.resourceTemplate.uriTemplate.match(n.toString());if(i)return s.readCallback(n,i,r)}throw new N(M.InvalidParams,`Resource ${n} not found`)}),this._resourceHandlersInitialized=!0)}setPromptRequestHandlers(){this._promptHandlersInitialized||(this.server.assertCanSetRequestHandler(dr(Vs)),this.server.assertCanSetRequestHandler(dr(Bs)),this.server.registerCapabilities({prompts:{listChanged:!0}}),this.server.setRequestHandler(Vs,()=>({prompts:Object.entries(this._registeredPrompts).filter(([,e])=>e.enabled).map(([e,r])=>({name:e,title:r.title,description:r.description,arguments:r.argsSchema?Lz(r.argsSchema):void 0}))})),this.server.setRequestHandler(Bs,async(e,r)=>{let n=this._registeredPrompts[e.params.name];if(!n)throw new N(M.InvalidParams,`Prompt ${e.params.name} not found`);if(!n.enabled)throw new N(M.InvalidParams,`Prompt ${e.params.name} disabled`);if(n.argsSchema){let o=pn(n.argsSchema),s=await Ss(o,e.params.arguments);if(!s.success){let c="error"in s?s.error:"Unknown error",u=$s(c);throw new N(M.InvalidParams,`Invalid arguments for prompt ${e.params.name}: ${u}`)}let i=s.data,a=n.callback;return await Promise.resolve(a(i,r))}else{let o=n.callback;return await Promise.resolve(o(r))}}),this._promptHandlersInitialized=!0)}resource(e,r,...n){let o;typeof n[0]=="object"&&(o=n.shift());let s=n[0];if(typeof r=="string"){if(this._registeredResources[r])throw new Error(`Resource ${r} is already registered`);let i=this._createRegisteredResource(e,void 0,r,o,s);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),i}else{if(this._registeredResourceTemplates[e])throw new Error(`Resource template ${e} is already registered`);let i=this._createRegisteredResourceTemplate(e,void 0,r,o,s);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),i}}registerResource(e,r,n,o){if(typeof r=="string"){if(this._registeredResources[r])throw new Error(`Resource ${r} is already registered`);let s=this._createRegisteredResource(e,n.title,r,n,o);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),s}else{if(this._registeredResourceTemplates[e])throw new Error(`Resource template ${e} is already registered`);let s=this._createRegisteredResourceTemplate(e,n.title,r,n,o);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),s}}_createRegisteredResource(e,r,n,o,s){let i={name:e,title:r,metadata:o,readCallback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({uri:null}),update:a=>{typeof a.uri<"u"&&a.uri!==n&&(delete this._registeredResources[n],a.uri&&(this._registeredResources[a.uri]=i)),typeof a.name<"u"&&(i.name=a.name),typeof a.title<"u"&&(i.title=a.title),typeof a.metadata<"u"&&(i.metadata=a.metadata),typeof a.callback<"u"&&(i.readCallback=a.callback),typeof a.enabled<"u"&&(i.enabled=a.enabled),this.sendResourceListChanged()}};return this._registeredResources[n]=i,i}_createRegisteredResourceTemplate(e,r,n,o,s){let i={resourceTemplate:n,title:r,metadata:o,readCallback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({name:null}),update:u=>{typeof u.name<"u"&&u.name!==e&&(delete this._registeredResourceTemplates[e],u.name&&(this._registeredResourceTemplates[u.name]=i)),typeof u.title<"u"&&(i.title=u.title),typeof u.template<"u"&&(i.resourceTemplate=u.template),typeof u.metadata<"u"&&(i.metadata=u.metadata),typeof u.callback<"u"&&(i.readCallback=u.callback),typeof u.enabled<"u"&&(i.enabled=u.enabled),this.sendResourceListChanged()}};this._registeredResourceTemplates[e]=i;let a=n.uriTemplate.variableNames;return Array.isArray(a)&&a.some(u=>!!n.completeCallback(u))&&this.setCompletionRequestHandler(),i}_createRegisteredPrompt(e,r,n,o,s){let i={title:r,description:n,argsSchema:o===void 0?void 0:Dr(o),callback:s,enabled:!0,disable:()=>i.update({enabled:!1}),enable:()=>i.update({enabled:!0}),remove:()=>i.update({name:null}),update:a=>{typeof a.name<"u"&&a.name!==e&&(delete this._registeredPrompts[e],a.name&&(this._registeredPrompts[a.name]=i)),typeof a.title<"u"&&(i.title=a.title),typeof a.description<"u"&&(i.description=a.description),typeof a.argsSchema<"u"&&(i.argsSchema=Dr(a.argsSchema)),typeof a.callback<"u"&&(i.callback=a.callback),typeof a.enabled<"u"&&(i.enabled=a.enabled),this.sendPromptListChanged()}};return this._registeredPrompts[e]=i,o&&Object.values(o).some(c=>{let u=c instanceof Fe?c._def?.innerType:c;return Zd(u)})&&this.setCompletionRequestHandler(),i}_createRegisteredTool(e,r,n,o,s,i,a,c,u){Ld(e);let l={title:r,description:n,inputSchema:s_(o),outputSchema:s_(s),annotations:i,execution:a,_meta:c,handler:u,enabled:!0,disable:()=>l.update({enabled:!1}),enable:()=>l.update({enabled:!0}),remove:()=>l.update({name:null}),update:d=>{typeof d.name<"u"&&d.name!==e&&(typeof d.name=="string"&&Ld(d.name),delete this._registeredTools[e],d.name&&(this._registeredTools[d.name]=l)),typeof d.title<"u"&&(l.title=d.title),typeof d.description<"u"&&(l.description=d.description),typeof d.paramsSchema<"u"&&(l.inputSchema=Dr(d.paramsSchema)),typeof d.outputSchema<"u"&&(l.outputSchema=Dr(d.outputSchema)),typeof d.callback<"u"&&(l.handler=d.callback),typeof d.annotations<"u"&&(l.annotations=d.annotations),typeof d._meta<"u"&&(l._meta=d._meta),typeof d.enabled<"u"&&(l.enabled=d.enabled),this.sendToolListChanged()}};return this._registeredTools[e]=l,this.setToolRequestHandlers(),this.sendToolListChanged(),l}tool(e,...r){if(this._registeredTools[e])throw new Error(`Tool ${e} is already registered`);let n,o,s,i;if(typeof r[0]=="string"&&(n=r.shift()),r.length>1){let c=r[0];Fd(c)?(o=r.shift(),r.length>1&&typeof r[0]=="object"&&r[0]!==null&&!Fd(r[0])&&(i=r.shift())):typeof c=="object"&&c!==null&&(i=r.shift())}let a=r[0];return this._createRegisteredTool(e,void 0,n,o,s,i,{taskSupport:"forbidden"},void 0,a)}registerTool(e,r,n){if(this._registeredTools[e])throw new Error(`Tool ${e} is already registered`);let{title:o,description:s,inputSchema:i,outputSchema:a,annotations:c,_meta:u}=r;return this._createRegisteredTool(e,o,s,i,a,c,{taskSupport:"forbidden"},u,n)}prompt(e,...r){if(this._registeredPrompts[e])throw new Error(`Prompt ${e} is already registered`);let n;typeof r[0]=="string"&&(n=r.shift());let o;r.length>1&&(o=r.shift());let s=r[0],i=this._createRegisteredPrompt(e,void 0,n,o,s);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),i}registerPrompt(e,r,n){if(this._registeredPrompts[e])throw new Error(`Prompt ${e} is already registered`);let{title:o,description:s,argsSchema:i}=r,a=this._createRegisteredPrompt(e,o,s,i,n);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),a}isConnected(){return this.server.transport!==void 0}async sendLoggingMessage(e,r){return this.server.sendLoggingMessage(e,r)}sendResourceListChanged(){this.isConnected()&&this.server.sendResourceListChanged()}sendToolListChanged(){this.isConnected()&&this.server.sendToolListChanged()}sendPromptListChanged(){this.isConnected()&&this.server.sendPromptListChanged()}};var Dz={type:"object",properties:{}};function a_(t){return t!==null&&typeof t=="object"&&"parse"in t&&typeof t.parse=="function"&&"safeParse"in t&&typeof t.safeParse=="function"}function Zz(t){return"_def"in t||"_zod"in t||a_(t)}function Fd(t){return typeof t!="object"||t===null||Zz(t)?!1:Object.keys(t).length===0?!0:Object.values(t).some(a_)}function s_(t){if(t)return Fd(t)?Dr(t):t}function Lz(t){let e=er(t);return e?Object.entries(e).map(([r,n])=>{let o=Hp(n),s=Gp(n);return{name:r,description:o,required:!s}}):[]}function dr(t){let r=er(t)?.method;if(!r)throw new Error("Schema is missing a method literal");let n=ks(r);if(typeof n=="string")return n;throw new Error("Schema method literal must be a string")}function i_(t){return{completion:{values:t.slice(0,100),total:t.length,hasMore:t.length>100}}}var Bo={completion:{values:[],hasMore:!1}};var qd=Ht(require("node:process"),1);var qi=class{append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;let e=this._buffer.indexOf(`
`);if(e===-1)return null;let r=this._buffer.toString("utf8",0,e).replace(/\r$/,"");return this._buffer=this._buffer.subarray(e+1),Fz(r)}clear(){this._buffer=void 0}};function Fz(t){return Sm.parse(JSON.parse(t))}function c_(t){return JSON.stringify(t)+`
`}var Ui=class{constructor(e=qd.default.stdin,r=qd.default.stdout){this._stdin=e,this._stdout=r,this._readBuffer=new qi,this._started=!1,this._ondata=n=>{this._readBuffer.append(n),this.processReadBuffer()},this._onerror=n=>{this.onerror?.(n)}}async start(){if(this._started)throw new Error("StdioServerTransport already started! If using Server class, note that connect() calls start() automatically.");this._started=!0,this._stdin.on("data",this._ondata),this._stdin.on("error",this._onerror)}processReadBuffer(){for(;;)try{let e=this._readBuffer.readMessage();if(e===null)break;this.onmessage?.(e)}catch(e){this.onerror?.(e)}}async close(){this._stdin.off("data",this._ondata),this._stdin.off("error",this._onerror),this._stdin.listenerCount("data")===0&&this._stdin.pause(),this._readBuffer.clear(),this.onclose?.()}send(e){return new Promise(r=>{let n=c_(e);this._stdout.write(n)?r():this._stdout.once("drain",r)})}};var aR=Ht(nv(),1),cR=Ht(Qd(),1),uR=Ht(rf(),1),ut=Ht(ta(),1),df=Ht(fv(),1);var Pe=[];for(let t=0;t<256;++t)Pe.push((t+256).toString(16).slice(1));function pv(t,e=0){return(Pe[t[e+0]]+Pe[t[e+1]]+Pe[t[e+2]]+Pe[t[e+3]]+"-"+Pe[t[e+4]]+Pe[t[e+5]]+"-"+Pe[t[e+6]]+Pe[t[e+7]]+"-"+Pe[t[e+8]]+Pe[t[e+9]]+"-"+Pe[t[e+10]]+Pe[t[e+11]]+Pe[t[e+12]]+Pe[t[e+13]]+Pe[t[e+14]]+Pe[t[e+15]]).toLowerCase()}var mv=require("crypto"),oa=new Uint8Array(256),na=oa.length;function ff(){return na>oa.length-16&&((0,mv.randomFillSync)(oa),na=0),oa.slice(na,na+=16)}var hv=require("crypto"),pf={randomUUID:hv.randomUUID};function lR(t,e,r){if(pf.randomUUID&&!e&&!t)return pf.randomUUID();t=t||{};let n=t.random??t.rng?.()??ff();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){if(r=r||0,r<0||r+16>e.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let o=0;o<16;++o)e[r+o]=n[o];return e}return pv(n)}var sa=lR;var dR=3055,fR=3e4,gv=500,ia=class{wss=null;clients=new Map;pending=new Map;activeClientId=null;port;serverState="stopped";consoleLogs=new Map;constructor(e=dR){this.port=e}start(){this.serverState="starting",this.wss=new df.default({port:this.port}),this.wss.on("listening",()=>{this.serverState="listening",this.log(`WebSocket bridge listening on ws://localhost:${this.port}`)}),this.wss.on("connection",e=>{let r=sa(),n={ws:e,clientId:r,fileName:"Unknown File",documentId:"",currentPageId:"",currentPageName:"",connectedAt:new Date};this.clients.set(r,n),this.log(`Figma plugin connected (clientId=${r}, total=${this.clients.size})`),this.clients.size===1&&(this.activeClientId=r),e.on("message",o=>{try{let s=JSON.parse(o.toString());if(s.__register){n.fileName=s.fileName??"Unknown File",n.documentId=s.documentId??"",n.currentPageId=s.currentPageId??"",n.currentPageName=s.currentPageName??"",this.log(`Registered file: "${n.fileName}" (clientId=${r})`);return}if(s.__pageChange){n.currentPageId=s.currentPageId??"",n.currentPageName=s.currentPageName??"",this.log(`Page changed in "${n.fileName}": ${n.currentPageName}`);return}if(s.__console){this.pushConsoleLog(r,n.fileName,s);return}this.handleResponse(s)}catch{this.log("Received malformed message from plugin")}}),e.on("close",()=>{this.log(`Figma plugin disconnected: "${n.fileName}" (clientId=${r})`),this.clients.delete(r);for(let[o,s]of this.pending)s.clientId===r&&(clearTimeout(s.timer),s.reject(new Error(`Figma plugin disconnected: "${n.fileName}"`)),this.pending.delete(o));this.consoleLogs.delete(r),this.activeClientId===r&&(this.clients.size===1?this.activeClientId=this.clients.keys().next().value:this.activeClientId=null)}),e.on("error",o=>{this.log(`WebSocket error (clientId=${r}): ${o.message}`)})}),this.wss.on("error",e=>{e.code==="EADDRINUSE"?(this.serverState="port_conflict",this.log(`Port ${this.port} is already in use. Another editor or process may be running the MCP server on this port.`)):(this.serverState="error",this.log(`WebSocket server error: ${e.message}`))})}sendCommand(e,r={},n,o){return new Promise((s,i)=>{if(this.serverState==="port_conflict"){i(new Error(`Port ${this.port} is already in use by another process (likely another editor with the MCP server running). Close the other editor or set a different FIGMA_BRIDGE_PORT.`));return}if(this.serverState!=="listening"){i(new Error(`WebSocket server is not running (state: ${this.serverState}). Restart the editor.`));return}let a=this.resolveClient(o);if(!a){i(this.buildRoutingError(o));return}if(a.ws.readyState!==ut.default.OPEN){i(new Error(`Figma plugin "${a.fileName}" is not connected.`));return}let c=sa(),u={id:c,type:e,params:r},l=n??fR,d=setTimeout(()=>{this.pending.delete(c),i(new Error(`Command "${e}" timed out after ${l}ms`))},l);this.pending.set(c,{resolve:s,reject:i,timer:d,clientId:a.clientId}),a.ws.send(JSON.stringify(u),g=>{g&&(clearTimeout(d),this.pending.delete(c),i(new Error(`Failed to send command: ${g.message}`)))})})}isConnected(){for(let e of this.clients.values())if(e.ws.readyState===ut.default.OPEN)return!0;return!1}listClients(){let e=[];for(let r of this.clients.values())r.ws.readyState===ut.default.OPEN&&e.push({clientId:r.clientId,fileName:r.fileName,documentId:r.documentId,currentPageId:r.currentPageId,currentPageName:r.currentPageName,connectedAt:r.connectedAt,isActive:r.clientId===this.activeClientId});return e}setActiveClient(e){let r=this.findClient(e);if(!r){let n=this.getConnectedFileNames();throw new Error(`No connected file matching "${e}". Connected files: ${n.join(", ")||"(none)"}`)}return this.activeClientId=r.clientId,this.log(`Active file set to: "${r.fileName}" (clientId=${r.clientId})`),{clientId:r.clientId,fileName:r.fileName,documentId:r.documentId,currentPageId:r.currentPageId,currentPageName:r.currentPageName,connectedAt:r.connectedAt}}getActiveClient(){if(!this.activeClientId)return null;let e=this.clients.get(this.activeClientId);return!e||e.ws.readyState!==ut.default.OPEN?null:{clientId:e.clientId,fileName:e.fileName,documentId:e.documentId,currentPageId:e.currentPageId,currentPageName:e.currentPageName,connectedAt:e.connectedAt,isActive:!0}}stop(){for(let[e,r]of this.pending)clearTimeout(r.timer),r.reject(new Error("Bridge shutting down")),this.pending.delete(e);for(let e of this.clients.values())e.ws.close();this.clients.clear(),this.activeClientId=null,this.wss&&(this.wss.close(),this.wss=null),this.serverState="stopped"}getStatus(){return{server:{state:this.serverState,port:this.port},connections:{count:this.clients.size,files:this.getConnectedFileNames(),activeFile:this.activeClientId?this.clients.get(this.activeClientId)?.fileName??null:null},pending:this.pending.size}}getConsoleLogs(e){let r=this.resolveClient(e?.fileId);if(!r)return[];let n=this.consoleLogs.get(r.clientId)||[];return e?.level&&(n=n.filter(o=>o.level===e.level)),e?.since&&(n=n.filter(o=>o.timestamp>=e.since)),e?.limit&&e.limit>0&&(n=n.slice(-e.limit)),n}clearConsoleLogs(e){let r=this.resolveClient(e);if(!r)return{cleared:0,clientId:null};let o=this.consoleLogs.get(r.clientId)?.length??0;return this.consoleLogs.delete(r.clientId),{cleared:o,clientId:r.clientId}}pushConsoleLog(e,r,n){let o=this.consoleLogs.get(e);o||(o=[],this.consoleLogs.set(e,o)),o.push({level:n.level,message:n.message,args:n.args??[],timestamp:n.timestamp??Date.now(),clientId:e,fileName:r}),o.length>gv&&o.splice(0,o.length-gv)}resolveClient(e){if(e)return this.findClient(e);if(this.clients.size===1){let r=this.clients.values().next().value;return r.ws.readyState===ut.default.OPEN?r:null}if(this.activeClientId){let r=this.clients.get(this.activeClientId);if(r&&r.ws.readyState===ut.default.OPEN)return r}return null}findClient(e){let r=this.clients.get(e);if(r&&r.ws.readyState===ut.default.OPEN)return r;for(let n of this.clients.values())if(n.ws.readyState===ut.default.OPEN&&n.fileName.toLowerCase()===e.toLowerCase())return n;for(let n of this.clients.values())if(n.ws.readyState===ut.default.OPEN&&n.fileName.toLowerCase().includes(e.toLowerCase()))return n;return null}buildRoutingError(e){let r=this.getConnectedFileNames();return this.clients.size===0?new Error("No Figma plugin connected. Open Figma and run the Outreach Figma MCP Bridge plugin first."):e?new Error(`No connected file matching "${e}". Connected files: ${r.join(", ")}`):new Error(`Multiple Figma files are connected but no active file is set. Connected files: ${r.join(", ")}. Use set_active_file to choose one, or pass fileId to target a specific file.`)}getConnectedFileNames(){let e=[];for(let r of this.clients.values())r.ws.readyState===ut.default.OPEN&&e.push(`"${r.fileName}"`);return e}handleResponse(e){let r=this.pending.get(e.id);if(!r){this.log(`Received response for unknown request: ${e.id}`);return}clearTimeout(r.timer),this.pending.delete(e.id),e.success?r.resolve(e.result):r.reject(new Error(e.error??"Unknown error from Figma plugin"))}log(e){process.stderr.write(`[outreach-figma-bridge] ${e}
`)}};function yv(t,e){t.tool("list_connected_files","List all Figma files that currently have the Outreach Figma MCP Bridge plugin running. Returns file names, IDs, current pages, and which file is active.",{},async()=>{let r=e.listClients();return{content:[{type:"text",text:JSON.stringify({connectedFiles:r.length,files:r},null,2)}]}}),t.tool("set_active_file","Set the default Figma file for subsequent commands. Accepts a file name or client ID. Required when multiple files are connected and you want to avoid passing fileId on every call.",{fileId:m.string().describe("File name or client ID to set as active. Matches by exact name, partial name, or client ID.")},async({fileId:r})=>{let n=e.setActiveClient(r);return{content:[{type:"text",text:JSON.stringify({message:`Active file set to "${n.fileName}"`,activeFile:n},null,2)}]}}),t.tool("get_document_info","Get information about the current Figma document (name, pages, etc.)",{fileId:E},async({fileId:r})=>{let n=await e.sendCommand("get_document_info",{},void 0,r);return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}}),t.tool("get_current_page","Get the current page name, ID, and top-level children",{fileId:E},async({fileId:r})=>{let n=await e.sendCommand("get_current_page",{},void 0,r);return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}}),t.tool("get_selection","Get the currently selected nodes in Figma",{fileId:E},async({fileId:r})=>{let n=await e.sendCommand("get_selection",{},void 0,r);return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}}),t.tool("get_node_by_id","Get detailed information about a node by its ID",{nodeId:m.string().describe("The Figma node ID (e.g. '12:34')"),fileId:E},async({nodeId:r,fileId:n})=>{let o=await e.sendCommand("get_node_by_id",{nodeId:r},void 0,n);return{content:[{type:"text",text:JSON.stringify(o,null,2)}]}}),t.tool("get_children","Get the direct children of a node",{nodeId:m.string().describe("Parent node ID"),depth:m.number().optional().describe("How deep to recurse (default 1)"),fileId:E},async({nodeId:r,depth:n,fileId:o})=>{let s=await e.sendCommand("get_children",{nodeId:r,depth:n??1},void 0,o);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("scan_page","Scan the current page and return a tree of all nodes (name, type, id)",{depth:m.number().optional().describe("Max depth to scan (default 3)"),fileId:E},async({depth:r,fileId:n})=>{let o=await e.sendCommand("scan_page",{depth:r??3},void 0,n);return{content:[{type:"text",text:JSON.stringify(o,null,2)}]}}),t.tool("read_my_design","Get detailed node information about the current selection without parameters (deep read of selected nodes)",{fileId:E},async({fileId:r})=>{let n=await e.sendCommand("read_my_design",{},void 0,r);return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}}),t.tool("get_nodes_info","Get detailed information about multiple nodes by providing an array of node IDs",{nodeIds:m.array(m.string()).describe("Array of node IDs to get info for"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("get_nodes_info",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("create_page","Create a new page in the Figma document",{name:m.string().optional().describe("Page name"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("create_page",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_current_page","Switch the active page by its ID",{pageId:m.string().describe("The page ID to switch to"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("set_current_page",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("get_available_fonts","List all font families available in Figma. Use this before creating text to ensure the font exists and avoid load errors. Returns up to 200 families.",{fileId:E},async({fileId:r})=>{let n=await e.sendCommand("get_available_fonts",{},void 0,r);return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}})}function _v(t,e){t.tool("create_instance","Create an instance of an existing component",{componentId:m.string().describe("The component node ID to instantiate"),x:m.number().optional().describe("X position"),y:m.number().optional().describe("Y position"),parentId:m.string().optional().describe("Parent node ID"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("create_instance",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("get_local_components","Get information about all local components on the current page",{fileId:E},async({fileId:r})=>{let n=await e.sendCommand("get_local_components",{},void 0,r);return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}}),t.tool("get_instance_overrides","Extract override properties (text, fills, visibility) from a component instance",{nodeId:m.string().describe("Instance node ID to extract overrides from"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("get_instance_overrides",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_instance_overrides","Apply multiple overrides to a component instance's children (text, fill, visibility) in one call",{nodeId:m.string().describe("Instance node ID to apply overrides to"),overrides:m.array(m.object({childName:m.string().describe("Name of the child node within the instance"),characters:m.string().optional().describe("New text content (for TEXT children)"),fillColor:m.object({r:m.number(),g:m.number(),b:m.number()}).optional().describe("Override fill color (r, g, b values 0-1)"),visible:m.boolean().optional().describe("Override visibility")})).describe("Array of overrides to apply"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("set_instance_overrides",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}})}var vv=m.object({r:m.number(),g:m.number(),b:m.number()}),pR=m.object({r:m.number(),g:m.number(),b:m.number(),a:m.number()});function bv(t,e){t.tool("set_node_property","Set general properties on a node (name, visible, opacity, rotation, locked)",{nodeId:m.string().describe("Target node ID"),name:m.string().optional().describe("New node name"),visible:m.boolean().optional().describe("Visibility"),opacity:m.number().min(0).max(1).optional().describe("Opacity 0-1"),rotation:m.number().optional().describe("Rotation in degrees"),locked:m.boolean().optional().describe("Whether node is locked"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("set_node_property",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_fill","Set the fill color(s) on a node",{nodeId:m.string().describe("Target node ID"),color:vv.describe("Solid fill color (r, g, b values 0-1)"),opacity:m.number().min(0).max(1).optional().describe("Fill opacity"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("set_fill",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_stroke","Set the stroke on a node",{nodeId:m.string().describe("Target node ID"),color:vv.describe("Stroke color (r, g, b values 0-1)"),weight:m.number().describe("Stroke weight"),opacity:m.number().min(0).max(1).optional().describe("Stroke opacity"),align:m.enum(["INSIDE","OUTSIDE","CENTER"]).optional().describe("Stroke alignment"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("set_stroke",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_corner_radius","Set corner radius on a node (uniform or per-corner)",{nodeId:m.string().describe("Target node ID"),radius:m.number().optional().describe("Uniform corner radius"),topLeft:m.number().optional().describe("Top-left corner radius"),topRight:m.number().optional().describe("Top-right corner radius"),bottomRight:m.number().optional().describe("Bottom-right corner radius"),bottomLeft:m.number().optional().describe("Bottom-left corner radius"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("set_corner_radius",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_text_content","Change the text characters of an existing text node",{nodeId:m.string().describe("Text node ID"),characters:m.string().describe("New text content"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("set_text_content",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_font","Set font properties on a text node",{nodeId:m.string().describe("Text node ID"),fontFamily:m.string().optional().describe("Font family (e.g. 'Inter')"),fontStyle:m.string().optional().describe("Font style (e.g. 'Bold')"),fontSize:m.number().optional().describe("Font size"),letterSpacing:m.number().optional().describe("Letter spacing"),lineHeight:m.number().optional().describe("Line height in px (use -1 for AUTO)"),textAlignHorizontal:m.enum(["LEFT","CENTER","RIGHT","JUSTIFIED"]).optional().describe("Horizontal alignment"),textAlignVertical:m.enum(["TOP","CENTER","BOTTOM"]).optional().describe("Vertical alignment"),textDecoration:m.enum(["NONE","UNDERLINE","STRIKETHROUGH"]).optional().describe("Text decoration"),textCase:m.enum(["ORIGINAL","UPPER","LOWER","TITLE"]).optional().describe("Text case transform"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("set_font",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_effects","Set effects (drop shadow, inner shadow, blur) on a node",{nodeId:m.string().describe("Target node ID"),effects:m.array(m.object({type:m.enum(["DROP_SHADOW","INNER_SHADOW","LAYER_BLUR","BACKGROUND_BLUR"]).describe("Effect type"),color:pR.optional().describe("Effect color (for shadows)"),offset:m.object({x:m.number(),y:m.number()}).optional().describe("Shadow offset"),radius:m.number().describe("Blur radius"),spread:m.number().optional().describe("Shadow spread"),visible:m.boolean().optional().describe("Effect visibility")})).describe("Array of effects to apply"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("set_effects",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("scan_text_nodes","Scan text nodes with intelligent chunking for large designs. Returns text content, font info, and position.",{nodeId:m.string().optional().describe("Optional root node ID to scope the scan (defaults to current page)"),chunkSize:m.number().optional().describe("Number of text nodes per chunk (defaults to all)"),chunkIndex:m.number().optional().describe("Which chunk to return (0-based, defaults to 0)"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("scan_text_nodes",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_multiple_text_contents","Batch update the text content of multiple text nodes efficiently",{entries:m.array(m.object({nodeId:m.string().describe("Text node ID"),characters:m.string().describe("New text content")})).describe("Array of {nodeId, characters} entries to update"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("set_multiple_text_contents",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}})}function xv(t,e){t.tool("set_auto_layout","Configure auto layout on a frame or component",{nodeId:m.string().describe("Target frame/component ID"),mode:m.enum(["HORIZONTAL","VERTICAL"]).describe("Layout direction"),itemSpacing:m.number().optional().describe("Spacing between items"),paddingTop:m.number().optional().describe("Top padding"),paddingRight:m.number().optional().describe("Right padding"),paddingBottom:m.number().optional().describe("Bottom padding"),paddingLeft:m.number().optional().describe("Left padding"),primaryAxisAlignItems:m.enum(["MIN","MAX","CENTER","SPACE_BETWEEN"]).optional().describe("Primary axis alignment"),counterAxisAlignItems:m.enum(["MIN","MAX","CENTER"]).optional().describe("Counter axis alignment"),primaryAxisSizingMode:m.enum(["FIXED","AUTO"]).optional().describe("Primary axis sizing"),counterAxisSizingMode:m.enum(["FIXED","AUTO"]).optional().describe("Counter axis sizing"),layoutWrap:m.enum(["NO_WRAP","WRAP"]).optional().describe("Whether children wrap"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("set_auto_layout",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("move_node","Move a node to a new x, y position",{nodeId:m.string().describe("Target node ID"),x:m.number().describe("New X position"),y:m.number().describe("New Y position"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("move_node",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("resize_node","Resize a node to new dimensions",{nodeId:m.string().describe("Target node ID"),width:m.number().describe("New width"),height:m.number().describe("New height"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("resize_node",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("append_child","Move a node to become the last child of a parent",{parentId:m.string().describe("Parent node ID"),childId:m.string().describe("Child node ID to move"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("append_child",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("remove_node","Delete a node from the document",{nodeId:m.string().describe("Node ID to remove"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("remove_node",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("clone_node","Clone/duplicate a node",{nodeId:m.string().describe("Node ID to clone"),parentId:m.string().optional().describe("Parent to place clone into (default: same parent)"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("clone_node",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("delete_multiple_nodes","Delete multiple nodes at once efficiently",{nodeIds:m.array(m.string()).describe("Array of node IDs to delete"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("delete_multiple_nodes",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("set_layout_sizing","Set layout sizing behavior on an auto-layout child (FILL to stretch, HUG to fit content, FIXED for explicit size)",{nodeId:m.string().describe("Target node ID (must be a child of an auto-layout frame)"),horizontal:m.enum(["FILL","HUG","FIXED"]).optional().describe("Horizontal sizing: FILL (stretch), HUG (fit content), or FIXED"),vertical:m.enum(["FILL","HUG","FIXED"]).optional().describe("Vertical sizing: FILL (stretch), HUG (fit content), or FIXED"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("set_layout_sizing",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}})}function wv(t,e){t.tool("export_node","Export a node as an image (returns base64-encoded data)",{nodeId:m.string().describe("Node ID to export"),format:m.enum(["PNG","JPG","SVG","PDF"]).optional().describe("Export format (default PNG)"),scale:m.number().optional().describe("Export scale (default 1)"),contentsOnly:m.boolean().optional().describe("Export only contents, not the node background"),fileId:E},async r=>{let n=await e.sendCommand("export_node",{nodeId:r.nodeId,format:r.format??"PNG",scale:r.scale??1,contentsOnly:r.contentsOnly??!1},void 0,r.fileId);return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}}),t.tool("verify_design","Export a node as a PNG screenshot and return it alongside the node tree for visual verification. Use this after creating or modifying designs to close the feedback loop: create \u2192 verify \u2192 fix.",{nodeId:m.string().describe("Node ID to export and verify (typically a frame)"),width:m.number().optional().describe("Width constraint for the exported PNG in pixels (default 800)"),depth:m.number().optional().describe("How deep to serialize the node tree (default 2)"),fileId:E},async r=>{let n=await e.sendCommand("verify_design",{nodeId:r.nodeId,width:r.width??800,depth:r.depth??2},void 0,r.fileId),o=[];return n.image&&o.push({type:"image",data:n.image,mimeType:"image/png"}),o.push({type:"text",text:JSON.stringify({nodeInfo:n.nodeInfo,byteLength:n.byteLength},null,2)}),{content:o}})}function Sv(t,e){t.tool("get_local_styles","Get all local paint, text, and effect styles in the document",{styleType:m.enum(["PAINT","TEXT","EFFECT","GRID","ALL"]).optional().describe("Filter by style type (default ALL)"),fileId:E},async({styleType:r})=>{let n=await e.sendCommand("get_local_styles",{styleType:r??"ALL"});return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}}),t.tool("get_node_styles",`Extract all paint, text, and effect style references from a node and its entire subtree. Returns style IDs, keys, names, and where they were found.

Use this to discover library styles by inspecting library component instances: create an instance of a library component, then call this tool on it to find all the style keys used. Those keys can then be reused with fillStyleKey/strokeStyleKey/textStyleKey/effectStyleKey in build specs.

Workflow for library style discovery:
1. create_instance of a library component (e.g. a button)
2. get_node_styles on the instance \u2192 returns all style keys
3. Use those keys in specs or remove the temporary instance`,{nodeId:m.string().describe("Node ID to extract styles from (walks the entire subtree)"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("get_node_styles",o,3e4,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}})}function $v(t,e){t.tool("find_nodes_by_name","Search for nodes by name (supports substring matching). Returns matching nodes from the current page.",{query:m.string().describe("Name or substring to search for"),caseSensitive:m.boolean().optional().describe("Whether the search is case-sensitive (default false)"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("find_nodes_by_name",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("find_nodes_by_type","Find all nodes of a given type on the current page (e.g. TEXT, FRAME, RECTANGLE, COMPONENT, INSTANCE)",{nodeType:m.string().describe("The node type to filter by (e.g. 'TEXT', 'FRAME', 'RECTANGLE', 'COMPONENT', 'INSTANCE')"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("find_nodes_by_type",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}})}var kv=new Set(["frame","text","rectangle","ellipse","line","component","vector","instance"]),mR=new Set(["HORIZONTAL","VERTICAL"]),hR=new Set(["MIN","MAX","CENTER","SPACE_BETWEEN"]),gR=new Set(["MIN","MAX","CENTER"]),Tv=new Set(["FIXED","AUTO"]),Ev=new Set(["FILL","HUG","FIXED"]),yR=new Set(["LEFT","CENTER","RIGHT","JUSTIFIED"]),_R=new Set(["DROP_SHADOW","INNER_SHADOW","LAYER_BLUR","BACKGROUND_BLUR"]),vR=new Set(["COLUMNS","ROWS","GRID"]),bR=new Set(["MIN","MAX","CENTER","STRETCH"]);function mf(t){let e=[];function r(o,s){if(!o||typeof o!="object")return e.push(`${s}: must be an {r, g, b} object`),!1;let i=o;return typeof i.r!="number"||typeof i.g!="number"||typeof i.b!="number"?(e.push(`${s}: r, g, b must all be numbers (0-1)`),!1):!0}function n(o,s){if(!o||typeof o!="object"){e.push(`${s}: must be an object`);return}let i=o;if((!i.name||typeof i.name!="string")&&e.push(`${s}: "name" is required and must be a string`),!i.type||typeof i.type!="string"||!kv.has(i.type)){e.push(`${s}: "type" must be one of: ${[...kv].join(", ")}`);return}if(i.type==="text"&&(i.characters===void 0||i.characters===null?e.push(`${s}: text nodes require a "characters" field`):typeof i.characters!="string"&&e.push(`${s}: "characters" must be a string`)),i.type==="instance"&&(!i.componentKey&&!i.componentId&&e.push(`${s}: instance nodes require "componentKey" (library) or "componentId" (local)`),i.componentKey&&typeof i.componentKey!="string"&&e.push(`${s}: "componentKey" must be a string`),i.componentId&&typeof i.componentId!="string"&&e.push(`${s}: "componentId" must be a string`),i.instanceOverrides!==void 0))if(!Array.isArray(i.instanceOverrides))e.push(`${s}.instanceOverrides: must be an array`);else for(let a=0;a<i.instanceOverrides.length;a++){let c=i.instanceOverrides[a];(!c.childName||typeof c.childName!="string")&&e.push(`${s}.instanceOverrides[${a}].childName: required string`)}for(let a of["x","y","width","height","cornerRadius","opacity","fillOpacity","fontSize"])i[a]!==void 0&&typeof i[a]!="number"&&e.push(`${s}: "${a}" must be a number`);if(i.fill!==void 0&&r(i.fill,`${s}.fill`),i.stroke!==void 0){let a=i.stroke;!a||typeof a!="object"?e.push(`${s}.stroke: must be an object`):(r(a.color,`${s}.stroke.color`),typeof a.weight!="number"&&e.push(`${s}.stroke.weight: must be a number`))}if(i.autoLayout!==void 0){i.type!=="frame"&&i.type!=="component"&&e.push(`${s}: autoLayout is only valid on frame or component types`);let a=i.autoLayout;!a||typeof a!="object"?e.push(`${s}.autoLayout: must be an object`):((!a.mode||!mR.has(a.mode))&&e.push(`${s}.autoLayout.mode: must be "HORIZONTAL" or "VERTICAL"`),a.primaryAxisAlignItems!==void 0&&!hR.has(a.primaryAxisAlignItems)&&e.push(`${s}.autoLayout.primaryAxisAlignItems: invalid value`),a.counterAxisAlignItems!==void 0&&!gR.has(a.counterAxisAlignItems)&&e.push(`${s}.autoLayout.counterAxisAlignItems: invalid value`),a.primaryAxisSizingMode!==void 0&&!Tv.has(a.primaryAxisSizingMode)&&e.push(`${s}.autoLayout.primaryAxisSizingMode: must be "FIXED" or "AUTO"`),a.counterAxisSizingMode!==void 0&&!Tv.has(a.counterAxisSizingMode)&&e.push(`${s}.autoLayout.counterAxisSizingMode: must be "FIXED" or "AUTO"`))}if(i.layoutSizing!==void 0){let a=i.layoutSizing;!a||typeof a!="object"?e.push(`${s}.layoutSizing: must be an object`):(a.horizontal!==void 0&&!Ev.has(a.horizontal)&&e.push(`${s}.layoutSizing.horizontal: must be "FILL", "HUG", or "FIXED"`),a.vertical!==void 0&&!Ev.has(a.vertical)&&e.push(`${s}.layoutSizing.vertical: must be "FILL", "HUG", or "FIXED"`))}for(let a of["fillVariable","strokeVariable","textFillVariable"])i[a]!==void 0&&typeof i[a]!="string"&&e.push(`${s}: "${a}" must be a string (Figma variable ID)`);if(i.layoutGrids!==void 0)if(i.type!=="frame"&&i.type!=="component"&&e.push(`${s}: layoutGrids is only valid on frame or component types`),!Array.isArray(i.layoutGrids))e.push(`${s}.layoutGrids: must be an array`);else for(let a=0;a<i.layoutGrids.length;a++){let c=i.layoutGrids[a];(!c.pattern||!vR.has(c.pattern))&&e.push(`${s}.layoutGrids[${a}].pattern: must be "COLUMNS", "ROWS", or "GRID"`),c.alignment!==void 0&&!bR.has(c.alignment)&&e.push(`${s}.layoutGrids[${a}].alignment: must be "MIN", "MAX", "CENTER", or "STRETCH"`);for(let u of["sectionSize","count","gutterSize","offset"])c[u]!==void 0&&typeof c[u]!="number"&&e.push(`${s}.layoutGrids[${a}].${u}: must be a number`)}if(i.textAlignHorizontal!==void 0&&!yR.has(i.textAlignHorizontal)&&e.push(`${s}.textAlignHorizontal: invalid value`),i.effects!==void 0)if(!Array.isArray(i.effects))e.push(`${s}.effects: must be an array`);else for(let a=0;a<i.effects.length;a++){let c=i.effects[a];(!c.type||!_R.has(c.type))&&e.push(`${s}.effects[${a}].type: invalid effect type`),typeof c.radius!="number"&&e.push(`${s}.effects[${a}].radius: must be a number`)}if(i.children!==void 0)if(i.type!=="frame"&&i.type!=="component")e.push(`${s}: only frame and component types can have children (use instanceOverrides for instance type)`);else if(!Array.isArray(i.children))e.push(`${s}.children: must be an array`);else for(let a=0;a<i.children.length;a++)n(i.children[a],`${s}.children[${a}]`)}return n(t,"spec"),{valid:e.length===0,errors:e}}function aa(t){if(!t||typeof t!="object")return 0;let e=t,r=1;if(Array.isArray(e.children))for(let n of e.children)r+=aa(n);return r}var xR=3e4,wR=2e3;function Iv(t){return xR+t*wR}var zv=`
The spec is a JSON object describing a component tree. Every node requires "name" and "type".

Supported types: frame, text, rectangle, ellipse, line, component, vector, instance.

Key fields:
  - name (string, required): Semantic layer name
  - type (string, required): Node type
  - x, y (number): Position
  - width, height (number): Dimensions
  - fill ({r,g,b}): Solid fill color (values 0-1)
  - fillOpacity (number): Fill opacity 0-1
  - stroke ({color:{r,g,b}, weight, align?}): Stroke
  - cornerRadius (number): Corner radius
  - opacity (number): Node opacity 0-1
  - visible (boolean): Visibility
  - clipContent (boolean): Clip children to frame bounds
  - effects ([{type, radius, color?, offset?, spread?}]): Shadows/blurs

Variable bindings (bind fills/strokes to Figma variables for theme support):
  - fillVariable (string): Figma variable ID to bind to fill color (e.g. "VariableID:abc/123:456")
  - strokeVariable (string): Figma variable ID to bind to stroke color
  - textFillVariable (string): Figma variable ID to bind to text fill color (text nodes only)

Text-specific (type: "text"):
  - characters (string, required): Text content
  - fontSize (number): Font size in px
  - fontFamily (string): Font family (default "Inter")
  - fontStyle (string): Font style (default "Regular")
  - textAlignHorizontal: LEFT | CENTER | RIGHT | JUSTIFIED

Auto-layout (type: "frame" or "component"):
  - autoLayout ({mode, itemSpacing?, padding?, primaryAxisAlignItems?, counterAxisAlignItems?, primaryAxisSizingMode?, counterAxisSizingMode?})
  - autoLayout.padding: number (uniform) or {top?, right?, bottom?, left?}

Layout grids (type: "frame" or "component"):
  - layoutGrids ([{pattern, sectionSize?, count?, gutterSize?, offset?, alignment?, color?, visible?}])
  - pattern: "COLUMNS" | "ROWS" | "GRID"
  - alignment: "MIN" | "MAX" | "CENTER" | "STRETCH" (for COLUMNS/ROWS)

Layout sizing (when inside an auto-layout parent):
  - layoutSizing ({horizontal?: FILL|HUG|FIXED, vertical?: FILL|HUG|FIXED})

Instance (type: "instance" \u2014 use library or local components):
  - componentKey (string): Component key from a published Figma library
  - componentId (string): Local component node ID (alternative to componentKey)
  - instanceOverrides ([{childName, characters?, fillColor?, visible?}]): Overrides for instance children

Nesting:
  - children (array of spec nodes): Only for frame and component types (instances use instanceOverrides)

Example:
{
  "name": "Card",
  "type": "frame",
  "width": 320,
  "height": 200,
  "fill": {"r": 1, "g": 1, "b": 1},
  "fillVariable": "VariableID:abc/123:456",
  "cornerRadius": 12,
  "autoLayout": {"mode": "VERTICAL", "itemSpacing": 16, "padding": 24},
  "layoutGrids": [{"pattern": "COLUMNS", "count": 4, "gutterSize": 16, "alignment": "STRETCH"}],
  "effects": [{"type": "DROP_SHADOW", "radius": 8, "color": {"r":0,"g":0,"b":0,"a":0.15}, "offset": {"x":0,"y":2}}],
  "children": [
    {"name": "Title", "type": "text", "characters": "Hello World", "fontSize": 24, "fontStyle": "Bold", "fill": {"r":0.1,"g":0.1,"b":0.1}},
    {"name": "Body", "type": "text", "characters": "Description text here", "fontSize": 14, "fill": {"r":0.4,"g":0.4,"b":0.4}, "layoutSizing": {"horizontal": "FILL"}}
  ]
}`.trim();function Pv(t,e){t.tool("build_from_spec",`Build a complete Figma component tree from a structured JSON specification in a single atomic operation. Instead of calling create_frame, create_text, set_auto_layout, etc. individually (50+ calls for a complex screen), pass a single spec that describes the entire tree. The plugin builds everything atomically with correct ordering: auto-layout is set before children are appended, layoutSizing is set after parent attachment. Returns the full created tree with all node IDs.

${zv}`,{spec:m.string().describe("JSON string of the component tree specification. Must have 'name' and 'type' at minimum. See tool description for full schema."),parentId:m.string().optional().describe("Parent node ID to build into (defaults to current page)"),fileId:E},async r=>{let n;try{n=JSON.parse(r.spec)}catch(c){return{content:[{type:"text",text:`Error: Failed to parse spec JSON.
${c instanceof Error?c.message:String(c)}

Make sure the spec is valid JSON.`}]}}let o=mf(n);if(!o.valid)return{content:[{type:"text",text:`Spec validation failed (${o.errors.length} error(s)):

${o.errors.map((c,u)=>`${u+1}. ${c}`).join(`
`)}`}]};let s=aa(n),i=Iv(s),a=await e.sendCommand("build_component_tree",{spec:n,parentId:r.parentId},i,r.fileId);return{content:[{type:"text",text:JSON.stringify({summary:{nodesCreated:s,rootNodeId:a?.id},tree:a},null,2)}]}}),t.tool("build_and_verify",`Build a component tree from spec AND automatically verify the result. This is the recommended workflow \u2014 it builds the tree atomically, exports a screenshot for visual inspection, and runs structural validation against the spec. Returns: screenshot image, validation report, and full node tree.

Workflow: parse spec \u2192 validate \u2192 build atomically \u2192 export screenshot \u2192 structural diff \u2192 return everything.

${zv}`,{spec:m.string().describe("JSON string of the component tree specification (same format as build_from_spec)"),parentId:m.string().optional().describe("Parent node ID to build into (defaults to current page)"),screenshotWidth:m.number().optional().describe("Width for the verification screenshot in pixels (default: auto from spec width, or 800)"),fileId:E},async r=>{let n;try{n=JSON.parse(r.spec)}catch(p){return{content:[{type:"text",text:`Error: Failed to parse spec JSON.
${p instanceof Error?p.message:String(p)}`}]}}let o=mf(n);if(!o.valid)return{content:[{type:"text",text:`Spec validation failed (${o.errors.length} error(s)):

${o.errors.map((p,f)=>`${f+1}. ${p}`).join(`
`)}`}]};let s=aa(n),i=Iv(s),a=await e.sendCommand("build_component_tree",{spec:n,parentId:r.parentId},i,r.fileId),c=a?.id;if(!c)return{content:[{type:"text",text:`Build failed: no root node ID returned.
${JSON.stringify(a,null,2)}`}]};let u=r.screenshotWidth??n.width??800,l=await e.sendCommand("verify_design",{nodeId:c,width:u,depth:6},void 0,r.fileId),d=await e.sendCommand("validate_tree",{nodeId:c,spec:n},void 0,r.fileId),g=[];l.image&&g.push({type:"image",data:l.image,mimeType:"image/png"});let h={summary:{nodesCreated:s,rootNodeId:c,screenshotBytes:l.byteLength},validation:d,nodeTree:l.nodeInfo};return g.push({type:"text",text:JSON.stringify(h,null,2)}),{content:g}}),t.tool("validate_tree","Validate an existing Figma node tree against a component tree spec. Walks both trees in parallel and reports structural differences: type mismatches, dimension drift, missing children, text content changes, and layout property deviations. Use this to verify that a built design matches its spec, or to audit spec compliance after manual edits.",{nodeId:m.string().describe("Root node ID of the Figma tree to validate"),spec:m.string().describe("JSON string of the expected component tree specification"),fileId:E},async r=>{let n;try{n=JSON.parse(r.spec)}catch(s){return{content:[{type:"text",text:`Error: Failed to parse spec JSON.
${s instanceof Error?s.message:String(s)}`}]}}let o=await e.sendCommand("validate_tree",{nodeId:r.nodeId,spec:n},void 0,r.fileId);return{content:[{type:"text",text:JSON.stringify(o,null,2)}]}})}var hf=3e4,gf=500;function Rv(t,e){t.tool("get_local_variables","Get all local variables and variable collections in the document. When includeLibrary is true (default), also imports and returns all variables from enabled team libraries \u2014 making them available for use with fillVariable/strokeVariable/textFillVariable bindings. Returns variables with their types, values per mode, scopes, and descriptions, plus all collections with their modes and variable IDs.",{includeLibrary:m.boolean().optional().describe("When true (default), also imports and returns variables from enabled team libraries. Set to false for local-only variables."),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("get_local_variables",o,6e4,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("get_variable_by_id","Get detailed information about a specific variable by its ID",{variableId:m.string().describe("The variable ID (e.g. 'VariableID:123:456')"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("get_variable_by_id",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("get_variable_collection_by_id","Get detailed information about a specific variable collection by its ID",{collectionId:m.string().describe("The variable collection ID"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("get_variable_collection_by_id",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("create_variable_collection","Create a new variable collection with optional initial mode name and additional modes. Collections group related design tokens (e.g. 'Brand Colors', 'Spacing').",{name:m.string().describe("Collection name (e.g. 'Brand Colors')"),initialModeName:m.string().optional().describe("Name for the default mode (default is 'Mode 1'). E.g. 'Light'"),additionalModes:m.array(m.string()).optional().describe("Additional modes to create (e.g. ['Dark', 'High Contrast'])"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("create_variable_collection",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("create_variable","Create a new variable (design token) in a collection. Supports COLOR, FLOAT, STRING, and BOOLEAN types. For COLOR values, you can pass hex strings (e.g. '#5E5EAF') or RGB objects ({r, g, b} with 0-1 values). Use 'VariableID:...' strings to create variable aliases.",{name:m.string().describe("Variable name (e.g. 'primary/main' or 'spacing/sm')"),collectionId:m.string().describe("ID of the collection to add the variable to"),resolvedType:m.enum(["COLOR","FLOAT","STRING","BOOLEAN"]).describe("The variable data type"),valuesByMode:m.record(m.unknown()).optional().describe("Initial values per mode. Keys are mode IDs, values depend on type. COLOR: hex string or {r,g,b} object. FLOAT: number. STRING: string. BOOLEAN: true/false."),description:m.string().optional().describe("Variable description"),scopes:m.array(m.string()).optional().describe("Scopes limiting where the variable can be applied (e.g. ['ALL_FILLS', 'STROKE_COLOR'])"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("create_variable",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("update_variable","Update a variable's value for a specific mode. For COLOR variables, accepts hex strings or RGB objects. Use 'VariableID:...' strings to set variable aliases.",{variableId:m.string().describe("The variable ID to update"),modeId:m.string().describe("The mode ID to set the value for"),value:m.unknown().describe("The new value. COLOR: hex or {r,g,b}. FLOAT: number. STRING: string. BOOLEAN: boolean."),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("update_variable",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("rename_variable","Rename a variable while preserving all its values and references",{variableId:m.string().describe("The variable ID to rename"),newName:m.string().describe("The new variable name"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("rename_variable",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("delete_variable","Delete a variable. This will remove all values and break any references to this variable.",{variableId:m.string().describe("The variable ID to delete"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("delete_variable",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("delete_variable_collection","Delete a variable collection and all its variables",{collectionId:m.string().describe("The collection ID to delete"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("delete_variable_collection",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("add_mode","Add a new mode to a variable collection (e.g. add 'Dark' mode to a color collection)",{collectionId:m.string().describe("The collection ID to add the mode to"),modeName:m.string().describe("Name for the new mode (e.g. 'Dark')"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("add_mode",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("rename_mode","Rename a mode in a variable collection (e.g. rename 'Mode 1' to 'Light')",{collectionId:m.string().describe("The collection ID containing the mode"),modeId:m.string().describe("The mode ID to rename"),newName:m.string().describe("The new mode name"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("rename_mode",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("batch_create_variables","Create up to 100 variables in a single collection in one call. Much faster than individual create_variable calls for bulk token setup. Returns per-item success/failure results.",{collectionId:m.string().describe("The collection ID to add variables to"),variables:m.array(m.object({name:m.string().describe("Variable name"),resolvedType:m.enum(["COLOR","FLOAT","STRING","BOOLEAN"]).describe("Data type"),valuesByMode:m.record(m.unknown()).optional().describe("Values per mode"),description:m.string().optional().describe("Description"),scopes:m.array(m.string()).optional().describe("Scopes")})).describe("Array of variable definitions to create (max 100)"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=o.variables||[],i=hf+s.length*gf,a=await e.sendCommand("batch_create_variables",o,i,n);return{content:[{type:"text",text:JSON.stringify(a,null,2)}]}}),t.tool("batch_update_variables","Update up to 100 variable values in one call. Each update specifies a variable ID, mode ID, and new value. Much faster than individual update_variable calls.",{updates:m.array(m.object({variableId:m.string().describe("Variable ID to update"),modeId:m.string().describe("Mode ID to set the value for"),value:m.unknown().describe("New value")})).describe("Array of variable updates to apply (max 100)"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=o.updates||[],i=hf+s.length*gf,a=await e.sendCommand("batch_update_variables",o,i,n);return{content:[{type:"text",text:JSON.stringify(a,null,2)}]}}),t.tool("setup_design_tokens",`Create a complete design token system atomically in one call: collection + modes + variables with all values. This is the fastest way to bootstrap a token system from scratch.

Variable values are mapped positionally to modes. For example, if modes are ["Light", "Dark"] and a variable has values ["#5E5EAF", "#8481C9"], then Light gets #5E5EAF and Dark gets #8481C9.

Example spec:
{
  "collectionName": "Brand Colors",
  "modes": ["Light", "Dark"],
  "variables": [
    { "name": "primary/main", "resolvedType": "COLOR", "values": ["#5E5EAF", "#8481C9"], "description": "Primary brand color" },
    { "name": "primary/light", "resolvedType": "COLOR", "values": ["#797BBD", "#AA9BFD"] },
    { "name": "spacing/sm", "resolvedType": "FLOAT", "values": [8, 8] },
    { "name": "compact", "resolvedType": "BOOLEAN", "values": [false, true] }
  ]
}`,{collectionName:m.string().describe("Name for the new collection (e.g. 'Brand Colors')"),modes:m.array(m.string()).optional().describe("Mode names in order (e.g. ['Light', 'Dark']). If omitted, uses the default single mode."),variables:m.array(m.object({name:m.string().describe("Variable name (e.g. 'primary/main')"),resolvedType:m.enum(["COLOR","FLOAT","STRING","BOOLEAN"]).describe("Data type"),values:m.array(m.unknown()).describe("Values mapped positionally to modes. COLOR: hex or {r,g,b}. FLOAT: number. STRING: string. BOOLEAN: boolean."),description:m.string().optional().describe("Variable description"),scopes:m.array(m.string()).optional().describe("Variable scopes")})).describe("Array of variable definitions (max 100)"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=o.variables||[],i=hf+s.length*gf,a=await e.sendCommand("setup_design_tokens",o,i,n);return{content:[{type:"text",text:JSON.stringify(a,null,2)}]}})}function Nv(t,e){t.tool("get_console_logs","Retrieve captured console logs from the Figma plugin. Logs are captured from console.log/info/warn/error/debug calls in the plugin sandbox. Supports filtering by level and timestamp, and limiting the number of results. Use the 'since' parameter for polling (pass the timestamp of the last retrieved log).",{limit:m.number().optional().describe("Maximum number of log entries to return (most recent first). Default: all."),level:m.enum(["log","info","warn","error","debug"]).optional().describe("Filter by log level"),since:m.number().optional().describe("Only return logs with timestamp >= this value (Unix ms). Use for polling."),fileId:E},async r=>{let n=e.getConsoleLogs({fileId:r.fileId,limit:r.limit,level:r.level,since:r.since});return{content:[{type:"text",text:JSON.stringify({count:n.length,logs:n.map(o=>({level:o.level,message:o.message,args:o.args,timestamp:o.timestamp,file:o.fileName}))},null,2)}]}}),t.tool("clear_console_logs","Clear all buffered console logs for the target Figma file. Useful to reset the buffer before testing a specific interaction.",{fileId:E},async r=>{let n=e.clearConsoleLogs(r.fileId);return{content:[{type:"text",text:JSON.stringify(n,null,2)}]}})}function Ov(t,e){t.tool("arrange_component_set",'Combine multiple component nodes into a proper Figma component set (variant group). This is the programmatic equivalent of "Combine as Variants" in Figma. Components must follow the variant naming convention: "Property=Value, Property2=Value2" (e.g. "Size=md, State=default"). Returns the created component set with parsed variant axes.',{componentIds:m.array(m.string()).describe("Array of component node IDs to combine into a variant set. Each must be a COMPONENT type node."),name:m.string().optional().describe("Optional name for the component set (e.g. 'Button')"),parentId:m.string().optional().describe("Parent node ID for the component set (defaults to the first component's parent)"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("arrange_component_set",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}}),t.tool("get_component_set_info","Get detailed information about a component set including all variant axes (properties and their possible values), individual variants with their properties, the default variant, and component property definitions. Use this to understand the variant structure before creating instances.",{nodeId:m.string().describe("The COMPONENT_SET node ID to inspect"),fileId:E},async r=>{let{fileId:n,rest:o}=j(r),s=await e.sendCommand("get_component_set_info",o,void 0,n);return{content:[{type:"text",text:JSON.stringify(s,null,2)}]}})}function Cv(t,e,r=.02){return Math.abs(t.r-e.r)<=r&&Math.abs(t.g-e.g)<=r&&Math.abs(t.b-e.b)<=r}function SR(t){return Array.isArray(t)?t.filter(e=>e.type==="SOLID"&&e.visible!==!1).map(e=>e.color):[]}function $R(t){switch(t){case"critical":return 0;case"warning":return .5;case"info":return .9}}function Av(t,e){t.tool("check_design_parity",`Compare a Figma design node against a structured code specification to find mismatches between design and implementation. The tool fetches the Figma node's properties and diffs them against the code spec.

The codeSpec should be a JSON object with any of these optional sections:
- colors: Array of {name, value: {r,g,b}} \u2014 expected fill/stroke colors (0-1 range)
- typography: {fontFamily?, fontSize?, fontWeight?, lineHeight?, letterSpacing?}
- spacing: {padding?: {top,right,bottom,left}, gap?, margin?}
- borderRadius: number or {topLeft, topRight, bottomRight, bottomLeft}
- border: {width?, color?: {r,g,b}}
- dimensions: {width?, height?}
- opacity: number (0-1)

Returns a scored report (0-100) with per-property comparison and actionable fix items.`,{nodeId:m.string().describe("Figma node ID to inspect"),codeSpec:m.string().describe("JSON string describing the code implementation properties"),depth:m.number().optional().describe("How deep to inspect children (default 1)"),fileId:E},async r=>{let{fileId:n}=j(r),o;try{o=JSON.parse(r.codeSpec)}catch(f){return{content:[{type:"text",text:`Error: Failed to parse codeSpec JSON.
${f instanceof Error?f.message:String(f)}`}]}}let s=await e.sendCommand("get_node_by_id",{nodeId:r.nodeId},void 0,n),i=[],a=0;if(o.colors&&Array.isArray(o.colors)){let f=SR(s.fills);for(let y of o.colors){a++;let b=y.value;f.find(S=>Cv(S,b))||i.push({category:"color",property:y.name||"fill",severity:"critical",designValue:f.length>0?f[0]:null,codeValue:b,message:`Color "${y.name||"fill"}" not found in design fills`})}}if(o.typography&&s.type==="TEXT"){let f=o.typography;if(f.fontFamily){a++;let y=s.fontName&&typeof s.fontName=="object"&&s.fontName.family;y&&y!==f.fontFamily&&i.push({category:"typography",property:"fontFamily",severity:"critical",designValue:y,codeValue:f.fontFamily,message:`Font family: design uses "${y}", code uses "${f.fontFamily}"`})}if(f.fontSize!==void 0&&(a++,s.fontSize!==void 0&&s.fontSize!==f.fontSize&&i.push({category:"typography",property:"fontSize",severity:"warning",designValue:s.fontSize,codeValue:f.fontSize,message:`Font size: design ${s.fontSize}px vs code ${f.fontSize}px`})),f.lineHeight!==void 0){a++;let y=s.lineHeight;y&&typeof y=="object"&&y.value!==f.lineHeight&&i.push({category:"typography",property:"lineHeight",severity:"info",designValue:y,codeValue:f.lineHeight,message:"Line height differs"})}}if(o.spacing){let f=o.spacing;if(f.padding){for(let y of["top","right","bottom","left"])if(f.padding[y]!==void 0){a++;let b=`padding${y.charAt(0).toUpperCase()+y.slice(1)}`,x=s[b];x!==void 0&&x!==f.padding[y]&&i.push({category:"spacing",property:`padding.${y}`,severity:"warning",designValue:x,codeValue:f.padding[y],message:`Padding ${y}: design ${x}px vs code ${f.padding[y]}px`})}}f.gap!==void 0&&(a++,s.itemSpacing!==void 0&&s.itemSpacing!==f.gap&&i.push({category:"spacing",property:"gap",severity:"warning",designValue:s.itemSpacing,codeValue:f.gap,message:`Gap/itemSpacing: design ${s.itemSpacing}px vs code ${f.gap}px`}))}if(o.borderRadius!==void 0){a++;let f=s.cornerRadius,y=o.borderRadius;typeof y=="number"&&f!==void 0&&f!==y&&i.push({category:"shape",property:"borderRadius",severity:"warning",designValue:f,codeValue:y,message:`Border radius: design ${f}px vs code ${y}px`})}if(o.border&&(o.border.width!==void 0&&(a++,s.strokeWeight!==void 0&&s.strokeWeight!==o.border.width&&i.push({category:"border",property:"borderWidth",severity:"warning",designValue:s.strokeWeight,codeValue:o.border.width,message:`Border width: design ${s.strokeWeight}px vs code ${o.border.width}px`})),o.border.color)){a++;let f=s.strokes;if(Array.isArray(f)&&f.length>0){let y=f[0].color;y&&!Cv(y,o.border.color)&&i.push({category:"border",property:"borderColor",severity:"warning",designValue:y,codeValue:o.border.color,message:"Border color differs"})}}o.dimensions&&(o.dimensions.width!==void 0&&(a++,s.width!==void 0&&Math.abs(s.width-o.dimensions.width)>1&&i.push({category:"dimensions",property:"width",severity:"warning",designValue:s.width,codeValue:o.dimensions.width,message:`Width: design ${s.width}px vs code ${o.dimensions.width}px`})),o.dimensions.height!==void 0&&(a++,s.height!==void 0&&Math.abs(s.height-o.dimensions.height)>1&&i.push({category:"dimensions",property:"height",severity:"info",designValue:s.height,codeValue:o.dimensions.height,message:`Height: design ${s.height}px vs code ${o.dimensions.height}px`}))),o.opacity!==void 0&&(a++,s.opacity!==void 0&&Math.abs(s.opacity-o.opacity)>.01&&i.push({category:"visual",property:"opacity",severity:"warning",designValue:s.opacity,codeValue:o.opacity,message:`Opacity: design ${s.opacity} vs code ${o.opacity}`})),a===0&&(a=1);let c=i.reduce((f,y)=>f+(1-$R(y.severity)),0),u=Math.max(0,1-c/a),l=Math.round(u*100),d=i.filter(f=>f.severity==="critical").length,g=i.filter(f=>f.severity==="warning").length,h=i.filter(f=>f.severity==="info").length,p={score:l,verdict:l>=90?"PASS":l>=70?"NEEDS_REVIEW":"FAIL",checksPerformed:a,issues:{critical:d,warning:g,info:h,total:i.length},details:i,designNode:{id:s.id,name:s.name,type:s.type}};return{content:[{type:"text",text:JSON.stringify(p,null,2)}]}})}var Fn=require("fs"),en=require("path"),kR=["design-system-config.mdc","figma-tool-usage-rules.mdc","interactive-specs.mdc"],TR=["quark-2-components.mdc","quark-2-tokens.mdc"];function Mv(t,e){t.tool("verify_workspace_setup","Verify that the workspace has the required Figma MCP Bridge rules installed. Call this before your first design operation in each session. Returns a pass/fail status with details about missing files.",{workspacePath:m.string().describe("Absolute path to the workspace root directory (the project folder open in the editor)")},async({workspacePath:r})=>{let n=(0,en.join)(r,".cursor","rules"),o=(0,en.join)(r,".cursor","specs"),s=(0,en.join)(r,".cursor","cache"),i=[],a=[],c=[];for(let g of kR){let h=(0,en.join)(n,g);(0,Fn.existsSync)(h)?a.push(g):i.push(g)}for(let g of TR){let h=(0,en.join)(n,g);(0,Fn.existsSync)(h)?a.push(g):c.push(`Optional rule "${g}" not found \u2014 design system features may be limited`)}(0,Fn.existsSync)(o)||c.push(".cursor/specs/ directory not found \u2014 spec validation will not work"),(0,Fn.existsSync)(s)||c.push(".cursor/cache/ directory not found \u2014 library cache will be created on first use");let u=(0,en.join)(r,".github","instructions"),l=(0,Fn.existsSync)(u);return i.length>0?{content:[{type:"text",text:["SETUP INCOMPLETE \u2014 Required rules are missing.","",`Missing (${i.length}):`,...i.map(h=>`  \u2717 .cursor/rules/${h}`),"",a.length>0?`Present (${a.length}):
${a.map(h=>`  \u2713 .cursor/rules/${h}`).join(`
`)}`:"","",c.length>0?`Warnings:
${c.map(h=>`  \u26A0 ${h}`).join(`
`)}`:"","","To fix: run the setup script from this project directory:",`  cd ${r}`,"  node ~/outreach-figma-bridge/setup.js","","DO NOT proceed with design operations until setup is complete."].filter(Boolean).join(`
`)}],isError:!0}:{content:[{type:"text",text:["SETUP VERIFIED \u2014 All required rules are present.","",`Rules (${a.length}):`,...a.map(g=>`  \u2713 .cursor/rules/${g}`),"",l?"  \u2713 .github/instructions/ (VS Code)":"  \u25CB .github/instructions/ (not found \u2014 VS Code users may need setup)","",c.length>0?`Warnings:
${c.map(g=>`  \u26A0 ${g}`).join(`
`)}
`:"","You may proceed with design operations."].filter(Boolean).join(`
`)}]}}),t.tool("check_health","Check the health of the MCP-to-Figma connection pipeline. Returns server state, WebSocket port, connected Figma files, and actionable guidance if something is wrong. Call this when design operations fail or before starting a session.",{},async()=>{let r=e.getStatus(),{server:n,connections:o,pending:s}=r;if(n.state==="port_conflict")return{content:[{type:"text",text:["CONNECTION PROBLEM \u2014 Port conflict",`  Server:  port ${n.port} is in use by another process`,"","  This usually means another editor (Cursor or VS Code) already has","  the MCP server running. Only one editor can control Figma at a time.","","  To fix:","  - Close the other editor, OR","  - Change FIGMA_BRIDGE_PORT in the other editor's MCP config"].join(`
`)}],isError:!0};if(n.state!=="listening")return{content:[{type:"text",text:["CONNECTION PROBLEM \u2014 Server not running",`  Server:  state is "${n.state}" (expected "listening")`,`  Port:    ${n.port}`,"","  To fix:","  - Restart your editor to reinitialize the MCP server","  - Check the terminal/output for startup errors"].join(`
`)}],isError:!0};if(o.count===0)return{content:[{type:"text",text:["CONNECTION PROBLEM \u2014 No Figma plugin",`  Server:  listening on port ${n.port}`,"  Plugin:  0 files connected","","  To fix:","  1. Open a Figma file in the Desktop App","  2. Run Plugins > Outreach Figma MCP Bridge",'  3. Wait for the "Connected" indicator in the plugin'].join(`
`)}],isError:!0};let i=o.count===1?"1 file connected":`${o.count} files connected`;return{content:[{type:"text",text:["CONNECTION HEALTHY",`  Server:  listening on port ${n.port}`,`  Plugin:  ${i}`,...o.activeFile?[`  Active:  "${o.activeFile}"`]:[],...o.files.length>1?[`  Files:   ${o.files.join(", ")}`]:[],`  Pending: ${s} command${s===1?"":"s"} in flight`].join(`
`)}]}})}var E=m.string().optional().describe("Target Figma file name or ID. Required when multiple files are connected. Omit when only one file is open.");function j(t){let{fileId:e,...r}=t;return{fileId:e,rest:r}}function jv(t,e){Mv(t,e),yv(t,e),$v(t,e),_v(t,e),bv(t,e),xv(t,e),wv(t,e),Sv(t,e),Pv(t,e),Rv(t,e),Nv(t,e),Ov(t,e),Av(t,e)}function Dv(t){t.prompt("design_screen","Generate a structured design plan from a natural-language screen description, following the active design system rules",{description:m.string().describe("Natural-language screen description (e.g. 'a settings page with profile section and toggles')")},async({description:e})=>({messages:[{role:"user",content:{type:"text",text:`You are a Figma design assistant. Design the following screen using the project's design system (defined in the cursor rules).

## Screen Description
${e}

## Instructions
Follow this structured approach:

1. **Consult the design system rules** for colors, typography, spacing, corner radius, elevation, and component specs. Never hardcode values \u2014 always use the tokens from the rules.
2. **Root Frame**: Create a screen frame at the size specified in the design system (e.g. desktop 1440px or mobile 375px). Apply the appropriate background color from the design system tokens.
3. **Navigation / App Bar**: If the design system specifies a header or sidebar, include it with the correct dimensions, fill, and typography.
4. **Content Area**: Auto layout VERTICAL frame with the design system's standard content padding and section spacing.
5. **Components**: For each UI element mentioned in the description, use the component specs from the design system rules:
   - "button" \u2192 the default button variant (check rules for height, radius, fill, text style)
   - "input" / "field" \u2192 the default text field (check rules for height, radius, stroke, label style)
   - "card" \u2192 the default card variant (check rules for radius, fill, elevation, padding)
   - "toggle" / "switch" \u2192 switch component from the rules
   - Use the correct typography styles, colors, and spacing from the design system.
6. **Spacing**: Follow the design system's spacing scale (typically multiples of a base unit).
7. **Typography**: Use the font families and styles specified in the design system rules.
8. **Name all layers semantically** (e.g. "Login Form", "Email Field", "Submit Button").
9. **Always set auto layout** on every frame before appending children.
10. **Use build_from_spec or build_and_verify** to create the design atomically from a single spec.

Build the design step by step, creating the outermost containers first, then inner components.`}}]})),t.prompt("design_from_prd","Parse a PRD (Product Requirements Document) and generate a multi-screen Figma design plan",{prd_content:m.string().describe("The full PRD content to parse")},async({prd_content:e})=>({messages:[{role:"user",content:{type:"text",text:`You are a Figma design assistant. Read the following PRD and create all the screens it describes using the project's design system (defined in the cursor rules).

## PRD Content
${e}

## Instructions
1. Identify each distinct screen or page described in the PRD.
2. For each screen, create a frame at the standard screen size from the design system, spaced 100px apart horizontally on the canvas.
3. Follow the design system rules exactly for:
   - Background colors, surface colors, text colors
   - Typography scale (font families, sizes, weights)
   - Component specs (buttons, inputs, cards, etc.)
   - Spacing tokens and corner radius values
   - Elevation / shadow tokens
4. Use auto layout on every container frame.
5. Name all layers semantically based on their function.
6. Apply proper elevation shadows as specified in the design system.
7. Use build_from_spec or build_and_verify to create each screen atomically.
8. Build each screen completely before moving to the next.`}}]})),t.prompt("audit_design","Audit an existing Figma design for design system compliance (colors, spacing, typography, components)",{nodeId:m.string().describe("The root node ID to audit (e.g. a frame or page)")},async({nodeId:e})=>({messages:[{role:"user",content:{type:"text",text:`You are a Figma design auditor. Inspect the node with ID "${e}" and all its children for design system compliance. Refer to the project's design system rules for the expected token values.

## Audit Checklist
1. **Colors**: Check that fills and text colors match the design system's color tokens. Flag any non-standard or hardcoded colors.
2. **Typography**: Verify font families, sizes, and weights match the design system's type scale. Flag mismatches.
3. **Spacing**: Check that padding and item spacing follow the design system's spacing scale. Flag values that aren't on the scale.
4. **Corner Radius**: Verify radii match the design system's shape tokens.
5. **Component Specs**: Check component dimensions (button heights, input heights, app bar heights, etc.) against the design system's specifications.
6. **Auto Layout**: Verify all container frames use auto layout.
7. **Layer Naming**: Check that layers have semantic names, not defaults like "Frame 1" or "Rectangle 3".

Use get_node_by_id and get_children to traverse the tree. Report findings as a structured list with severity (error/warning/info) and specific fix recommendations referencing the correct design system token.`}}]})),t.prompt("responsive_variants","Create tablet and desktop variants from an existing design",{nodeId:m.string().describe("The source frame node ID to create variants from"),breakpoints:m.string().optional().describe("Comma-separated breakpoint widths (default: '768,1440' for tablet and desktop)")},async({nodeId:e,breakpoints:r})=>{let n=(r||"768,1440").split(",").map(o=>o.trim());return{messages:[{role:"user",content:{type:"text",text:`You are a responsive design specialist. Take the existing design at node ID "${e}" and create responsive variants for these breakpoints: ${n.join("px, ")}px.

## Instructions
1. First, use get_node_by_id to inspect the source design and understand its structure.
2. For each breakpoint width (${n.join(", ")}):
   a. Clone the source frame using clone_node.
   b. Resize the clone to the new width (keep height auto or adjust proportionally).
   c. Position the clone 100px to the right of the previous frame.
   d. Rename it with the breakpoint suffix (e.g. "Login Screen - Tablet", "Login Screen - Desktop").
   e. Adjust the layout for the new width:
      - For tablet (~768px): Increase horizontal padding, widen content areas.
      - For desktop (~1440px): Center content in a max-width container, use the design system's desktop padding values.
   f. Adjust text fields, buttons, and other components to appropriate widths for the breakpoint.
3. Maintain all design system tokens (colors, typography, spacing) \u2014 refer to the cursor rules.
4. Ensure auto layout is preserved and adapts correctly.`}}]}}),t.prompt("design_strategy","Best practices for working with Figma designs \u2013 structure, auto layout, naming, and efficient tool usage",{},async()=>({messages:[{role:"user",content:{type:"text",text:`You are a Figma design expert. Follow these best practices when creating or modifying Figma designs:

## Structure & Hierarchy
1. **Always use auto layout** on container frames before appending children. Set the layout mode (HORIZONTAL/VERTICAL) first, then add children.
2. **Build outside-in**: Create the root frame first, then nested containers, then leaf elements.
3. **Use semantic layer names**: "Login Card", "Email Field Row", "Primary Button" \u2014 never "Frame 42" or "Rectangle 3".
4. **Group related elements** using frames with auto layout, not loose grouping.

## Auto Layout Best Practices
- Set layout mode BEFORE appending children.
- Use primaryAxisSizingMode: "AUTO" (hug) for content-driven frames, "FIXED" for constrained widths.
- Use counterAxisSizingMode: "AUTO" for height-hugging, "FIXED" for explicit heights.
- Use set_layout_sizing with "FILL" on children that should stretch to fill their parent.
- For centered content: primaryAxisAlignItems: "CENTER" and counterAxisAlignItems: "CENTER".

## Spacing & Layout
- Follow the design system's spacing scale (defined in the cursor rules). Typically based on an 8px or 4px grid.
- set_auto_layout accepts padding values (paddingTop, paddingRight, paddingBottom, paddingLeft) and itemSpacing directly.
- For equal padding on all sides, set all four values the same.

## Typography
- Use get_available_fonts to check font availability before creating text.
- Use the font families and type scale from the project's design system rules.

## Colors
- Always use color tokens from the design system rules. Never hardcode arbitrary color values.
- Apply fills and strokes using the token values specified in the rules.

## Atomic Building
- Use build_from_spec or build_and_verify to create entire component trees in one call.
- Use build_and_verify for visual confirmation \u2014 it builds + screenshots + validates in one call.
- Reserve individual tools (set_fill, set_font, etc.) for post-creation modifications only.

## Efficiency
- Use batch tools (set_multiple_text_contents, delete_multiple_nodes) when operating on 3+ nodes.
- Use scan_text_nodes with chunking for large designs.
- Use read_my_design to quickly inspect the current selection.`}}]})),t.prompt("read_design_strategy","Best practices for reading and understanding existing Figma designs",{},async()=>({messages:[{role:"user",content:{type:"text",text:`You are a Figma design analyst. Follow these best practices when reading and understanding existing designs:

## Reading Strategy
1. **Start with the big picture**: Use get_document_info to understand the document structure and pages.
2. **Scan the page**: Use scan_page with depth 2-3 to get an overview of top-level frames and their children.
3. **Drill down selectively**: Use get_node_by_id or get_children with increasing depth on specific nodes of interest.
4. **Use read_my_design**: When the user has something selected, use this to get detailed info without needing node IDs.

## Efficient Inspection
- Use get_nodes_info to batch-fetch multiple nodes in one call.
- Use find_nodes_by_name for targeted name searches.
- Use find_nodes_by_type to find all nodes of a specific type (e.g., all TEXT, FRAME, or COMPONENT nodes).
- Use scan_text_nodes for a comprehensive text inventory with font metadata.

## Understanding Layout
- Check layoutMode on frames: "HORIZONTAL", "VERTICAL", or "NONE" (absolute positioning).
- Check primaryAxisSizingMode and counterAxisSizingMode for sizing behavior.
- Check padding and itemSpacing for spacing values.
- Look at children's layoutSizingHorizontal/layoutSizingVertical for fill/hug/fixed behavior.

## Understanding Components
- Use get_local_components to list all components on the page.
- Use get_instance_overrides to understand what has been customized on an instance.
- Check mainComponent on instances to find the source component.

## Reporting
- Summarize findings in a structured format: hierarchy tree, color palette, typography used, spacing patterns.
- Note any inconsistencies or deviations from the project's design system (refer to cursor rules for expected values).`}}]})),t.prompt("text_replacement_strategy","Systematic approach for replacing text across Figma designs \u2013 scan, match, and batch-update",{find:m.string().describe("Text to find"),replace:m.string().describe("Text to replace with"),scope:m.string().optional().describe("Optional node ID to scope the replacement (defaults to entire page)")},async({find:e,replace:r,scope:n})=>({messages:[{role:"user",content:{type:"text",text:`You are a Figma text replacement specialist. Replace all occurrences of "${e}" with "${r}"${n?` within node ${n}`:" on the current page"}.

## Strategy
1. **Scan**: Use scan_text_nodes${n?` with nodeId "${n}"`:""} to get all text nodes and their current content.
2. **Match**: Filter the results to find text nodes containing "${e}".
3. **Preview**: List all matching nodes with their IDs, names, and current text before making changes.
4. **Replace**: Use set_multiple_text_contents to batch-update all matching nodes at once.
   - For each matching node, replace "${e}" with "${r}" in the characters string.
   - Preserve any surrounding text that doesn't match.
5. **Verify**: Use scan_text_nodes again to confirm all replacements were applied correctly.
6. **Report**: Summarize how many nodes were updated and list any that couldn't be updated (e.g., mixed fonts).

## Important
- Text nodes with mixed font styles (different fonts within the same node) may fail if the replacement changes the text length. Handle these individually with set_text_content.
- Always preview before replacing \u2013 ask the user to confirm if the list of changes looks correct.
- Use chunked scanning for large designs to avoid timeouts.`}}]})),t.prompt("swap_overrides_instances","Strategy for transferring overrides between component instances in Figma",{sourceInstanceId:m.string().describe("Source instance ID to copy overrides from"),targetInstanceIds:m.string().describe("Comma-separated target instance IDs to apply overrides to")},async({sourceInstanceId:e,targetInstanceIds:r})=>{let n=r.split(",").map(o=>o.trim());return{messages:[{role:"user",content:{type:"text",text:`You are a Figma component specialist. Transfer overrides from instance "${e}" to these target instances: ${n.join(", ")}.

## Strategy
1. **Extract source overrides**: Use get_instance_overrides with nodeId "${e}" to get all current overrides (text, fills, visibility).
2. **Review overrides**: List the extracted overrides and confirm which ones should be transferred.
3. **Apply to targets**: For each target instance (${n.join(", ")}):
   a. Use set_instance_overrides with the target instance ID and the extracted overrides array.
   b. Map overrides by childName \u2013 ensure the child names match between source and target instances.
4. **Verify**: Use get_instance_overrides on each target to confirm the overrides were applied correctly.
5. **Handle mismatches**: If child names don't match (different component variants), report which overrides couldn't be applied and suggest alternatives.

## Important
- Only transfer overrides for children that exist in both source and target instances.
- Text overrides require the target child to be a TEXT node.
- Fill overrides require the target child to support fills.
- Visibility overrides can be applied to any node.
- If source and target are instances of different components, some children may not exist in the target.`}}]}}),t.prompt("spec_format","Reference guide for the component tree spec format used by build_from_spec and build_and_verify. Describes all supported fields, types, and patterns with examples.",{},async()=>({messages:[{role:"user",content:{type:"text",text:`You are a Figma design assistant that uses the component tree spec format to build designs atomically.

## Component Tree Spec Format

The spec is a JSON object that describes a Figma component tree declaratively. Instead of making many individual tool calls, you write a single spec and pass it to \`build_from_spec\` or \`build_and_verify\`.

### Required Fields

Every node MUST have:
- **name** (string): Semantic layer name. Use descriptive names like "Login Card", "Email Field", "Submit Button".
- **type** (string): One of: \`frame\`, \`text\`, \`rectangle\`, \`ellipse\`, \`line\`, \`component\`, \`vector\`

### Geometry Fields (all optional)

- **x** (number): X position in pixels
- **y** (number): Y position in pixels
- **width** (number): Width in pixels
- **height** (number): Height in pixels

### Visual Fields (all optional)

- **fill** ({r, g, b}): Solid fill color. Values are 0-1, not 0-255.
  - Example: \`{"r": 0.369, "g": 0.369, "b": 0.686}\` \u2014 always use token values from the design system rules.
- **fillOpacity** (number): Fill opacity, 0-1. Default 1.
- **stroke** ({color: {r,g,b}, weight: number, align?: string}): Stroke config.
  - align: "INSIDE" | "OUTSIDE" | "CENTER"
- **cornerRadius** (number): Uniform corner radius in pixels.
- **opacity** (number): Node opacity, 0-1. Default 1.
- **visible** (boolean): Node visibility. Default true.
- **clipContent** (boolean): Clip children to frame bounds. Default true for frames.
- **effects** (array): Shadows and blurs.
  - \`{"type": "DROP_SHADOW", "radius": 8, "color": {"r":0,"g":0,"b":0,"a":0.15}, "offset": {"x":0,"y":2}, "spread": 0}\`
  - \`{"type": "INNER_SHADOW", "radius": 4, "color": {"r":0,"g":0,"b":0,"a":0.1}, "offset": {"x":0,"y":1}}\`
  - \`{"type": "LAYER_BLUR", "radius": 10}\`

### Text Fields (only for type: "text")

- **characters** (string, REQUIRED for text): The text content.
- **fontSize** (number): Font size in px. Default 14.
- **fontFamily** (string): Font family name. Default "Inter".
- **fontStyle** (string): Font style. Default "Regular". Options: "Regular", "Bold", "Medium", "Light", "SemiBold", "Italic", etc.
- **textAlignHorizontal**: "LEFT" | "CENTER" | "RIGHT" | "JUSTIFIED"
- **textAlignVertical**: "TOP" | "CENTER" | "BOTTOM"

### Auto-Layout (only for frame/component)

- **autoLayout** (object): Configure auto-layout on this container.
  - **mode** (REQUIRED): "HORIZONTAL" | "VERTICAL"
  - **itemSpacing** (number): Gap between children in px
  - **padding** (number OR object): Uniform padding or per-side:
    - Number: \`16\` \u2192 16px on all sides
    - Object: \`{"top": 24, "right": 16, "bottom": 24, "left": 16}\`
  - **primaryAxisAlignItems**: "MIN" | "MAX" | "CENTER" | "SPACE_BETWEEN"
  - **counterAxisAlignItems**: "MIN" | "MAX" | "CENTER"
  - **primaryAxisSizingMode**: "FIXED" | "AUTO" (hug)
  - **counterAxisSizingMode**: "FIXED" | "AUTO" (hug)
  - **layoutWrap**: "NO_WRAP" | "WRAP"

### Layout Sizing (when inside an auto-layout parent)

- **layoutSizing** (object): How this node sizes within its parent.
  - **horizontal**: "FILL" (stretch) | "HUG" (fit content) | "FIXED"
  - **vertical**: "FILL" | "HUG" | "FIXED"

### Children (only for frame/component)

- **children** (array): Ordered list of child spec nodes. Each child follows the same schema recursively.

### Vector Fields (type: "vector")

- **svgPath** (string): SVG path data string, e.g. "M 0 0 L 100 0 L 100 100 Z"

---

## Examples

### Simple Card

\`\`\`json
{
  "name": "Info Card",
  "type": "frame",
  "width": 320,
  "fill": {"r": 0.996, "g": 0.992, "b": 0.988},
  "cornerRadius": 8,
  "autoLayout": {
    "mode": "VERTICAL",
    "itemSpacing": 8,
    "padding": 16,
    "counterAxisSizingMode": "FIXED",
    "primaryAxisSizingMode": "AUTO"
  },
  "stroke": {"color": {"r": 0.8, "g": 0.808, "b": 0.859}, "weight": 1},
  "children": [
    {
      "name": "Title",
      "type": "text",
      "characters": "Card Title",
      "fontSize": 20,
      "fontFamily": "Work Sans",
      "fontStyle": "SemiBold",
      "fill": {"r": 0.271, "g": 0.259, "b": 0.384},
      "layoutSizing": {"horizontal": "FILL"}
    },
    {
      "name": "Description",
      "type": "text",
      "characters": "This is a description of the card content.",
      "fontSize": 14,
      "fontFamily": "Roboto Flex",
      "fontStyle": "Regular",
      "fill": {"r": 0.408, "g": 0.404, "b": 0.514},
      "layoutSizing": {"horizontal": "FILL"}
    }
  ]
}
\`\`\`

### Button

\`\`\`json
{
  "name": "Primary Button",
  "type": "frame",
  "height": 36,
  "fill": {"r": 0.369, "g": 0.369, "b": 0.686},
  "cornerRadius": 100,
  "autoLayout": {
    "mode": "HORIZONTAL",
    "padding": {"top": 8, "right": 12, "bottom": 8, "left": 12},
    "primaryAxisSizingMode": "AUTO",
    "counterAxisSizingMode": "FIXED",
    "primaryAxisAlignItems": "CENTER",
    "counterAxisAlignItems": "CENTER",
    "itemSpacing": 4
  },
  "children": [
    {
      "name": "Button Label",
      "type": "text",
      "characters": "Click Me",
      "fontSize": 14,
      "fontFamily": "Roboto Flex",
      "fontStyle": "SemiBold",
      "fill": {"r": 1, "g": 1, "b": 1}
    }
  ]
}
\`\`\`

> **Note:** The colors in these examples are illustrative. Always look up the correct token values from the project's design system rules.

## Best Practices

1. **Always use autoLayout on container frames** before specifying children. This ensures Figma arranges children correctly.
2. **Use layoutSizing: {"horizontal": "FILL"}** on children that should stretch to fill their parent width.
3. **Build outside-in**: Define the root frame first, then nested containers, then leaf elements.
4. **Use semantic names**: "Login Card", "Email Field Row", "Submit Button" \u2014 never "Frame 1" or "Rectangle 3".
5. **Use build_and_verify** instead of build_from_spec when you want visual confirmation. It builds + screenshots + validates in one call.
6. **After build_and_verify**, check the validation report for any mismatches and fix them.
7. **Use design system tokens**: Always reference the color, typography, and spacing tokens from the project's cursor rules. Never hardcode arbitrary values.
8. **Prefer uniform padding** (number) when all sides are equal: \`"padding": 16\` instead of \`{"top":16,"right":16,"bottom":16,"left":16}\`.`}}]})),t.prompt("design_code_parity","Guide for checking design-code parity. Explains how to extract design properties from Figma, extract code properties from the codebase, and run check_design_parity to produce a scored diff report.",{nodeId:m.string().describe("Figma node ID of the component to check"),componentPath:m.string().describe("File path of the code component to compare against")},async({nodeId:e,componentPath:r})=>({messages:[{role:"user",content:{type:"text",text:`# Design-Code Parity Check

## Objective
Compare the Figma design for node **${e}** against the code implementation at **${r}** and produce a scored diff report.

## Steps

### 1. Read the Figma design
Use \`get_node_by_id\` with nodeId "${e}" to get the design properties.

### 2. Read the code implementation
Read the file at "${r}" and extract visual properties into a codeSpec JSON:

\`\`\`json
{
  "colors": [
    { "name": "background", "value": { "r": 0.369, "g": 0.369, "b": 0.686 } }
  ],
  "typography": {
    "fontFamily": "Roboto Flex",
    "fontSize": 14,
    "fontWeight": "600"
  },
  "spacing": {
    "padding": { "top": 8, "right": 12, "bottom": 8, "left": 12 },
    "gap": 4
  },
  "borderRadius": 8,
  "border": {
    "width": 1,
    "color": { "r": 0.8, "g": 0.808, "b": 0.859 }
  },
  "dimensions": {
    "width": 220,
    "height": 36
  },
  "opacity": 1
}
\`\`\`

### 3. Run the parity check
Call \`check_design_parity\` with the nodeId and the codeSpec JSON string.

### 4. Interpret the results
- **Score 90-100 (PASS)**: Design and code are aligned.
- **Score 70-89 (NEEDS_REVIEW)**: Minor discrepancies to review.
- **Score below 70 (FAIL)**: Significant mismatches that need fixing.

### 5. Generate fix recommendations
For each issue in the report:
- **Critical**: Must fix \u2014 wrong colors, wrong fonts.
- **Warning**: Should fix \u2014 spacing, radius, border differences.
- **Info**: Nice to fix \u2014 minor dimension or opacity drift.

Provide specific code changes needed to bring the implementation into alignment with the design.`}}]})),t.prompt("design_system_audit","Run a comprehensive design system audit: library health (T1) and component architecture (T2). Generates a self-contained HTML report in audits/.",{focus:m.string().optional().describe("Audit scope: 'full' (default), 'library-health' (T1 only), 'component-architecture' (T2 only)")},async({focus:e})=>{let r=e||"full";return{messages:[{role:"user",content:{type:"text",text:`# Design System Audit \u2014 Library Health & Component Architecture

You are a design system auditor. Run a comprehensive audit on the connected Figma library file. Analyze both library-level health and internal component architecture. Generate a self-contained HTML report.

**Audit scope: ${r}**
${r==="library-health"?"Skip T2 (component architecture) checks. Run T1 only.":""}
${r==="component-architecture"?"Skip T1 (library health) checks. Run T2 only.":""}
${r==="full"?"Run both T1 and T2 checks.":""}

---

## CALL OPTIMIZATION \u2014 READ FIRST

Minimize MCP round-trips. Follow this EXACT strategy:

**GLOBAL (3 calls):**
1. get_document_info \u2014 page list, file name
2. get_local_variables with includeLibrary: false \u2014 all local variables
3. get_local_styles \u2014 all paint, text, effect styles

**PER PAGE (1 + N calls, where N = component sets on that page):**
4. set_current_page(pageId) then scan_page with depth: 3 \u2014 returns the ENTIRE page tree. From this single response, extract:
   - All COMPONENT_SET nodes and their IDs (type === "COMPONENT_SET")
   - All COMPONENT nodes and their parent types (ghost detection: parent is FRAME/GROUP instead of COMPONENT_SET)
   - Internal structure of each variant (child types, layoutMode, layer names, fills) \u2014 variants are the COMPONENT children of each COMPONENT_SET
   - Variant names for axis parsing (e.g. "Style=Primary, Size=Small" \u2014 split by comma, split by =)
5. For EACH COMPONENT_SET found in the scan data: get_component_set_info(setId) \u2014 returns componentPropertyDefinitions (BOOLEAN/TEXT/INSTANCE_SWAP). This is the ONLY per-component call needed.

**DO NOT call these \u2014 scan_page already provides the data:**
- get_children (redundant with scan_page depth 3)
- get_node_by_id (redundant \u2014 all node info is in scan data)
- find_nodes_by_type (redundant \u2014 filter scan data by type instead)
- get_node_styles per component (too expensive \u2014 use global style audit)

**Total calls: 3 + (2 x pages) + (total component sets)**
Target: under 50 calls for a typical library.

---

## Phase 1 \u2014 Data Collection

Execute calls above. Collect and organize into these data structures:

**A. GLOBAL DATA:**
- fileName, pageCount, pageNames
- variables: totalCount, unaliasedCount, unaliasedList (variables where valuesByMode values are raw RGB objects, not VARIABLE_ALIAS references). Group unaliased by name prefix (primary/, secondary/, grey/, common/).
- paintStyles: totalCount, unboundCount, unboundList (styles where paints lack boundVariables). Group by name prefix.
- textStyles: totalCount, names
- effectStyles: totalCount, names

**B. PER-PAGE DATA (from scan_page):**
- pageName, componentSetCount, variantCount
- ghostComponents: variants whose parent in the scan tree is a FRAME or GROUP (not COMPONENT_SET). Record name + parent type.
- componentSetIds: list of COMPONENT_SET node IDs for Phase 1C

**C. PER-COMPONENT-SET DATA (from scan_page + get_component_set_info):**

For each COMPONENT_SET, record:

1. **Identity**: name, id, page, variantCount
2. **Variant axes** (parse from variant child names in scan data):
   - Split each COMPONENT child name by ", " then by "=" to get axis:value pairs
   - Collect all unique axes and their value sets
   - Compute expectedVariants = product of all axis value counts
   - actualVariants = number of COMPONENT children
   - missingPct = 1 - (actual / expected), only if expected > 0
3. **Property definitions** (from get_component_set_info \u2192 componentPropertyDefinitions):
   - Count properties by type: BOOLEAN, TEXT, INSTANCE_SWAP, VARIANT
   - List each property: name, type
   - Flag: has icon child but no INSTANCE_SWAP? Has text child but no TEXT property?
4. **Internal structure** (from scan_page \u2014 inspect the FIRST variant's children at depth 2-3):
   - childTypeCounts: count of INSTANCE, FRAME, TEXT, RECTANGLE, VECTOR, ELLIPSE, GROUP among children
   - totalChildren: sum of all child nodes (recursive up to depth 3)
   - instanceCount: number of INSTANCE nodes found
   - instanceRatio: instanceCount / totalChildren (0 to 1)
5. **Auto-layout** (from scan_page \u2014 check the first variant):
   - rootHasAutoLayout: does the variant root have layoutMode set (HORIZONTAL or VERTICAL)?
   - childAutoLayoutPct: percentage of FRAME children that have layoutMode set
6. **Layer naming** (from scan_page \u2014 check all descendants of first variant):
   - defaultNameCount: children with names matching "Frame *", "Rectangle *", "Group *", "Ellipse *", "Vector *" (case-insensitive regex)
   - totalLayerCount: total descendant count
   - defaultNamePct: defaultNameCount / totalLayerCount
   - defaultNameExamples: up to 5 example names
7. **Nesting depth** (from scan_page):
   - maxDepth: deepest nesting level within the variant (the scan gives depth 3 from the component set level, so depth 2 from the variant level \u2014 note actual depth may be deeper)
8. **Documentation**:
   - hasDescription: does the component set or variant have a non-empty description? (from get_component_set_info)

---

## Phase 2 \u2014 Audit Rules

### T1: Library Health

| # | Rule | Scoring |
|---|------|---------|
| R1 | **Token Alias Chain** | Score = 100 - (unaliased% x 100). Unaliased% = unaliasedVariables / totalVariables. |
| R2 | **Style-Variable Binding** | Score = 100 - (unbound% x 100). Unbound% = unboundPaintStyles / totalPaintStyles. |
| R3 | **Component Set Structure** | Score = 100 if 0 ghosts. Deduct 10 pts per ghost, min 0. |
| R4 | **Deprecated Cleanup** | Score = 100 if 0 deprecated on active pages. Deduct 15 per deprecated set, min 0. |
| R5 | **Naming Convention** | Determine the dominant convention (PascalCase/lowercase/dot-prefix). Score = dominantPct (the % of sets following the majority convention). |
| R6 | **No Duplicates** | Score = 100 if 0 duplicate set names. Deduct 20 per duplicate, min 0. |
| R7 | **Clean Hierarchy** | Score = 100 if 0 empty pages and 0 orphaned layers. Deduct 10 per issue, min 0. |

### T2: Component Architecture

For each component set, score these individually then average across all sets:

| # | Rule | Per-Component Scoring |
|---|------|----------------------|
| R8 | **Sub-component Decomposition** | If totalChildren < 5: score = 100 (simple component, flat is fine). If totalChildren >= 5: score = min(100, instanceRatio x 200). So ratio 0.5+ = 100, ratio 0 = 0. |
| R9 | **Property Definitions** | Start at 100. Deduct 25 if component has icon-like children (INSTANCE or VECTOR) but no INSTANCE_SWAP property. Deduct 25 if component has TEXT children but no TEXT property. Deduct 15 if component has toggleable elements but no BOOLEAN property. |
| R10 | **Variant Matrix Completeness** | Score = (actualVariants / expectedVariants) x 100. Cap at 100. If expectedVariants = 0, score = 100. |
| R11 | **Axis Naming Consistency** | Cross-system check. For each common axis name (Size, State, Style/Variant/Type), collect values across ALL component sets. Score = average consistency ratio per axis (% of sets using the most common value set). |
| R12 | **Auto-Layout Coverage** | Score = 100 if rootHasAutoLayout. Score = 0 if not. |
| R13 | **Internal Layer Naming** | Score = 100 - (defaultNamePct x 100). |
| R14 | **Nesting Depth** | Score = 100 if depth 2-4. Score = 70 if depth 1 or 5. Score = 40 if depth 0 or 6+. |
| R15 | **Documentation** | Score = 100 if hasDescription. Score = 0 if not. |

### Category Scores

- **T1 Library Health** = average of R1-R7 scores
- **T2 Component Architecture** = average of R8-R15 scores (each Rx is itself averaged across all component sets)
- **Overall** = (T1 x 0.4) + (T2 x 0.6)

### Grade Scale

| Grade | Range | Meaning |
|-------|-------|---------|
| A | 90-100 | Excellent |
| B | 75-89 | Good, minor improvements |
| C | 60-74 | Fair, notable gaps |
| D | 40-59 | Poor, significant rework |
| F | 0-39 | Critical issues |

---

## Phase 3 \u2014 HTML Report

Generate a self-contained HTML file. Save to: **audits/audit-YYYY-MM-DD.html** (today's date).
If a file with that name already exists, append a sequence number: audit-YYYY-MM-DD-2.html.
Create the audits/ directory if it does not exist.

The HTML file must be fully self-contained \u2014 all CSS inline in a <style> tag, no external dependencies.

### CSS Variables and Palette

Use these CSS custom properties:

:root {
  --bg: #f8fafc;
  --surface: #ffffff;
  --text-primary: #1e293b;
  --text-secondary: #64748b;
  --text-muted: #94a3b8;
  --border: #e2e8f0;
  --border-light: #f1f5f9;
  --critical: #dc2626;
  --critical-bg: #fef2f2;
  --critical-border: #fecaca;
  --warning: #f59e0b;
  --warning-bg: #fffbeb;
  --warning-border: #fde68a;
  --info: #3b82f6;
  --info-bg: #eff6ff;
  --info-border: #bfdbfe;
  --pass: #10b981;
  --pass-bg: #ecfdf5;
  --pass-border: #a7f3d0;
  --grade-a: #10b981;
  --grade-b: #3b82f6;
  --grade-c: #f59e0b;
  --grade-d: #f97316;
  --grade-f: #dc2626;
}

### Design Rules

- Font: system-ui, -apple-system, sans-serif. Monospace for data: ui-monospace, monospace.
- Max-width: 1100px, centered with auto margins, 32px padding.
- Cards: white bg, 1px solid var(--border), 8px radius, padding 20px-24px.
- Tables: full width, text-align left, alternating row colors (#f8fafc for even rows), 1px border-bottom on rows. Sticky thead with white bg.
- Score bars: 160px wide, 8px tall, rounded-full, grey background (#e2e8f0), colored fill proportional to score. Green (>=75), yellow (>=50), red (<50).
- Severity badges: inline-block, padding 2px 8px, border-radius 9999px, font-size 11px, font-weight 600, uppercase, letter-spacing 0.05em.
  - CRITICAL: bg var(--critical-bg), color var(--critical), border 1px solid var(--critical-border)
  - WARNING: bg var(--warning-bg), color var(--warning), border 1px solid var(--warning-border)
  - INFO: bg var(--info-bg), color var(--info), border 1px solid var(--info-border)
  - PASS: bg var(--pass-bg), color var(--pass), border 1px solid var(--pass-border)
- Grade circle: 80px x 80px, border-radius 50%, font-size 36px, font-weight 800, white text, background color from grade scale (--grade-a through --grade-f).
- Section headings: font-size 20px, font-weight 700, color var(--text-primary), margin-top 48px, margin-bottom 16px, with a small colored left border (4px, border-radius 2px).
- Collapsible details: use <details><summary> for per-component breakdowns so the report stays scannable.
- Print-friendly: @media print \u2014 remove shadows, use border-only cards, break-inside: avoid on cards.

### Report Sections (in order)

**1. HEADER**
- File name as h1
- Subtitle: "Design System Audit Report"
- Metadata row: date, page count, total component sets, total variants
- Grade circle (overall grade letter + numeric score below it)
- Two category score cards side by side: "Library Health" (T1 avg) and "Component Architecture" (T2 avg), each with its own score bar

**2. EXECUTIVE SUMMARY**
- Collect the top 8 most impactful findings across all rules, ordered by severity (critical > warning > info)
- Each finding: severity badge, one-line title, one-line description
- Severity assignment: score < 50 = CRITICAL, score 50-74 = WARNING, score >= 75 and has issues = INFO, score >= 90 with no issues = PASS (don't list PASS items here)

**3. SCORE BREAKDOWN**
- Two sub-sections: "Library Health" and "Component Architecture"
- Each rule shown as a row: rule number badge, rule name, score bar, numeric score
- Rules scoring < 50 get a red highlight row background

**4. T1: LIBRARY HEALTH DETAILS**
${r==="component-architecture"?"(Skip this section \u2014 T1 not in scope)":`
4a. Token Coverage: total variables, unaliased count, unaliased % \u2014 list unaliased variable names grouped by prefix
4b. Style Binding: total paint styles, unbound count, unbound % \u2014 list unbound style names grouped by prefix
4c. Component Census: table with columns Page | Sets | Variants | Ghosts \u2014 totals row
4d. Ghost Components: list each ghost with its name, parent type, and page
4e. Naming: show the dominant convention, list components that don't follow it
4f. Deprecated: list any deprecated sets still on active pages
4g. Duplicates: list any duplicate component set names`}

**5. T2: COMPONENT ARCHITECTURE DETAILS**
${r==="library-health"?"(Skip this section \u2014 T2 not in scope)":`
5a. System-wide summary table: all component sets with columns:
    Component | Props (B/T/I) | Variants (actual/expected) | Instance Ratio | Auto-Layout | Naming | Depth | Docs | Score
    Sort by score ascending (worst first). Color-code the score column.

5b. Per-component details (inside <details> tags so they're collapsible):
    For each component set (sorted worst-score first):
    - Component name as summary
    - Property definitions: table of property name, type, and notes
    - Variant axes: list each axis with its values
    - Variant completeness: expected vs actual, missing %
    - Decomposition: child type breakdown (INSTANCE: N, FRAME: N, TEXT: N, etc.), instance ratio
    - Auto-layout: root has auto-layout? child auto-layout coverage
    - Layer naming: default name count, examples
    - Depth: measured value
    - Documentation: description present/absent, description text if present
    - Specific findings/recommendations for this component`}

**6. CROSS-SYSTEM CONSISTENCY** (T2 scope only)
${r==="library-health"?"(Skip this section)":`
- For each common axis (Size, State, Style/Variant/Type):
  - Table showing all component sets that have this axis and their values
  - Highlight rows where values deviate from the majority`}

**7. RECOMMENDATIONS**
- Numbered list of prioritized action items (most impactful first)
- Each item: priority badge (P1/P2/P3), title, description, list of affected components
- P1 = critical (score < 50), P2 = warning (50-74), P3 = info (75+)

**8. FOOTER**
- "Generated by Figma MCP Bridge Audit" + timestamp
- Total MCP calls made (track this during data collection)

---

## Phase 4 \u2014 Output

1. Write the complete HTML to the audits/ directory using the Write tool
2. Tell the user: the file path, the overall grade, the T1 and T2 category scores, the top 3 findings, and the worst-scoring component
3. Suggest: "Open the HTML file in a browser for the full interactive report"`}}]}})}var ER=Number(process.env.FIGMA_BRIDGE_PORT)||3055;async function IR(){let t=new ia(ER);t.start();let e=new Fi({name:"outreach-figma-mcp-bridge",version:"1.0.0"},{instructions:`CRITICAL SETUP REQUIREMENT \u2014 READ BEFORE ANY OPERATION:

This MCP server requires workspace rules to be installed in the user's project.
These rules guide the AI on how to use the Figma design tools correctly, including
design system integration, spec workflows, and component building best practices.

Required files (must exist in the workspace):
  - .cursor/rules/design-system-config.mdc
  - .cursor/rules/figma-tool-usage-rules.mdc
  - .cursor/rules/interactive-specs.mdc

If you do NOT see these rules loaded in your context:
  1. DO NOT execute any design operations (build_from_spec, build_and_verify, etc.)
  2. Instead, tell the user:
     "The Figma MCP Bridge workspace rules are not installed in this project.
      Please run the setup script from your project directory:
        cd <your-project>
        node ~/outreach-figma-bridge/setup.js
      Then restart your editor."
  3. You may still use read-only inspection tools (scan_page, get_node_by_id, etc.)
     but do NOT create or modify designs without the rules.

BEFORE YOUR FIRST DESIGN OPERATION in each session:
  1. Call verify_workspace_setup to confirm the workspace rules are installed.
  2. Call check_health to confirm the Figma connection is live.
     - If check_health reports a problem, tell the user EXACTLY what it says
       and do NOT attempt any design operations until the issue is resolved.
     - Common issues: port conflict (another editor is using the port),
       no Figma plugin connected, server not running.`});jv(e,t),Dv(e);let r=new Ui;await e.connect(r);let n=()=>{t.stop(),process.exit(0)};process.on("SIGINT",n),process.on("SIGTERM",n)}IR().catch(t=>{process.stderr.write(`Fatal error: ${t}
`),process.exit(1)});
